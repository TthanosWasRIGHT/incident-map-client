(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const B of document.querySelectorAll('link[rel="modulepreload"]'))I(B);new MutationObserver(B=>{for(const H of B)if(H.type==="childList")for(const Q of H.addedNodes)Q.tagName==="LINK"&&Q.rel==="modulepreload"&&I(Q)}).observe(document,{childList:!0,subtree:!0});function T(B){const H={};return B.integrity&&(H.integrity=B.integrity),B.referrerPolicy&&(H.referrerPolicy=B.referrerPolicy),B.crossOrigin==="use-credentials"?H.credentials="include":B.crossOrigin==="anonymous"?H.credentials="omit":H.credentials="same-origin",H}function I(B){if(B.ep)return;B.ep=!0;const H=T(B);fetch(B.href,H)}})();function px(E){return E&&E.__esModule&&Object.prototype.hasOwnProperty.call(E,"default")?E.default:E}var D0={exports:{}},lg={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xw;function TA(){if(xw)return lg;xw=1;var E=Symbol.for("react.transitional.element"),m=Symbol.for("react.fragment");function T(I,B,H){var Q=null;if(H!==void 0&&(Q=""+H),B.key!==void 0&&(Q=""+B.key),"key"in B){H={};for(var o in B)o!=="key"&&(H[o]=B[o])}else H=B;return B=H.ref,{$$typeof:E,type:I,key:Q,ref:B!==void 0?B:null,props:H}}return lg.Fragment=m,lg.jsx=T,lg.jsxs=T,lg}var bw;function SA(){return bw||(bw=1,D0.exports=TA()),D0.exports}var Yo=SA(),z0={exports:{}},Fn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ww;function EA(){if(ww)return Fn;ww=1;var E=Symbol.for("react.transitional.element"),m=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),H=Symbol.for("react.consumer"),Q=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),xe=Symbol.for("react.suspense"),pe=Symbol.for("react.memo"),Ke=Symbol.for("react.lazy"),nt=Symbol.iterator;function Je(Le){return Le===null||typeof Le!="object"?null:(Le=nt&&Le[nt]||Le["@@iterator"],typeof Le=="function"?Le:null)}var Kt={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pi=Object.assign,Yt={};function Qi(Le,Bt,hi){this.props=Le,this.context=Bt,this.refs=Yt,this.updater=hi||Kt}Qi.prototype.isReactComponent={},Qi.prototype.setState=function(Le,Bt){if(typeof Le!="object"&&typeof Le!="function"&&Le!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Le,Bt,"setState")},Qi.prototype.forceUpdate=function(Le){this.updater.enqueueForceUpdate(this,Le,"forceUpdate")};function Ji(){}Ji.prototype=Qi.prototype;function Yn(Le,Bt,hi){this.props=Le,this.context=Bt,this.refs=Yt,this.updater=hi||Kt}var xn=Yn.prototype=new Ji;xn.constructor=Yn,pi(xn,Qi.prototype),xn.isPureReactComponent=!0;var Nr=Array.isArray,_n={H:null,A:null,T:null,S:null,V:null},Zr=Object.prototype.hasOwnProperty;function us(Le,Bt,hi,di,ki,Ci){return hi=Ci.ref,{$$typeof:E,type:Le,key:Bt,ref:hi!==void 0?hi:null,props:Ci}}function Kr(Le,Bt){return us(Le.type,Bt,void 0,void 0,void 0,Le.props)}function ns(Le){return typeof Le=="object"&&Le!==null&&Le.$$typeof===E}function rl(Le){var Bt={"=":"=0",":":"=2"};return"$"+Le.replace(/[=:]/g,function(hi){return Bt[hi]})}var ir=/\/+/g;function Ur(Le,Bt){return typeof Le=="object"&&Le!==null&&Le.key!=null?rl(""+Le.key):Bt.toString(36)}function Vr(){}function rn(Le){switch(Le.status){case"fulfilled":return Le.value;case"rejected":throw Le.reason;default:switch(typeof Le.status=="string"?Le.then(Vr,Vr):(Le.status="pending",Le.then(function(Bt){Le.status==="pending"&&(Le.status="fulfilled",Le.value=Bt)},function(Bt){Le.status==="pending"&&(Le.status="rejected",Le.reason=Bt)})),Le.status){case"fulfilled":return Le.value;case"rejected":throw Le.reason}}throw Le}function bn(Le,Bt,hi,di,ki){var Ci=typeof Le;(Ci==="undefined"||Ci==="boolean")&&(Le=null);var yi=!1;if(Le===null)yi=!0;else switch(Ci){case"bigint":case"string":case"number":yi=!0;break;case"object":switch(Le.$$typeof){case E:case m:yi=!0;break;case Ke:return yi=Le._init,bn(yi(Le._payload),Bt,hi,di,ki)}}if(yi)return ki=ki(Le),yi=di===""?"."+Ur(Le,0):di,Nr(ki)?(hi="",yi!=null&&(hi=yi.replace(ir,"$&/")+"/"),bn(ki,Bt,hi,"",function(cn){return cn})):ki!=null&&(ns(ki)&&(ki=Kr(ki,hi+(ki.key==null||Le&&Le.key===ki.key?"":(""+ki.key).replace(ir,"$&/")+"/")+yi)),Bt.push(ki)),1;yi=0;var nr=di===""?".":di+":";if(Nr(Le))for(var Hn=0;Hn<Le.length;Hn++)di=Le[Hn],Ci=nr+Ur(di,Hn),yi+=bn(di,Bt,hi,Ci,ki);else if(Hn=Je(Le),typeof Hn=="function")for(Le=Hn.call(Le),Hn=0;!(di=Le.next()).done;)di=di.value,Ci=nr+Ur(di,Hn++),yi+=bn(di,Bt,hi,Ci,ki);else if(Ci==="object"){if(typeof Le.then=="function")return bn(rn(Le),Bt,hi,di,ki);throw Bt=String(Le),Error("Objects are not valid as a React child (found: "+(Bt==="[object Object]"?"object with keys {"+Object.keys(Le).join(", ")+"}":Bt)+"). If you meant to render a collection of children, use an array instead.")}return yi}function wt(Le,Bt,hi){if(Le==null)return Le;var di=[],ki=0;return bn(Le,di,"","",function(Ci){return Bt.call(hi,Ci,ki++)}),di}function oi(Le){if(Le._status===-1){var Bt=Le._result;Bt=Bt(),Bt.then(function(hi){(Le._status===0||Le._status===-1)&&(Le._status=1,Le._result=hi)},function(hi){(Le._status===0||Le._status===-1)&&(Le._status=2,Le._result=hi)}),Le._status===-1&&(Le._status=0,Le._result=Bt)}if(Le._status===1)return Le._result.default;throw Le._result}var Oi=typeof reportError=="function"?reportError:function(Le){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Bt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Le=="object"&&Le!==null&&typeof Le.message=="string"?String(Le.message):String(Le),error:Le});if(!window.dispatchEvent(Bt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Le);return}console.error(Le)};function zn(){}return Fn.Children={map:wt,forEach:function(Le,Bt,hi){wt(Le,function(){Bt.apply(this,arguments)},hi)},count:function(Le){var Bt=0;return wt(Le,function(){Bt++}),Bt},toArray:function(Le){return wt(Le,function(Bt){return Bt})||[]},only:function(Le){if(!ns(Le))throw Error("React.Children.only expected to receive a single React element child.");return Le}},Fn.Component=Qi,Fn.Fragment=T,Fn.Profiler=B,Fn.PureComponent=Yn,Fn.StrictMode=I,Fn.Suspense=xe,Fn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_n,Fn.__COMPILER_RUNTIME={__proto__:null,c:function(Le){return _n.H.useMemoCache(Le)}},Fn.cache=function(Le){return function(){return Le.apply(null,arguments)}},Fn.cloneElement=function(Le,Bt,hi){if(Le==null)throw Error("The argument must be a React element, but you passed "+Le+".");var di=pi({},Le.props),ki=Le.key,Ci=void 0;if(Bt!=null)for(yi in Bt.ref!==void 0&&(Ci=void 0),Bt.key!==void 0&&(ki=""+Bt.key),Bt)!Zr.call(Bt,yi)||yi==="key"||yi==="__self"||yi==="__source"||yi==="ref"&&Bt.ref===void 0||(di[yi]=Bt[yi]);var yi=arguments.length-2;if(yi===1)di.children=hi;else if(1<yi){for(var nr=Array(yi),Hn=0;Hn<yi;Hn++)nr[Hn]=arguments[Hn+2];di.children=nr}return us(Le.type,ki,void 0,void 0,Ci,di)},Fn.createContext=function(Le){return Le={$$typeof:Q,_currentValue:Le,_currentValue2:Le,_threadCount:0,Provider:null,Consumer:null},Le.Provider=Le,Le.Consumer={$$typeof:H,_context:Le},Le},Fn.createElement=function(Le,Bt,hi){var di,ki={},Ci=null;if(Bt!=null)for(di in Bt.key!==void 0&&(Ci=""+Bt.key),Bt)Zr.call(Bt,di)&&di!=="key"&&di!=="__self"&&di!=="__source"&&(ki[di]=Bt[di]);var yi=arguments.length-2;if(yi===1)ki.children=hi;else if(1<yi){for(var nr=Array(yi),Hn=0;Hn<yi;Hn++)nr[Hn]=arguments[Hn+2];ki.children=nr}if(Le&&Le.defaultProps)for(di in yi=Le.defaultProps,yi)ki[di]===void 0&&(ki[di]=yi[di]);return us(Le,Ci,void 0,void 0,null,ki)},Fn.createRef=function(){return{current:null}},Fn.forwardRef=function(Le){return{$$typeof:o,render:Le}},Fn.isValidElement=ns,Fn.lazy=function(Le){return{$$typeof:Ke,_payload:{_status:-1,_result:Le},_init:oi}},Fn.memo=function(Le,Bt){return{$$typeof:pe,type:Le,compare:Bt===void 0?null:Bt}},Fn.startTransition=function(Le){var Bt=_n.T,hi={};_n.T=hi;try{var di=Le(),ki=_n.S;ki!==null&&ki(hi,di),typeof di=="object"&&di!==null&&typeof di.then=="function"&&di.then(zn,Oi)}catch(Ci){Oi(Ci)}finally{_n.T=Bt}},Fn.unstable_useCacheRefresh=function(){return _n.H.useCacheRefresh()},Fn.use=function(Le){return _n.H.use(Le)},Fn.useActionState=function(Le,Bt,hi){return _n.H.useActionState(Le,Bt,hi)},Fn.useCallback=function(Le,Bt){return _n.H.useCallback(Le,Bt)},Fn.useContext=function(Le){return _n.H.useContext(Le)},Fn.useDebugValue=function(){},Fn.useDeferredValue=function(Le,Bt){return _n.H.useDeferredValue(Le,Bt)},Fn.useEffect=function(Le,Bt,hi){var di=_n.H;if(typeof hi=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return di.useEffect(Le,Bt)},Fn.useId=function(){return _n.H.useId()},Fn.useImperativeHandle=function(Le,Bt,hi){return _n.H.useImperativeHandle(Le,Bt,hi)},Fn.useInsertionEffect=function(Le,Bt){return _n.H.useInsertionEffect(Le,Bt)},Fn.useLayoutEffect=function(Le,Bt){return _n.H.useLayoutEffect(Le,Bt)},Fn.useMemo=function(Le,Bt){return _n.H.useMemo(Le,Bt)},Fn.useOptimistic=function(Le,Bt){return _n.H.useOptimistic(Le,Bt)},Fn.useReducer=function(Le,Bt,hi){return _n.H.useReducer(Le,Bt,hi)},Fn.useRef=function(Le){return _n.H.useRef(Le)},Fn.useState=function(Le){return _n.H.useState(Le)},Fn.useSyncExternalStore=function(Le,Bt,hi){return _n.H.useSyncExternalStore(Le,Bt,hi)},Fn.useTransition=function(){return _n.H.useTransition()},Fn.version="19.1.0",Fn}var Tw;function mx(){return Tw||(Tw=1,z0.exports=EA()),z0.exports}var Yy=mx();const AA=px(Yy);var L0={exports:{}},cg={},P0={exports:{}},O0={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sw;function CA(){return Sw||(Sw=1,function(E){function m(wt,oi){var Oi=wt.length;wt.push(oi);e:for(;0<Oi;){var zn=Oi-1>>>1,Le=wt[zn];if(0<B(Le,oi))wt[zn]=oi,wt[Oi]=Le,Oi=zn;else break e}}function T(wt){return wt.length===0?null:wt[0]}function I(wt){if(wt.length===0)return null;var oi=wt[0],Oi=wt.pop();if(Oi!==oi){wt[0]=Oi;e:for(var zn=0,Le=wt.length,Bt=Le>>>1;zn<Bt;){var hi=2*(zn+1)-1,di=wt[hi],ki=hi+1,Ci=wt[ki];if(0>B(di,Oi))ki<Le&&0>B(Ci,di)?(wt[zn]=Ci,wt[ki]=Oi,zn=ki):(wt[zn]=di,wt[hi]=Oi,zn=hi);else if(ki<Le&&0>B(Ci,Oi))wt[zn]=Ci,wt[ki]=Oi,zn=ki;else break e}}return oi}function B(wt,oi){var Oi=wt.sortIndex-oi.sortIndex;return Oi!==0?Oi:wt.id-oi.id}if(E.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var H=performance;E.unstable_now=function(){return H.now()}}else{var Q=Date,o=Q.now();E.unstable_now=function(){return Q.now()-o}}var xe=[],pe=[],Ke=1,nt=null,Je=3,Kt=!1,pi=!1,Yt=!1,Qi=!1,Ji=typeof setTimeout=="function"?setTimeout:null,Yn=typeof clearTimeout=="function"?clearTimeout:null,xn=typeof setImmediate<"u"?setImmediate:null;function Nr(wt){for(var oi=T(pe);oi!==null;){if(oi.callback===null)I(pe);else if(oi.startTime<=wt)I(pe),oi.sortIndex=oi.expirationTime,m(xe,oi);else break;oi=T(pe)}}function _n(wt){if(Yt=!1,Nr(wt),!pi)if(T(xe)!==null)pi=!0,Zr||(Zr=!0,Ur());else{var oi=T(pe);oi!==null&&bn(_n,oi.startTime-wt)}}var Zr=!1,us=-1,Kr=5,ns=-1;function rl(){return Qi?!0:!(E.unstable_now()-ns<Kr)}function ir(){if(Qi=!1,Zr){var wt=E.unstable_now();ns=wt;var oi=!0;try{e:{pi=!1,Yt&&(Yt=!1,Yn(us),us=-1),Kt=!0;var Oi=Je;try{t:{for(Nr(wt),nt=T(xe);nt!==null&&!(nt.expirationTime>wt&&rl());){var zn=nt.callback;if(typeof zn=="function"){nt.callback=null,Je=nt.priorityLevel;var Le=zn(nt.expirationTime<=wt);if(wt=E.unstable_now(),typeof Le=="function"){nt.callback=Le,Nr(wt),oi=!0;break t}nt===T(xe)&&I(xe),Nr(wt)}else I(xe);nt=T(xe)}if(nt!==null)oi=!0;else{var Bt=T(pe);Bt!==null&&bn(_n,Bt.startTime-wt),oi=!1}}break e}finally{nt=null,Je=Oi,Kt=!1}oi=void 0}}finally{oi?Ur():Zr=!1}}}var Ur;if(typeof xn=="function")Ur=function(){xn(ir)};else if(typeof MessageChannel<"u"){var Vr=new MessageChannel,rn=Vr.port2;Vr.port1.onmessage=ir,Ur=function(){rn.postMessage(null)}}else Ur=function(){Ji(ir,0)};function bn(wt,oi){us=Ji(function(){wt(E.unstable_now())},oi)}E.unstable_IdlePriority=5,E.unstable_ImmediatePriority=1,E.unstable_LowPriority=4,E.unstable_NormalPriority=3,E.unstable_Profiling=null,E.unstable_UserBlockingPriority=2,E.unstable_cancelCallback=function(wt){wt.callback=null},E.unstable_forceFrameRate=function(wt){0>wt||125<wt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Kr=0<wt?Math.floor(1e3/wt):5},E.unstable_getCurrentPriorityLevel=function(){return Je},E.unstable_next=function(wt){switch(Je){case 1:case 2:case 3:var oi=3;break;default:oi=Je}var Oi=Je;Je=oi;try{return wt()}finally{Je=Oi}},E.unstable_requestPaint=function(){Qi=!0},E.unstable_runWithPriority=function(wt,oi){switch(wt){case 1:case 2:case 3:case 4:case 5:break;default:wt=3}var Oi=Je;Je=wt;try{return oi()}finally{Je=Oi}},E.unstable_scheduleCallback=function(wt,oi,Oi){var zn=E.unstable_now();switch(typeof Oi=="object"&&Oi!==null?(Oi=Oi.delay,Oi=typeof Oi=="number"&&0<Oi?zn+Oi:zn):Oi=zn,wt){case 1:var Le=-1;break;case 2:Le=250;break;case 5:Le=1073741823;break;case 4:Le=1e4;break;default:Le=5e3}return Le=Oi+Le,wt={id:Ke++,callback:oi,priorityLevel:wt,startTime:Oi,expirationTime:Le,sortIndex:-1},Oi>zn?(wt.sortIndex=Oi,m(pe,wt),T(xe)===null&&wt===T(pe)&&(Yt?(Yn(us),us=-1):Yt=!0,bn(_n,Oi-zn))):(wt.sortIndex=Le,m(xe,wt),pi||Kt||(pi=!0,Zr||(Zr=!0,Ur()))),wt},E.unstable_shouldYield=rl,E.unstable_wrapCallback=function(wt){var oi=Je;return function(){var Oi=Je;Je=oi;try{return wt.apply(this,arguments)}finally{Je=Oi}}}}(O0)),O0}var Ew;function IA(){return Ew||(Ew=1,P0.exports=CA()),P0.exports}var k0={exports:{}},$o={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Aw;function MA(){if(Aw)return $o;Aw=1;var E=mx();function m(xe){var pe="https://react.dev/errors/"+xe;if(1<arguments.length){pe+="?args[]="+encodeURIComponent(arguments[1]);for(var Ke=2;Ke<arguments.length;Ke++)pe+="&args[]="+encodeURIComponent(arguments[Ke])}return"Minified React error #"+xe+"; visit "+pe+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function T(){}var I={d:{f:T,r:function(){throw Error(m(522))},D:T,C:T,L:T,m:T,X:T,S:T,M:T},p:0,findDOMNode:null},B=Symbol.for("react.portal");function H(xe,pe,Ke){var nt=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:B,key:nt==null?null:""+nt,children:xe,containerInfo:pe,implementation:Ke}}var Q=E.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(xe,pe){if(xe==="font")return"";if(typeof pe=="string")return pe==="use-credentials"?pe:""}return $o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,$o.createPortal=function(xe,pe){var Ke=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!pe||pe.nodeType!==1&&pe.nodeType!==9&&pe.nodeType!==11)throw Error(m(299));return H(xe,pe,null,Ke)},$o.flushSync=function(xe){var pe=Q.T,Ke=I.p;try{if(Q.T=null,I.p=2,xe)return xe()}finally{Q.T=pe,I.p=Ke,I.d.f()}},$o.preconnect=function(xe,pe){typeof xe=="string"&&(pe?(pe=pe.crossOrigin,pe=typeof pe=="string"?pe==="use-credentials"?pe:"":void 0):pe=null,I.d.C(xe,pe))},$o.prefetchDNS=function(xe){typeof xe=="string"&&I.d.D(xe)},$o.preinit=function(xe,pe){if(typeof xe=="string"&&pe&&typeof pe.as=="string"){var Ke=pe.as,nt=o(Ke,pe.crossOrigin),Je=typeof pe.integrity=="string"?pe.integrity:void 0,Kt=typeof pe.fetchPriority=="string"?pe.fetchPriority:void 0;Ke==="style"?I.d.S(xe,typeof pe.precedence=="string"?pe.precedence:void 0,{crossOrigin:nt,integrity:Je,fetchPriority:Kt}):Ke==="script"&&I.d.X(xe,{crossOrigin:nt,integrity:Je,fetchPriority:Kt,nonce:typeof pe.nonce=="string"?pe.nonce:void 0})}},$o.preinitModule=function(xe,pe){if(typeof xe=="string")if(typeof pe=="object"&&pe!==null){if(pe.as==null||pe.as==="script"){var Ke=o(pe.as,pe.crossOrigin);I.d.M(xe,{crossOrigin:Ke,integrity:typeof pe.integrity=="string"?pe.integrity:void 0,nonce:typeof pe.nonce=="string"?pe.nonce:void 0})}}else pe==null&&I.d.M(xe)},$o.preload=function(xe,pe){if(typeof xe=="string"&&typeof pe=="object"&&pe!==null&&typeof pe.as=="string"){var Ke=pe.as,nt=o(Ke,pe.crossOrigin);I.d.L(xe,Ke,{crossOrigin:nt,integrity:typeof pe.integrity=="string"?pe.integrity:void 0,nonce:typeof pe.nonce=="string"?pe.nonce:void 0,type:typeof pe.type=="string"?pe.type:void 0,fetchPriority:typeof pe.fetchPriority=="string"?pe.fetchPriority:void 0,referrerPolicy:typeof pe.referrerPolicy=="string"?pe.referrerPolicy:void 0,imageSrcSet:typeof pe.imageSrcSet=="string"?pe.imageSrcSet:void 0,imageSizes:typeof pe.imageSizes=="string"?pe.imageSizes:void 0,media:typeof pe.media=="string"?pe.media:void 0})}},$o.preloadModule=function(xe,pe){if(typeof xe=="string")if(pe){var Ke=o(pe.as,pe.crossOrigin);I.d.m(xe,{as:typeof pe.as=="string"&&pe.as!=="script"?pe.as:void 0,crossOrigin:Ke,integrity:typeof pe.integrity=="string"?pe.integrity:void 0})}else I.d.m(xe)},$o.requestFormReset=function(xe){I.d.r(xe)},$o.unstable_batchedUpdates=function(xe,pe){return xe(pe)},$o.useFormState=function(xe,pe,Ke){return Q.H.useFormState(xe,pe,Ke)},$o.useFormStatus=function(){return Q.H.useHostTransitionStatus()},$o.version="19.1.0",$o}var Cw;function RA(){if(Cw)return k0.exports;Cw=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(m){console.error(m)}}return E(),k0.exports=MA(),k0.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Iw;function DA(){if(Iw)return cg;Iw=1;var E=IA(),m=mx(),T=RA();function I(a){var h="https://react.dev/errors/"+a;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+a+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function B(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function H(a){var h=a,y=a;if(a.alternate)for(;h.return;)h=h.return;else{a=h;do h=a,(h.flags&4098)!==0&&(y=h.return),a=h.return;while(a)}return h.tag===3?y:null}function Q(a){if(a.tag===13){var h=a.memoizedState;if(h===null&&(a=a.alternate,a!==null&&(h=a.memoizedState)),h!==null)return h.dehydrated}return null}function o(a){if(H(a)!==a)throw Error(I(188))}function xe(a){var h=a.alternate;if(!h){if(h=H(a),h===null)throw Error(I(188));return h!==a?null:a}for(var y=a,S=h;;){var z=y.return;if(z===null)break;var U=z.alternate;if(U===null){if(S=z.return,S!==null){y=S;continue}break}if(z.child===U.child){for(U=z.child;U;){if(U===y)return o(z),a;if(U===S)return o(z),h;U=U.sibling}throw Error(I(188))}if(y.return!==S.return)y=z,S=U;else{for(var ie=!1,ge=z.child;ge;){if(ge===y){ie=!0,y=z,S=U;break}if(ge===S){ie=!0,S=z,y=U;break}ge=ge.sibling}if(!ie){for(ge=U.child;ge;){if(ge===y){ie=!0,y=U,S=z;break}if(ge===S){ie=!0,S=U,y=z;break}ge=ge.sibling}if(!ie)throw Error(I(189))}}if(y.alternate!==S)throw Error(I(190))}if(y.tag!==3)throw Error(I(188));return y.stateNode.current===y?a:h}function pe(a){var h=a.tag;if(h===5||h===26||h===27||h===6)return a;for(a=a.child;a!==null;){if(h=pe(a),h!==null)return h;a=a.sibling}return null}var Ke=Object.assign,nt=Symbol.for("react.element"),Je=Symbol.for("react.transitional.element"),Kt=Symbol.for("react.portal"),pi=Symbol.for("react.fragment"),Yt=Symbol.for("react.strict_mode"),Qi=Symbol.for("react.profiler"),Ji=Symbol.for("react.provider"),Yn=Symbol.for("react.consumer"),xn=Symbol.for("react.context"),Nr=Symbol.for("react.forward_ref"),_n=Symbol.for("react.suspense"),Zr=Symbol.for("react.suspense_list"),us=Symbol.for("react.memo"),Kr=Symbol.for("react.lazy"),ns=Symbol.for("react.activity"),rl=Symbol.for("react.memo_cache_sentinel"),ir=Symbol.iterator;function Ur(a){return a===null||typeof a!="object"?null:(a=ir&&a[ir]||a["@@iterator"],typeof a=="function"?a:null)}var Vr=Symbol.for("react.client.reference");function rn(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===Vr?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case pi:return"Fragment";case Qi:return"Profiler";case Yt:return"StrictMode";case _n:return"Suspense";case Zr:return"SuspenseList";case ns:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case Kt:return"Portal";case xn:return(a.displayName||"Context")+".Provider";case Yn:return(a._context.displayName||"Context")+".Consumer";case Nr:var h=a.render;return a=a.displayName,a||(a=h.displayName||h.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case us:return h=a.displayName||null,h!==null?h:rn(a.type)||"Memo";case Kr:h=a._payload,a=a._init;try{return rn(a(h))}catch{}}return null}var bn=Array.isArray,wt=m.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oi=T.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Oi={pending:!1,data:null,method:null,action:null},zn=[],Le=-1;function Bt(a){return{current:a}}function hi(a){0>Le||(a.current=zn[Le],zn[Le]=null,Le--)}function di(a,h){Le++,zn[Le]=a.current,a.current=h}var ki=Bt(null),Ci=Bt(null),yi=Bt(null),nr=Bt(null);function Hn(a,h){switch(di(yi,h),di(Ci,a),di(ki,null),h.nodeType){case 9:case 11:a=(a=h.documentElement)&&(a=a.namespaceURI)?$g(a):0;break;default:if(a=h.tagName,h=h.namespaceURI)h=$g(h),a=Yg(h,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}hi(ki),di(ki,a)}function cn(){hi(ki),hi(Ci),hi(yi)}function Bl(a){a.memoizedState!==null&&di(nr,a);var h=ki.current,y=Yg(h,a.type);h!==y&&(di(Ci,a),di(ki,y))}function Ao(a){Ci.current===a&&(hi(ki),hi(Ci)),nr.current===a&&(hi(nr),If._currentValue=Oi)}var _o=Object.prototype.hasOwnProperty,vr=E.unstable_scheduleCallback,Fl=E.unstable_cancelCallback,Nl=E.unstable_shouldYield,Ls=E.unstable_requestPaint,Ps=E.unstable_now,bh=E.unstable_getCurrentPriorityLevel,ys=E.unstable_ImmediatePriority,Hs=E.unstable_UserBlockingPriority,Jo=E.unstable_NormalPriority,Ul=E.unstable_LowPriority,sl=E.unstable_IdlePriority,Os=E.log,yu=E.unstable_setDisableYieldValue,ba=null,Ar=null;function Co(a){if(typeof Os=="function"&&yu(a),Ar&&typeof Ar.setStrictMode=="function")try{Ar.setStrictMode(ba,a)}catch{}}var Xr=Math.clz32?Math.clz32:Io,vu=Math.log,vs=Math.LN2;function Io(a){return a>>>=0,a===0?32:31-(vu(a)/vs|0)|0}var wa=256,ea=4194304;function go(a){var h=a&42;if(h!==0)return h;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function ta(a,h,y){var S=a.pendingLanes;if(S===0)return 0;var z=0,U=a.suspendedLanes,ie=a.pingedLanes;a=a.warmLanes;var ge=S&134217727;return ge!==0?(S=ge&~U,S!==0?z=go(S):(ie&=ge,ie!==0?z=go(ie):y||(y=ge&~a,y!==0&&(z=go(y))))):(ge=S&~U,ge!==0?z=go(ge):ie!==0?z=go(ie):y||(y=S&~a,y!==0&&(z=go(y)))),z===0?0:h!==0&&h!==z&&(h&U)===0&&(U=z&-z,y=h&-h,U>=y||U===32&&(y&4194048)!==0)?h:z}function Ta(a,h){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&h)===0}function qn(a,h){switch(a){case 1:case 2:case 4:case 8:case 64:return h+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ol(){var a=wa;return wa<<=1,(wa&4194048)===0&&(wa=256),a}function Tc(){var a=ea;return ea<<=1,(ea&62914560)===0&&(ea=4194304),a}function ks(a){for(var h=[],y=0;31>y;y++)h.push(a);return h}function Sc(a,h){a.pendingLanes|=h,h!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Pd(a,h,y,S,z,U){var ie=a.pendingLanes;a.pendingLanes=y,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=y,a.entangledLanes&=y,a.errorRecoveryDisabledLanes&=y,a.shellSuspendCounter=0;var ge=a.entanglements,Pe=a.expirationTimes,lt=a.hiddenUpdates;for(y=ie&~y;0<y;){var Mt=31-Xr(y),Nt=1<<Mt;ge[Mt]=0,Pe[Mt]=-1;var ut=lt[Mt];if(ut!==null)for(lt[Mt]=null,Mt=0;Mt<ut.length;Mt++){var pt=ut[Mt];pt!==null&&(pt.lane&=-536870913)}y&=~Nt}S!==0&&Vl(a,S,0),U!==0&&z===0&&a.tag!==0&&(a.suspendedLanes|=U&~(ie&~h))}function Vl(a,h,y){a.pendingLanes|=h,a.suspendedLanes&=~h;var S=31-Xr(h);a.entangledLanes|=h,a.entanglements[S]=a.entanglements[S]|1073741824|y&4194090}function Tt(a,h){var y=a.entangledLanes|=h;for(a=a.entanglements;y;){var S=31-Xr(y),z=1<<S;z&h|a[S]&h&&(a[S]|=h),y&=~z}}function ia(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function wh(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function xu(){var a=oi.p;return a!==0?a:(a=window.event,a===void 0?32:kp(a.type))}function en(a,h){var y=oi.p;try{return oi.p=a,h()}finally{oi.p=y}}var Be=Math.random().toString(36).slice(2),W="__reactFiber$"+Be,K="__reactProps$"+Be,le="__reactContainer$"+Be,we="__reactEvents$"+Be,me="__reactListeners$"+Be,Ce="__reactHandles$"+Be,Oe="__reactResources$"+Be,Ae="__reactMarker$"+Be;function ke(a){delete a[W],delete a[K],delete a[we],delete a[me],delete a[Ce]}function Qe(a){var h=a[W];if(h)return h;for(var y=a.parentNode;y;){if(h=y[le]||y[W]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(a=Im(a);a!==null;){if(y=a[W])return y;a=Im(a)}return h}a=y,y=a.parentNode}return null}function Ne(a){if(a=a[W]||a[le]){var h=a.tag;if(h===5||h===6||h===13||h===26||h===27||h===3)return a}return null}function xt(a){var h=a.tag;if(h===5||h===26||h===27||h===6)return a.stateNode;throw Error(I(33))}function Ft(a){var h=a[Oe];return h||(h=a[Oe]={hoistableStyles:new Map,hoistableScripts:new Map}),h}function Rt(a){a[Ae]=!0}var ai=new Set,fi={};function ci(a,h){wi(a,h),wi(a+"Capture",h)}function wi(a,h){for(fi[a]=h,a=0;a<h.length;a++)ai.add(h[a])}var vi=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),gn={},Ln={};function Nn(a){return _o.call(Ln,a)?!0:_o.call(gn,a)?!1:vi.test(a)?Ln[a]=!0:(gn[a]=!0,!1)}function tn(a,h,y){if(Nn(h))if(y===null)a.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":a.removeAttribute(h);return;case"boolean":var S=h.toLowerCase().slice(0,5);if(S!=="data-"&&S!=="aria-"){a.removeAttribute(h);return}}a.setAttribute(h,""+y)}}function Xi(a,h,y){if(y===null)a.removeAttribute(h);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(h);return}a.setAttribute(h,""+y)}}function Mn(a,h,y,S){if(S===null)a.removeAttribute(y);else{switch(typeof S){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(y);return}a.setAttributeNS(h,y,""+S)}}var Kn,Qn;function Ir(a){if(Kn===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);Kn=h&&h[1]||"",Qn=-1<y.stack.indexOf(`
    at`)?" (<anonymous>)":-1<y.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Kn+a+Qn}var xs=!1;function rs(a,h){if(!a||xs)return"";xs=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var S={DetermineComponentFrameRoot:function(){try{if(h){var Nt=function(){throw Error()};if(Object.defineProperty(Nt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Nt,[])}catch(pt){var ut=pt}Reflect.construct(a,[],Nt)}else{try{Nt.call()}catch(pt){ut=pt}a.call(Nt.prototype)}}else{try{throw Error()}catch(pt){ut=pt}(Nt=a())&&typeof Nt.catch=="function"&&Nt.catch(function(){})}}catch(pt){if(pt&&ut&&typeof pt.stack=="string")return[pt.stack,ut.stack]}return[null,null]}};S.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var z=Object.getOwnPropertyDescriptor(S.DetermineComponentFrameRoot,"name");z&&z.configurable&&Object.defineProperty(S.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=S.DetermineComponentFrameRoot(),ie=U[0],ge=U[1];if(ie&&ge){var Pe=ie.split(`
`),lt=ge.split(`
`);for(z=S=0;S<Pe.length&&!Pe[S].includes("DetermineComponentFrameRoot");)S++;for(;z<lt.length&&!lt[z].includes("DetermineComponentFrameRoot");)z++;if(S===Pe.length||z===lt.length)for(S=Pe.length-1,z=lt.length-1;1<=S&&0<=z&&Pe[S]!==lt[z];)z--;for(;1<=S&&0<=z;S--,z--)if(Pe[S]!==lt[z]){if(S!==1||z!==1)do if(S--,z--,0>z||Pe[S]!==lt[z]){var Mt=`
`+Pe[S].replace(" at new "," at ");return a.displayName&&Mt.includes("<anonymous>")&&(Mt=Mt.replace("<anonymous>",a.displayName)),Mt}while(1<=S&&0<=z);break}}}finally{xs=!1,Error.prepareStackTrace=y}return(y=a?a.displayName||a.name:"")?Ir(y):""}function Th(a){switch(a.tag){case 26:case 27:case 5:return Ir(a.type);case 16:return Ir("Lazy");case 13:return Ir("Suspense");case 19:return Ir("SuspenseList");case 0:case 15:return rs(a.type,!1);case 11:return rs(a.type.render,!1);case 1:return rs(a.type,!0);case 31:return Ir("Activity");default:return""}}function Qr(a){try{var h="";do h+=Th(a),a=a.return;while(a);return h}catch(y){return`
Error generating stack: `+y.message+`
`+y.stack}}function ss(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Sh(a){var h=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Eh(a){var h=Sh(a)?"checked":"value",y=Object.getOwnPropertyDescriptor(a.constructor.prototype,h),S=""+a[h];if(!a.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var z=y.get,U=y.set;return Object.defineProperty(a,h,{configurable:!0,get:function(){return z.call(this)},set:function(ie){S=""+ie,U.call(this,ie)}}),Object.defineProperty(a,h,{enumerable:y.enumerable}),{getValue:function(){return S},setValue:function(ie){S=""+ie},stopTracking:function(){a._valueTracker=null,delete a[h]}}}}function jl(a){a._valueTracker||(a._valueTracker=Eh(a))}function Ah(a){if(!a)return!1;var h=a._valueTracker;if(!h)return!0;var y=h.getValue(),S="";return a&&(S=Sh(a)?a.checked?"true":"false":a.value),a=S,a!==y?(h.setValue(a),!0):!1}function Ec(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ac=/[\n"\\]/g;function Bs(a){return a.replace(Ac,function(h){return"\\"+h.charCodeAt(0).toString(16)+" "})}function bu(a,h,y,S,z,U,ie,ge){a.name="",ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"?a.type=ie:a.removeAttribute("type"),h!=null?ie==="number"?(h===0&&a.value===""||a.value!=h)&&(a.value=""+ss(h)):a.value!==""+ss(h)&&(a.value=""+ss(h)):ie!=="submit"&&ie!=="reset"||a.removeAttribute("value"),h!=null?qs(a,ie,ss(h)):y!=null?qs(a,ie,ss(y)):S!=null&&a.removeAttribute("value"),z==null&&U!=null&&(a.defaultChecked=!!U),z!=null&&(a.checked=z&&typeof z!="function"&&typeof z!="symbol"),ge!=null&&typeof ge!="function"&&typeof ge!="symbol"&&typeof ge!="boolean"?a.name=""+ss(ge):a.removeAttribute("name")}function Mo(a,h,y,S,z,U,ie,ge){if(U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(a.type=U),h!=null||y!=null){if(!(U!=="submit"&&U!=="reset"||h!=null))return;y=y!=null?""+ss(y):"",h=h!=null?""+ss(h):y,ge||h===a.value||(a.value=h),a.defaultValue=h}S=S??z,S=typeof S!="function"&&typeof S!="symbol"&&!!S,a.checked=ge?a.checked:!!S,a.defaultChecked=!!S,ie!=null&&typeof ie!="function"&&typeof ie!="symbol"&&typeof ie!="boolean"&&(a.name=ie)}function qs(a,h,y){h==="number"&&Ec(a.ownerDocument)===a||a.defaultValue===""+y||(a.defaultValue=""+y)}function bs(a,h,y,S){if(a=a.options,h){h={};for(var z=0;z<y.length;z++)h["$"+y[z]]=!0;for(y=0;y<a.length;y++)z=h.hasOwnProperty("$"+a[y].value),a[y].selected!==z&&(a[y].selected=z),z&&S&&(a[y].defaultSelected=!0)}else{for(y=""+ss(y),h=null,z=0;z<a.length;z++){if(a[z].value===y){a[z].selected=!0,S&&(a[z].defaultSelected=!0);return}h!==null||a[z].disabled||(h=a[z])}h!==null&&(h.selected=!0)}}function Sa(a,h,y){if(h!=null&&(h=""+ss(h),h!==a.value&&(a.value=h),y==null)){a.defaultValue!==h&&(a.defaultValue=h);return}a.defaultValue=y!=null?""+ss(y):""}function Ro(a,h,y,S){if(h==null){if(S!=null){if(y!=null)throw Error(I(92));if(bn(S)){if(1<S.length)throw Error(I(93));S=S[0]}y=S}y==null&&(y=""),h=y}y=ss(h),a.defaultValue=y,S=a.textContent,S===y&&S!==""&&S!==null&&(a.value=S)}function to(a,h){if(h){var y=a.firstChild;if(y&&y===a.lastChild&&y.nodeType===3){y.nodeValue=h;return}}a.textContent=h}var Ch=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function na(a,h,y){var S=h.indexOf("--")===0;y==null||typeof y=="boolean"||y===""?S?a.setProperty(h,""):h==="float"?a.cssFloat="":a[h]="":S?a.setProperty(h,y):typeof y!="number"||y===0||Ch.has(h)?h==="float"?a.cssFloat=y:a[h]=(""+y).trim():a[h]=y+"px"}function wu(a,h,y){if(h!=null&&typeof h!="object")throw Error(I(62));if(a=a.style,y!=null){for(var S in y)!y.hasOwnProperty(S)||h!=null&&h.hasOwnProperty(S)||(S.indexOf("--")===0?a.setProperty(S,""):S==="float"?a.cssFloat="":a[S]="");for(var z in h)S=h[z],h.hasOwnProperty(z)&&y[z]!==S&&na(a,z,S)}else for(var U in h)h.hasOwnProperty(U)&&na(a,U,h[U])}function al(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Tu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Gf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Su(a){return Gf.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var ws=null;function ll(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Ea=null,ra=null;function Hf(a){var h=Ne(a);if(h&&(a=h.stateNode)){var y=a[K]||null;e:switch(a=h.stateNode,h.type){case"input":if(bu(a,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name),h=y.name,y.type==="radio"&&h!=null){for(y=a;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll('input[name="'+Bs(""+h)+'"][type="radio"]'),h=0;h<y.length;h++){var S=y[h];if(S!==a&&S.form===a.form){var z=S[K]||null;if(!z)throw Error(I(90));bu(S,z.value,z.defaultValue,z.defaultValue,z.checked,z.defaultChecked,z.type,z.name)}}for(h=0;h<y.length;h++)S=y[h],S.form===a.form&&Ah(S)}break e;case"textarea":Sa(a,y.value,y.defaultValue);break e;case"select":h=y.value,h!=null&&bs(a,!!y.multiple,h,!1)}}}var Od=!1;function Eu(a,h,y){if(Od)return a(h,y);Od=!0;try{var S=a(h);return S}finally{if(Od=!1,(Ea!==null||ra!==null)&&(_c(),Ea&&(h=Ea,a=ra,ra=Ea=null,Hf(h),a)))for(h=0;h<a.length;h++)Hf(a[h])}}function ji(a,h){var y=a.stateNode;if(y===null)return null;var S=y[K]||null;if(S===null)return null;y=S[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(a=a.type,S=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!S;break e;default:a=!1}if(a)return null;if(y&&typeof y!="function")throw Error(I(231,h,typeof y));return y}var Do=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gl=!1;if(Do)try{var cl={};Object.defineProperty(cl,"passive",{get:function(){Gl=!0}}),window.addEventListener("test",cl,cl),window.removeEventListener("test",cl,cl)}catch{Gl=!1}var Hl=null,Cc=null,Aa=null;function ul(){if(Aa)return Aa;var a,h=Cc,y=h.length,S,z="value"in Hl?Hl.value:Hl.textContent,U=z.length;for(a=0;a<y&&h[a]===z[a];a++);var ie=y-a;for(S=1;S<=ie&&h[y-S]===z[U-S];S++);return Aa=z.slice(a,1<S?1-S:void 0)}function Au(a){var h=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&h===13&&(a=13)):a=h,a===10&&(a=13),32<=a||a===13?a:0}function Cu(){return!0}function ql(){return!1}function Zs(a){function h(y,S,z,U,ie){this._reactName=y,this._targetInst=z,this.type=S,this.nativeEvent=U,this.target=ie,this.currentTarget=null;for(var ge in a)a.hasOwnProperty(ge)&&(y=a[ge],this[ge]=y?y(U):U[ge]);return this.isDefaultPrevented=(U.defaultPrevented!=null?U.defaultPrevented:U.returnValue===!1)?Cu:ql,this.isPropagationStopped=ql,this}return Ke(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=Cu)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=Cu)},persist:function(){},isPersistent:Cu}),h}var Xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ic=Zs(Xs),Zl=Ke({},Xs,{view:0,detail:0}),sa=Zs(Zl),Mc,hl,Xl,Iu=Ke({},Zl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rh,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==Xl&&(Xl&&a.type==="mousemove"?(Mc=a.screenX-Xl.screenX,hl=a.screenY-Xl.screenY):hl=Mc=0,Xl=a),Mc)},movementY:function(a){return"movementY"in a?a.movementY:hl}}),Ih=Zs(Iu),Rc=Ke({},Iu,{dataTransfer:0}),io=Zs(Rc),qf=Ke({},Zl,{relatedTarget:0}),Wl=Zs(qf),Dc=Ke({},Xs,{animationName:0,elapsedTime:0,pseudoElement:0}),sn=Zs(Dc),oa=Ke({},Xs,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),c_=Zs(oa),Zf=Ke({},Xs,{data:0}),ei=Zs(Zf),kd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mh={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function yo(a){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(a):(a=zc[a])?!!h[a]:!1}function Rh(){return yo}var Mu=Ke({},Zl,{key:function(a){if(a.key){var h=kd[a.key]||a.key;if(h!=="Unidentified")return h}return a.type==="keypress"?(a=Au(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Mh[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rh,charCode:function(a){return a.type==="keypress"?Au(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?Au(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Wt=Zs(Mu),un=Ke({},Iu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nn=Zs(un),no=Ke({},Zl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rh}),dl=Zs(no),on=Ke({},Xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),Bd=Zs(on),Dh=Ke({},Iu,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),zh=Zs(Dh),Fs=Ke({},Xs,{newState:0,oldState:0}),Rr=Zs(Fs),u_=[9,13,27,32],$l=Do&&"CompositionEvent"in window,zo=null;Do&&"documentMode"in document&&(zo=document.documentMode);var Lh=Do&&"TextEvent"in window&&!zo,Ph=Do&&(!$l||zo&&8<zo&&11>=zo),Ru=" ",Oh=!1;function Ts(a,h){switch(a){case"keyup":return u_.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ca(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var Jr=!1;function Lc(a,h){switch(a){case"compositionend":return Ca(h);case"keypress":return h.which!==32?null:(Oh=!0,Ru);case"textInput":return a=h.data,a===Ru&&Oh?null:a;default:return null}}function Ii(a,h){if(Jr)return a==="compositionend"||!$l&&Ts(a,h)?(a=ul(),Aa=Cc=Hl=null,Jr=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Ph&&h.locale!=="ko"?null:h.data;default:return null}}var kt={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function vo(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h==="input"?!!kt[a.type]:h==="textarea"}function li(a,h,y,S){Ea?ra?ra.push(S):ra=[S]:Ea=S,h=Tf(h,"onChange"),0<h.length&&(y=new Ic("onChange","change",null,y,S),a.push({event:y,listeners:h}))}var mr=null,fl=null;function Jt(a){qg(a,0)}function pl(a){var h=xt(a);if(Ah(h))return a}function Pc(a,h){if(a==="change")return h}var ml=!1;if(Do){var Fd;if(Do){var ro="oninput"in document;if(!ro){var Ss=document.createElement("div");Ss.setAttribute("oninput","return;"),ro=typeof Ss.oninput=="function"}Fd=ro}else Fd=!1;ml=Fd&&(!document.documentMode||9<document.documentMode)}function Du(){mr&&(mr.detachEvent("onpropertychange",Wr),fl=mr=null)}function Wr(a){if(a.propertyName==="value"&&pl(fl)){var h=[];li(h,fl,a,ll(a)),Eu(Jt,h)}}function Xf(a,h,y){a==="focusin"?(Du(),mr=h,fl=y,mr.attachEvent("onpropertychange",Wr)):a==="focusout"&&Du()}function Ia(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return pl(fl)}function Es(a,h){if(a==="click")return pl(h)}function kh(a,h){if(a==="input"||a==="change")return pl(h)}function h_(a,h){return a===h&&(a!==0||1/a===1/h)||a!==a&&h!==h}var xo=typeof Object.is=="function"?Object.is:h_;function Lo(a,h){if(xo(a,h))return!0;if(typeof a!="object"||a===null||typeof h!="object"||h===null)return!1;var y=Object.keys(a),S=Object.keys(h);if(y.length!==S.length)return!1;for(S=0;S<y.length;S++){var z=y[S];if(!_o.call(h,z)||!xo(a[z],h[z]))return!1}return!0}function Oc(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Yl(a,h){var y=Oc(a);a=0;for(var S;y;){if(y.nodeType===3){if(S=a+y.textContent.length,a<=h&&S>=h)return{node:y,offset:h-a};a=S}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=Oc(y)}}function kc(a,h){return a&&h?a===h?!0:a&&a.nodeType===3?!1:h&&h.nodeType===3?kc(a,h.parentNode):"contains"in a?a.contains(h):a.compareDocumentPosition?!!(a.compareDocumentPosition(h)&16):!1:!1}function Wf(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var h=Ec(a.document);h instanceof a.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)a=h.contentWindow;else break;h=Ec(a.document)}return h}function zu(a){var h=a&&a.nodeName&&a.nodeName.toLowerCase();return h&&(h==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||h==="textarea"||a.contentEditable==="true")}var $f=Do&&"documentMode"in document&&11>=document.documentMode,so=null,Yf=null,Bh=null,Nd=!1;function Kf(a,h,y){var S=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Nd||so==null||so!==Ec(S)||(S=so,"selectionStart"in S&&zu(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),Bh&&Lo(Bh,S)||(Bh=S,S=Tf(Yf,"onSelect"),0<S.length&&(h=new Ic("onSelect","select",null,h,y),a.push({event:h,listeners:S}),h.target=so)))}function bo(a,h){var y={};return y[a.toLowerCase()]=h.toLowerCase(),y["Webkit"+a]="webkit"+h,y["Moz"+a]="moz"+h,y}var Kl={animationend:bo("Animation","AnimationEnd"),animationiteration:bo("Animation","AnimationIteration"),animationstart:bo("Animation","AnimationStart"),transitionrun:bo("Transition","TransitionRun"),transitionstart:bo("Transition","TransitionStart"),transitioncancel:bo("Transition","TransitionCancel"),transitionend:bo("Transition","TransitionEnd")},Ud={},Fh={};Do&&(Fh=document.createElement("div").style,"AnimationEvent"in window||(delete Kl.animationend.animation,delete Kl.animationiteration.animation,delete Kl.animationstart.animation),"TransitionEvent"in window||delete Kl.transitionend.transition);function _l(a){if(Ud[a])return Ud[a];if(!Kl[a])return a;var h=Kl[a],y;for(y in h)if(h.hasOwnProperty(y)&&y in Fh)return Ud[a]=h[y];return a}var Vd=_l("animationend"),hs=_l("animationiteration"),Lu=_l("animationstart"),Qf=_l("transitionrun"),Jf=_l("transitionstart"),Pu=_l("transitioncancel"),Bc=_l("transitionend"),jd=new Map,Ou="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Ou.push("scrollEnd");function Lr(a,h){jd.set(a,h),ci(h,[a])}var Nh=new WeakMap;function vt(a,h){if(typeof a=="object"&&a!==null){var y=Nh.get(a);return y!==void 0?y:(h={value:a,source:h,stack:Qr(h)},Nh.set(a,h),h)}return{value:a,source:h,stack:Qr(h)}}var oo=[],aa=0,Ql=0;function Jl(){for(var a=aa,h=Ql=aa=0;h<a;){var y=oo[h];oo[h++]=null;var S=oo[h];oo[h++]=null;var z=oo[h];oo[h++]=null;var U=oo[h];if(oo[h++]=null,S!==null&&z!==null){var ie=S.pending;ie===null?z.next=z:(z.next=ie.next,ie.next=z),S.pending=z}U!==0&&wo(y,z,U)}}function ec(a,h,y,S){oo[aa++]=a,oo[aa++]=h,oo[aa++]=y,oo[aa++]=S,Ql|=S,a.lanes|=S,a=a.alternate,a!==null&&(a.lanes|=S)}function Po(a,h,y,S){return ec(a,h,y,S),Li(a)}function gl(a,h){return ec(a,null,null,h),Li(a)}function wo(a,h,y){a.lanes|=y;var S=a.alternate;S!==null&&(S.lanes|=y);for(var z=!1,U=a.return;U!==null;)U.childLanes|=y,S=U.alternate,S!==null&&(S.childLanes|=y),U.tag===22&&(a=U.stateNode,a===null||a._visibility&1||(z=!0)),a=U,U=U.return;return a.tag===3?(U=a.stateNode,z&&h!==null&&(z=31-Xr(y),a=U.hiddenUpdates,S=a[z],S===null?a[z]=[h]:S.push(h),h.lane=y|536870912),U):null}function Li(a){if(50<Us)throw Us=0,Is=null,Error(I(185));for(var h=a.return;h!==null;)a=h,h=a.return;return a.tag===3?a.stateNode:null}var la={};function d_(a,h,y,S){this.tag=a,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function To(a,h,y,S){return new d_(a,h,y,S)}function ku(a){return a=a.prototype,!(!a||!a.isReactComponent)}function yl(a,h){var y=a.alternate;return y===null?(y=To(a.tag,h,a.key,a.mode),y.elementType=a.elementType,y.type=a.type,y.stateNode=a.stateNode,y.alternate=a,a.alternate=y):(y.pendingProps=h,y.type=a.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=a.flags&65011712,y.childLanes=a.childLanes,y.lanes=a.lanes,y.child=a.child,y.memoizedProps=a.memoizedProps,y.memoizedState=a.memoizedState,y.updateQueue=a.updateQueue,h=a.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=a.sibling,y.index=a.index,y.ref=a.ref,y.refCleanup=a.refCleanup,y}function Jn(a,h){a.flags&=65011714;var y=a.alternate;return y===null?(a.childLanes=0,a.lanes=h,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=y.childLanes,a.lanes=y.lanes,a.child=y.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=y.memoizedProps,a.memoizedState=y.memoizedState,a.updateQueue=y.updateQueue,a.type=y.type,h=y.dependencies,a.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),a}function Uh(a,h,y,S,z,U){var ie=0;if(S=a,typeof a=="function")ku(a)&&(ie=1);else if(typeof a=="string")ie=Ov(a,y,ki.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case ns:return a=To(31,y,h,z),a.elementType=ns,a.lanes=U,a;case pi:return vl(y.children,z,U,h);case Yt:ie=8,z|=24;break;case Qi:return a=To(12,y,h,z|2),a.elementType=Qi,a.lanes=U,a;case _n:return a=To(13,y,h,z),a.elementType=_n,a.lanes=U,a;case Zr:return a=To(19,y,h,z),a.elementType=Zr,a.lanes=U,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case Ji:case xn:ie=10;break e;case Yn:ie=9;break e;case Nr:ie=11;break e;case us:ie=14;break e;case Kr:ie=16,S=null;break e}ie=29,y=Error(I(130,a===null?"null":typeof a,"")),S=null}return h=To(ie,y,h,z),h.elementType=a,h.type=S,h.lanes=U,h}function vl(a,h,y,S){return a=To(7,a,S,h),a.lanes=y,a}function ep(a,h,y){return a=To(6,a,null,h),a.lanes=y,a}function tp(a,h,y){return h=To(4,a.children!==null?a.children:[],a.key,h),h.lanes=y,h.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},h}var Bu=[],Fu=0,Vh=null,Gd=0,Ws=[],Oo=0,tc=null,ca=1,ko="";function xl(a,h){Bu[Fu++]=Gd,Bu[Fu++]=Vh,Vh=a,Gd=h}function ic(a,h,y){Ws[Oo++]=ca,Ws[Oo++]=ko,Ws[Oo++]=tc,tc=a;var S=ca;a=ko;var z=32-Xr(S)-1;S&=~(1<<z),y+=1;var U=32-Xr(h)+z;if(30<U){var ie=z-z%5;U=(S&(1<<ie)-1).toString(32),S>>=ie,z-=ie,ca=1<<32-Xr(h)+z|y<<z|S,ko=U+a}else ca=1<<U|y<<z|S,ko=a}function nc(a){a.return!==null&&(xl(a,1),ic(a,1,0))}function Nu(a){for(;a===Vh;)Vh=Bu[--Fu],Bu[Fu]=null,Gd=Bu[--Fu],Bu[Fu]=null;for(;a===tc;)tc=Ws[--Oo],Ws[Oo]=null,ko=Ws[--Oo],Ws[Oo]=null,ca=Ws[--Oo],Ws[Oo]=null}var ds=null,Tr=null,cr=!1,bl=null,ua=!1,rc=Error(I(519));function Ma(a){var h=Error(I(418,""));throw Uu(vt(h,a)),rc}function jh(a){var h=a.stateNode,y=a.type,S=a.memoizedProps;switch(h[W]=a,h[K]=S,y){case"dialog":Un("cancel",h),Un("close",h);break;case"iframe":case"object":case"embed":Un("load",h);break;case"video":case"audio":for(y=0;y<bf.length;y++)Un(bf[y],h);break;case"source":Un("error",h);break;case"img":case"image":case"link":Un("error",h),Un("load",h);break;case"details":Un("toggle",h);break;case"input":Un("invalid",h),Mo(h,S.value,S.defaultValue,S.checked,S.defaultChecked,S.type,S.name,!0),jl(h);break;case"select":Un("invalid",h);break;case"textarea":Un("invalid",h),Ro(h,S.value,S.defaultValue,S.children),jl(h)}y=S.children,typeof y!="string"&&typeof y!="number"&&typeof y!="bigint"||h.textContent===""+y||S.suppressHydrationWarning===!0||Wg(h.textContent,y)?(S.popover!=null&&(Un("beforetoggle",h),Un("toggle",h)),S.onScroll!=null&&Un("scroll",h),S.onScrollEnd!=null&&Un("scrollend",h),S.onClick!=null&&(h.onclick=wm),h=!0):h=!1,h||Ma(a)}function Hd(a){for(ds=a.return;ds;)switch(ds.tag){case 5:case 13:ua=!1;return;case 27:case 3:ua=!0;return;default:ds=ds.return}}function sc(a){if(a!==ds)return!1;if(!cr)return Hd(a),cr=!0,!1;var h=a.tag,y;if((y=h!==3&&h!==27)&&((y=h===5)&&(y=a.type,y=!(y!=="form"&&y!=="button")||C_(a.type,a.memoizedProps)),y=!y),y&&Tr&&Ma(a),Hd(a),h===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(I(317));e:{for(a=a.nextSibling,h=0;a;){if(a.nodeType===8)if(y=a.data,y==="/$"){if(h===0){Tr=el(a.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++;a=a.nextSibling}Tr=null}}else h===27?(h=Tr,br(a.type)?(a=wd,wd=null,Tr=a):Tr=h):Tr=ds?el(a.stateNode.nextSibling):null;return!0}function wl(){Tr=ds=null,cr=!1}function ip(){var a=bl;return a!==null&&(Tn===null?Tn=a:Tn.push.apply(Tn,a),bl=null),a}function Uu(a){bl===null?bl=[a]:bl.push(a)}var qd=Bt(null),ao=null,Ra=null;function Tl(a,h,y){di(qd,h._currentValue),h._currentValue=y}function Sl(a){a._currentValue=qd.current,hi(qd)}function np(a,h,y){for(;a!==null;){var S=a.alternate;if((a.childLanes&h)!==h?(a.childLanes|=h,S!==null&&(S.childLanes|=h)):S!==null&&(S.childLanes&h)!==h&&(S.childLanes|=h),a===y)break;a=a.return}}function Gh(a,h,y,S){var z=a.child;for(z!==null&&(z.return=a);z!==null;){var U=z.dependencies;if(U!==null){var ie=z.child;U=U.firstContext;e:for(;U!==null;){var ge=U;U=z;for(var Pe=0;Pe<h.length;Pe++)if(ge.context===h[Pe]){U.lanes|=y,ge=U.alternate,ge!==null&&(ge.lanes|=y),np(U.return,y,a),S||(ie=null);break e}U=ge.next}}else if(z.tag===18){if(ie=z.return,ie===null)throw Error(I(341));ie.lanes|=y,U=ie.alternate,U!==null&&(U.lanes|=y),np(ie,y,a),ie=null}else ie=z.child;if(ie!==null)ie.return=z;else for(ie=z;ie!==null;){if(ie===a){ie=null;break}if(z=ie.sibling,z!==null){z.return=ie.return,ie=z;break}ie=ie.return}z=ie}}function oc(a,h,y,S){a=null;for(var z=h,U=!1;z!==null;){if(!U){if((z.flags&524288)!==0)U=!0;else if((z.flags&262144)!==0)break}if(z.tag===10){var ie=z.alternate;if(ie===null)throw Error(I(387));if(ie=ie.memoizedProps,ie!==null){var ge=z.type;xo(z.pendingProps.value,ie.value)||(a!==null?a.push(ge):a=[ge])}}else if(z===nr.current){if(ie=z.alternate,ie===null)throw Error(I(387));ie.memoizedState.memoizedState!==z.memoizedState.memoizedState&&(a!==null?a.push(If):a=[If])}z=z.return}a!==null&&Gh(h,a,y,S),h.flags|=262144}function Fc(a){for(a=a.firstContext;a!==null;){if(!xo(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function lo(a){ao=a,Ra=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function fs(a){return rm(ao,a)}function Vu(a,h){return ao===null&&lo(a),rm(a,h)}function rm(a,h){var y=h._currentValue;if(h={context:h,memoizedValue:y,next:null},Ra===null){if(a===null)throw Error(I(308));Ra=h,a.dependencies={lanes:0,firstContext:h},a.flags|=524288}else Ra=Ra.next=h;return y}var Nc=typeof AbortController<"u"?AbortController:function(){var a=[],h=this.signal={aborted:!1,addEventListener:function(y,S){a.push(S)}};this.abort=function(){h.aborted=!0,a.forEach(function(y){return y()})}},Uc=E.unstable_scheduleCallback,sm=E.unstable_NormalPriority,hr={$$typeof:xn,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function ju(){return{controller:new Nc,data:new Map,refCount:0}}function El(a){a.refCount--,a.refCount===0&&Uc(sm,function(){a.controller.abort()})}var ac=null,Hh=0,lc=0,Al=null;function qh(a,h){if(ac===null){var y=ac=[];Hh=0,lc=Ip(),Al={status:"pending",value:void 0,then:function(S){y.push(S)}}}return Hh++,h.then(Vc,Vc),h}function Vc(){if(--Hh===0&&ac!==null){Al!==null&&(Al.status="fulfilled");var a=ac;ac=null,lc=0,Al=null;for(var h=0;h<a.length;h++)(0,a[h])()}}function rp(a,h){var y=[],S={status:"pending",value:null,reason:null,then:function(z){y.push(z)}};return a.then(function(){S.status="fulfilled",S.value=h;for(var z=0;z<y.length;z++)(0,y[z])(h)},function(z){for(S.status="rejected",S.reason=z,z=0;z<y.length;z++)(0,y[z])(void 0)}),S}var Gu=wt.S;wt.S=function(a,h){typeof h=="object"&&h!==null&&typeof h.then=="function"&&qh(a,h),Gu!==null&&Gu(a,h)};var cc=Bt(null);function Zd(){var a=cc.current;return a!==null?a:qt.pooledCache}function Da(a,h){h===null?di(cc,cc.current):di(cc,h.pool)}function sp(){var a=Zd();return a===null?null:{parent:hr._currentValue,pool:a}}var Zh=Error(I(460)),om=Error(I(474)),Xd=Error(I(542)),Hu={then:function(){}};function am(a){return a=a.status,a==="fulfilled"||a==="rejected"}function jc(){}function Wd(a,h,y){switch(y=a[y],y===void 0?a.push(h):y!==h&&(h.then(jc,jc),h=y),h.status){case"fulfilled":return h.value;case"rejected":throw a=h.reason,$d(a),a;default:if(typeof h.status=="string")h.then(jc,jc);else{if(a=qt,a!==null&&100<a.shellSuspendCounter)throw Error(I(482));a=h,a.status="pending",a.then(function(S){if(h.status==="pending"){var z=h;z.status="fulfilled",z.value=S}},function(S){if(h.status==="pending"){var z=h;z.status="rejected",z.reason=S}})}switch(h.status){case"fulfilled":return h.value;case"rejected":throw a=h.reason,$d(a),a}throw qu=h,Zh}}var qu=null;function uc(){if(qu===null)throw Error(I(459));var a=qu;return qu=null,a}function $d(a){if(a===Zh||a===Xd)throw Error(I(483))}var za=!1;function Yd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function La(a,h){a=a.updateQueue,h.updateQueue===a&&(h.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function co(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function Cl(a,h,y){var S=a.updateQueue;if(S===null)return null;if(S=S.shared,(Lt&2)!==0){var z=S.pending;return z===null?h.next=h:(h.next=z.next,z.next=h),S.pending=h,h=Li(a),wo(a,null,y),h}return ec(a,S,h,y),Li(a)}function Bo(a,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194048)!==0)){var S=h.lanes;S&=a.pendingLanes,y|=S,h.lanes=y,Tt(a,y)}}function Zu(a,h){var y=a.updateQueue,S=a.alternate;if(S!==null&&(S=S.updateQueue,y===S)){var z=null,U=null;if(y=y.firstBaseUpdate,y!==null){do{var ie={lane:y.lane,tag:y.tag,payload:y.payload,callback:null,next:null};U===null?z=U=ie:U=U.next=ie,y=y.next}while(y!==null);U===null?z=U=h:U=U.next=h}else z=U=h;y={baseState:S.baseState,firstBaseUpdate:z,lastBaseUpdate:U,shared:S.shared,callbacks:S.callbacks},a.updateQueue=y;return}a=y.lastBaseUpdate,a===null?y.firstBaseUpdate=h:a.next=h,y.lastBaseUpdate=h}var Gc=!1;function Hc(){if(Gc){var a=Al;if(a!==null)throw a}}function qc(a,h,y,S){Gc=!1;var z=a.updateQueue;za=!1;var U=z.firstBaseUpdate,ie=z.lastBaseUpdate,ge=z.shared.pending;if(ge!==null){z.shared.pending=null;var Pe=ge,lt=Pe.next;Pe.next=null,ie===null?U=lt:ie.next=lt,ie=Pe;var Mt=a.alternate;Mt!==null&&(Mt=Mt.updateQueue,ge=Mt.lastBaseUpdate,ge!==ie&&(ge===null?Mt.firstBaseUpdate=lt:ge.next=lt,Mt.lastBaseUpdate=Pe))}if(U!==null){var Nt=z.baseState;ie=0,Mt=lt=Pe=null,ge=U;do{var ut=ge.lane&-536870913,pt=ut!==ge.lane;if(pt?(ui&ut)===ut:(S&ut)===ut){ut!==0&&ut===lc&&(Gc=!0),Mt!==null&&(Mt=Mt.next={lane:0,tag:ge.tag,payload:ge.payload,callback:null,next:null});e:{var $i=a,Zi=ge;ut=h;var gr=y;switch(Zi.tag){case 1:if($i=Zi.payload,typeof $i=="function"){Nt=$i.call(gr,Nt,ut);break e}Nt=$i;break e;case 3:$i.flags=$i.flags&-65537|128;case 0:if($i=Zi.payload,ut=typeof $i=="function"?$i.call(gr,Nt,ut):$i,ut==null)break e;Nt=Ke({},Nt,ut);break e;case 2:za=!0}}ut=ge.callback,ut!==null&&(a.flags|=64,pt&&(a.flags|=8192),pt=z.callbacks,pt===null?z.callbacks=[ut]:pt.push(ut))}else pt={lane:ut,tag:ge.tag,payload:ge.payload,callback:ge.callback,next:null},Mt===null?(lt=Mt=pt,Pe=Nt):Mt=Mt.next=pt,ie|=ut;if(ge=ge.next,ge===null){if(ge=z.shared.pending,ge===null)break;pt=ge,ge=pt.next,pt.next=null,z.lastBaseUpdate=pt,z.shared.pending=null}}while(!0);Mt===null&&(Pe=Nt),z.baseState=Pe,z.firstBaseUpdate=lt,z.lastBaseUpdate=Mt,U===null&&(z.shared.lanes=0),an|=ie,a.lanes=ie,a.memoizedState=Nt}}function Xu(a,h){if(typeof a!="function")throw Error(I(191,a));a.call(h)}function Wu(a,h){var y=a.callbacks;if(y!==null)for(a.callbacks=null,a=0;a<y.length;a++)Xu(y[a],h)}var Zc=Bt(null),Xh=Bt(0);function So(a,h){a=mi,di(Xh,a),di(Zc,h),mi=a|h.baseLanes}function op(){di(Xh,mi),di(Zc,Zc.current)}function ap(){mi=Xh.current,hi(Zc),hi(Xh)}var Pa=0,An=null,rr=null,Pr=null,Fo=!1,Oa=!1,ha=!1,Wh=0,ka=0,da=null,Kd=0;function Or(){throw Error(I(321))}function $h(a,h){if(h===null)return!1;for(var y=0;y<h.length&&y<a.length;y++)if(!xo(a[y],h[y]))return!1;return!0}function fa(a,h,y,S,z,U){return Pa=U,An=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,wt.H=a===null||a.memoizedState===null?sf:rd,ha=!1,U=y(S,z),ha=!1,Oa&&(U=Pt(h,y,S,z)),Ba(a),U}function Ba(a){wt.H=pa;var h=rr!==null&&rr.next!==null;if(Pa=0,Pr=rr=An=null,Fo=!1,ka=0,da=null,h)throw Error(I(300));a===null||as||(a=a.dependencies,a!==null&&Fc(a)&&(as=!0))}function Pt(a,h,y,S){An=a;var z=0;do{if(Oa&&(da=null),ka=0,Oa=!1,25<=z)throw Error(I(301));if(z+=1,Pr=rr=null,a.updateQueue!=null){var U=a.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}wt.H=ih,U=h(y,S)}while(Oa);return U}function lm(){var a=wt.H,h=a.useState()[0];return h=typeof h.then=="function"?Yh(h):h,a=a.useState()[0],(rr!==null?rr.memoizedState:null)!==a&&(An.flags|=1024),h}function Qd(){var a=Wh!==0;return Wh=0,a}function Fa(a,h,y){h.updateQueue=a.updateQueue,h.flags&=-2053,a.lanes&=~y}function Na(a){if(Fo){for(a=a.memoizedState;a!==null;){var h=a.queue;h!==null&&(h.pending=null),a=a.next}Fo=!1}Pa=0,Pr=rr=An=null,Oa=!1,ka=Wh=0,da=null}function Zt(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Pr===null?An.memoizedState=Pr=a:Pr=Pr.next=a,Pr}function Dr(){if(rr===null){var a=An.alternate;a=a!==null?a.memoizedState:null}else a=rr.next;var h=Pr===null?An.memoizedState:Pr.next;if(h!==null)Pr=h,rr=a;else{if(a===null)throw An.alternate===null?Error(I(467)):Error(I(310));rr=a,a={memoizedState:rr.memoizedState,baseState:rr.baseState,baseQueue:rr.baseQueue,queue:rr.queue,next:null},Pr===null?An.memoizedState=Pr=a:Pr=Pr.next=a}return Pr}function lp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yh(a){var h=ka;return ka+=1,da===null&&(da=[]),a=Wd(da,a,h),h=An,(Pr===null?h.memoizedState:Pr.next)===null&&(h=h.alternate,wt.H=h===null||h.memoizedState===null?sf:rd),a}function $u(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Yh(a);if(a.$$typeof===xn)return fs(a)}throw Error(I(438,String(a)))}function Jd(a){var h=null,y=An.updateQueue;if(y!==null&&(h=y.memoCache),h==null){var S=An.alternate;S!==null&&(S=S.updateQueue,S!==null&&(S=S.memoCache,S!=null&&(h={data:S.data.map(function(z){return z.slice()}),index:0})))}if(h==null&&(h={data:[],index:0}),y===null&&(y=lp(),An.updateQueue=y),y.memoCache=h,y=h.data[h.index],y===void 0)for(y=h.data[h.index]=Array(a),S=0;S<a;S++)y[S]=rl;return h.index++,y}function Il(a,h){return typeof h=="function"?h(a):h}function Kh(a){var h=Dr();return cp(h,rr,a)}function cp(a,h,y){var S=a.queue;if(S===null)throw Error(I(311));S.lastRenderedReducer=y;var z=a.baseQueue,U=S.pending;if(U!==null){if(z!==null){var ie=z.next;z.next=U.next,U.next=ie}h.baseQueue=z=U,S.pending=null}if(U=a.baseState,z===null)a.memoizedState=U;else{h=z.next;var ge=ie=null,Pe=null,lt=h,Mt=!1;do{var Nt=lt.lane&-536870913;if(Nt!==lt.lane?(ui&Nt)===Nt:(Pa&Nt)===Nt){var ut=lt.revertLane;if(ut===0)Pe!==null&&(Pe=Pe.next={lane:0,revertLane:0,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null}),Nt===lc&&(Mt=!0);else if((Pa&ut)===ut){lt=lt.next,ut===lc&&(Mt=!0);continue}else Nt={lane:0,revertLane:lt.revertLane,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null},Pe===null?(ge=Pe=Nt,ie=U):Pe=Pe.next=Nt,An.lanes|=ut,an|=ut;Nt=lt.action,ha&&y(U,Nt),U=lt.hasEagerState?lt.eagerState:y(U,Nt)}else ut={lane:Nt,revertLane:lt.revertLane,action:lt.action,hasEagerState:lt.hasEagerState,eagerState:lt.eagerState,next:null},Pe===null?(ge=Pe=ut,ie=U):Pe=Pe.next=ut,An.lanes|=Nt,an|=Nt;lt=lt.next}while(lt!==null&&lt!==h);if(Pe===null?ie=U:Pe.next=ge,!xo(U,a.memoizedState)&&(as=!0,Mt&&(y=Al,y!==null)))throw y;a.memoizedState=U,a.baseState=ie,a.baseQueue=Pe,S.lastRenderedState=U}return z===null&&(S.lanes=0),[a.memoizedState,S.dispatch]}function up(a){var h=Dr(),y=h.queue;if(y===null)throw Error(I(311));y.lastRenderedReducer=a;var S=y.dispatch,z=y.pending,U=h.memoizedState;if(z!==null){y.pending=null;var ie=z=z.next;do U=a(U,ie.action),ie=ie.next;while(ie!==z);xo(U,h.memoizedState)||(as=!0),h.memoizedState=U,h.baseQueue===null&&(h.baseState=U),y.lastRenderedState=U}return[U,S]}function $s(a,h,y){var S=An,z=Dr(),U=cr;if(U){if(y===void 0)throw Error(I(407));y=y()}else y=h();var ie=!xo((rr||z).memoizedState,y);ie&&(z.memoizedState=y,as=!0),z=z.queue;var ge=Ua.bind(null,S,z,a);if(Ys(2048,8,ge,[a]),z.getSnapshot!==h||ie||Pr!==null&&Pr.memoizedState.tag&1){if(S.flags|=2048,St(9,Ga(),As.bind(null,S,z,y,h),null),qt===null)throw Error(I(349));U||(Pa&124)!==0||ef(S,h,y)}return y}function ef(a,h,y){a.flags|=16384,a={getSnapshot:h,value:y},h=An.updateQueue,h===null?(h=lp(),An.updateQueue=h,h.stores=[a]):(y=h.stores,y===null?h.stores=[a]:y.push(a))}function As(a,h,y,S){h.value=y,h.getSnapshot=S,hc(h)&&Qh(a)}function Ua(a,h,y){return y(function(){hc(h)&&Qh(a)})}function hc(a){var h=a.getSnapshot;a=a.value;try{var y=h();return!xo(a,y)}catch{return!0}}function Qh(a){var h=gl(a,2);h!==null&&ts(h,a,2)}function Yu(a){var h=Zt();if(typeof a=="function"){var y=a;if(a=y(),ha){Co(!0);try{y()}finally{Co(!1)}}}return h.memoizedState=h.baseState=a,h.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:a},h}function Xc(a,h,y,S){return a.baseState=y,cp(a,rr,typeof S=="function"?S:Il)}function cm(a,h,y,S,z){if(No(a))throw Error(I(485));if(a=h.action,a!==null){var U={payload:z,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ie){U.listeners.push(ie)}};wt.T!==null?y(!0):U.isTransition=!1,S(U),y=h.pending,y===null?(U.next=h.pending=U,Va(h,U)):(U.next=y.next,h.pending=y.next=U)}}function Va(a,h){var y=h.action,S=h.payload,z=a.state;if(h.isTransition){var U=wt.T,ie={};wt.T=ie;try{var ge=y(z,S),Pe=wt.S;Pe!==null&&Pe(ie,ge),hn(a,h,ge)}catch(lt){ja(a,h,lt)}finally{wt.T=U}}else try{U=y(z,S),hn(a,h,U)}catch(lt){ja(a,h,lt)}}function hn(a,h,y){y!==null&&typeof y=="object"&&typeof y.then=="function"?y.then(function(S){Ku(a,h,S)},function(S){return ja(a,h,S)}):Ku(a,h,y)}function Ku(a,h,y){h.status="fulfilled",h.value=y,hp(h),a.state=y,h=a.pending,h!==null&&(y=h.next,y===h?a.pending=null:(y=y.next,h.next=y,Va(a,y)))}function ja(a,h,y){var S=a.pending;if(a.pending=null,S!==null){S=S.next;do h.status="rejected",h.reason=y,hp(h),h=h.next;while(h!==S)}a.action=null}function hp(a){a=a.listeners;for(var h=0;h<a.length;h++)(0,a[h])()}function dp(a,h){return h}function fp(a,h){if(cr){var y=qt.formState;if(y!==null){e:{var S=An;if(cr){if(Tr){t:{for(var z=Tr,U=ua;z.nodeType!==8;){if(!U){z=null;break t}if(z=el(z.nextSibling),z===null){z=null;break t}}U=z.data,z=U==="F!"||U==="F"?z:null}if(z){Tr=el(z.nextSibling),S=z.data==="F!";break e}}Ma(S)}S=!1}S&&(h=y[0])}}return y=Zt(),y.memoizedState=y.baseState=h,S={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dp,lastRenderedState:h},y.queue=S,y=Pn.bind(null,An,S),S.dispatch=y,S=Yu(!1),U=nd.bind(null,An,!1,S.queue),S=Zt(),z={state:h,dispatch:null,action:a,pending:null},S.queue=z,y=cm.bind(null,An,z,U,y),z.dispatch=y,S.memoizedState=a,[h,y,!1]}function um(a){var h=Dr();return Wc(h,rr,a)}function Wc(a,h,y){if(h=cp(a,h,dp)[0],a=Kh(Il)[0],typeof h=="object"&&h!==null&&typeof h.then=="function")try{var S=Yh(h)}catch(ie){throw ie===Zh?Xd:ie}else S=h;h=Dr();var z=h.queue,U=z.dispatch;return y!==h.memoizedState&&(An.flags|=2048,St(9,Ga(),$c.bind(null,z,y),null)),[S,U,a]}function $c(a,h){a.action=h}function dt(a){var h=Dr(),y=rr;if(y!==null)return Wc(h,y,a);Dr(),h=h.memoizedState,y=Dr();var S=y.queue.dispatch;return y.memoizedState=a,[h,S,!1]}function St(a,h,y,S){return a={tag:a,create:y,deps:S,inst:h,next:null},h=An.updateQueue,h===null&&(h=lp(),An.updateQueue=h),y=h.lastEffect,y===null?h.lastEffect=a.next=a:(S=y.next,y.next=a,a.next=S,h.lastEffect=a),a}function Ga(){return{destroy:void 0,resource:void 0}}function sr(){return Dr().memoizedState}function Re(a,h,y,S){var z=Zt();S=S===void 0?null:S,An.flags|=a,z.memoizedState=St(1|h,Ga(),y,S)}function Ys(a,h,y,S){var z=Dr();S=S===void 0?null:S;var U=z.memoizedState.inst;rr!==null&&S!==null&&$h(S,rr.memoizedState.deps)?z.memoizedState=St(h,U,y,S):(An.flags|=a,z.memoizedState=St(1|h,U,y,S))}function Jh(a,h){Re(8390656,8,a,h)}function ed(a,h){Ys(2048,8,a,h)}function tf(a,h){return Ys(4,2,a,h)}function pp(a,h){return Ys(4,4,a,h)}function mp(a,h){if(typeof h=="function"){a=a();var y=h(a);return function(){typeof y=="function"?y():h(null)}}if(h!=null)return a=a(),h.current=a,function(){h.current=null}}function Yc(a,h,y){y=y!=null?y.concat([a]):null,Ys(4,4,mp.bind(null,h,a),y)}function _p(){}function hm(a,h){var y=Dr();h=h===void 0?null:h;var S=y.memoizedState;return h!==null&&$h(h,S[1])?S[0]:(y.memoizedState=[a,h],a)}function gp(a,h){var y=Dr();h=h===void 0?null:h;var S=y.memoizedState;if(h!==null&&$h(h,S[1]))return S[0];if(S=a(),ha){Co(!0);try{a()}finally{Co(!1)}}return y.memoizedState=[S,h],S}function Qu(a,h,y){return y===void 0||(Pa&1073741824)!==0?a.memoizedState=h:(a.memoizedState=y,a=Zo(),An.lanes|=a,an|=a,y)}function nf(a,h,y,S){return xo(y,h)?y:Zc.current!==null?(a=Qu(a,y,S),xo(a,h)||(as=!0),a):(Pa&42)===0?(as=!0,a.memoizedState=y):(a=Zo(),An.lanes|=a,an|=a,h)}function rf(a,h,y,S,z){var U=oi.p;oi.p=U!==0&&8>U?U:8;var ie=wt.T,ge={};wt.T=ge,nd(a,!1,h,y);try{var Pe=z(),lt=wt.S;if(lt!==null&&lt(ge,Pe),Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"){var Mt=rp(Pe,S);Gi(a,h,Mt,es(a))}else Gi(a,h,S,es(a))}catch(Nt){Gi(a,h,{then:function(){},status:"rejected",reason:Nt},es())}finally{oi.p=U,wt.T=ie}}function dm(){}function Ju(a,h,y,S){if(a.tag!==5)throw Error(I(476));var z=eh(a).queue;rf(a,z,h,Oi,y===null?dm:function(){return dc(a),y(S)})}function eh(a){var h=a.memoizedState;if(h!==null)return h;h={memoizedState:Oi,baseState:Oi,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:Oi},next:null};var y={};return h.next={memoizedState:y,baseState:y,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Il,lastRenderedState:y},next:null},a.memoizedState=h,a=a.alternate,a!==null&&(a.memoizedState=h),h}function dc(a){var h=eh(a).next.queue;Gi(a,h,{},es())}function td(){return fs(If)}function Ml(){return Dr().memoizedState}function ps(){return Dr().memoizedState}function f_(a){for(var h=a.return;h!==null;){switch(h.tag){case 24:case 3:var y=es();a=co(y);var S=Cl(h,a,y);S!==null&&(ts(S,h,y),Bo(S,h,y)),h={cache:ju()},a.payload=h;return}h=h.return}}function id(a,h,y){var S=es();y={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null},No(a)?th(h,y):(y=Po(a,h,y,S),y!==null&&(ts(y,a,S),Kc(y,h,S)))}function Pn(a,h,y){var S=es();Gi(a,h,y,S)}function Gi(a,h,y,S){var z={lane:S,revertLane:0,action:y,hasEagerState:!1,eagerState:null,next:null};if(No(a))th(h,z);else{var U=a.alternate;if(a.lanes===0&&(U===null||U.lanes===0)&&(U=h.lastRenderedReducer,U!==null))try{var ie=h.lastRenderedState,ge=U(ie,y);if(z.hasEagerState=!0,z.eagerState=ge,xo(ge,ie))return ec(a,h,z,0),qt===null&&Jl(),!1}catch{}finally{}if(y=Po(a,h,z,S),y!==null)return ts(y,a,S),Kc(y,h,S),!0}return!1}function nd(a,h,y,S){if(S={lane:2,revertLane:Ip(),action:S,hasEagerState:!1,eagerState:null,next:null},No(a)){if(h)throw Error(I(479))}else h=Po(a,y,S,2),h!==null&&ts(h,a,2)}function No(a){var h=a.alternate;return a===An||h!==null&&h===An}function th(a,h){Oa=Fo=!0;var y=a.pending;y===null?h.next=h:(h.next=y.next,y.next=h),a.pending=h}function Kc(a,h,y){if((y&4194048)!==0){var S=h.lanes;S&=a.pendingLanes,y|=S,h.lanes=y,Tt(a,y)}}var pa={readContext:fs,use:$u,useCallback:Or,useContext:Or,useEffect:Or,useImperativeHandle:Or,useLayoutEffect:Or,useInsertionEffect:Or,useMemo:Or,useReducer:Or,useRef:Or,useState:Or,useDebugValue:Or,useDeferredValue:Or,useTransition:Or,useSyncExternalStore:Or,useId:Or,useHostTransitionStatus:Or,useFormState:Or,useActionState:Or,useOptimistic:Or,useMemoCache:Or,useCacheRefresh:Or},sf={readContext:fs,use:$u,useCallback:function(a,h){return Zt().memoizedState=[a,h===void 0?null:h],a},useContext:fs,useEffect:Jh,useImperativeHandle:function(a,h,y){y=y!=null?y.concat([a]):null,Re(4194308,4,mp.bind(null,h,a),y)},useLayoutEffect:function(a,h){return Re(4194308,4,a,h)},useInsertionEffect:function(a,h){Re(4,2,a,h)},useMemo:function(a,h){var y=Zt();h=h===void 0?null:h;var S=a();if(ha){Co(!0);try{a()}finally{Co(!1)}}return y.memoizedState=[S,h],S},useReducer:function(a,h,y){var S=Zt();if(y!==void 0){var z=y(h);if(ha){Co(!0);try{y(h)}finally{Co(!1)}}}else z=h;return S.memoizedState=S.baseState=z,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:z},S.queue=a,a=a.dispatch=id.bind(null,An,a),[S.memoizedState,a]},useRef:function(a){var h=Zt();return a={current:a},h.memoizedState=a},useState:function(a){a=Yu(a);var h=a.queue,y=Pn.bind(null,An,h);return h.dispatch=y,[a.memoizedState,y]},useDebugValue:_p,useDeferredValue:function(a,h){var y=Zt();return Qu(y,a,h)},useTransition:function(){var a=Yu(!1);return a=rf.bind(null,An,a.queue,!0,!1),Zt().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,h,y){var S=An,z=Zt();if(cr){if(y===void 0)throw Error(I(407));y=y()}else{if(y=h(),qt===null)throw Error(I(349));(ui&124)!==0||ef(S,h,y)}z.memoizedState=y;var U={value:y,getSnapshot:h};return z.queue=U,Jh(Ua.bind(null,S,U,a),[a]),S.flags|=2048,St(9,Ga(),As.bind(null,S,U,y,h),null),y},useId:function(){var a=Zt(),h=qt.identifierPrefix;if(cr){var y=ko,S=ca;y=(S&~(1<<32-Xr(S)-1)).toString(32)+y,h=""+h+"R"+y,y=Wh++,0<y&&(h+="H"+y.toString(32)),h+=""}else y=Kd++,h=""+h+"r"+y.toString(32)+"";return a.memoizedState=h},useHostTransitionStatus:td,useFormState:fp,useActionState:fp,useOptimistic:function(a){var h=Zt();h.memoizedState=h.baseState=a;var y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return h.queue=y,h=nd.bind(null,An,!0,y),y.dispatch=h,[a,h]},useMemoCache:Jd,useCacheRefresh:function(){return Zt().memoizedState=f_.bind(null,An)}},rd={readContext:fs,use:$u,useCallback:hm,useContext:fs,useEffect:ed,useImperativeHandle:Yc,useInsertionEffect:tf,useLayoutEffect:pp,useMemo:gp,useReducer:Kh,useRef:sr,useState:function(){return Kh(Il)},useDebugValue:_p,useDeferredValue:function(a,h){var y=Dr();return nf(y,rr.memoizedState,a,h)},useTransition:function(){var a=Kh(Il)[0],h=Dr().memoizedState;return[typeof a=="boolean"?a:Yh(a),h]},useSyncExternalStore:$s,useId:Ml,useHostTransitionStatus:td,useFormState:um,useActionState:um,useOptimistic:function(a,h){var y=Dr();return Xc(y,rr,a,h)},useMemoCache:Jd,useCacheRefresh:ps},ih={readContext:fs,use:$u,useCallback:hm,useContext:fs,useEffect:ed,useImperativeHandle:Yc,useInsertionEffect:tf,useLayoutEffect:pp,useMemo:gp,useReducer:up,useRef:sr,useState:function(){return up(Il)},useDebugValue:_p,useDeferredValue:function(a,h){var y=Dr();return rr===null?Qu(y,a,h):nf(y,rr.memoizedState,a,h)},useTransition:function(){var a=up(Il)[0],h=Dr().memoizedState;return[typeof a=="boolean"?a:Yh(a),h]},useSyncExternalStore:$s,useId:Ml,useHostTransitionStatus:td,useFormState:dt,useActionState:dt,useOptimistic:function(a,h){var y=Dr();return rr!==null?Xc(y,rr,a,h):(y.baseState=a,[a,y.queue.dispatch])},useMemoCache:Jd,useCacheRefresh:ps},fc=null,uo=0;function ma(a){var h=uo;return uo+=1,fc===null&&(fc=[]),Wd(fc,a,h)}function Rl(a,h){h=h.props.ref,a.ref=h!==void 0?h:null}function Qc(a,h){throw h.$$typeof===nt?Error(I(525)):(a=Object.prototype.toString.call(h),Error(I(31,a==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":a)))}function Jc(a){var h=a._init;return h(a._payload)}function eu(a){function h(it,Ze){if(a){var ot=it.deletions;ot===null?(it.deletions=[Ze],it.flags|=16):ot.push(Ze)}}function y(it,Ze){if(!a)return null;for(;Ze!==null;)h(it,Ze),Ze=Ze.sibling;return null}function S(it){for(var Ze=new Map;it!==null;)it.key!==null?Ze.set(it.key,it):Ze.set(it.index,it),it=it.sibling;return Ze}function z(it,Ze){return it=yl(it,Ze),it.index=0,it.sibling=null,it}function U(it,Ze,ot){return it.index=ot,a?(ot=it.alternate,ot!==null?(ot=ot.index,ot<Ze?(it.flags|=67108866,Ze):ot):(it.flags|=67108866,Ze)):(it.flags|=1048576,Ze)}function ie(it){return a&&it.alternate===null&&(it.flags|=67108866),it}function ge(it,Ze,ot,It){return Ze===null||Ze.tag!==6?(Ze=ep(ot,it.mode,It),Ze.return=it,Ze):(Ze=z(Ze,ot),Ze.return=it,Ze)}function Pe(it,Ze,ot,It){var xi=ot.type;return xi===pi?Mt(it,Ze,ot.props.children,It,ot.key):Ze!==null&&(Ze.elementType===xi||typeof xi=="object"&&xi!==null&&xi.$$typeof===Kr&&Jc(xi)===Ze.type)?(Ze=z(Ze,ot.props),Rl(Ze,ot),Ze.return=it,Ze):(Ze=Uh(ot.type,ot.key,ot.props,null,it.mode,It),Rl(Ze,ot),Ze.return=it,Ze)}function lt(it,Ze,ot,It){return Ze===null||Ze.tag!==4||Ze.stateNode.containerInfo!==ot.containerInfo||Ze.stateNode.implementation!==ot.implementation?(Ze=tp(ot,it.mode,It),Ze.return=it,Ze):(Ze=z(Ze,ot.children||[]),Ze.return=it,Ze)}function Mt(it,Ze,ot,It,xi){return Ze===null||Ze.tag!==7?(Ze=vl(ot,it.mode,It,xi),Ze.return=it,Ze):(Ze=z(Ze,ot),Ze.return=it,Ze)}function Nt(it,Ze,ot){if(typeof Ze=="string"&&Ze!==""||typeof Ze=="number"||typeof Ze=="bigint")return Ze=ep(""+Ze,it.mode,ot),Ze.return=it,Ze;if(typeof Ze=="object"&&Ze!==null){switch(Ze.$$typeof){case Je:return ot=Uh(Ze.type,Ze.key,Ze.props,null,it.mode,ot),Rl(ot,Ze),ot.return=it,ot;case Kt:return Ze=tp(Ze,it.mode,ot),Ze.return=it,Ze;case Kr:var It=Ze._init;return Ze=It(Ze._payload),Nt(it,Ze,ot)}if(bn(Ze)||Ur(Ze))return Ze=vl(Ze,it.mode,ot,null),Ze.return=it,Ze;if(typeof Ze.then=="function")return Nt(it,ma(Ze),ot);if(Ze.$$typeof===xn)return Nt(it,Vu(it,Ze),ot);Qc(it,Ze)}return null}function ut(it,Ze,ot,It){var xi=Ze!==null?Ze.key:null;if(typeof ot=="string"&&ot!==""||typeof ot=="number"||typeof ot=="bigint")return xi!==null?null:ge(it,Ze,""+ot,It);if(typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case Je:return ot.key===xi?Pe(it,Ze,ot,It):null;case Kt:return ot.key===xi?lt(it,Ze,ot,It):null;case Kr:return xi=ot._init,ot=xi(ot._payload),ut(it,Ze,ot,It)}if(bn(ot)||Ur(ot))return xi!==null?null:Mt(it,Ze,ot,It,null);if(typeof ot.then=="function")return ut(it,Ze,ma(ot),It);if(ot.$$typeof===xn)return ut(it,Ze,Vu(it,ot),It);Qc(it,ot)}return null}function pt(it,Ze,ot,It,xi){if(typeof It=="string"&&It!==""||typeof It=="number"||typeof It=="bigint")return it=it.get(ot)||null,ge(Ze,it,""+It,xi);if(typeof It=="object"&&It!==null){switch(It.$$typeof){case Je:return it=it.get(It.key===null?ot:It.key)||null,Pe(Ze,it,It,xi);case Kt:return it=it.get(It.key===null?ot:It.key)||null,lt(Ze,it,It,xi);case Kr:var Dn=It._init;return It=Dn(It._payload),pt(it,Ze,ot,It,xi)}if(bn(It)||Ur(It))return it=it.get(ot)||null,Mt(Ze,it,It,xi,null);if(typeof It.then=="function")return pt(it,Ze,ot,ma(It),xi);if(It.$$typeof===xn)return pt(it,Ze,ot,Vu(Ze,It),xi);Qc(Ze,It)}return null}function $i(it,Ze,ot,It){for(var xi=null,Dn=null,Ri=Ze,qi=Ze=0,Ds=null;Ri!==null&&qi<ot.length;qi++){Ri.index>qi?(Ds=Ri,Ri=null):Ds=Ri.sibling;var ur=ut(it,Ri,ot[qi],It);if(ur===null){Ri===null&&(Ri=Ds);break}a&&Ri&&ur.alternate===null&&h(it,Ri),Ze=U(ur,Ze,qi),Dn===null?xi=ur:Dn.sibling=ur,Dn=ur,Ri=Ds}if(qi===ot.length)return y(it,Ri),cr&&xl(it,qi),xi;if(Ri===null){for(;qi<ot.length;qi++)Ri=Nt(it,ot[qi],It),Ri!==null&&(Ze=U(Ri,Ze,qi),Dn===null?xi=Ri:Dn.sibling=Ri,Dn=Ri);return cr&&xl(it,qi),xi}for(Ri=S(Ri);qi<ot.length;qi++)Ds=pt(Ri,it,qi,ot[qi],It),Ds!==null&&(a&&Ds.alternate!==null&&Ri.delete(Ds.key===null?qi:Ds.key),Ze=U(Ds,Ze,qi),Dn===null?xi=Ds:Dn.sibling=Ds,Dn=Ds);return a&&Ri.forEach(function(uu){return h(it,uu)}),cr&&xl(it,qi),xi}function Zi(it,Ze,ot,It){if(ot==null)throw Error(I(151));for(var xi=null,Dn=null,Ri=Ze,qi=Ze=0,Ds=null,ur=ot.next();Ri!==null&&!ur.done;qi++,ur=ot.next()){Ri.index>qi?(Ds=Ri,Ri=null):Ds=Ri.sibling;var uu=ut(it,Ri,ur.value,It);if(uu===null){Ri===null&&(Ri=Ds);break}a&&Ri&&uu.alternate===null&&h(it,Ri),Ze=U(uu,Ze,qi),Dn===null?xi=uu:Dn.sibling=uu,Dn=uu,Ri=Ds}if(ur.done)return y(it,Ri),cr&&xl(it,qi),xi;if(Ri===null){for(;!ur.done;qi++,ur=ot.next())ur=Nt(it,ur.value,It),ur!==null&&(Ze=U(ur,Ze,qi),Dn===null?xi=ur:Dn.sibling=ur,Dn=ur);return cr&&xl(it,qi),xi}for(Ri=S(Ri);!ur.done;qi++,ur=ot.next())ur=pt(Ri,it,qi,ur.value,It),ur!==null&&(a&&ur.alternate!==null&&Ri.delete(ur.key===null?qi:ur.key),Ze=U(ur,Ze,qi),Dn===null?xi=ur:Dn.sibling=ur,Dn=ur);return a&&Ri.forEach(function(dy){return h(it,dy)}),cr&&xl(it,qi),xi}function gr(it,Ze,ot,It){if(typeof ot=="object"&&ot!==null&&ot.type===pi&&ot.key===null&&(ot=ot.props.children),typeof ot=="object"&&ot!==null){switch(ot.$$typeof){case Je:e:{for(var xi=ot.key;Ze!==null;){if(Ze.key===xi){if(xi=ot.type,xi===pi){if(Ze.tag===7){y(it,Ze.sibling),It=z(Ze,ot.props.children),It.return=it,it=It;break e}}else if(Ze.elementType===xi||typeof xi=="object"&&xi!==null&&xi.$$typeof===Kr&&Jc(xi)===Ze.type){y(it,Ze.sibling),It=z(Ze,ot.props),Rl(It,ot),It.return=it,it=It;break e}y(it,Ze);break}else h(it,Ze);Ze=Ze.sibling}ot.type===pi?(It=vl(ot.props.children,it.mode,It,ot.key),It.return=it,it=It):(It=Uh(ot.type,ot.key,ot.props,null,it.mode,It),Rl(It,ot),It.return=it,it=It)}return ie(it);case Kt:e:{for(xi=ot.key;Ze!==null;){if(Ze.key===xi)if(Ze.tag===4&&Ze.stateNode.containerInfo===ot.containerInfo&&Ze.stateNode.implementation===ot.implementation){y(it,Ze.sibling),It=z(Ze,ot.children||[]),It.return=it,it=It;break e}else{y(it,Ze);break}else h(it,Ze);Ze=Ze.sibling}It=tp(ot,it.mode,It),It.return=it,it=It}return ie(it);case Kr:return xi=ot._init,ot=xi(ot._payload),gr(it,Ze,ot,It)}if(bn(ot))return $i(it,Ze,ot,It);if(Ur(ot)){if(xi=Ur(ot),typeof xi!="function")throw Error(I(150));return ot=xi.call(ot),Zi(it,Ze,ot,It)}if(typeof ot.then=="function")return gr(it,Ze,ma(ot),It);if(ot.$$typeof===xn)return gr(it,Ze,Vu(it,ot),It);Qc(it,ot)}return typeof ot=="string"&&ot!==""||typeof ot=="number"||typeof ot=="bigint"?(ot=""+ot,Ze!==null&&Ze.tag===6?(y(it,Ze.sibling),It=z(Ze,ot),It.return=it,it=It):(y(it,Ze),It=ep(ot,it.mode,It),It.return=it,it=It),ie(it)):y(it,Ze)}return function(it,Ze,ot,It){try{uo=0;var xi=gr(it,Ze,ot,It);return fc=null,xi}catch(Ri){if(Ri===Zh||Ri===Xd)throw Ri;var Dn=To(29,Ri,null,it.mode);return Dn.lanes=It,Dn.return=it,Dn}finally{}}}var zr=eu(!0),tu=eu(!1),os=Bt(null),Uo=null;function _a(a){var h=a.alternate;di(kr,kr.current&1),di(os,a),Uo===null&&(h===null||Zc.current!==null||h.memoizedState!==null)&&(Uo=a)}function of(a){if(a.tag===22){if(di(kr,kr.current),di(os,a),Uo===null){var h=a.alternate;h!==null&&h.memoizedState!==null&&(Uo=a)}}else Vo()}function Vo(){di(kr,kr.current),di(os,os.current)}function Sr(a){hi(os),Uo===a&&(Uo=null),hi(kr)}var kr=Bt(0);function nh(a){for(var h=a;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||bd(y)))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}function sd(a,h,y,S){h=a.memoizedState,y=y(S,h),y=y==null?h:Ke({},h,y),a.memoizedState=y,a.lanes===0&&(a.updateQueue.baseState=y)}var Ha={enqueueSetState:function(a,h,y){a=a._reactInternals;var S=es(),z=co(S);z.payload=h,y!=null&&(z.callback=y),h=Cl(a,z,S),h!==null&&(ts(h,a,S),Bo(h,a,S))},enqueueReplaceState:function(a,h,y){a=a._reactInternals;var S=es(),z=co(S);z.tag=1,z.payload=h,y!=null&&(z.callback=y),h=Cl(a,z,S),h!==null&&(ts(h,a,S),Bo(h,a,S))},enqueueForceUpdate:function(a,h){a=a._reactInternals;var y=es(),S=co(y);S.tag=2,h!=null&&(S.callback=h),h=Cl(a,S,y),h!==null&&(ts(h,a,y),Bo(h,a,y))}};function rh(a,h,y,S,z,U,ie){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(S,U,ie):h.prototype&&h.prototype.isPureReactComponent?!Lo(y,S)||!Lo(z,U):!0}function af(a,h,y,S){a=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,S),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,S),h.state!==a&&Ha.enqueueReplaceState(h,h.state,null)}function qa(a,h){var y=h;if("ref"in h){y={};for(var S in h)S!=="ref"&&(y[S]=h[S])}if(a=a.defaultProps){y===h&&(y=Ke({},y));for(var z in a)y[z]===void 0&&(y[z]=a[z])}return y}var Za=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var h=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(h))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function lf(a){Za(a)}function sh(a){console.error(a)}function iu(a){Za(a)}function pc(a,h){try{var y=a.onUncaughtError;y(h.value,{componentStack:h.stack})}catch(S){setTimeout(function(){throw S})}}function cf(a,h,y){try{var S=a.onCaughtError;S(y.value,{componentStack:y.stack,errorBoundary:h.tag===1?h.stateNode:null})}catch(z){setTimeout(function(){throw z})}}function oh(a,h,y){return y=co(y),y.tag=3,y.payload={element:null},y.callback=function(){pc(a,h)},y}function yp(a){return a=co(a),a.tag=3,a}function od(a,h,y,S){var z=y.type.getDerivedStateFromError;if(typeof z=="function"){var U=S.value;a.payload=function(){return z(U)},a.callback=function(){cf(h,y,S)}}var ie=y.stateNode;ie!==null&&typeof ie.componentDidCatch=="function"&&(a.callback=function(){cf(h,y,S),typeof z!="function"&&(Rn===null?Rn=new Set([this]):Rn.add(this));var ge=S.stack;this.componentDidCatch(S.value,{componentStack:ge!==null?ge:""})})}function fm(a,h,y,S,z){if(y.flags|=32768,S!==null&&typeof S=="object"&&typeof S.then=="function"){if(h=y.alternate,h!==null&&oc(h,y,z,!0),y=os.current,y!==null){switch(y.tag){case 13:return Uo===null?Ja():y.alternate===null&&ii===0&&(ii=3),y.flags&=-257,y.flags|=65536,y.lanes=z,S===Hu?y.flags|=16384:(h=y.updateQueue,h===null?y.updateQueue=new Set([S]):h.add(S),y_(a,S,z)),!1;case 22:return y.flags|=65536,S===Hu?y.flags|=16384:(h=y.updateQueue,h===null?(h={transitions:null,markerInstances:null,retryQueue:new Set([S])},y.updateQueue=h):(y=h.retryQueue,y===null?h.retryQueue=new Set([S]):y.add(S)),y_(a,S,z)),!1}throw Error(I(435,y.tag))}return y_(a,S,z),Ja(),!1}if(cr)return h=os.current,h!==null?((h.flags&65536)===0&&(h.flags|=256),h.flags|=65536,h.lanes=z,S!==rc&&(a=Error(I(422),{cause:S}),Uu(vt(a,y)))):(S!==rc&&(h=Error(I(423),{cause:S}),Uu(vt(h,y))),a=a.current.alternate,a.flags|=65536,z&=-z,a.lanes|=z,S=vt(S,y),z=oh(a.stateNode,S,z),Zu(a,z),ii!==4&&(ii=2)),!1;var U=Error(I(520),{cause:S});if(U=vt(U,y),Fi===null?Fi=[U]:Fi.push(U),ii!==4&&(ii=2),h===null)return!0;S=vt(S,y),y=h;do{switch(y.tag){case 3:return y.flags|=65536,a=z&-z,y.lanes|=a,a=oh(y.stateNode,S,a),Zu(y,a),!1;case 1:if(h=y.type,U=y.stateNode,(y.flags&128)===0&&(typeof h.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(Rn===null||!Rn.has(U))))return y.flags|=65536,z&=-z,y.lanes|=z,z=yp(z),od(z,a,y,S),Zu(y,z),!1}y=y.return}while(y!==null);return!1}var vp=Error(I(461)),as=!1;function ms(a,h,y,S){h.child=a===null?tu(h,null,y,S):zr(h,a.child,y,S)}function uf(a,h,y,S,z){y=y.render;var U=h.ref;if("ref"in S){var ie={};for(var ge in S)ge!=="ref"&&(ie[ge]=S[ge])}else ie=S;return lo(h),S=fa(a,h,y,ie,U,z),ge=Qd(),a!==null&&!as?(Fa(a,h,z),jo(a,h,z)):(cr&&ge&&nc(h),h.flags|=1,ms(a,h,S,z),h.child)}function xp(a,h,y,S,z){if(a===null){var U=y.type;return typeof U=="function"&&!ku(U)&&U.defaultProps===void 0&&y.compare===null?(h.tag=15,h.type=U,bp(a,h,U,S,z)):(a=Uh(y.type,null,S,h,h.mode,z),a.ref=h.ref,a.return=h,h.child=a)}if(U=a.child,!_r(a,z)){var ie=U.memoizedProps;if(y=y.compare,y=y!==null?y:Lo,y(ie,S)&&a.ref===h.ref)return jo(a,h,z)}return h.flags|=1,a=yl(U,S),a.ref=h.ref,a.return=h,h.child=a}function bp(a,h,y,S,z){if(a!==null){var U=a.memoizedProps;if(Lo(U,S)&&a.ref===h.ref)if(as=!1,h.pendingProps=S=U,_r(a,z))(a.flags&131072)!==0&&(as=!0);else return h.lanes=a.lanes,jo(a,h,z)}return hf(a,h,y,S,z)}function wp(a,h,y){var S=h.pendingProps,z=S.children,U=a!==null?a.memoizedState:null;if(S.mode==="hidden"){if((h.flags&128)!==0){if(S=U!==null?U.baseLanes|y:y,a!==null){for(z=h.child=a.child,U=0;z!==null;)U=U|z.lanes|z.childLanes,z=z.sibling;h.childLanes=U&~S}else h.childLanes=0,h.child=null;return Tp(a,h,S,y)}if((y&536870912)!==0)h.memoizedState={baseLanes:0,cachePool:null},a!==null&&Da(h,U!==null?U.cachePool:null),U!==null?So(h,U):op(),of(h);else return h.lanes=h.childLanes=536870912,Tp(a,h,U!==null?U.baseLanes|y:y,y)}else U!==null?(Da(h,U.cachePool),So(h,U),Vo(),h.memoizedState=null):(a!==null&&Da(h,null),op(),Vo());return ms(a,h,z,y),h.child}function Tp(a,h,y,S){var z=Zd();return z=z===null?null:{parent:hr._currentValue,pool:z},h.memoizedState={baseLanes:y,cachePool:z},a!==null&&Da(h,null),op(),of(h),a!==null&&oc(a,h,S,!0),null}function ad(a,h){var y=h.ref;if(y===null)a!==null&&a.ref!==null&&(h.flags|=4194816);else{if(typeof y!="function"&&typeof y!="object")throw Error(I(284));(a===null||a.ref!==y)&&(h.flags|=4194816)}}function hf(a,h,y,S,z){return lo(h),y=fa(a,h,y,S,void 0,z),S=Qd(),a!==null&&!as?(Fa(a,h,z),jo(a,h,z)):(cr&&S&&nc(h),h.flags|=1,ms(a,h,y,z),h.child)}function pm(a,h,y,S,z,U){return lo(h),h.updateQueue=null,y=Pt(h,S,y,z),Ba(a),S=Qd(),a!==null&&!as?(Fa(a,h,U),jo(a,h,U)):(cr&&S&&nc(h),h.flags|=1,ms(a,h,y,U),h.child)}function mm(a,h,y,S,z){if(lo(h),h.stateNode===null){var U=la,ie=y.contextType;typeof ie=="object"&&ie!==null&&(U=fs(ie)),U=new y(S,U),h.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=Ha,h.stateNode=U,U._reactInternals=h,U=h.stateNode,U.props=S,U.state=h.memoizedState,U.refs={},Yd(h),ie=y.contextType,U.context=typeof ie=="object"&&ie!==null?fs(ie):la,U.state=h.memoizedState,ie=y.getDerivedStateFromProps,typeof ie=="function"&&(sd(h,y,ie,S),U.state=h.memoizedState),typeof y.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(ie=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),ie!==U.state&&Ha.enqueueReplaceState(U,U.state,null),qc(h,S,U,z),Hc(),U.state=h.memoizedState),typeof U.componentDidMount=="function"&&(h.flags|=4194308),S=!0}else if(a===null){U=h.stateNode;var ge=h.memoizedProps,Pe=qa(y,ge);U.props=Pe;var lt=U.context,Mt=y.contextType;ie=la,typeof Mt=="object"&&Mt!==null&&(ie=fs(Mt));var Nt=y.getDerivedStateFromProps;Mt=typeof Nt=="function"||typeof U.getSnapshotBeforeUpdate=="function",ge=h.pendingProps!==ge,Mt||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ge||lt!==ie)&&af(h,U,S,ie),za=!1;var ut=h.memoizedState;U.state=ut,qc(h,S,U,z),Hc(),lt=h.memoizedState,ge||ut!==lt||za?(typeof Nt=="function"&&(sd(h,y,Nt,S),lt=h.memoizedState),(Pe=za||rh(h,y,Pe,S,ut,lt,ie))?(Mt||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(h.flags|=4194308)):(typeof U.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=S,h.memoizedState=lt),U.props=S,U.state=lt,U.context=ie,S=Pe):(typeof U.componentDidMount=="function"&&(h.flags|=4194308),S=!1)}else{U=h.stateNode,La(a,h),ie=h.memoizedProps,Mt=qa(y,ie),U.props=Mt,Nt=h.pendingProps,ut=U.context,lt=y.contextType,Pe=la,typeof lt=="object"&&lt!==null&&(Pe=fs(lt)),ge=y.getDerivedStateFromProps,(lt=typeof ge=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(ie!==Nt||ut!==Pe)&&af(h,U,S,Pe),za=!1,ut=h.memoizedState,U.state=ut,qc(h,S,U,z),Hc();var pt=h.memoizedState;ie!==Nt||ut!==pt||za||a!==null&&a.dependencies!==null&&Fc(a.dependencies)?(typeof ge=="function"&&(sd(h,y,ge,S),pt=h.memoizedState),(Mt=za||rh(h,y,Mt,S,ut,pt,Pe)||a!==null&&a.dependencies!==null&&Fc(a.dependencies))?(lt||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(S,pt,Pe),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(S,pt,Pe)),typeof U.componentDidUpdate=="function"&&(h.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof U.componentDidUpdate!="function"||ie===a.memoizedProps&&ut===a.memoizedState||(h.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ie===a.memoizedProps&&ut===a.memoizedState||(h.flags|=1024),h.memoizedProps=S,h.memoizedState=pt),U.props=S,U.state=pt,U.context=Pe,S=Mt):(typeof U.componentDidUpdate!="function"||ie===a.memoizedProps&&ut===a.memoizedState||(h.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||ie===a.memoizedProps&&ut===a.memoizedState||(h.flags|=1024),S=!1)}return U=S,ad(a,h),S=(h.flags&128)!==0,U||S?(U=h.stateNode,y=S&&typeof y.getDerivedStateFromError!="function"?null:U.render(),h.flags|=1,a!==null&&S?(h.child=zr(h,a.child,null,z),h.child=zr(h,null,y,z)):ms(a,h,y,z),h.memoizedState=U.state,a=h.child):a=jo(a,h,z),a}function ld(a,h,y,S){return wl(),h.flags|=256,ms(a,h,y,S),h.child}var or={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function df(a){return{baseLanes:a,cachePool:sp()}}function ah(a,h,y){return a=a!==null?a.childLanes&~y:0,h&&(a|=Pi),a}function ff(a,h,y){var S=h.pendingProps,z=!1,U=(h.flags&128)!==0,ie;if((ie=U)||(ie=a!==null&&a.memoizedState===null?!1:(kr.current&2)!==0),ie&&(z=!0,h.flags&=-129),ie=(h.flags&32)!==0,h.flags&=-33,a===null){if(cr){if(z?_a(h):Vo(),cr){var ge=Tr,Pe;if(Pe=ge){e:{for(Pe=ge,ge=ua;Pe.nodeType!==8;){if(!ge){ge=null;break e}if(Pe=el(Pe.nextSibling),Pe===null){ge=null;break e}}ge=Pe}ge!==null?(h.memoizedState={dehydrated:ge,treeContext:tc!==null?{id:ca,overflow:ko}:null,retryLane:536870912,hydrationErrors:null},Pe=To(18,null,null,0),Pe.stateNode=ge,Pe.return=h,h.child=Pe,ds=h,Tr=null,Pe=!0):Pe=!1}Pe||Ma(h)}if(ge=h.memoizedState,ge!==null&&(ge=ge.dehydrated,ge!==null))return bd(ge)?h.lanes=32:h.lanes=536870912,null;Sr(h)}return ge=S.children,S=S.fallback,z?(Vo(),z=h.mode,ge=mc({mode:"hidden",children:ge},z),S=vl(S,z,y,null),ge.return=h,S.return=h,ge.sibling=S,h.child=ge,z=h.child,z.memoizedState=df(y),z.childLanes=ah(a,ie,y),h.memoizedState=or,S):(_a(h),pf(h,ge))}if(Pe=a.memoizedState,Pe!==null&&(ge=Pe.dehydrated,ge!==null)){if(U)h.flags&256?(_a(h),h.flags&=-257,h=cd(a,h,y)):h.memoizedState!==null?(Vo(),h.child=a.child,h.flags|=128,h=null):(Vo(),z=S.fallback,ge=h.mode,S=mc({mode:"visible",children:S.children},ge),z=vl(z,ge,y,null),z.flags|=2,S.return=h,z.return=h,S.sibling=z,h.child=S,zr(h,a.child,null,y),S=h.child,S.memoizedState=df(y),S.childLanes=ah(a,ie,y),h.memoizedState=or,h=z);else if(_a(h),bd(ge)){if(ie=ge.nextSibling&&ge.nextSibling.dataset,ie)var lt=ie.dgst;ie=lt,S=Error(I(419)),S.stack="",S.digest=ie,Uu({value:S,source:null,stack:null}),h=cd(a,h,y)}else if(as||oc(a,h,y,!1),ie=(y&a.childLanes)!==0,as||ie){if(ie=qt,ie!==null&&(S=y&-y,S=(S&42)!==0?1:ia(S),S=(S&(ie.suspendedLanes|y))!==0?0:S,S!==0&&S!==Pe.retryLane))throw Pe.retryLane=S,gl(a,S),ts(ie,a,S),vp;ge.data==="$?"||Ja(),h=cd(a,h,y)}else ge.data==="$?"?(h.flags|=192,h.child=a.child,h=null):(a=Pe.treeContext,Tr=el(ge.nextSibling),ds=h,cr=!0,bl=null,ua=!1,a!==null&&(Ws[Oo++]=ca,Ws[Oo++]=ko,Ws[Oo++]=tc,ca=a.id,ko=a.overflow,tc=h),h=pf(h,S.children),h.flags|=4096);return h}return z?(Vo(),z=S.fallback,ge=h.mode,Pe=a.child,lt=Pe.sibling,S=yl(Pe,{mode:"hidden",children:S.children}),S.subtreeFlags=Pe.subtreeFlags&65011712,lt!==null?z=yl(lt,z):(z=vl(z,ge,y,null),z.flags|=2),z.return=h,S.return=h,S.sibling=z,h.child=S,S=z,z=h.child,ge=a.child.memoizedState,ge===null?ge=df(y):(Pe=ge.cachePool,Pe!==null?(lt=hr._currentValue,Pe=Pe.parent!==lt?{parent:lt,pool:lt}:Pe):Pe=sp(),ge={baseLanes:ge.baseLanes|y,cachePool:Pe}),z.memoizedState=ge,z.childLanes=ah(a,ie,y),h.memoizedState=or,S):(_a(h),y=a.child,a=y.sibling,y=yl(y,{mode:"visible",children:S.children}),y.return=h,y.sibling=null,a!==null&&(ie=h.deletions,ie===null?(h.deletions=[a],h.flags|=16):ie.push(a)),h.child=y,h.memoizedState=null,y)}function pf(a,h){return h=mc({mode:"visible",children:h},a.mode),h.return=a,a.child=h}function mc(a,h){return a=To(22,a,null,h),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function cd(a,h,y){return zr(h,a.child,null,y),a=pf(h,h.pendingProps.children),a.flags|=2,h.memoizedState=null,a}function ud(a,h,y){a.lanes|=h;var S=a.alternate;S!==null&&(S.lanes|=h),np(a.return,h,y)}function nu(a,h,y,S,z){var U=a.memoizedState;U===null?a.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:S,tail:y,tailMode:z}:(U.isBackwards=h,U.rendering=null,U.renderingStartTime=0,U.last=S,U.tail=y,U.tailMode=z)}function Xa(a,h,y){var S=h.pendingProps,z=S.revealOrder,U=S.tail;if(ms(a,h,S.children,y),S=kr.current,(S&2)!==0)S=S&1|2,h.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=h.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&ud(a,y,h);else if(a.tag===19)ud(a,y,h);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===h)break e;for(;a.sibling===null;){if(a.return===null||a.return===h)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}S&=1}switch(di(kr,S),z){case"forwards":for(y=h.child,z=null;y!==null;)a=y.alternate,a!==null&&nh(a)===null&&(z=y),y=y.sibling;y=z,y===null?(z=h.child,h.child=null):(z=y.sibling,y.sibling=null),nu(h,!1,z,y,U);break;case"backwards":for(y=null,z=h.child,h.child=null;z!==null;){if(a=z.alternate,a!==null&&nh(a)===null){h.child=z;break}a=z.sibling,z.sibling=y,y=z,z=a}nu(h,!0,y,null,U);break;case"together":nu(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function jo(a,h,y){if(a!==null&&(h.dependencies=a.dependencies),an|=h.lanes,(y&h.childLanes)===0)if(a!==null){if(oc(a,h,y,!1),(y&h.childLanes)===0)return null}else return null;if(a!==null&&h.child!==a.child)throw Error(I(153));if(h.child!==null){for(a=h.child,y=yl(a,a.pendingProps),h.child=y,y.return=h;a.sibling!==null;)a=a.sibling,y=y.sibling=yl(a,a.pendingProps),y.return=h;y.sibling=null}return h.child}function _r(a,h){return(a.lanes&h)!==0?!0:(a=a.dependencies,!!(a!==null&&Fc(a)))}function Wa(a,h,y){switch(h.tag){case 3:Hn(h,h.stateNode.containerInfo),Tl(h,hr,a.memoizedState.cache),wl();break;case 27:case 5:Bl(h);break;case 4:Hn(h,h.stateNode.containerInfo);break;case 10:Tl(h,h.type,h.memoizedProps.value);break;case 13:var S=h.memoizedState;if(S!==null)return S.dehydrated!==null?(_a(h),h.flags|=128,null):(y&h.child.childLanes)!==0?ff(a,h,y):(_a(h),a=jo(a,h,y),a!==null?a.sibling:null);_a(h);break;case 19:var z=(a.flags&128)!==0;if(S=(y&h.childLanes)!==0,S||(oc(a,h,y,!1),S=(y&h.childLanes)!==0),z){if(S)return Xa(a,h,y);h.flags|=128}if(z=h.memoizedState,z!==null&&(z.rendering=null,z.tail=null,z.lastEffect=null),di(kr,kr.current),S)break;return null;case 22:case 23:return h.lanes=0,wp(a,h,y);case 24:Tl(h,hr,a.memoizedState.cache)}return jo(a,h,y)}function lh(a,h,y){if(a!==null)if(a.memoizedProps!==h.pendingProps)as=!0;else{if(!_r(a,y)&&(h.flags&128)===0)return as=!1,Wa(a,h,y);as=(a.flags&131072)!==0}else as=!1,cr&&(h.flags&1048576)!==0&&ic(h,Gd,h.index);switch(h.lanes=0,h.tag){case 16:e:{a=h.pendingProps;var S=h.elementType,z=S._init;if(S=z(S._payload),h.type=S,typeof S=="function")ku(S)?(a=qa(S,a),h.tag=1,h=mm(null,h,S,a,y)):(h.tag=0,h=hf(null,h,S,a,y));else{if(S!=null){if(z=S.$$typeof,z===Nr){h.tag=11,h=uf(null,h,S,a,y);break e}else if(z===us){h.tag=14,h=xp(null,h,S,a,y);break e}}throw h=rn(S)||S,Error(I(306,h,""))}}return h;case 0:return hf(a,h,h.type,h.pendingProps,y);case 1:return S=h.type,z=qa(S,h.pendingProps),mm(a,h,S,z,y);case 3:e:{if(Hn(h,h.stateNode.containerInfo),a===null)throw Error(I(387));S=h.pendingProps;var U=h.memoizedState;z=U.element,La(a,h),qc(h,S,null,y);var ie=h.memoizedState;if(S=ie.cache,Tl(h,hr,S),S!==U.cache&&Gh(h,[hr],y,!0),Hc(),S=ie.element,U.isDehydrated)if(U={element:S,isDehydrated:!1,cache:ie.cache},h.updateQueue.baseState=U,h.memoizedState=U,h.flags&256){h=ld(a,h,S,y);break e}else if(S!==z){z=vt(Error(I(424)),h),Uu(z),h=ld(a,h,S,y);break e}else{switch(a=h.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Tr=el(a.firstChild),ds=h,cr=!0,bl=null,ua=!0,y=tu(h,null,S,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling}else{if(wl(),S===z){h=jo(a,h,y);break e}ms(a,h,S,y)}h=h.child}return h;case 26:return ad(a,h),a===null?(y=Dm(h.type,null,h.pendingProps,null))?h.memoizedState=y:cr||(y=h.type,a=h.pendingProps,S=Tm(yi.current).createElement(y),S[W]=h,S[K]=a,Vs(S,y,a),Rt(S),h.stateNode=S):h.memoizedState=Dm(h.type,a.memoizedProps,h.pendingProps,a.memoizedState),null;case 27:return Bl(h),a===null&&cr&&(S=h.stateNode=zp(h.type,h.pendingProps,yi.current),ds=h,ua=!0,z=Tr,br(h.type)?(wd=z,Tr=el(S.firstChild)):Tr=z),ms(a,h,h.pendingProps.children,y),ad(a,h),a===null&&(h.flags|=4194304),h.child;case 5:return a===null&&cr&&((z=S=Tr)&&(S=Am(S,h.type,h.pendingProps,ua),S!==null?(h.stateNode=S,ds=h,Tr=el(S.firstChild),ua=!1,z=!0):z=!1),z||Ma(h)),Bl(h),z=h.type,U=h.pendingProps,ie=a!==null?a.memoizedProps:null,S=U.children,C_(z,U)?S=null:ie!==null&&C_(z,ie)&&(h.flags|=32),h.memoizedState!==null&&(z=fa(a,h,lm,null,null,y),If._currentValue=z),ad(a,h),ms(a,h,S,y),h.child;case 6:return a===null&&cr&&((a=y=Tr)&&(y=Cm(y,h.pendingProps,ua),y!==null?(h.stateNode=y,ds=h,Tr=null,a=!0):a=!1),a||Ma(h)),null;case 13:return ff(a,h,y);case 4:return Hn(h,h.stateNode.containerInfo),S=h.pendingProps,a===null?h.child=zr(h,null,S,y):ms(a,h,S,y),h.child;case 11:return uf(a,h,h.type,h.pendingProps,y);case 7:return ms(a,h,h.pendingProps,y),h.child;case 8:return ms(a,h,h.pendingProps.children,y),h.child;case 12:return ms(a,h,h.pendingProps.children,y),h.child;case 10:return S=h.pendingProps,Tl(h,h.type,S.value),ms(a,h,S.children,y),h.child;case 9:return z=h.type._context,S=h.pendingProps.children,lo(h),z=fs(z),S=S(z),h.flags|=1,ms(a,h,S,y),h.child;case 14:return xp(a,h,h.type,h.pendingProps,y);case 15:return bp(a,h,h.type,h.pendingProps,y);case 19:return Xa(a,h,y);case 31:return S=h.pendingProps,y=h.mode,S={mode:S.mode,children:S.children},a===null?(y=mc(S,y),y.ref=h.ref,h.child=y,y.return=h,h=y):(y=yl(a.child,S),y.ref=h.ref,h.child=y,y.return=h,h=y),h;case 22:return wp(a,h,y);case 24:return lo(h),S=fs(hr),a===null?(z=Zd(),z===null&&(z=qt,U=ju(),z.pooledCache=U,U.refCount++,U!==null&&(z.pooledCacheLanes|=y),z=U),h.memoizedState={parent:S,cache:z},Yd(h),Tl(h,hr,z)):((a.lanes&y)!==0&&(La(a,h),qc(h,null,null,y),Hc()),z=a.memoizedState,U=h.memoizedState,z.parent!==S?(z={parent:S,cache:S},h.memoizedState=z,h.lanes===0&&(h.memoizedState=h.updateQueue.baseState=z),Tl(h,hr,S)):(S=U.cache,Tl(h,hr,S),S!==z.cache&&Gh(h,[hr],y,!0))),ms(a,h,h.pendingProps.children,y),h.child;case 29:throw h.pendingProps}throw Error(I(156,h.tag))}function Go(a){a.flags|=4}function Sp(a,h){if(h.type!=="stylesheet"||(h.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!ry(h)){if(h=os.current,h!==null&&((ui&4194048)===ui?Uo!==null:(ui&62914560)!==ui&&(ui&536870912)===0||h!==Uo))throw qu=Hu,om;a.flags|=8192}}function mf(a,h){h!==null&&(a.flags|=4),a.flags&16384&&(h=a.tag!==22?Tc():536870912,a.lanes|=h,On|=h)}function $a(a,h){if(!cr)switch(a.tailMode){case"hidden":h=a.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?a.tail=null:y.sibling=null;break;case"collapsed":y=a.tail;for(var S=null;y!==null;)y.alternate!==null&&(S=y),y=y.sibling;S===null?h||a.tail===null?a.tail=null:a.tail.sibling=null:S.sibling=null}}function Mr(a){var h=a.alternate!==null&&a.alternate.child===a.child,y=0,S=0;if(h)for(var z=a.child;z!==null;)y|=z.lanes|z.childLanes,S|=z.subtreeFlags&65011712,S|=z.flags&65011712,z.return=a,z=z.sibling;else for(z=a.child;z!==null;)y|=z.lanes|z.childLanes,S|=z.subtreeFlags,S|=z.flags,z.return=a,z=z.sibling;return a.subtreeFlags|=S,a.childLanes=y,h}function Ya(a,h,y){var S=h.pendingProps;switch(Nu(h),h.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Mr(h),null;case 1:return Mr(h),null;case 3:return y=h.stateNode,S=null,a!==null&&(S=a.memoizedState.cache),h.memoizedState.cache!==S&&(h.flags|=2048),Sl(hr),cn(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(a===null||a.child===null)&&(sc(h)?Go(h):a===null||a.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,ip())),Mr(h),null;case 26:return y=h.memoizedState,a===null?(Go(h),y!==null?(Mr(h),Sp(h,y)):(Mr(h),h.flags&=-16777217)):y?y!==a.memoizedState?(Go(h),Mr(h),Sp(h,y)):(Mr(h),h.flags&=-16777217):(a.memoizedProps!==S&&Go(h),Mr(h),h.flags&=-16777217),null;case 27:Ao(h),y=yi.current;var z=h.type;if(a!==null&&h.stateNode!=null)a.memoizedProps!==S&&Go(h);else{if(!S){if(h.stateNode===null)throw Error(I(166));return Mr(h),null}a=ki.current,sc(h)?jh(h):(a=zp(z,S,y),h.stateNode=a,Go(h))}return Mr(h),null;case 5:if(Ao(h),y=h.type,a!==null&&h.stateNode!=null)a.memoizedProps!==S&&Go(h);else{if(!S){if(h.stateNode===null)throw Error(I(166));return Mr(h),null}if(a=ki.current,sc(h))jh(h);else{switch(z=Tm(yi.current),a){case 1:a=z.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:a=z.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":a=z.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":a=z.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":a=z.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof S.is=="string"?z.createElement("select",{is:S.is}):z.createElement("select"),S.multiple?a.multiple=!0:S.size&&(a.size=S.size);break;default:a=typeof S.is=="string"?z.createElement(y,{is:S.is}):z.createElement(y)}}a[W]=h,a[K]=S;e:for(z=h.child;z!==null;){if(z.tag===5||z.tag===6)a.appendChild(z.stateNode);else if(z.tag!==4&&z.tag!==27&&z.child!==null){z.child.return=z,z=z.child;continue}if(z===h)break e;for(;z.sibling===null;){if(z.return===null||z.return===h)break e;z=z.return}z.sibling.return=z.return,z=z.sibling}h.stateNode=a;e:switch(Vs(a,y,S),y){case"button":case"input":case"select":case"textarea":a=!!S.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&Go(h)}}return Mr(h),h.flags&=-16777217,null;case 6:if(a&&h.stateNode!=null)a.memoizedProps!==S&&Go(h);else{if(typeof S!="string"&&h.stateNode===null)throw Error(I(166));if(a=yi.current,sc(h)){if(a=h.stateNode,y=h.memoizedProps,S=null,z=ds,z!==null)switch(z.tag){case 27:case 5:S=z.memoizedProps}a[W]=h,a=!!(a.nodeValue===y||S!==null&&S.suppressHydrationWarning===!0||Wg(a.nodeValue,y)),a||Ma(h)}else a=Tm(a).createTextNode(S),a[W]=h,h.stateNode=a}return Mr(h),null;case 13:if(S=h.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(z=sc(h),S!==null&&S.dehydrated!==null){if(a===null){if(!z)throw Error(I(318));if(z=h.memoizedState,z=z!==null?z.dehydrated:null,!z)throw Error(I(317));z[W]=h}else wl(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Mr(h),z=!1}else z=ip(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=z),z=!0;if(!z)return h.flags&256?(Sr(h),h):(Sr(h),null)}if(Sr(h),(h.flags&128)!==0)return h.lanes=y,h;if(y=S!==null,a=a!==null&&a.memoizedState!==null,y){S=h.child,z=null,S.alternate!==null&&S.alternate.memoizedState!==null&&S.alternate.memoizedState.cachePool!==null&&(z=S.alternate.memoizedState.cachePool.pool);var U=null;S.memoizedState!==null&&S.memoizedState.cachePool!==null&&(U=S.memoizedState.cachePool.pool),U!==z&&(S.flags|=2048)}return y!==a&&y&&(h.child.flags|=8192),mf(h,h.updateQueue),Mr(h),null;case 4:return cn(),a===null&&xm(h.stateNode.containerInfo),Mr(h),null;case 10:return Sl(h.type),Mr(h),null;case 19:if(hi(kr),z=h.memoizedState,z===null)return Mr(h),null;if(S=(h.flags&128)!==0,U=z.rendering,U===null)if(S)$a(z,!1);else{if(ii!==0||a!==null&&(a.flags&128)!==0)for(a=h.child;a!==null;){if(U=nh(a),U!==null){for(h.flags|=128,$a(z,!1),a=U.updateQueue,h.updateQueue=a,mf(h,a),h.subtreeFlags=0,a=y,y=h.child;y!==null;)Jn(y,a),y=y.sibling;return di(kr,kr.current&1|2),h.child}a=a.sibling}z.tail!==null&&Ps()>Sn&&(h.flags|=128,S=!0,$a(z,!1),h.lanes=4194304)}else{if(!S)if(a=nh(U),a!==null){if(h.flags|=128,S=!0,a=a.updateQueue,h.updateQueue=a,mf(h,a),$a(z,!0),z.tail===null&&z.tailMode==="hidden"&&!U.alternate&&!cr)return Mr(h),null}else 2*Ps()-z.renderingStartTime>Sn&&y!==536870912&&(h.flags|=128,S=!0,$a(z,!1),h.lanes=4194304);z.isBackwards?(U.sibling=h.child,h.child=U):(a=z.last,a!==null?a.sibling=U:h.child=U,z.last=U)}return z.tail!==null?(h=z.tail,z.rendering=h,z.tail=h.sibling,z.renderingStartTime=Ps(),h.sibling=null,a=kr.current,di(kr,S?a&1|2:a&1),h):(Mr(h),null);case 22:case 23:return Sr(h),ap(),S=h.memoizedState!==null,a!==null?a.memoizedState!==null!==S&&(h.flags|=8192):S&&(h.flags|=8192),S?(y&536870912)!==0&&(h.flags&128)===0&&(Mr(h),h.subtreeFlags&6&&(h.flags|=8192)):Mr(h),y=h.updateQueue,y!==null&&mf(h,y.retryQueue),y=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(y=a.memoizedState.cachePool.pool),S=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(S=h.memoizedState.cachePool.pool),S!==y&&(h.flags|=2048),a!==null&&hi(cc),null;case 24:return y=null,a!==null&&(y=a.memoizedState.cache),h.memoizedState.cache!==y&&(h.flags|=2048),Sl(hr),Mr(h),null;case 25:return null;case 30:return null}throw Error(I(156,h.tag))}function hd(a,h){switch(Nu(h),h.tag){case 1:return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 3:return Sl(hr),cn(),a=h.flags,(a&65536)!==0&&(a&128)===0?(h.flags=a&-65537|128,h):null;case 26:case 27:case 5:return Ao(h),null;case 13:if(Sr(h),a=h.memoizedState,a!==null&&a.dehydrated!==null){if(h.alternate===null)throw Error(I(340));wl()}return a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 19:return hi(kr),null;case 4:return cn(),null;case 10:return Sl(h.type),null;case 22:case 23:return Sr(h),ap(),a!==null&&hi(cc),a=h.flags,a&65536?(h.flags=a&-65537|128,h):null;case 24:return Sl(hr),null;case 25:return null;default:return null}}function _f(a,h){switch(Nu(h),h.tag){case 3:Sl(hr),cn();break;case 26:case 27:case 5:Ao(h);break;case 4:cn();break;case 13:Sr(h);break;case 19:hi(kr);break;case 10:Sl(h.type);break;case 22:case 23:Sr(h),ap(),a!==null&&hi(cc);break;case 24:Sl(hr)}}function Dl(a,h){try{var y=h.updateQueue,S=y!==null?y.lastEffect:null;if(S!==null){var z=S.next;y=z;do{if((y.tag&a)===a){S=void 0;var U=y.create,ie=y.inst;S=U(),ie.destroy=S}y=y.next}while(y!==z)}}catch(ge){xr(h,h.return,ge)}}function Eo(a,h,y){try{var S=h.updateQueue,z=S!==null?S.lastEffect:null;if(z!==null){var U=z.next;S=U;do{if((S.tag&a)===a){var ie=S.inst,ge=ie.destroy;if(ge!==void 0){ie.destroy=void 0,z=h;var Pe=y,lt=ge;try{lt()}catch(Mt){xr(z,Pe,Mt)}}}S=S.next}while(S!==U)}}catch(Mt){xr(h,h.return,Mt)}}function Ka(a){var h=a.updateQueue;if(h!==null){var y=a.stateNode;try{Wu(h,y)}catch(S){xr(a,a.return,S)}}}function Ho(a,h,y){y.props=qa(a.type,a.memoizedProps),y.state=a.memoizedState;try{y.componentWillUnmount()}catch(S){xr(a,h,S)}}function Ns(a,h){try{var y=a.ref;if(y!==null){switch(a.tag){case 26:case 27:case 5:var S=a.stateNode;break;case 30:S=a.stateNode;break;default:S=a.stateNode}typeof y=="function"?a.refCleanup=y(S):y.current=S}}catch(z){xr(a,h,z)}}function Ks(a,h){var y=a.ref,S=a.refCleanup;if(y!==null)if(typeof S=="function")try{S()}catch(z){xr(a,h,z)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof y=="function")try{y(null)}catch(z){xr(a,h,z)}else y.current=null}function c(a){var h=a.type,y=a.memoizedProps,S=a.stateNode;try{e:switch(h){case"button":case"input":case"select":case"textarea":y.autoFocus&&S.focus();break e;case"img":y.src?S.src=y.src:y.srcSet&&(S.srcset=y.srcSet)}}catch(z){xr(a,a.return,z)}}function t(a,h,y){try{var S=a.stateNode;yd(S,a.type,y,h),S[K]=h}catch(z){xr(a,a.return,z)}}function r(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&br(a.type)||a.tag===4}function u(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||r(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&br(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function p(a,h,y){var S=a.tag;if(S===5||S===6)a=a.stateNode,h?(y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y).insertBefore(a,h):(h=y.nodeType===9?y.body:y.nodeName==="HTML"?y.ownerDocument.body:y,h.appendChild(a),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=wm));else if(S!==4&&(S===27&&br(a.type)&&(y=a.stateNode,h=null),a=a.child,a!==null))for(p(a,h,y),a=a.sibling;a!==null;)p(a,h,y),a=a.sibling}function _(a,h,y){var S=a.tag;if(S===5||S===6)a=a.stateNode,h?y.insertBefore(a,h):y.appendChild(a);else if(S!==4&&(S===27&&br(a.type)&&(y=a.stateNode),a=a.child,a!==null))for(_(a,h,y),a=a.sibling;a!==null;)_(a,h,y),a=a.sibling}function v(a){var h=a.stateNode,y=a.memoizedProps;try{for(var S=a.type,z=h.attributes;z.length;)h.removeAttributeNode(z[0]);Vs(h,S,y),h[W]=a,h[K]=y}catch(U){xr(a,a.return,U)}}var w=!1,A=!1,D=!1,L=typeof WeakSet=="function"?WeakSet:Set,k=null;function O(a,h){if(a=a.containerInfo,vd=km,a=Wf(a),zu(a)){if("selectionStart"in a)var y={start:a.selectionStart,end:a.selectionEnd};else e:{y=(y=a.ownerDocument)&&y.defaultView||window;var S=y.getSelection&&y.getSelection();if(S&&S.rangeCount!==0){y=S.anchorNode;var z=S.anchorOffset,U=S.focusNode;S=S.focusOffset;try{y.nodeType,U.nodeType}catch{y=null;break e}var ie=0,ge=-1,Pe=-1,lt=0,Mt=0,Nt=a,ut=null;t:for(;;){for(var pt;Nt!==y||z!==0&&Nt.nodeType!==3||(ge=ie+z),Nt!==U||S!==0&&Nt.nodeType!==3||(Pe=ie+S),Nt.nodeType===3&&(ie+=Nt.nodeValue.length),(pt=Nt.firstChild)!==null;)ut=Nt,Nt=pt;for(;;){if(Nt===a)break t;if(ut===y&&++lt===z&&(ge=ie),ut===U&&++Mt===S&&(Pe=ie),(pt=Nt.nextSibling)!==null)break;Nt=ut,ut=Nt.parentNode}Nt=pt}y=ge===-1||Pe===-1?null:{start:ge,end:Pe}}else y=null}y=y||{start:0,end:0}}else y=null;for(A_={focusedElem:a,selectionRange:y},km=!1,k=h;k!==null;)if(h=k,a=h.child,(h.subtreeFlags&1024)!==0&&a!==null)a.return=h,k=a;else for(;k!==null;){switch(h=k,U=h.alternate,a=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&U!==null){a=void 0,y=h,z=U.memoizedProps,U=U.memoizedState,S=y.stateNode;try{var $i=qa(y.type,z,y.elementType===y.type);a=S.getSnapshotBeforeUpdate($i,U),S.__reactInternalSnapshotBeforeUpdate=a}catch(Zi){xr(y,y.return,Zi)}}break;case 3:if((a&1024)!==0){if(a=h.stateNode.containerInfo,y=a.nodeType,y===9)Em(a);else if(y===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Em(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(I(163))}if(a=h.sibling,a!==null){a.return=h.return,k=a;break}k=h.return}}function N(a,h,y){var S=y.flags;switch(y.tag){case 0:case 11:case 15:De(a,y),S&4&&Dl(5,y);break;case 1:if(De(a,y),S&4)if(a=y.stateNode,h===null)try{a.componentDidMount()}catch(ie){xr(y,y.return,ie)}else{var z=qa(y.type,h.memoizedProps);h=h.memoizedState;try{a.componentDidUpdate(z,h,a.__reactInternalSnapshotBeforeUpdate)}catch(ie){xr(y,y.return,ie)}}S&64&&Ka(y),S&512&&Ns(y,y.return);break;case 3:if(De(a,y),S&64&&(a=y.updateQueue,a!==null)){if(h=null,y.child!==null)switch(y.child.tag){case 27:case 5:h=y.child.stateNode;break;case 1:h=y.child.stateNode}try{Wu(a,h)}catch(ie){xr(y,y.return,ie)}}break;case 27:h===null&&S&4&&v(y);case 26:case 5:De(a,y),h===null&&S&4&&c(y),S&512&&Ns(y,y.return);break;case 12:De(a,y);break;case 13:De(a,y),S&4&&oe(a,y),S&64&&(a=y.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(y=v_.bind(null,y),Kg(a,y))));break;case 22:if(S=y.memoizedState!==null||w,!S){h=h!==null&&h.memoizedState!==null||A,z=w;var U=A;w=S,(A=h)&&!U?qe(a,y,(y.subtreeFlags&8772)!==0):De(a,y),w=z,A=U}break;case 30:break;default:De(a,y)}}function Z(a){var h=a.alternate;h!==null&&(a.alternate=null,Z(h)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(h=a.stateNode,h!==null&&ke(h)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var j=null,X=!1;function Y(a,h,y){for(y=y.child;y!==null;)J(a,h,y),y=y.sibling}function J(a,h,y){if(Ar&&typeof Ar.onCommitFiberUnmount=="function")try{Ar.onCommitFiberUnmount(ba,y)}catch{}switch(y.tag){case 26:A||Ks(y,h),Y(a,h,y),y.memoizedState?y.memoizedState.count--:y.stateNode&&(y=y.stateNode,y.parentNode.removeChild(y));break;case 27:A||Ks(y,h);var S=j,z=X;br(y.type)&&(j=y.stateNode,X=!1),Y(a,h,y),Lp(y.stateNode),j=S,X=z;break;case 5:A||Ks(y,h);case 6:if(S=j,z=X,j=null,Y(a,h,y),j=S,X=z,j!==null)if(X)try{(j.nodeType===9?j.body:j.nodeName==="HTML"?j.ownerDocument.body:j).removeChild(y.stateNode)}catch(U){xr(y,h,U)}else try{j.removeChild(y.stateNode)}catch(U){xr(y,h,U)}break;case 18:j!==null&&(X?(a=j,xd(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,y.stateNode),Vp(a)):xd(j,y.stateNode));break;case 4:S=j,z=X,j=y.stateNode.containerInfo,X=!0,Y(a,h,y),j=S,X=z;break;case 0:case 11:case 14:case 15:A||Eo(2,y,h),A||Eo(4,y,h),Y(a,h,y);break;case 1:A||(Ks(y,h),S=y.stateNode,typeof S.componentWillUnmount=="function"&&Ho(y,h,S)),Y(a,h,y);break;case 21:Y(a,h,y);break;case 22:A=(S=A)||y.memoizedState!==null,Y(a,h,y),A=S;break;default:Y(a,h,y)}}function oe(a,h){if(h.memoizedState===null&&(a=h.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{Vp(a)}catch(y){xr(h,h.return,y)}}function ce(a){switch(a.tag){case 13:case 19:var h=a.stateNode;return h===null&&(h=a.stateNode=new L),h;case 22:return a=a.stateNode,h=a._retryCache,h===null&&(h=a._retryCache=new L),h;default:throw Error(I(435,a.tag))}}function ye(a,h){var y=ce(a);h.forEach(function(S){var z=yc.bind(null,a,S);y.has(S)||(y.add(S),S.then(z,z))})}function fe(a,h){var y=h.deletions;if(y!==null)for(var S=0;S<y.length;S++){var z=y[S],U=a,ie=h,ge=ie;e:for(;ge!==null;){switch(ge.tag){case 27:if(br(ge.type)){j=ge.stateNode,X=!1;break e}break;case 5:j=ge.stateNode,X=!1;break e;case 3:case 4:j=ge.stateNode.containerInfo,X=!0;break e}ge=ge.return}if(j===null)throw Error(I(160));J(U,ie,z),j=null,X=!1,U=z.alternate,U!==null&&(U.return=null),z.return=null}if(h.subtreeFlags&13878)for(h=h.child;h!==null;)he(h,a),h=h.sibling}var de=null;function he(a,h){var y=a.alternate,S=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:fe(h,a),_e(a),S&4&&(Eo(3,a,a.return),Dl(3,a),Eo(5,a,a.return));break;case 1:fe(h,a),_e(a),S&512&&(A||y===null||Ks(y,y.return)),S&64&&w&&(a=a.updateQueue,a!==null&&(S=a.callbacks,S!==null&&(y=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=y===null?S:y.concat(S))));break;case 26:var z=de;if(fe(h,a),_e(a),S&512&&(A||y===null||Ks(y,y.return)),S&4){var U=y!==null?y.memoizedState:null;if(S=a.memoizedState,y===null)if(S===null)if(a.stateNode===null){e:{S=a.type,y=a.memoizedProps,z=z.ownerDocument||z;t:switch(S){case"title":U=z.getElementsByTagName("title")[0],(!U||U[Ae]||U[W]||U.namespaceURI==="http://www.w3.org/2000/svg"||U.hasAttribute("itemprop"))&&(U=z.createElement(S),z.head.insertBefore(U,z.querySelector("head > title"))),Vs(U,S,y),U[W]=a,Rt(U),S=U;break e;case"link":var ie=iy("link","href",z).get(S+(y.href||""));if(ie){for(var ge=0;ge<ie.length;ge++)if(U=ie[ge],U.getAttribute("href")===(y.href==null||y.href===""?null:y.href)&&U.getAttribute("rel")===(y.rel==null?null:y.rel)&&U.getAttribute("title")===(y.title==null?null:y.title)&&U.getAttribute("crossorigin")===(y.crossOrigin==null?null:y.crossOrigin)){ie.splice(ge,1);break t}}U=z.createElement(S),Vs(U,S,y),z.head.appendChild(U);break;case"meta":if(ie=iy("meta","content",z).get(S+(y.content||""))){for(ge=0;ge<ie.length;ge++)if(U=ie[ge],U.getAttribute("content")===(y.content==null?null:""+y.content)&&U.getAttribute("name")===(y.name==null?null:y.name)&&U.getAttribute("property")===(y.property==null?null:y.property)&&U.getAttribute("http-equiv")===(y.httpEquiv==null?null:y.httpEquiv)&&U.getAttribute("charset")===(y.charSet==null?null:y.charSet)){ie.splice(ge,1);break t}}U=z.createElement(S),Vs(U,S,y),z.head.appendChild(U);break;default:throw Error(I(468,S))}U[W]=a,Rt(U),S=U}a.stateNode=S}else ny(z,a.type,a.stateNode);else a.stateNode=Pl(z,S,a.memoizedProps);else U!==S?(U===null?y.stateNode!==null&&(y=y.stateNode,y.parentNode.removeChild(y)):U.count--,S===null?ny(z,a.type,a.stateNode):Pl(z,S,a.memoizedProps)):S===null&&a.stateNode!==null&&t(a,a.memoizedProps,y.memoizedProps)}break;case 27:fe(h,a),_e(a),S&512&&(A||y===null||Ks(y,y.return)),y!==null&&S&4&&t(a,a.memoizedProps,y.memoizedProps);break;case 5:if(fe(h,a),_e(a),S&512&&(A||y===null||Ks(y,y.return)),a.flags&32){z=a.stateNode;try{to(z,"")}catch(pt){xr(a,a.return,pt)}}S&4&&a.stateNode!=null&&(z=a.memoizedProps,t(a,z,y!==null?y.memoizedProps:z)),S&1024&&(D=!0);break;case 6:if(fe(h,a),_e(a),S&4){if(a.stateNode===null)throw Error(I(162));S=a.memoizedProps,y=a.stateNode;try{y.nodeValue=S}catch(pt){xr(a,a.return,pt)}}break;case 3:if(zm=null,z=de,de=Sf(h.containerInfo),fe(h,a),de=z,_e(a),S&4&&y!==null&&y.memoizedState.isDehydrated)try{Vp(h.containerInfo)}catch(pt){xr(a,a.return,pt)}D&&(D=!1,be(a));break;case 4:S=de,de=Sf(a.stateNode.containerInfo),fe(h,a),_e(a),de=S;break;case 12:fe(h,a),_e(a);break;case 13:fe(h,a),_e(a),a.child.flags&8192&&a.memoizedState!==null!=(y!==null&&y.memoizedState!==null)&&(yn=Ps()),S&4&&(S=a.updateQueue,S!==null&&(a.updateQueue=null,ye(a,S)));break;case 22:z=a.memoizedState!==null;var Pe=y!==null&&y.memoizedState!==null,lt=w,Mt=A;if(w=lt||z,A=Mt||Pe,fe(h,a),A=Mt,w=lt,_e(a),S&8192)e:for(h=a.stateNode,h._visibility=z?h._visibility&-2:h._visibility|1,z&&(y===null||Pe||w||A||ze(a)),y=null,h=a;;){if(h.tag===5||h.tag===26){if(y===null){Pe=y=h;try{if(U=Pe.stateNode,z)ie=U.style,typeof ie.setProperty=="function"?ie.setProperty("display","none","important"):ie.display="none";else{ge=Pe.stateNode;var Nt=Pe.memoizedProps.style,ut=Nt!=null&&Nt.hasOwnProperty("display")?Nt.display:null;ge.style.display=ut==null||typeof ut=="boolean"?"":(""+ut).trim()}}catch(pt){xr(Pe,Pe.return,pt)}}}else if(h.tag===6){if(y===null){Pe=h;try{Pe.stateNode.nodeValue=z?"":Pe.memoizedProps}catch(pt){xr(Pe,Pe.return,pt)}}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===a)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===a)break e;for(;h.sibling===null;){if(h.return===null||h.return===a)break e;y===h&&(y=null),h=h.return}y===h&&(y=null),h.sibling.return=h.return,h=h.sibling}S&4&&(S=a.updateQueue,S!==null&&(y=S.retryQueue,y!==null&&(S.retryQueue=null,ye(a,y))));break;case 19:fe(h,a),_e(a),S&4&&(S=a.updateQueue,S!==null&&(a.updateQueue=null,ye(a,S)));break;case 30:break;case 21:break;default:fe(h,a),_e(a)}}function _e(a){var h=a.flags;if(h&2){try{for(var y,S=a.return;S!==null;){if(r(S)){y=S;break}S=S.return}if(y==null)throw Error(I(160));switch(y.tag){case 27:var z=y.stateNode,U=u(a);_(a,U,z);break;case 5:var ie=y.stateNode;y.flags&32&&(to(ie,""),y.flags&=-33);var ge=u(a);_(a,ge,ie);break;case 3:case 4:var Pe=y.stateNode.containerInfo,lt=u(a);p(a,lt,Pe);break;default:throw Error(I(161))}}catch(Mt){xr(a,a.return,Mt)}a.flags&=-3}h&4096&&(a.flags&=-4097)}function be(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var h=a;be(h),h.tag===5&&h.flags&1024&&h.stateNode.reset(),a=a.sibling}}function De(a,h){if(h.subtreeFlags&8772)for(h=h.child;h!==null;)N(a,h.alternate,h),h=h.sibling}function ze(a){for(a=a.child;a!==null;){var h=a;switch(h.tag){case 0:case 11:case 14:case 15:Eo(4,h,h.return),ze(h);break;case 1:Ks(h,h.return);var y=h.stateNode;typeof y.componentWillUnmount=="function"&&Ho(h,h.return,y),ze(h);break;case 27:Lp(h.stateNode);case 26:case 5:Ks(h,h.return),ze(h);break;case 22:h.memoizedState===null&&ze(h);break;case 30:ze(h);break;default:ze(h)}a=a.sibling}}function qe(a,h,y){for(y=y&&(h.subtreeFlags&8772)!==0,h=h.child;h!==null;){var S=h.alternate,z=a,U=h,ie=U.flags;switch(U.tag){case 0:case 11:case 15:qe(z,U,y),Dl(4,U);break;case 1:if(qe(z,U,y),S=U,z=S.stateNode,typeof z.componentDidMount=="function")try{z.componentDidMount()}catch(lt){xr(S,S.return,lt)}if(S=U,z=S.updateQueue,z!==null){var ge=S.stateNode;try{var Pe=z.shared.hiddenCallbacks;if(Pe!==null)for(z.shared.hiddenCallbacks=null,z=0;z<Pe.length;z++)Xu(Pe[z],ge)}catch(lt){xr(S,S.return,lt)}}y&&ie&64&&Ka(U),Ns(U,U.return);break;case 27:v(U);case 26:case 5:qe(z,U,y),y&&S===null&&ie&4&&c(U),Ns(U,U.return);break;case 12:qe(z,U,y);break;case 13:qe(z,U,y),y&&ie&4&&oe(z,U);break;case 22:U.memoizedState===null&&qe(z,U,y),Ns(U,U.return);break;case 30:break;default:qe(z,U,y)}h=h.sibling}}function We(a,h){var y=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(y=a.memoizedState.cachePool.pool),a=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(a=h.memoizedState.cachePool.pool),a!==y&&(a!=null&&a.refCount++,y!=null&&El(y))}function rt(a,h){a=null,h.alternate!==null&&(a=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==a&&(h.refCount++,a!=null&&El(a))}function Ie(a,h,y,S){if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Ue(a,h,y,S),h=h.sibling}function Ue(a,h,y,S){var z=h.flags;switch(h.tag){case 0:case 11:case 15:Ie(a,h,y,S),z&2048&&Dl(9,h);break;case 1:Ie(a,h,y,S);break;case 3:Ie(a,h,y,S),z&2048&&(a=null,h.alternate!==null&&(a=h.alternate.memoizedState.cache),h=h.memoizedState.cache,h!==a&&(h.refCount++,a!=null&&El(a)));break;case 12:if(z&2048){Ie(a,h,y,S),a=h.stateNode;try{var U=h.memoizedProps,ie=U.id,ge=U.onPostCommit;typeof ge=="function"&&ge(ie,h.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(Pe){xr(h,h.return,Pe)}}else Ie(a,h,y,S);break;case 13:Ie(a,h,y,S);break;case 23:break;case 22:U=h.stateNode,ie=h.alternate,h.memoizedState!==null?U._visibility&2?Ie(a,h,y,S):$e(a,h):U._visibility&2?Ie(a,h,y,S):(U._visibility|=2,Ee(a,h,y,S,(h.subtreeFlags&10256)!==0)),z&2048&&We(ie,h);break;case 24:Ie(a,h,y,S),z&2048&&rt(h.alternate,h);break;default:Ie(a,h,y,S)}}function Ee(a,h,y,S,z){for(z=z&&(h.subtreeFlags&10256)!==0,h=h.child;h!==null;){var U=a,ie=h,ge=y,Pe=S,lt=ie.flags;switch(ie.tag){case 0:case 11:case 15:Ee(U,ie,ge,Pe,z),Dl(8,ie);break;case 23:break;case 22:var Mt=ie.stateNode;ie.memoizedState!==null?Mt._visibility&2?Ee(U,ie,ge,Pe,z):$e(U,ie):(Mt._visibility|=2,Ee(U,ie,ge,Pe,z)),z&&lt&2048&&We(ie.alternate,ie);break;case 24:Ee(U,ie,ge,Pe,z),z&&lt&2048&&rt(ie.alternate,ie);break;default:Ee(U,ie,ge,Pe,z)}h=h.sibling}}function $e(a,h){if(h.subtreeFlags&10256)for(h=h.child;h!==null;){var y=a,S=h,z=S.flags;switch(S.tag){case 22:$e(y,S),z&2048&&We(S.alternate,S);break;case 24:$e(y,S),z&2048&&rt(S.alternate,S);break;default:$e(y,S)}h=h.sibling}}var Fe=8192;function tt(a){if(a.subtreeFlags&Fe)for(a=a.child;a!==null;)gt(a),a=a.sibling}function gt(a){switch(a.tag){case 26:tt(a),a.flags&Fe&&a.memoizedState!==null&&Lm(de,a.memoizedState,a.memoizedProps);break;case 5:tt(a);break;case 3:case 4:var h=de;de=Sf(a.stateNode.containerInfo),tt(a),de=h;break;case 22:a.memoizedState===null&&(h=a.alternate,h!==null&&h.memoizedState!==null?(h=Fe,Fe=16777216,tt(a),Fe=h):tt(a));break;default:tt(a)}}function Ye(a){var h=a.alternate;if(h!==null&&(a=h.child,a!==null)){h.child=null;do h=a.sibling,a.sibling=null,a=h;while(a!==null)}}function ht(a){var h=a.deletions;if((a.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var S=h[y];k=S,Dt(S,a)}Ye(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)Ot(a),a=a.sibling}function Ot(a){switch(a.tag){case 0:case 11:case 15:ht(a),a.flags&2048&&Eo(9,a,a.return);break;case 3:ht(a);break;case 12:ht(a);break;case 22:var h=a.stateNode;a.memoizedState!==null&&h._visibility&2&&(a.return===null||a.return.tag!==13)?(h._visibility&=-3,zt(a)):ht(a);break;default:ht(a)}}function zt(a){var h=a.deletions;if((a.flags&16)!==0){if(h!==null)for(var y=0;y<h.length;y++){var S=h[y];k=S,Dt(S,a)}Ye(a)}for(a=a.child;a!==null;){switch(h=a,h.tag){case 0:case 11:case 15:Eo(8,h,h.return),zt(h);break;case 22:y=h.stateNode,y._visibility&2&&(y._visibility&=-3,zt(h));break;default:zt(h)}a=a.sibling}}function Dt(a,h){for(;k!==null;){var y=k;switch(y.tag){case 0:case 11:case 15:Eo(8,y,h);break;case 23:case 22:if(y.memoizedState!==null&&y.memoizedState.cachePool!==null){var S=y.memoizedState.cachePool.pool;S!=null&&S.refCount++}break;case 24:El(y.memoizedState.cache)}if(S=y.child,S!==null)S.return=y,k=S;else e:for(y=a;k!==null;){S=k;var z=S.sibling,U=S.return;if(Z(S),S===y){k=null;break e}if(z!==null){z.return=U,k=z;break e}k=U}}}var Ht={getCacheForType:function(a){var h=fs(hr),y=h.data.get(a);return y===void 0&&(y=a(),h.data.set(a,y)),y}},$t=typeof WeakMap=="function"?WeakMap:Map,Lt=0,qt=null,Xt=null,ui=0,Ti=0,Bi=null,Wi=!1,Zn=!1,gi=!1,mi=0,ii=0,an=0,dr=0,wn=0,Pi=0,On=0,Fi=null,Tn=null,Cn=!1,yn=0,Sn=1/0,Ki=null,Rn=null,Xn=0,dn=null,Hi=null,ls=0,Cs=0,Qs=null,qo=null,Us=0,Is=null;function es(){if((Lt&2)!==0&&ui!==0)return ui&-ui;if(wt.T!==null){var a=lc;return a!==0?a:Ip()}return xu()}function Zo(){Pi===0&&(Pi=(ui&536870912)===0||cr?ol():536870912);var a=os.current;return a!==null&&(a.flags|=32),Pi}function ts(a,h,y){(a===qt&&(Ti===2||Ti===9)||a.cancelPendingCommit!==null)&&(zl(a,0),Qa(a,ui,Pi,!1)),Sc(a,y),((Lt&2)===0||a!==qt)&&(a===qt&&((Lt&2)===0&&(dr|=y),ii===4&&Qa(a,ui,Pi,!1)),Ll(a))}function ch(a,h,y){if((Lt&6)!==0)throw Error(I(327));var S=!y&&(h&124)===0&&(h&a.expiredLanes)===0||Ta(a,h),z=S?_m(a,h):Ep(a,h,!0),U=S;do{if(z===0){Zn&&!S&&Qa(a,h,0,!1);break}else{if(y=a.current.alternate,U&&!uh(y)){z=Ep(a,h,!1),U=!1;continue}if(z===2){if(U=h,a.errorRecoveryDisabledLanes&U)var ie=0;else ie=a.pendingLanes&-536870913,ie=ie!==0?ie:ie&536870912?536870912:0;if(ie!==0){h=ie;e:{var ge=a;z=Fi;var Pe=ge.current.memoizedState.isDehydrated;if(Pe&&(zl(ge,ie).flags|=256),ie=Ep(ge,ie,!1),ie!==2){if(gi&&!Pe){ge.errorRecoveryDisabledLanes|=U,dr|=U,z=4;break e}U=Tn,Tn=z,U!==null&&(Tn===null?Tn=U:Tn.push.apply(Tn,U))}z=ie}if(U=!1,z!==2)continue}}if(z===1){zl(a,0),Qa(a,h,0,!0);break}e:{switch(S=a,U=z,U){case 0:case 1:throw Error(I(345));case 4:if((h&4194048)!==h)break;case 6:Qa(S,h,Pi,!Wi);break e;case 2:Tn=null;break;case 3:case 5:break;default:throw Error(I(329))}if((h&62914560)===h&&(z=yn+300-Ps(),10<z)){if(Qa(S,h,Pi,!Wi),ta(S,0,!0)!==0)break e;S.timeoutHandle=Sm(gf.bind(null,S,y,Tn,Ki,Cn,h,Pi,dr,On,Wi,U,2,-0,0),z);break e}gf(S,y,Tn,Ki,Cn,h,Pi,dr,On,Wi,U,0,-0,0)}}break}while(!0);Ll(a)}function gf(a,h,y,S,z,U,ie,ge,Pe,lt,Mt,Nt,ut,pt){if(a.timeoutHandle=-1,Nt=h.subtreeFlags,(Nt&8192||(Nt&16785408)===16785408)&&(mh={stylesheets:null,count:0,unsuspend:sy},gt(h),Nt=oy(),Nt!==null)){a.cancelPendingCommit=Nt(__.bind(null,a,h,U,y,S,z,ie,ge,Pe,Mt,1,ut,pt)),Qa(a,U,ie,!lt);return}__(a,h,U,y,S,z,ie,ge,Pe)}function uh(a){for(var h=a;;){var y=h.tag;if((y===0||y===11||y===15)&&h.flags&16384&&(y=h.updateQueue,y!==null&&(y=y.stores,y!==null)))for(var S=0;S<y.length;S++){var z=y[S],U=z.getSnapshot;z=z.value;try{if(!xo(U(),z))return!1}catch{return!1}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===a)break;for(;h.sibling===null;){if(h.return===null||h.return===a)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Qa(a,h,y,S){h&=~wn,h&=~dr,a.suspendedLanes|=h,a.pingedLanes&=~h,S&&(a.warmLanes|=h),S=a.expirationTimes;for(var z=h;0<z;){var U=31-Xr(z),ie=1<<U;S[U]=-1,z&=~ie}y!==0&&Vl(a,y,h)}function _c(){return(Lt&6)===0?(fh(0),!1):!0}function hh(){if(Xt!==null){if(Ti===0)var a=Xt.return;else a=Xt,Ra=ao=null,Na(a),fc=null,uo=0,a=Xt;for(;a!==null;)_f(a.alternate,a),a=a.return;Xt=null}}function zl(a,h){var y=a.timeoutHandle;y!==-1&&(a.timeoutHandle=-1,Rv(y)),y=a.cancelPendingCommit,y!==null&&(a.cancelPendingCommit=null,y()),hh(),qt=a,Xt=y=yl(a.current,null),ui=h,Ti=0,Bi=null,Wi=!1,Zn=Ta(a,h),gi=!1,On=Pi=wn=dr=an=ii=0,Tn=Fi=null,Cn=!1,(h&8)!==0&&(h|=h&32);var S=a.entangledLanes;if(S!==0)for(a=a.entanglements,S&=h;0<S;){var z=31-Xr(S),U=1<<z;h|=a[z],S&=~U}return mi=h,Jl(),y}function ga(a,h){An=null,wt.H=pa,h===Zh||h===Xd?(h=uc(),Ti=3):h===om?(h=uc(),Ti=4):Ti=h===vp?8:h!==null&&typeof h=="object"&&typeof h.then=="function"?6:1,Bi=h,Xt===null&&(ii=1,pc(a,vt(h,a.current)))}function ru(){var a=wt.H;return wt.H=pa,a===null?pa:a}function gc(){var a=wt.A;return wt.A=Ht,a}function Ja(){ii=4,Wi||(ui&4194048)!==ui&&os.current!==null||(Zn=!0),(an&134217727)===0&&(dr&134217727)===0||qt===null||Qa(qt,ui,Pi,!1)}function Ep(a,h,y){var S=Lt;Lt|=2;var z=ru(),U=gc();(qt!==a||ui!==h)&&(Ki=null,zl(a,h)),h=!1;var ie=ii;e:do try{if(Ti!==0&&Xt!==null){var ge=Xt,Pe=Bi;switch(Ti){case 8:hh(),ie=6;break e;case 3:case 2:case 9:case 6:os.current===null&&(h=!0);var lt=Ti;if(Ti=0,Bi=null,dd(a,ge,Pe,lt),y&&Zn){ie=0;break e}break;default:lt=Ti,Ti=0,Bi=null,dd(a,ge,Pe,lt)}}yf(),ie=ii;break}catch(Mt){ga(a,Mt)}while(!0);return h&&a.shellSuspendCounter++,Ra=ao=null,Lt=S,wt.H=z,wt.A=U,Xt===null&&(qt=null,ui=0,Jl()),ie}function yf(){for(;Xt!==null;)p_(Xt)}function _m(a,h){var y=Lt;Lt|=2;var S=ru(),z=gc();qt!==a||ui!==h?(Ki=null,Sn=Ps()+500,zl(a,h)):Zn=Ta(a,h);e:do try{if(Ti!==0&&Xt!==null){h=Xt;var U=Bi;t:switch(Ti){case 1:Ti=0,Bi=null,dd(a,h,U,1);break;case 2:case 9:if(am(U)){Ti=0,Bi=null,m_(h);break}h=function(){Ti!==2&&Ti!==9||qt!==a||(Ti=7),Ll(a)},U.then(h,h);break e;case 3:Ti=7;break e;case 4:Ti=5;break e;case 7:am(U)?(Ti=0,Bi=null,m_(h)):(Ti=0,Bi=null,dd(a,h,U,7));break;case 5:var ie=null;switch(Xt.tag){case 26:ie=Xt.memoizedState;case 5:case 27:var ge=Xt;if(!ie||ry(ie)){Ti=0,Bi=null;var Pe=ge.sibling;if(Pe!==null)Xt=Pe;else{var lt=ge.return;lt!==null?(Xt=lt,Ap(lt)):Xt=null}break t}}Ti=0,Bi=null,dd(a,h,U,5);break;case 6:Ti=0,Bi=null,dd(a,h,U,6);break;case 8:hh(),ii=6;break e;default:throw Error(I(462))}}kg();break}catch(Mt){ga(a,Mt)}while(!0);return Ra=ao=null,wt.H=S,wt.A=z,Lt=y,Xt!==null?0:(qt=null,ui=0,Jl(),ii)}function kg(){for(;Xt!==null&&!Nl();)p_(Xt)}function p_(a){var h=lh(a.alternate,a,mi);a.memoizedProps=a.pendingProps,h===null?Ap(a):Xt=h}function m_(a){var h=a,y=h.alternate;switch(h.tag){case 15:case 0:h=pm(y,h,h.pendingProps,h.type,void 0,ui);break;case 11:h=pm(y,h,h.pendingProps,h.type.render,h.ref,ui);break;case 5:Na(h);default:_f(y,h),h=Xt=Jn(h,mi),h=lh(y,h,mi)}a.memoizedProps=a.pendingProps,h===null?Ap(a):Xt=h}function dd(a,h,y,S){Ra=ao=null,Na(h),fc=null,uo=0;var z=h.return;try{if(fm(a,z,h,y,ui)){ii=1,pc(a,vt(y,a.current)),Xt=null;return}}catch(U){if(z!==null)throw Xt=z,U;ii=1,pc(a,vt(y,a.current)),Xt=null;return}h.flags&32768?(cr||S===1?a=!0:Zn||(ui&536870912)!==0?a=!1:(Wi=a=!0,(S===2||S===9||S===3||S===6)&&(S=os.current,S!==null&&S.tag===13&&(S.flags|=16384))),dh(h,a)):Ap(h)}function Ap(a){var h=a;do{if((h.flags&32768)!==0){dh(h,Wi);return}a=h.return;var y=Ya(h.alternate,h,mi);if(y!==null){Xt=y;return}if(h=h.sibling,h!==null){Xt=h;return}Xt=h=a}while(h!==null);ii===0&&(ii=5)}function dh(a,h){do{var y=hd(a.alternate,a);if(y!==null){y.flags&=32767,Xt=y;return}if(y=a.return,y!==null&&(y.flags|=32768,y.subtreeFlags=0,y.deletions=null),!h&&(a=a.sibling,a!==null)){Xt=a;return}Xt=a=y}while(a!==null);ii=6,Xt=null}function __(a,h,y,S,z,U,ie,ge,Pe){a.cancelPendingCommit=null;do pd();while(Xn!==0);if((Lt&6)!==0)throw Error(I(327));if(h!==null){if(h===a.current)throw Error(I(177));if(U=h.lanes|h.childLanes,U|=Ql,Pd(a,y,U,ie,ge,Pe),a===qt&&(Xt=qt=null,ui=0),Hi=h,dn=a,ls=y,Cs=U,Qs=z,qo=S,(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,su(Jo,function(){return Ng(),null})):(a.callbackNode=null,a.callbackPriority=0),S=(h.flags&13878)!==0,(h.subtreeFlags&13878)!==0||S){S=wt.T,wt.T=null,z=oi.p,oi.p=2,ie=Lt,Lt|=4;try{O(a,h,y)}finally{Lt=ie,oi.p=z,wt.T=S}}Xn=1,Ms(),fd(),Bg()}}function Ms(){if(Xn===1){Xn=0;var a=dn,h=Hi,y=(h.flags&13878)!==0;if((h.subtreeFlags&13878)!==0||y){y=wt.T,wt.T=null;var S=oi.p;oi.p=2;var z=Lt;Lt|=4;try{he(h,a);var U=A_,ie=Wf(a.containerInfo),ge=U.focusedElem,Pe=U.selectionRange;if(ie!==ge&&ge&&ge.ownerDocument&&kc(ge.ownerDocument.documentElement,ge)){if(Pe!==null&&zu(ge)){var lt=Pe.start,Mt=Pe.end;if(Mt===void 0&&(Mt=lt),"selectionStart"in ge)ge.selectionStart=lt,ge.selectionEnd=Math.min(Mt,ge.value.length);else{var Nt=ge.ownerDocument||document,ut=Nt&&Nt.defaultView||window;if(ut.getSelection){var pt=ut.getSelection(),$i=ge.textContent.length,Zi=Math.min(Pe.start,$i),gr=Pe.end===void 0?Zi:Math.min(Pe.end,$i);!pt.extend&&Zi>gr&&(ie=gr,gr=Zi,Zi=ie);var it=Yl(ge,Zi),Ze=Yl(ge,gr);if(it&&Ze&&(pt.rangeCount!==1||pt.anchorNode!==it.node||pt.anchorOffset!==it.offset||pt.focusNode!==Ze.node||pt.focusOffset!==Ze.offset)){var ot=Nt.createRange();ot.setStart(it.node,it.offset),pt.removeAllRanges(),Zi>gr?(pt.addRange(ot),pt.extend(Ze.node,Ze.offset)):(ot.setEnd(Ze.node,Ze.offset),pt.addRange(ot))}}}}for(Nt=[],pt=ge;pt=pt.parentNode;)pt.nodeType===1&&Nt.push({element:pt,left:pt.scrollLeft,top:pt.scrollTop});for(typeof ge.focus=="function"&&ge.focus(),ge=0;ge<Nt.length;ge++){var It=Nt[ge];It.element.scrollLeft=It.left,It.element.scrollTop=It.top}}km=!!vd,A_=vd=null}finally{Lt=z,oi.p=S,wt.T=y}}a.current=h,Xn=2}}function fd(){if(Xn===2){Xn=0;var a=dn,h=Hi,y=(h.flags&8772)!==0;if((h.subtreeFlags&8772)!==0||y){y=wt.T,wt.T=null;var S=oi.p;oi.p=2;var z=Lt;Lt|=4;try{N(a,h.alternate,h)}finally{Lt=z,oi.p=S,wt.T=y}}Xn=3}}function Bg(){if(Xn===4||Xn===3){Xn=0,Ls();var a=dn,h=Hi,y=ls,S=qo;(h.subtreeFlags&10256)!==0||(h.flags&10256)!==0?Xn=5:(Xn=0,Hi=dn=null,Fg(a,a.pendingLanes));var z=a.pendingLanes;if(z===0&&(Rn=null),wh(y),h=h.stateNode,Ar&&typeof Ar.onCommitFiberRoot=="function")try{Ar.onCommitFiberRoot(ba,h,void 0,(h.current.flags&128)===128)}catch{}if(S!==null){h=wt.T,z=oi.p,oi.p=2,wt.T=null;try{for(var U=a.onRecoverableError,ie=0;ie<S.length;ie++){var ge=S[ie];U(ge.value,{componentStack:ge.stack})}}finally{wt.T=h,oi.p=z}}(ls&3)!==0&&pd(),Ll(a),z=a.pendingLanes,(y&4194090)!==0&&(z&42)!==0?a===Is?Us++:(Us=0,Is=a):Us=0,fh(0)}}function Fg(a,h){(a.pooledCacheLanes&=h)===0&&(h=a.pooledCache,h!=null&&(a.pooledCache=null,El(h)))}function pd(a){return Ms(),fd(),Bg(),Ng()}function Ng(){if(Xn!==5)return!1;var a=dn,h=Cs;Cs=0;var y=wh(ls),S=wt.T,z=oi.p;try{oi.p=32>y?32:y,wt.T=null,y=Qs,Qs=null;var U=dn,ie=ls;if(Xn=0,Hi=dn=null,ls=0,(Lt&6)!==0)throw Error(I(331));var ge=Lt;if(Lt|=4,Ot(U.current),Ue(U,U.current,ie,y),Lt=ge,fh(0,!1),Ar&&typeof Ar.onPostCommitFiberRoot=="function")try{Ar.onPostCommitFiberRoot(ba,U)}catch{}return!0}finally{oi.p=z,wt.T=S,Fg(a,h)}}function g_(a,h,y){h=vt(y,h),h=oh(a.stateNode,h,2),a=Cl(a,h,2),a!==null&&(Sc(a,2),Ll(a))}function xr(a,h,y){if(a.tag===3)g_(a,a,y);else for(;h!==null;){if(h.tag===3){g_(h,a,y);break}else if(h.tag===1){var S=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Rn===null||!Rn.has(S))){a=vt(y,a),y=yp(2),S=Cl(h,y,2),S!==null&&(od(y,S,h,a),Sc(S,2),Ll(S));break}}h=h.return}}function y_(a,h,y){var S=a.pingCache;if(S===null){S=a.pingCache=new $t;var z=new Set;S.set(h,z)}else z=S.get(h),z===void 0&&(z=new Set,S.set(h,z));z.has(y)||(gi=!0,z.add(y),a=Ug.bind(null,a,h,y),h.then(a,a))}function Ug(a,h,y){var S=a.pingCache;S!==null&&S.delete(h),a.pingedLanes|=a.suspendedLanes&y,a.warmLanes&=~y,qt===a&&(ui&y)===y&&(ii===4||ii===3&&(ui&62914560)===ui&&300>Ps()-yn?(Lt&2)===0&&zl(a,0):wn|=y,On===ui&&(On=0)),Ll(a)}function Vg(a,h){h===0&&(h=Tc()),a=gl(a,h),a!==null&&(Sc(a,h),Ll(a))}function v_(a){var h=a.memoizedState,y=0;h!==null&&(y=h.retryLane),Vg(a,y)}function yc(a,h){var y=0;switch(a.tag){case 13:var S=a.stateNode,z=a.memoizedState;z!==null&&(y=z.retryLane);break;case 19:S=a.stateNode;break;case 22:S=a.stateNode._retryCache;break;default:throw Error(I(314))}S!==null&&S.delete(h),Vg(a,y)}function su(a,h){return vr(a,h)}var Cp=null,md=null,vf=!1,xf=!1,_d=!1,vc=0;function Ll(a){a!==md&&a.next===null&&(md===null?Cp=md=a:md=md.next=a),xf=!0,vf||(vf=!0,jg())}function fh(a,h){if(!_d&&xf){_d=!0;do for(var y=!1,S=Cp;S!==null;){if(a!==0){var z=S.pendingLanes;if(z===0)var U=0;else{var ie=S.suspendedLanes,ge=S.pingedLanes;U=(1<<31-Xr(42|a)+1)-1,U&=z&~(ie&~ge),U=U&201326741?U&201326741|1:U?U|2:0}U!==0&&(y=!0,ou(S,U))}else U=ui,U=ta(S,S===qt?U:0,S.cancelPendingCommit!==null||S.timeoutHandle!==-1),(U&3)===0||Ta(S,U)||(y=!0,ou(S,U));S=S.next}while(y);_d=!1}}function x_(){gm()}function gm(){xf=vf=!1;var a=0;vc!==0&&(Mv()&&(a=vc),vc=0);for(var h=Ps(),y=null,S=Cp;S!==null;){var z=S.next,U=b_(S,h);U===0?(S.next=null,y===null?Cp=z:y.next=z,z===null&&(md=y)):(y=S,(a!==0||(U&3)!==0)&&(xf=!0)),S=z}fh(a)}function b_(a,h){for(var y=a.suspendedLanes,S=a.pingedLanes,z=a.expirationTimes,U=a.pendingLanes&-62914561;0<U;){var ie=31-Xr(U),ge=1<<ie,Pe=z[ie];Pe===-1?((ge&y)===0||(ge&S)!==0)&&(z[ie]=qn(ge,h)):Pe<=h&&(a.expiredLanes|=ge),U&=~ge}if(h=qt,y=ui,y=ta(a,a===h?y:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),S=a.callbackNode,y===0||a===h&&(Ti===2||Ti===9)||a.cancelPendingCommit!==null)return S!==null&&S!==null&&Fl(S),a.callbackNode=null,a.callbackPriority=0;if((y&3)===0||Ta(a,y)){if(h=y&-y,h===a.callbackPriority)return h;switch(S!==null&&Fl(S),wh(y)){case 2:case 8:y=Hs;break;case 32:y=Jo;break;case 268435456:y=sl;break;default:y=Jo}return S=w_.bind(null,a),y=vr(y,S),a.callbackPriority=h,a.callbackNode=y,h}return S!==null&&S!==null&&Fl(S),a.callbackPriority=2,a.callbackNode=null,2}function w_(a,h){if(Xn!==0&&Xn!==5)return a.callbackNode=null,a.callbackPriority=0,null;var y=a.callbackNode;if(pd()&&a.callbackNode!==y)return null;var S=ui;return S=ta(a,a===qt?S:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),S===0?null:(ch(a,S,h),b_(a,Ps()),a.callbackNode!=null&&a.callbackNode===y?w_.bind(null,a):null)}function ou(a,h){if(pd())return null;ch(a,h,!0)}function jg(){Dp(function(){(Lt&6)!==0?vr(ys,x_):gm()})}function Ip(){return vc===0&&(vc=ol()),vc}function T_(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Su(""+a)}function Gg(a,h){var y=h.ownerDocument.createElement("input");return y.name=h.name,y.value=h.value,a.id&&y.setAttribute("form",a.id),h.parentNode.insertBefore(y,h),a=new FormData(a),y.parentNode.removeChild(y),a}function Av(a,h,y,S,z){if(h==="submit"&&y&&y.stateNode===z){var U=T_((z[K]||null).action),ie=S.submitter;ie&&(h=(h=ie[K]||null)?T_(h.formAction):ie.getAttribute("formAction"),h!==null&&(U=h,ie=null));var ge=new Ic("action","action",null,S,z);a.push({event:ge,listeners:[{instance:null,listener:function(){if(S.defaultPrevented){if(vc!==0){var Pe=ie?Gg(z,ie):new FormData(z);Ju(y,{pending:!0,data:Pe,method:z.method,action:U},null,Pe)}}else typeof U=="function"&&(ge.preventDefault(),Pe=ie?Gg(z,ie):new FormData(z),Ju(y,{pending:!0,data:Pe,method:z.method,action:U},U,Pe))},currentTarget:z}]})}}for(var S_=0;S_<Ou.length;S_++){var ym=Ou[S_],Hg=ym.toLowerCase(),Cv=ym[0].toUpperCase()+ym.slice(1);Lr(Hg,"on"+Cv)}Lr(Vd,"onAnimationEnd"),Lr(hs,"onAnimationIteration"),Lr(Lu,"onAnimationStart"),Lr("dblclick","onDoubleClick"),Lr("focusin","onFocus"),Lr("focusout","onBlur"),Lr(Qf,"onTransitionRun"),Lr(Jf,"onTransitionStart"),Lr(Pu,"onTransitionCancel"),Lr(Bc,"onTransitionEnd"),wi("onMouseEnter",["mouseout","mouseover"]),wi("onMouseLeave",["mouseout","mouseover"]),wi("onPointerEnter",["pointerout","pointerover"]),wi("onPointerLeave",["pointerout","pointerover"]),ci("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ci("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ci("onBeforeInput",["compositionend","keypress","textInput","paste"]),ci("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ci("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var bf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Iv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(bf));function qg(a,h){h=(h&4)!==0;for(var y=0;y<a.length;y++){var S=a[y],z=S.event;S=S.listeners;e:{var U=void 0;if(h)for(var ie=S.length-1;0<=ie;ie--){var ge=S[ie],Pe=ge.instance,lt=ge.currentTarget;if(ge=ge.listener,Pe!==U&&z.isPropagationStopped())break e;U=ge,z.currentTarget=lt;try{U(z)}catch(Mt){Za(Mt)}z.currentTarget=null,U=Pe}else for(ie=0;ie<S.length;ie++){if(ge=S[ie],Pe=ge.instance,lt=ge.currentTarget,ge=ge.listener,Pe!==U&&z.isPropagationStopped())break e;U=ge,z.currentTarget=lt;try{U(z)}catch(Mt){Za(Mt)}z.currentTarget=null,U=Pe}}}}function Un(a,h){var y=h[we];y===void 0&&(y=h[we]=new Set);var S=a+"__bubble";y.has(S)||(E_(h,a,2,!1),y.add(S))}function vm(a,h,y){var S=0;h&&(S|=4),E_(y,a,S,h)}var Mp="_reactListening"+Math.random().toString(36).slice(2);function xm(a){if(!a[Mp]){a[Mp]=!0,ai.forEach(function(y){y!=="selectionchange"&&(Iv.has(y)||vm(y,!1,a),vm(y,!0,a))});var h=a.nodeType===9?a:a.ownerDocument;h===null||h[Mp]||(h[Mp]=!0,vm("selectionchange",!1,h))}}function E_(a,h,y,S){switch(kp(h)){case 2:var z=Bv;break;case 8:z=Fv;break;default:z=Bm}y=z.bind(null,h,y,a),z=void 0,!Gl||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(z=!0),S?z!==void 0?a.addEventListener(h,y,{capture:!0,passive:z}):a.addEventListener(h,y,!0):z!==void 0?a.addEventListener(h,y,{passive:z}):a.addEventListener(h,y,!1)}function bm(a,h,y,S,z){var U=S;if((h&1)===0&&(h&2)===0&&S!==null)e:for(;;){if(S===null)return;var ie=S.tag;if(ie===3||ie===4){var ge=S.stateNode.containerInfo;if(ge===z)break;if(ie===4)for(ie=S.return;ie!==null;){var Pe=ie.tag;if((Pe===3||Pe===4)&&ie.stateNode.containerInfo===z)return;ie=ie.return}for(;ge!==null;){if(ie=Qe(ge),ie===null)return;if(Pe=ie.tag,Pe===5||Pe===6||Pe===26||Pe===27){S=U=ie;continue e}ge=ge.parentNode}}S=S.return}Eu(function(){var lt=U,Mt=ll(y),Nt=[];e:{var ut=jd.get(a);if(ut!==void 0){var pt=Ic,$i=a;switch(a){case"keypress":if(Au(y)===0)break e;case"keydown":case"keyup":pt=Wt;break;case"focusin":$i="focus",pt=Wl;break;case"focusout":$i="blur",pt=Wl;break;case"beforeblur":case"afterblur":pt=Wl;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pt=Ih;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pt=io;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pt=dl;break;case Vd:case hs:case Lu:pt=sn;break;case Bc:pt=Bd;break;case"scroll":case"scrollend":pt=sa;break;case"wheel":pt=zh;break;case"copy":case"cut":case"paste":pt=c_;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pt=nn;break;case"toggle":case"beforetoggle":pt=Rr}var Zi=(h&4)!==0,gr=!Zi&&(a==="scroll"||a==="scrollend"),it=Zi?ut!==null?ut+"Capture":null:ut;Zi=[];for(var Ze=lt,ot;Ze!==null;){var It=Ze;if(ot=It.stateNode,It=It.tag,It!==5&&It!==26&&It!==27||ot===null||it===null||(It=ji(Ze,it),It!=null&&Zi.push(wf(Ze,It,ot))),gr)break;Ze=Ze.return}0<Zi.length&&(ut=new pt(ut,$i,null,y,Mt),Nt.push({event:ut,listeners:Zi}))}}if((h&7)===0){e:{if(ut=a==="mouseover"||a==="pointerover",pt=a==="mouseout"||a==="pointerout",ut&&y!==ws&&($i=y.relatedTarget||y.fromElement)&&(Qe($i)||$i[le]))break e;if((pt||ut)&&(ut=Mt.window===Mt?Mt:(ut=Mt.ownerDocument)?ut.defaultView||ut.parentWindow:window,pt?($i=y.relatedTarget||y.toElement,pt=lt,$i=$i?Qe($i):null,$i!==null&&(gr=H($i),Zi=$i.tag,$i!==gr||Zi!==5&&Zi!==27&&Zi!==6)&&($i=null)):(pt=null,$i=lt),pt!==$i)){if(Zi=Ih,It="onMouseLeave",it="onMouseEnter",Ze="mouse",(a==="pointerout"||a==="pointerover")&&(Zi=nn,It="onPointerLeave",it="onPointerEnter",Ze="pointer"),gr=pt==null?ut:xt(pt),ot=$i==null?ut:xt($i),ut=new Zi(It,Ze+"leave",pt,y,Mt),ut.target=gr,ut.relatedTarget=ot,It=null,Qe(Mt)===lt&&(Zi=new Zi(it,Ze+"enter",$i,y,Mt),Zi.target=ot,Zi.relatedTarget=gr,It=Zi),gr=It,pt&&$i)t:{for(Zi=pt,it=$i,Ze=0,ot=Zi;ot;ot=ya(ot))Ze++;for(ot=0,It=it;It;It=ya(It))ot++;for(;0<Ze-ot;)Zi=ya(Zi),Ze--;for(;0<ot-Ze;)it=ya(it),ot--;for(;Ze--;){if(Zi===it||it!==null&&Zi===it.alternate)break t;Zi=ya(Zi),it=ya(it)}Zi=null}else Zi=null;pt!==null&&cs(Nt,ut,pt,Zi,!1),$i!==null&&gr!==null&&cs(Nt,gr,$i,Zi,!0)}}e:{if(ut=lt?xt(lt):window,pt=ut.nodeName&&ut.nodeName.toLowerCase(),pt==="select"||pt==="input"&&ut.type==="file")var xi=Pc;else if(vo(ut))if(ml)xi=kh;else{xi=Ia;var Dn=Xf}else pt=ut.nodeName,!pt||pt.toLowerCase()!=="input"||ut.type!=="checkbox"&&ut.type!=="radio"?lt&&al(lt.elementType)&&(xi=Pc):xi=Es;if(xi&&(xi=xi(a,lt))){li(Nt,xi,y,Mt);break e}Dn&&Dn(a,ut,lt),a==="focusout"&&lt&&ut.type==="number"&&lt.memoizedProps.value!=null&&qs(ut,"number",ut.value)}switch(Dn=lt?xt(lt):window,a){case"focusin":(vo(Dn)||Dn.contentEditable==="true")&&(so=Dn,Yf=lt,Bh=null);break;case"focusout":Bh=Yf=so=null;break;case"mousedown":Nd=!0;break;case"contextmenu":case"mouseup":case"dragend":Nd=!1,Kf(Nt,y,Mt);break;case"selectionchange":if($f)break;case"keydown":case"keyup":Kf(Nt,y,Mt)}var Ri;if($l)e:{switch(a){case"compositionstart":var qi="onCompositionStart";break e;case"compositionend":qi="onCompositionEnd";break e;case"compositionupdate":qi="onCompositionUpdate";break e}qi=void 0}else Jr?Ts(a,y)&&(qi="onCompositionEnd"):a==="keydown"&&y.keyCode===229&&(qi="onCompositionStart");qi&&(Ph&&y.locale!=="ko"&&(Jr||qi!=="onCompositionStart"?qi==="onCompositionEnd"&&Jr&&(Ri=ul()):(Hl=Mt,Cc="value"in Hl?Hl.value:Hl.textContent,Jr=!0)),Dn=Tf(lt,qi),0<Dn.length&&(qi=new ei(qi,a,null,y,Mt),Nt.push({event:qi,listeners:Dn}),Ri?qi.data=Ri:(Ri=Ca(y),Ri!==null&&(qi.data=Ri)))),(Ri=Lh?Lc(a,y):Ii(a,y))&&(qi=Tf(lt,"onBeforeInput"),0<qi.length&&(Dn=new ei("onBeforeInput","beforeinput",null,y,Mt),Nt.push({event:Dn,listeners:qi}),Dn.data=Ri)),Av(Nt,a,lt,y,Mt)}qg(Nt,h)})}function wf(a,h,y){return{instance:a,listener:h,currentTarget:y}}function Tf(a,h){for(var y=h+"Capture",S=[];a!==null;){var z=a,U=z.stateNode;if(z=z.tag,z!==5&&z!==26&&z!==27||U===null||(z=ji(a,y),z!=null&&S.unshift(wf(a,z,U)),z=ji(a,h),z!=null&&S.push(wf(a,z,U))),a.tag===3)return S;a=a.return}return[]}function ya(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function cs(a,h,y,S,z){for(var U=h._reactName,ie=[];y!==null&&y!==S;){var ge=y,Pe=ge.alternate,lt=ge.stateNode;if(ge=ge.tag,Pe!==null&&Pe===S)break;ge!==5&&ge!==26&&ge!==27||lt===null||(Pe=lt,z?(lt=ji(y,U),lt!=null&&ie.unshift(wf(y,lt,Pe))):z||(lt=ji(y,U),lt!=null&&ie.push(wf(y,lt,Pe)))),y=y.return}ie.length!==0&&a.push({event:h,listeners:ie})}var Zg=/\r\n?/g,Rp=/\u0000|\uFFFD/g;function Xg(a){return(typeof a=="string"?a:""+a).replace(Zg,`
`).replace(Rp,"")}function Wg(a,h){return h=Xg(h),Xg(a)===h}function wm(){}function Cr(a,h,y,S,z,U){switch(y){case"children":typeof S=="string"?h==="body"||h==="textarea"&&S===""||to(a,S):(typeof S=="number"||typeof S=="bigint")&&h!=="body"&&to(a,""+S);break;case"className":Xi(a,"class",S);break;case"tabIndex":Xi(a,"tabindex",S);break;case"dir":case"role":case"viewBox":case"width":case"height":Xi(a,y,S);break;case"style":wu(a,S,U);break;case"data":if(h!=="object"){Xi(a,"data",S);break}case"src":case"href":if(S===""&&(h!=="a"||y!=="href")){a.removeAttribute(y);break}if(S==null||typeof S=="function"||typeof S=="symbol"||typeof S=="boolean"){a.removeAttribute(y);break}S=Su(""+S),a.setAttribute(y,S);break;case"action":case"formAction":if(typeof S=="function"){a.setAttribute(y,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof U=="function"&&(y==="formAction"?(h!=="input"&&Cr(a,h,"name",z.name,z,null),Cr(a,h,"formEncType",z.formEncType,z,null),Cr(a,h,"formMethod",z.formMethod,z,null),Cr(a,h,"formTarget",z.formTarget,z,null)):(Cr(a,h,"encType",z.encType,z,null),Cr(a,h,"method",z.method,z,null),Cr(a,h,"target",z.target,z,null)));if(S==null||typeof S=="symbol"||typeof S=="boolean"){a.removeAttribute(y);break}S=Su(""+S),a.setAttribute(y,S);break;case"onClick":S!=null&&(a.onclick=wm);break;case"onScroll":S!=null&&Un("scroll",a);break;case"onScrollEnd":S!=null&&Un("scrollend",a);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(I(61));if(y=S.__html,y!=null){if(z.children!=null)throw Error(I(60));a.innerHTML=y}}break;case"multiple":a.multiple=S&&typeof S!="function"&&typeof S!="symbol";break;case"muted":a.muted=S&&typeof S!="function"&&typeof S!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(S==null||typeof S=="function"||typeof S=="boolean"||typeof S=="symbol"){a.removeAttribute("xlink:href");break}y=Su(""+S),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",y);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":S!=null&&typeof S!="function"&&typeof S!="symbol"?a.setAttribute(y,""+S):a.removeAttribute(y);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":S&&typeof S!="function"&&typeof S!="symbol"?a.setAttribute(y,""):a.removeAttribute(y);break;case"capture":case"download":S===!0?a.setAttribute(y,""):S!==!1&&S!=null&&typeof S!="function"&&typeof S!="symbol"?a.setAttribute(y,S):a.removeAttribute(y);break;case"cols":case"rows":case"size":case"span":S!=null&&typeof S!="function"&&typeof S!="symbol"&&!isNaN(S)&&1<=S?a.setAttribute(y,S):a.removeAttribute(y);break;case"rowSpan":case"start":S==null||typeof S=="function"||typeof S=="symbol"||isNaN(S)?a.removeAttribute(y):a.setAttribute(y,S);break;case"popover":Un("beforetoggle",a),Un("toggle",a),tn(a,"popover",S);break;case"xlinkActuate":Mn(a,"http://www.w3.org/1999/xlink","xlink:actuate",S);break;case"xlinkArcrole":Mn(a,"http://www.w3.org/1999/xlink","xlink:arcrole",S);break;case"xlinkRole":Mn(a,"http://www.w3.org/1999/xlink","xlink:role",S);break;case"xlinkShow":Mn(a,"http://www.w3.org/1999/xlink","xlink:show",S);break;case"xlinkTitle":Mn(a,"http://www.w3.org/1999/xlink","xlink:title",S);break;case"xlinkType":Mn(a,"http://www.w3.org/1999/xlink","xlink:type",S);break;case"xmlBase":Mn(a,"http://www.w3.org/XML/1998/namespace","xml:base",S);break;case"xmlLang":Mn(a,"http://www.w3.org/XML/1998/namespace","xml:lang",S);break;case"xmlSpace":Mn(a,"http://www.w3.org/XML/1998/namespace","xml:space",S);break;case"is":tn(a,"is",S);break;case"innerText":case"textContent":break;default:(!(2<y.length)||y[0]!=="o"&&y[0]!=="O"||y[1]!=="n"&&y[1]!=="N")&&(y=Tu.get(y)||y,tn(a,y,S))}}function gd(a,h,y,S,z,U){switch(y){case"style":wu(a,S,U);break;case"dangerouslySetInnerHTML":if(S!=null){if(typeof S!="object"||!("__html"in S))throw Error(I(61));if(y=S.__html,y!=null){if(z.children!=null)throw Error(I(60));a.innerHTML=y}}break;case"children":typeof S=="string"?to(a,S):(typeof S=="number"||typeof S=="bigint")&&to(a,""+S);break;case"onScroll":S!=null&&Un("scroll",a);break;case"onScrollEnd":S!=null&&Un("scrollend",a);break;case"onClick":S!=null&&(a.onclick=wm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!fi.hasOwnProperty(y))e:{if(y[0]==="o"&&y[1]==="n"&&(z=y.endsWith("Capture"),h=y.slice(2,z?y.length-7:void 0),U=a[K]||null,U=U!=null?U[y]:null,typeof U=="function"&&a.removeEventListener(h,U,z),typeof S=="function")){typeof U!="function"&&U!==null&&(y in a?a[y]=null:a.hasAttribute(y)&&a.removeAttribute(y)),a.addEventListener(h,S,z);break e}y in a?a[y]=S:S===!0?a.setAttribute(y,""):tn(a,y,S)}}}function Vs(a,h,y){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Un("error",a),Un("load",a);var S=!1,z=!1,U;for(U in y)if(y.hasOwnProperty(U)){var ie=y[U];if(ie!=null)switch(U){case"src":S=!0;break;case"srcSet":z=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(I(137,h));default:Cr(a,h,U,ie,y,null)}}z&&Cr(a,h,"srcSet",y.srcSet,y,null),S&&Cr(a,h,"src",y.src,y,null);return;case"input":Un("invalid",a);var ge=U=ie=z=null,Pe=null,lt=null;for(S in y)if(y.hasOwnProperty(S)){var Mt=y[S];if(Mt!=null)switch(S){case"name":z=Mt;break;case"type":ie=Mt;break;case"checked":Pe=Mt;break;case"defaultChecked":lt=Mt;break;case"value":U=Mt;break;case"defaultValue":ge=Mt;break;case"children":case"dangerouslySetInnerHTML":if(Mt!=null)throw Error(I(137,h));break;default:Cr(a,h,S,Mt,y,null)}}Mo(a,U,ge,Pe,lt,ie,z,!1),jl(a);return;case"select":Un("invalid",a),S=ie=U=null;for(z in y)if(y.hasOwnProperty(z)&&(ge=y[z],ge!=null))switch(z){case"value":U=ge;break;case"defaultValue":ie=ge;break;case"multiple":S=ge;default:Cr(a,h,z,ge,y,null)}h=U,y=ie,a.multiple=!!S,h!=null?bs(a,!!S,h,!1):y!=null&&bs(a,!!S,y,!0);return;case"textarea":Un("invalid",a),U=z=S=null;for(ie in y)if(y.hasOwnProperty(ie)&&(ge=y[ie],ge!=null))switch(ie){case"value":S=ge;break;case"defaultValue":z=ge;break;case"children":U=ge;break;case"dangerouslySetInnerHTML":if(ge!=null)throw Error(I(91));break;default:Cr(a,h,ie,ge,y,null)}Ro(a,S,z,U),jl(a);return;case"option":for(Pe in y)if(y.hasOwnProperty(Pe)&&(S=y[Pe],S!=null))switch(Pe){case"selected":a.selected=S&&typeof S!="function"&&typeof S!="symbol";break;default:Cr(a,h,Pe,S,y,null)}return;case"dialog":Un("beforetoggle",a),Un("toggle",a),Un("cancel",a),Un("close",a);break;case"iframe":case"object":Un("load",a);break;case"video":case"audio":for(S=0;S<bf.length;S++)Un(bf[S],a);break;case"image":Un("error",a),Un("load",a);break;case"details":Un("toggle",a);break;case"embed":case"source":case"link":Un("error",a),Un("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(lt in y)if(y.hasOwnProperty(lt)&&(S=y[lt],S!=null))switch(lt){case"children":case"dangerouslySetInnerHTML":throw Error(I(137,h));default:Cr(a,h,lt,S,y,null)}return;default:if(al(h)){for(Mt in y)y.hasOwnProperty(Mt)&&(S=y[Mt],S!==void 0&&gd(a,h,Mt,S,y,void 0));return}}for(ge in y)y.hasOwnProperty(ge)&&(S=y[ge],S!=null&&Cr(a,h,ge,S,y,null))}function yd(a,h,y,S){switch(h){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var z=null,U=null,ie=null,ge=null,Pe=null,lt=null,Mt=null;for(pt in y){var Nt=y[pt];if(y.hasOwnProperty(pt)&&Nt!=null)switch(pt){case"checked":break;case"value":break;case"defaultValue":Pe=Nt;default:S.hasOwnProperty(pt)||Cr(a,h,pt,null,S,Nt)}}for(var ut in S){var pt=S[ut];if(Nt=y[ut],S.hasOwnProperty(ut)&&(pt!=null||Nt!=null))switch(ut){case"type":U=pt;break;case"name":z=pt;break;case"checked":lt=pt;break;case"defaultChecked":Mt=pt;break;case"value":ie=pt;break;case"defaultValue":ge=pt;break;case"children":case"dangerouslySetInnerHTML":if(pt!=null)throw Error(I(137,h));break;default:pt!==Nt&&Cr(a,h,ut,pt,S,Nt)}}bu(a,ie,ge,Pe,lt,Mt,U,z);return;case"select":pt=ie=ge=ut=null;for(U in y)if(Pe=y[U],y.hasOwnProperty(U)&&Pe!=null)switch(U){case"value":break;case"multiple":pt=Pe;default:S.hasOwnProperty(U)||Cr(a,h,U,null,S,Pe)}for(z in S)if(U=S[z],Pe=y[z],S.hasOwnProperty(z)&&(U!=null||Pe!=null))switch(z){case"value":ut=U;break;case"defaultValue":ge=U;break;case"multiple":ie=U;default:U!==Pe&&Cr(a,h,z,U,S,Pe)}h=ge,y=ie,S=pt,ut!=null?bs(a,!!y,ut,!1):!!S!=!!y&&(h!=null?bs(a,!!y,h,!0):bs(a,!!y,y?[]:"",!1));return;case"textarea":pt=ut=null;for(ge in y)if(z=y[ge],y.hasOwnProperty(ge)&&z!=null&&!S.hasOwnProperty(ge))switch(ge){case"value":break;case"children":break;default:Cr(a,h,ge,null,S,z)}for(ie in S)if(z=S[ie],U=y[ie],S.hasOwnProperty(ie)&&(z!=null||U!=null))switch(ie){case"value":ut=z;break;case"defaultValue":pt=z;break;case"children":break;case"dangerouslySetInnerHTML":if(z!=null)throw Error(I(91));break;default:z!==U&&Cr(a,h,ie,z,S,U)}Sa(a,ut,pt);return;case"option":for(var $i in y)if(ut=y[$i],y.hasOwnProperty($i)&&ut!=null&&!S.hasOwnProperty($i))switch($i){case"selected":a.selected=!1;break;default:Cr(a,h,$i,null,S,ut)}for(Pe in S)if(ut=S[Pe],pt=y[Pe],S.hasOwnProperty(Pe)&&ut!==pt&&(ut!=null||pt!=null))switch(Pe){case"selected":a.selected=ut&&typeof ut!="function"&&typeof ut!="symbol";break;default:Cr(a,h,Pe,ut,S,pt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Zi in y)ut=y[Zi],y.hasOwnProperty(Zi)&&ut!=null&&!S.hasOwnProperty(Zi)&&Cr(a,h,Zi,null,S,ut);for(lt in S)if(ut=S[lt],pt=y[lt],S.hasOwnProperty(lt)&&ut!==pt&&(ut!=null||pt!=null))switch(lt){case"children":case"dangerouslySetInnerHTML":if(ut!=null)throw Error(I(137,h));break;default:Cr(a,h,lt,ut,S,pt)}return;default:if(al(h)){for(var gr in y)ut=y[gr],y.hasOwnProperty(gr)&&ut!==void 0&&!S.hasOwnProperty(gr)&&gd(a,h,gr,void 0,S,ut);for(Mt in S)ut=S[Mt],pt=y[Mt],!S.hasOwnProperty(Mt)||ut===pt||ut===void 0&&pt===void 0||gd(a,h,Mt,ut,S,pt);return}}for(var it in y)ut=y[it],y.hasOwnProperty(it)&&ut!=null&&!S.hasOwnProperty(it)&&Cr(a,h,it,null,S,ut);for(Nt in S)ut=S[Nt],pt=y[Nt],!S.hasOwnProperty(Nt)||ut===pt||ut==null&&pt==null||Cr(a,h,Nt,ut,S,pt)}var vd=null,A_=null;function Tm(a){return a.nodeType===9?a:a.ownerDocument}function $g(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Yg(a,h){if(a===0)switch(h){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&h==="foreignObject"?0:a}function C_(a,h){return a==="textarea"||a==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.children=="bigint"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var I_=null;function Mv(){var a=window.event;return a&&a.type==="popstate"?a===I_?!1:(I_=a,!0):(I_=null,!1)}var Sm=typeof setTimeout=="function"?setTimeout:void 0,Rv=typeof clearTimeout=="function"?clearTimeout:void 0,M_=typeof Promise=="function"?Promise:void 0,Dp=typeof queueMicrotask=="function"?queueMicrotask:typeof M_<"u"?function(a){return M_.resolve(null).then(a).catch(Dv)}:Sm;function Dv(a){setTimeout(function(){throw a})}function br(a){return a==="head"}function xd(a,h){var y=h,S=0,z=0;do{var U=y.nextSibling;if(a.removeChild(y),U&&U.nodeType===8)if(y=U.data,y==="/$"){if(0<S&&8>S){y=S;var ie=a.ownerDocument;if(y&1&&Lp(ie.documentElement),y&2&&Lp(ie.body),y&4)for(y=ie.head,Lp(y),ie=y.firstChild;ie;){var ge=ie.nextSibling,Pe=ie.nodeName;ie[Ae]||Pe==="SCRIPT"||Pe==="STYLE"||Pe==="LINK"&&ie.rel.toLowerCase()==="stylesheet"||y.removeChild(ie),ie=ge}}if(z===0){a.removeChild(U),Vp(h);return}z--}else y==="$"||y==="$?"||y==="$!"?z++:S=y.charCodeAt(0)-48;else S=0;y=U}while(y);Vp(h)}function Em(a){var h=a.firstChild;for(h&&h.nodeType===10&&(h=h.nextSibling);h;){var y=h;switch(h=h.nextSibling,y.nodeName){case"HTML":case"HEAD":case"BODY":Em(y),ke(y);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(y.rel.toLowerCase()==="stylesheet")continue}a.removeChild(y)}}function Am(a,h,y,S){for(;a.nodeType===1;){var z=y;if(a.nodeName.toLowerCase()!==h.toLowerCase()){if(!S&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(S){if(!a[Ae])switch(h){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(U=a.getAttribute("rel"),U==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(U!==z.rel||a.getAttribute("href")!==(z.href==null||z.href===""?null:z.href)||a.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin)||a.getAttribute("title")!==(z.title==null?null:z.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(U=a.getAttribute("src"),(U!==(z.src==null?null:z.src)||a.getAttribute("type")!==(z.type==null?null:z.type)||a.getAttribute("crossorigin")!==(z.crossOrigin==null?null:z.crossOrigin))&&U&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(h==="input"&&a.type==="hidden"){var U=z.name==null?null:""+z.name;if(z.type==="hidden"&&a.getAttribute("name")===U)return a}else return a;if(a=el(a.nextSibling),a===null)break}return null}function Cm(a,h,y){if(h==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!y||(a=el(a.nextSibling),a===null))return null;return a}function bd(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function Kg(a,h){var y=a.ownerDocument;if(a.data!=="$?"||y.readyState==="complete")h();else{var S=function(){h(),y.removeEventListener("DOMContentLoaded",S)};y.addEventListener("DOMContentLoaded",S),a._reactRetry=S}}function el(a){for(;a!=null;a=a.nextSibling){var h=a.nodeType;if(h===1||h===3)break;if(h===8){if(h=a.data,h==="$"||h==="$!"||h==="$?"||h==="F!"||h==="F")break;if(h==="/$")return null}}return a}var wd=null;function Im(a){a=a.previousSibling;for(var h=0;a;){if(a.nodeType===8){var y=a.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return a;h--}else y==="/$"&&h++}a=a.previousSibling}return null}function zp(a,h,y){switch(h=Tm(y),a){case"html":if(a=h.documentElement,!a)throw Error(I(452));return a;case"head":if(a=h.head,!a)throw Error(I(453));return a;case"body":if(a=h.body,!a)throw Error(I(454));return a;default:throw Error(I(451))}}function Lp(a){for(var h=a.attributes;h.length;)a.removeAttributeNode(h[0]);ke(a)}var va=new Map,Mm=new Set;function Sf(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var xc=oi.d;oi.d={f:Td,r:zv,D:Qg,C:Jg,L:Rm,m:Lv,X:D_,S:Pv,M:ey};function Td(){var a=xc.f(),h=_c();return a||h}function zv(a){var h=Ne(a);h!==null&&h.tag===5&&h.type==="form"?dc(h):xc.r(a)}var Rs=typeof document>"u"?null:document;function R_(a,h,y){var S=Rs;if(S&&typeof h=="string"&&h){var z=Bs(h);z='link[rel="'+a+'"][href="'+z+'"]',typeof y=="string"&&(z+='[crossorigin="'+y+'"]'),Mm.has(z)||(Mm.add(z),a={rel:a,crossOrigin:y,href:h},S.querySelector(z)===null&&(h=S.createElement("link"),Vs(h,"link",a),Rt(h),S.head.appendChild(h)))}}function Qg(a){xc.D(a),R_("dns-prefetch",a,null)}function Jg(a,h){xc.C(a,h),R_("preconnect",a,h)}function Rm(a,h,y){xc.L(a,h,y);var S=Rs;if(S&&a&&h){var z='link[rel="preload"][as="'+Bs(h)+'"]';h==="image"&&y&&y.imageSrcSet?(z+='[imagesrcset="'+Bs(y.imageSrcSet)+'"]',typeof y.imageSizes=="string"&&(z+='[imagesizes="'+Bs(y.imageSizes)+'"]')):z+='[href="'+Bs(a)+'"]';var U=z;switch(h){case"style":U=ph(a);break;case"script":U=Sd(a)}va.has(U)||(a=Ke({rel:"preload",href:h==="image"&&y&&y.imageSrcSet?void 0:a,as:h},y),va.set(U,a),S.querySelector(z)!==null||h==="style"&&S.querySelector(Ef(U))||h==="script"&&S.querySelector(Ed(U))||(h=S.createElement("link"),Vs(h,"link",a),Rt(h),S.head.appendChild(h)))}}function Lv(a,h){xc.m(a,h);var y=Rs;if(y&&a){var S=h&&typeof h.as=="string"?h.as:"script",z='link[rel="modulepreload"][as="'+Bs(S)+'"][href="'+Bs(a)+'"]',U=z;switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":U=Sd(a)}if(!va.has(U)&&(a=Ke({rel:"modulepreload",href:a},h),va.set(U,a),y.querySelector(z)===null)){switch(S){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(y.querySelector(Ed(U)))return}S=y.createElement("link"),Vs(S,"link",a),Rt(S),y.head.appendChild(S)}}}function Pv(a,h,y){xc.S(a,h,y);var S=Rs;if(S&&a){var z=Ft(S).hoistableStyles,U=ph(a);h=h||"default";var ie=z.get(U);if(!ie){var ge={loading:0,preload:null};if(ie=S.querySelector(Ef(U)))ge.loading=5;else{a=Ke({rel:"stylesheet",href:a,"data-precedence":h},y),(y=va.get(U))&&L_(a,y);var Pe=ie=S.createElement("link");Rt(Pe),Vs(Pe,"link",a),Pe._p=new Promise(function(lt,Mt){Pe.onload=lt,Pe.onerror=Mt}),Pe.addEventListener("load",function(){ge.loading|=1}),Pe.addEventListener("error",function(){ge.loading|=2}),ge.loading|=4,Pp(ie,h,S)}ie={type:"stylesheet",instance:ie,count:1,state:ge},z.set(U,ie)}}}function D_(a,h){xc.X(a,h);var y=Rs;if(y&&a){var S=Ft(y).hoistableScripts,z=Sd(a),U=S.get(z);U||(U=y.querySelector(Ed(z)),U||(a=Ke({src:a,async:!0},h),(h=va.get(z))&&P_(a,h),U=y.createElement("script"),Rt(U),Vs(U,"link",a),y.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(z,U))}}function ey(a,h){xc.M(a,h);var y=Rs;if(y&&a){var S=Ft(y).hoistableScripts,z=Sd(a),U=S.get(z);U||(U=y.querySelector(Ed(z)),U||(a=Ke({src:a,async:!0,type:"module"},h),(h=va.get(z))&&P_(a,h),U=y.createElement("script"),Rt(U),Vs(U,"link",a),y.head.appendChild(U)),U={type:"script",instance:U,count:1,state:null},S.set(z,U))}}function Dm(a,h,y,S){var z=(z=yi.current)?Sf(z):null;if(!z)throw Error(I(446));switch(a){case"meta":case"title":return null;case"style":return typeof y.precedence=="string"&&typeof y.href=="string"?(h=ph(y.href),y=Ft(z).hoistableStyles,S=y.get(h),S||(S={type:"style",instance:null,count:0,state:null},y.set(h,S)),S):{type:"void",instance:null,count:0,state:null};case"link":if(y.rel==="stylesheet"&&typeof y.href=="string"&&typeof y.precedence=="string"){a=ph(y.href);var U=Ft(z).hoistableStyles,ie=U.get(a);if(ie||(z=z.ownerDocument||z,ie={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},U.set(a,ie),(U=z.querySelector(Ef(a)))&&!U._p&&(ie.instance=U,ie.state.loading=5),va.has(a)||(y={rel:"preload",as:"style",href:y.href,crossOrigin:y.crossOrigin,integrity:y.integrity,media:y.media,hrefLang:y.hrefLang,referrerPolicy:y.referrerPolicy},va.set(a,y),U||ty(z,a,y,ie.state))),h&&S===null)throw Error(I(528,""));return ie}if(h&&S!==null)throw Error(I(529,""));return null;case"script":return h=y.async,y=y.src,typeof y=="string"&&h&&typeof h!="function"&&typeof h!="symbol"?(h=Sd(y),y=Ft(z).hoistableScripts,S=y.get(h),S||(S={type:"script",instance:null,count:0,state:null},y.set(h,S)),S):{type:"void",instance:null,count:0,state:null};default:throw Error(I(444,a))}}function ph(a){return'href="'+Bs(a)+'"'}function Ef(a){return'link[rel="stylesheet"]['+a+"]"}function z_(a){return Ke({},a,{"data-precedence":a.precedence,precedence:null})}function ty(a,h,y,S){a.querySelector('link[rel="preload"][as="style"]['+h+"]")?S.loading=1:(h=a.createElement("link"),S.preload=h,h.addEventListener("load",function(){return S.loading|=1}),h.addEventListener("error",function(){return S.loading|=2}),Vs(h,"link",y),Rt(h),a.head.appendChild(h))}function Sd(a){return'[src="'+Bs(a)+'"]'}function Ed(a){return"script[async]"+a}function Pl(a,h,y){if(h.count++,h.instance===null)switch(h.type){case"style":var S=a.querySelector('style[data-href~="'+Bs(y.href)+'"]');if(S)return h.instance=S,Rt(S),S;var z=Ke({},y,{"data-href":y.href,"data-precedence":y.precedence,href:null,precedence:null});return S=(a.ownerDocument||a).createElement("style"),Rt(S),Vs(S,"style",z),Pp(S,y.precedence,a),h.instance=S;case"stylesheet":z=ph(y.href);var U=a.querySelector(Ef(z));if(U)return h.state.loading|=4,h.instance=U,Rt(U),U;S=z_(y),(z=va.get(z))&&L_(S,z),U=(a.ownerDocument||a).createElement("link"),Rt(U);var ie=U;return ie._p=new Promise(function(ge,Pe){ie.onload=ge,ie.onerror=Pe}),Vs(U,"link",S),h.state.loading|=4,Pp(U,y.precedence,a),h.instance=U;case"script":return U=Sd(y.src),(z=a.querySelector(Ed(U)))?(h.instance=z,Rt(z),z):(S=y,(z=va.get(U))&&(S=Ke({},y),P_(S,z)),a=a.ownerDocument||a,z=a.createElement("script"),Rt(z),Vs(z,"link",S),a.head.appendChild(z),h.instance=z);case"void":return null;default:throw Error(I(443,h.type))}else h.type==="stylesheet"&&(h.state.loading&4)===0&&(S=h.instance,h.state.loading|=4,Pp(S,y.precedence,a));return h.instance}function Pp(a,h,y){for(var S=y.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),z=S.length?S[S.length-1]:null,U=z,ie=0;ie<S.length;ie++){var ge=S[ie];if(ge.dataset.precedence===h)U=ge;else if(U!==z)break}U?U.parentNode.insertBefore(a,U.nextSibling):(h=y.nodeType===9?y.head:y,h.insertBefore(a,h.firstChild))}function L_(a,h){a.crossOrigin==null&&(a.crossOrigin=h.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=h.referrerPolicy),a.title==null&&(a.title=h.title)}function P_(a,h){a.crossOrigin==null&&(a.crossOrigin=h.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=h.referrerPolicy),a.integrity==null&&(a.integrity=h.integrity)}var zm=null;function iy(a,h,y){if(zm===null){var S=new Map,z=zm=new Map;z.set(y,S)}else z=zm,S=z.get(y),S||(S=new Map,z.set(y,S));if(S.has(a))return S;for(S.set(a,null),y=y.getElementsByTagName(a),z=0;z<y.length;z++){var U=y[z];if(!(U[Ae]||U[W]||a==="link"&&U.getAttribute("rel")==="stylesheet")&&U.namespaceURI!=="http://www.w3.org/2000/svg"){var ie=U.getAttribute(h)||"";ie=a+ie;var ge=S.get(ie);ge?ge.push(U):S.set(ie,[U])}}return S}function ny(a,h,y){a=a.ownerDocument||a,a.head.insertBefore(y,h==="title"?a.querySelector("head > title"):null)}function Ov(a,h,y){if(y===1||h.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof h.precedence!="string"||typeof h.href!="string"||h.href==="")break;return!0;case"link":if(typeof h.rel!="string"||typeof h.href!="string"||h.href===""||h.onLoad||h.onError)break;switch(h.rel){case"stylesheet":return a=h.disabled,typeof h.precedence=="string"&&a==null;default:return!0}case"script":if(h.async&&typeof h.async!="function"&&typeof h.async!="symbol"&&!h.onLoad&&!h.onError&&h.src&&typeof h.src=="string")return!0}return!1}function ry(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var mh=null;function sy(){}function Lm(a,h,y){if(mh===null)throw Error(I(475));var S=mh;if(h.type==="stylesheet"&&(typeof y.media!="string"||matchMedia(y.media).matches!==!1)&&(h.state.loading&4)===0){if(h.instance===null){var z=ph(y.href),U=a.querySelector(Ef(z));if(U){a=U._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(S.count++,S=Af.bind(S),a.then(S,S)),h.state.loading|=4,h.instance=U,Rt(U);return}U=a.ownerDocument||a,y=z_(y),(z=va.get(z))&&L_(y,z),U=U.createElement("link"),Rt(U);var ie=U;ie._p=new Promise(function(ge,Pe){ie.onload=ge,ie.onerror=Pe}),Vs(U,"link",y),h.instance=U}S.stylesheets===null&&(S.stylesheets=new Map),S.stylesheets.set(h,a),(a=h.state.preload)&&(h.state.loading&3)===0&&(S.count++,h=Af.bind(S),a.addEventListener("load",h),a.addEventListener("error",h))}}function oy(){if(mh===null)throw Error(I(475));var a=mh;return a.stylesheets&&a.count===0&&Pm(a,a.stylesheets),0<a.count?function(h){var y=setTimeout(function(){if(a.stylesheets&&Pm(a,a.stylesheets),a.unsuspend){var S=a.unsuspend;a.unsuspend=null,S()}},6e4);return a.unsuspend=h,function(){a.unsuspend=null,clearTimeout(y)}}:null}function Af(){if(this.count--,this.count===0){if(this.stylesheets)Pm(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Cf=null;function Pm(a,h){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Cf=new Map,h.forEach(kv,a),Cf=null,Af.call(a))}function kv(a,h){if(!(h.state.loading&4)){var y=Cf.get(a);if(y)var S=y.get(null);else{y=new Map,Cf.set(a,y);for(var z=a.querySelectorAll("link[data-precedence],style[data-precedence]"),U=0;U<z.length;U++){var ie=z[U];(ie.nodeName==="LINK"||ie.getAttribute("media")!=="not all")&&(y.set(ie.dataset.precedence,ie),S=ie)}S&&y.set(null,S)}z=h.instance,ie=z.getAttribute("data-precedence"),U=y.get(ie)||S,U===S&&y.set(null,z),y.set(ie,z),this.count++,S=Af.bind(this),z.addEventListener("load",S),z.addEventListener("error",S),U?U.parentNode.insertBefore(z,U.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(z,a.firstChild)),h.state.loading|=4}}var If={$$typeof:xn,Provider:null,Consumer:null,_currentValue:Oi,_currentValue2:Oi,_threadCount:0};function ay(a,h,y,S,z,U,ie,ge){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=ks(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ks(0),this.hiddenUpdates=ks(null),this.identifierPrefix=S,this.onUncaughtError=z,this.onCaughtError=U,this.onRecoverableError=ie,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ge,this.incompleteTransitions=new Map}function O_(a,h,y,S,z,U,ie,ge,Pe,lt,Mt,Nt){return a=new ay(a,h,y,ie,ge,Pe,lt,Nt),h=1,U===!0&&(h|=24),U=To(3,null,null,h),a.current=U,U.stateNode=a,h=ju(),h.refCount++,a.pooledCache=h,h.refCount++,U.memoizedState={element:S,isDehydrated:y,cache:h},Yd(U),a}function k_(a){return a?(a=la,a):la}function Om(a,h,y,S,z,U){z=k_(z),S.context===null?S.context=z:S.pendingContext=z,S=co(h),S.payload={element:y},U=U===void 0?null:U,U!==null&&(S.callback=U),y=Cl(a,S,h),y!==null&&(ts(y,a,h),Bo(y,a,h))}function B_(a,h){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var y=a.retryLane;a.retryLane=y!==0&&y<h?y:h}}function Op(a,h){B_(a,h),(a=a.alternate)&&B_(a,h)}function ly(a){if(a.tag===13){var h=gl(a,67108864);h!==null&&ts(h,a,67108864),Op(a,67108864)}}var km=!0;function Bv(a,h,y,S){var z=wt.T;wt.T=null;var U=oi.p;try{oi.p=2,Bm(a,h,y,S)}finally{oi.p=U,wt.T=z}}function Fv(a,h,y,S){var z=wt.T;wt.T=null;var U=oi.p;try{oi.p=8,Bm(a,h,y,S)}finally{oi.p=U,wt.T=z}}function Bm(a,h,y,S){if(km){var z=bc(S);if(z===null)bm(a,h,S,_h,y),Fp(a,S);else if(Nv(z,a,h,y,S))S.stopPropagation();else if(Fp(a,S),h&4&&-1<cy.indexOf(a)){for(;z!==null;){var U=Ne(z);if(U!==null)switch(U.tag){case 3:if(U=U.stateNode,U.current.memoizedState.isDehydrated){var ie=go(U.pendingLanes);if(ie!==0){var ge=U;for(ge.pendingLanes|=2,ge.entangledLanes|=2;ie;){var Pe=1<<31-Xr(ie);ge.entanglements[1]|=Pe,ie&=~Pe}Ll(U),(Lt&6)===0&&(Sn=Ps()+500,fh(0))}}break;case 13:ge=gl(U,2),ge!==null&&ts(ge,U,2),_c(),Op(U,2)}if(U=bc(S),U===null&&bm(a,h,S,_h,y),U===z)break;z=U}z!==null&&S.stopPropagation()}else bm(a,h,S,null,y)}}function bc(a){return a=ll(a),Ad(a)}var _h=null;function Ad(a){if(_h=null,a=Qe(a),a!==null){var h=H(a);if(h===null)a=null;else{var y=h.tag;if(y===13){if(a=Q(h),a!==null)return a;a=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;a=null}else h!==a&&(a=null)}}return _h=a,null}function kp(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(bh()){case ys:return 2;case Hs:return 8;case Jo:case Ul:return 32;case sl:return 268435456;default:return 32}default:return 32}}var Cd=!1,au=null,lu=null,cu=null,Mf=new Map,Bp=new Map,gh=[],cy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Fp(a,h){switch(a){case"focusin":case"focusout":au=null;break;case"dragenter":case"dragleave":lu=null;break;case"mouseover":case"mouseout":cu=null;break;case"pointerover":case"pointerout":Mf.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Bp.delete(h.pointerId)}}function Rf(a,h,y,S,z,U){return a===null||a.nativeEvent!==U?(a={blockedOn:h,domEventName:y,eventSystemFlags:S,nativeEvent:U,targetContainers:[z]},h!==null&&(h=Ne(h),h!==null&&ly(h)),a):(a.eventSystemFlags|=S,h=a.targetContainers,z!==null&&h.indexOf(z)===-1&&h.push(z),a)}function Nv(a,h,y,S,z){switch(h){case"focusin":return au=Rf(au,a,h,y,S,z),!0;case"dragenter":return lu=Rf(lu,a,h,y,S,z),!0;case"mouseover":return cu=Rf(cu,a,h,y,S,z),!0;case"pointerover":var U=z.pointerId;return Mf.set(U,Rf(Mf.get(U)||null,a,h,y,S,z)),!0;case"gotpointercapture":return U=z.pointerId,Bp.set(U,Rf(Bp.get(U)||null,a,h,y,S,z)),!0}return!1}function F_(a){var h=Qe(a.target);if(h!==null){var y=H(h);if(y!==null){if(h=y.tag,h===13){if(h=Q(y),h!==null){a.blockedOn=h,en(a.priority,function(){if(y.tag===13){var S=es();S=ia(S);var z=gl(y,S);z!==null&&ts(z,y,S),Op(y,S)}});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){a.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Df(a){if(a.blockedOn!==null)return!1;for(var h=a.targetContainers;0<h.length;){var y=bc(a.nativeEvent);if(y===null){y=a.nativeEvent;var S=new y.constructor(y.type,y);ws=S,y.target.dispatchEvent(S),ws=null}else return h=Ne(y),h!==null&&ly(h),a.blockedOn=y,!1;h.shift()}return!0}function N_(a,h,y){Df(a)&&y.delete(h)}function uy(){Cd=!1,au!==null&&Df(au)&&(au=null),lu!==null&&Df(lu)&&(lu=null),cu!==null&&Df(cu)&&(cu=null),Mf.forEach(N_),Bp.forEach(N_)}function Np(a,h){a.blockedOn===h&&(a.blockedOn=null,Cd||(Cd=!0,E.unstable_scheduleCallback(E.unstable_NormalPriority,uy)))}var Up=null;function U_(a){Up!==a&&(Up=a,E.unstable_scheduleCallback(E.unstable_NormalPriority,function(){Up===a&&(Up=null);for(var h=0;h<a.length;h+=3){var y=a[h],S=a[h+1],z=a[h+2];if(typeof S!="function"){if(Ad(S||y)===null)continue;break}var U=Ne(y);U!==null&&(a.splice(h,3),h-=3,Ju(U,{pending:!0,data:z,method:y.method,action:S},S,z))}}))}function Vp(a){function h(Pe){return Np(Pe,a)}au!==null&&Np(au,a),lu!==null&&Np(lu,a),cu!==null&&Np(cu,a),Mf.forEach(h),Bp.forEach(h);for(var y=0;y<gh.length;y++){var S=gh[y];S.blockedOn===a&&(S.blockedOn=null)}for(;0<gh.length&&(y=gh[0],y.blockedOn===null);)F_(y),y.blockedOn===null&&gh.shift();if(y=(a.ownerDocument||a).$$reactFormReplay,y!=null)for(S=0;S<y.length;S+=3){var z=y[S],U=y[S+1],ie=z[K]||null;if(typeof U=="function")ie||U_(y);else if(ie){var ge=null;if(U&&U.hasAttribute("formAction")){if(z=U,ie=U[K]||null)ge=ie.formAction;else if(Ad(z)!==null)continue}else ge=ie.action;typeof ge=="function"?y[S+1]=ge:(y.splice(S,3),S-=3),U_(y)}}}function Fm(a){this._internalRoot=a}jp.prototype.render=Fm.prototype.render=function(a){var h=this._internalRoot;if(h===null)throw Error(I(409));var y=h.current,S=es();Om(y,S,a,h,null,null)},jp.prototype.unmount=Fm.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var h=a.containerInfo;Om(a.current,2,null,a,null,null),_c(),h[le]=null}};function jp(a){this._internalRoot=a}jp.prototype.unstable_scheduleHydration=function(a){if(a){var h=xu();a={blockedOn:null,target:a,priority:h};for(var y=0;y<gh.length&&h!==0&&h<gh[y].priority;y++);gh.splice(y,0,a),y===0&&F_(a)}};var yh=m.version;if(yh!=="19.1.0")throw Error(I(527,yh,"19.1.0"));oi.findDOMNode=function(a){var h=a._reactInternals;if(h===void 0)throw typeof a.render=="function"?Error(I(188)):(a=Object.keys(a).join(","),Error(I(268,a)));return a=xe(h),a=a!==null?pe(a):null,a=a===null?null:a.stateNode,a};var hy={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:wt,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gp.isDisabled&&Gp.supportsFiber)try{ba=Gp.inject(hy),Ar=Gp}catch{}}return cg.createRoot=function(a,h){if(!B(a))throw Error(I(299));var y=!1,S="",z=lf,U=sh,ie=iu,ge=null;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(S=h.identifierPrefix),h.onUncaughtError!==void 0&&(z=h.onUncaughtError),h.onCaughtError!==void 0&&(U=h.onCaughtError),h.onRecoverableError!==void 0&&(ie=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(ge=h.unstable_transitionCallbacks)),h=O_(a,1,!1,null,null,y,S,z,U,ie,ge,null),a[le]=h.current,xm(a),new Fm(h)},cg.hydrateRoot=function(a,h,y){if(!B(a))throw Error(I(299));var S=!1,z="",U=lf,ie=sh,ge=iu,Pe=null,lt=null;return y!=null&&(y.unstable_strictMode===!0&&(S=!0),y.identifierPrefix!==void 0&&(z=y.identifierPrefix),y.onUncaughtError!==void 0&&(U=y.onUncaughtError),y.onCaughtError!==void 0&&(ie=y.onCaughtError),y.onRecoverableError!==void 0&&(ge=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(Pe=y.unstable_transitionCallbacks),y.formState!==void 0&&(lt=y.formState)),h=O_(a,1,!0,h,y??null,S,z,U,ie,ge,Pe,lt),h.context=k_(null),y=h.current,S=es(),S=ia(S),z=co(S),z.callback=null,Cl(y,z,S),y=S,h.current.lanes=y,Sc(h,y),Ll(h),a[le]=h.current,xm(a),new jp(h)},cg.version="19.1.0",cg}var Mw;function zA(){if(Mw)return L0.exports;Mw=1;function E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(E)}catch(m){console.error(m)}}return E(),L0.exports=DA(),L0.exports}var LA=zA();const PA=px(LA);var Ky={exports:{}},OA=Ky.exports,Rw;function kA(){return Rw||(Rw=1,function(E,m){(function(T,I){E.exports=I()})(OA,function(){var T,I,B;function H(o,xe){if(!T)T=xe;else if(!I)I=xe;else{var pe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+T+")(sharedChunk); ("+I+")(sharedChunk); self.onerror = null;",Ke={};T(Ke),B=xe(Ke),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(B.workerUrl=window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"})))}}H(["exports"],function(o){var xe=1e-6,pe=typeof Float32Array<"u"?Float32Array:Array;function Ke(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=i*d-l*s;return f?(n[0]=d*(f=1/f),n[1]=-s*f,n[2]=-l*f,n[3]=i*f,n):null}function nt(){var n=new pe(9);return pe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[5]=0,n[6]=0,n[7]=0),n[0]=1,n[4]=1,n[8]=1,n}function Je(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],C=e[8];return n[0]=f*C-g*b,n[1]=l*b-s*C,n[2]=s*g-l*f,n[3]=g*x-d*C,n[4]=i*C-l*x,n[5]=l*d-i*g,n[6]=d*b-f*x,n[7]=s*x-i*b,n[8]=i*f-s*d,n}function Kt(n,e,i){var s=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],C=e[7],M=e[8],R=i[0],P=i[1],F=i[2],V=i[3],q=i[4],$=i[5],te=i[6],ne=i[7],G=i[8];return n[0]=R*s+P*f+F*b,n[1]=R*l+P*g+F*C,n[2]=R*d+P*x+F*M,n[3]=V*s+q*f+$*b,n[4]=V*l+q*g+$*C,n[5]=V*d+q*x+$*M,n[6]=te*s+ne*f+G*b,n[7]=te*l+ne*g+G*C,n[8]=te*d+ne*x+G*M,n}function pi(){var n=new pe(16);return pe!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function Yt(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Qi(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],C=e[8],M=e[9],R=e[10],P=e[11],F=e[12],V=e[13],q=e[14],$=e[15],te=i*g-s*f,ne=i*x-l*f,G=i*b-d*f,ee=s*x-l*g,re=s*b-d*g,ae=l*b-d*x,Te=C*V-M*F,ve=C*q-R*F,Se=C*$-P*F,Me=M*q-R*V,je=M*$-P*V,ct=R*$-P*q,et=te*ct-ne*je+G*Me+ee*Se-re*ve+ae*Te;return et?(n[0]=(g*ct-x*je+b*Me)*(et=1/et),n[1]=(l*je-s*ct-d*Me)*et,n[2]=(V*ae-q*re+$*ee)*et,n[3]=(R*re-M*ae-P*ee)*et,n[4]=(x*Se-f*ct-b*ve)*et,n[5]=(i*ct-l*Se+d*ve)*et,n[6]=(q*G-F*ae-$*ne)*et,n[7]=(C*ae-R*G+P*ne)*et,n[8]=(f*je-g*Se+b*Te)*et,n[9]=(s*Se-i*je-d*Te)*et,n[10]=(F*re-V*G+$*te)*et,n[11]=(M*G-C*re-P*te)*et,n[12]=(g*ve-f*Me-x*Te)*et,n[13]=(i*Me-s*ve+l*Te)*et,n[14]=(V*ne-F*ee-q*te)*et,n[15]=(C*ee-M*ne+R*te)*et,n):null}function Ji(n,e,i){var s=e[0],l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],C=e[7],M=e[8],R=e[9],P=e[10],F=e[11],V=e[12],q=e[13],$=e[14],te=e[15],ne=i[0],G=i[1],ee=i[2],re=i[3];return n[0]=ne*s+G*g+ee*M+re*V,n[1]=ne*l+G*x+ee*R+re*q,n[2]=ne*d+G*b+ee*P+re*$,n[3]=ne*f+G*C+ee*F+re*te,n[4]=(ne=i[4])*s+(G=i[5])*g+(ee=i[6])*M+(re=i[7])*V,n[5]=ne*l+G*x+ee*R+re*q,n[6]=ne*d+G*b+ee*P+re*$,n[7]=ne*f+G*C+ee*F+re*te,n[8]=(ne=i[8])*s+(G=i[9])*g+(ee=i[10])*M+(re=i[11])*V,n[9]=ne*l+G*x+ee*R+re*q,n[10]=ne*d+G*b+ee*P+re*$,n[11]=ne*f+G*C+ee*F+re*te,n[12]=(ne=i[12])*s+(G=i[13])*g+(ee=i[14])*M+(re=i[15])*V,n[13]=ne*l+G*x+ee*R+re*q,n[14]=ne*d+G*b+ee*P+re*$,n[15]=ne*f+G*C+ee*F+re*te,n}function Yn(n,e,i){var s,l,d,f,g,x,b,C,M,R,P,F,V=i[0],q=i[1],$=i[2];return e===n?(n[12]=e[0]*V+e[4]*q+e[8]*$+e[12],n[13]=e[1]*V+e[5]*q+e[9]*$+e[13],n[14]=e[2]*V+e[6]*q+e[10]*$+e[14],n[15]=e[3]*V+e[7]*q+e[11]*$+e[15]):(l=e[1],d=e[2],f=e[3],g=e[4],x=e[5],b=e[6],C=e[7],M=e[8],R=e[9],P=e[10],F=e[11],n[0]=s=e[0],n[1]=l,n[2]=d,n[3]=f,n[4]=g,n[5]=x,n[6]=b,n[7]=C,n[8]=M,n[9]=R,n[10]=P,n[11]=F,n[12]=s*V+g*q+M*$+e[12],n[13]=l*V+x*q+R*$+e[13],n[14]=d*V+b*q+P*$+e[14],n[15]=f*V+C*q+F*$+e[15]),n}function xn(n,e,i){var s=i[0],l=i[1],d=i[2];return n[0]=e[0]*s,n[1]=e[1]*s,n[2]=e[2]*s,n[3]=e[3]*s,n[4]=e[4]*l,n[5]=e[5]*l,n[6]=e[6]*l,n[7]=e[7]*l,n[8]=e[8]*d,n[9]=e[9]*d,n[10]=e[10]*d,n[11]=e[11]*d,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Nr(n,e,i){var s=Math.sin(i),l=Math.cos(i),d=e[4],f=e[5],g=e[6],x=e[7],b=e[8],C=e[9],M=e[10],R=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=d*l+b*s,n[5]=f*l+C*s,n[6]=g*l+M*s,n[7]=x*l+R*s,n[8]=b*l-d*s,n[9]=C*l-f*s,n[10]=M*l-g*s,n[11]=R*l-x*s,n}function _n(n,e,i){var s=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],b=e[8],C=e[9],M=e[10],R=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l-b*s,n[1]=f*l-C*s,n[2]=g*l-M*s,n[3]=x*l-R*s,n[8]=d*s+b*l,n[9]=f*s+C*l,n[10]=g*s+M*l,n[11]=x*s+R*l,n}function Zr(n,e,i){var s=Math.sin(i),l=Math.cos(i),d=e[0],f=e[1],g=e[2],x=e[3],b=e[4],C=e[5],M=e[6],R=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=d*l+b*s,n[1]=f*l+C*s,n[2]=g*l+M*s,n[3]=x*l+R*s,n[4]=b*l-d*s,n[5]=C*l-f*s,n[6]=M*l-g*s,n[7]=R*l-x*s,n}function us(n,e){return n[0]=e[0],n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=e[1],n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=e[2],n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Kr(n,e,i){var s,l,d,f=i[0],g=i[1],x=i[2],b=Math.hypot(f,g,x);return b<xe?null:(f*=b=1/b,g*=b,x*=b,s=Math.sin(e),l=Math.cos(e),n[0]=f*f*(d=1-l)+l,n[1]=g*f*d+x*s,n[2]=x*f*d-g*s,n[3]=0,n[4]=f*g*d-x*s,n[5]=g*g*d+l,n[6]=x*g*d+f*s,n[7]=0,n[8]=f*x*d+g*s,n[9]=g*x*d-f*s,n[10]=x*x*d+l,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n)}function ns(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=i+i,g=s+s,x=l+l,b=i*f,C=s*f,M=s*g,R=l*f,P=l*g,F=l*x,V=d*f,q=d*g,$=d*x;return n[0]=1-M-F,n[1]=C+$,n[2]=R-q,n[3]=0,n[4]=C-$,n[5]=1-b-F,n[6]=P+V,n[7]=0,n[8]=R+q,n[9]=P-V,n[10]=1-b-M,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});var rl=Ji;function ir(){var n=new pe(3);return pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function Ur(n){var e=new pe(3);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Vr(n){return Math.hypot(n[0],n[1],n[2])}function rn(n,e,i){var s=new pe(3);return s[0]=n,s[1]=e,s[2]=i,s}function bn(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n[2]=e[2]+i[2],n}function wt(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n[2]=e[2]-i[2],n}function oi(n,e,i){return n[0]=e[0]*i[0],n[1]=e[1]*i[1],n[2]=e[2]*i[2],n}function Oi(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n}function zn(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n}function Le(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n}function Bt(n,e,i,s){return n[0]=e[0]+i[0]*s,n[1]=e[1]+i[1]*s,n[2]=e[2]+i[2]*s,n}function hi(n,e){var i=e[0]-n[0],s=e[1]-n[1],l=e[2]-n[2];return i*i+s*s+l*l}function di(n){var e=n[0],i=n[1],s=n[2];return e*e+i*i+s*s}function ki(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function Ci(n,e){var i=e[0],s=e[1],l=e[2],d=i*i+s*s+l*l;return d>0&&(d=1/Math.sqrt(d)),n[0]=e[0]*d,n[1]=e[1]*d,n[2]=e[2]*d,n}function yi(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function nr(n,e,i){var s=e[0],l=e[1],d=e[2],f=i[0],g=i[1],x=i[2];return n[0]=l*x-d*g,n[1]=d*f-s*x,n[2]=s*g-l*f,n}function Hn(n,e,i,s){var l=e[0],d=e[1],f=e[2];return n[0]=l+s*(i[0]-l),n[1]=d+s*(i[1]-d),n[2]=f+s*(i[2]-f),n}function cn(n,e,i){var s=e[0],l=e[1],d=e[2],f=i[3]*s+i[7]*l+i[11]*d+i[15];return n[0]=(i[0]*s+i[4]*l+i[8]*d+i[12])/(f=f||1),n[1]=(i[1]*s+i[5]*l+i[9]*d+i[13])/f,n[2]=(i[2]*s+i[6]*l+i[10]*d+i[14])/f,n}function Bl(n,e,i){var s=e[0],l=e[1],d=e[2];return n[0]=s*i[0]+l*i[3]+d*i[6],n[1]=s*i[1]+l*i[4]+d*i[7],n[2]=s*i[2]+l*i[5]+d*i[8],n}function Ao(n,e,i){var s=i[0],l=i[1],d=i[2],f=e[0],g=e[1],x=e[2],b=l*x-d*g,C=d*f-s*x,M=s*g-l*f,R=l*M-d*C,P=d*b-s*M,F=s*C-l*b,V=2*i[3];return C*=V,M*=V,P*=2,F*=2,n[0]=f+(b*=V)+(R*=2),n[1]=g+C+P,n[2]=x+M+F,n}function _o(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]}var vr=wt,Fl=oi,Nl=Vr;function Ls(){var n=new pe(4);return pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function Ps(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n[2]=e[2]*i,n[3]=e[3]*i,n}function bh(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=i*i+s*s+l*l+d*d;return f>0&&(f=1/Math.sqrt(f)),n[0]=i*f,n[1]=s*f,n[2]=l*f,n[3]=d*f,n}function ys(n,e,i){var s=e[0],l=e[1],d=e[2],f=e[3];return n[0]=i[0]*s+i[4]*l+i[8]*d+i[12]*f,n[1]=i[1]*s+i[5]*l+i[9]*d+i[13]*f,n[2]=i[2]*s+i[6]*l+i[10]*d+i[14]*f,n[3]=i[3]*s+i[7]*l+i[11]*d+i[15]*f,n}function Hs(){var n=new pe(4);return pe!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n[3]=1,n}function Jo(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n}function Ul(n,e,i){i*=.5;var s=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=s*x+f*g,n[1]=l*x+d*g,n[2]=d*x-l*g,n[3]=f*x-s*g,n}function sl(n,e,i){i*=.5;var s=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=s*x-d*g,n[1]=l*x+f*g,n[2]=d*x+s*g,n[3]=f*x-l*g,n}ir(),Ls();var Os,yu,ba,Ar,Co,Xr=bh,vu=(Os=ir(),yu=rn(1,0,0),ba=rn(0,1,0),function(n,e,i){var s=yi(e,i);return s<-.999999?(nr(Os,yu,e),Nl(Os)<1e-6&&nr(Os,ba,e),Ci(Os,Os),function(l,d,f){f*=.5;var g=Math.sin(f);l[0]=g*d[0],l[1]=g*d[1],l[2]=g*d[2],l[3]=Math.cos(f)}(n,Os,Math.PI),n):s>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(nr(Os,e,i),n[0]=Os[0],n[1]=Os[1],n[2]=Os[2],n[3]=1+s,Xr(n,n))});function vs(){var n=new pe(2);return pe!=Float32Array&&(n[0]=0,n[1]=0),n}function Io(n,e){var i=new pe(2);return i[0]=n,i[1]=e,i}function wa(n,e,i){return n[0]=e[0]+i[0],n[1]=e[1]+i[1],n}function ea(n,e,i){return n[0]=e[0]-i[0],n[1]=e[1]-i[1],n}function go(n,e,i){return n[0]=e[0]*i,n[1]=e[1]*i,n}function ta(n){return Math.hypot(n[0],n[1])}function Ta(n,e){var i=e[0],s=e[1],l=i*i+s*s;return l>0&&(l=1/Math.sqrt(l)),n[0]=e[0]*l,n[1]=e[1]*l,n}function qn(n,e){return n[0]*e[0]+n[1]*e[1]}function ol(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}Hs(),Hs(),nt(),vs();var Tc,ks,Sc=function(){if(Co)return Ar;function n(e,i,s,l){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(l-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=l}return Co=1,Ar=n,n.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,l=0;l<8;l++){var d=this.sampleCurveX(s)-e;if(Math.abs(d)<i)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=d/f}var g=0,x=1;for(s=e,l=0;l<20&&(d=this.sampleCurveX(s),!(Math.abs(d-e)<i));l++)e>d?g=s:x=s,s=.5*(x-g)+g;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Ar}(),Pd=ol(Sc);function Vl(){if(ks)return Tc;function n(e,i){this.x=e,this.y=i}return ks=1,Tc=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,s=e.y-this.y;return i*i+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),s=Math.sin(e),l=s*this.x+i*this.y;return this.x=i*this.x-s*this.y,this.y=l,this},_rotateAround:function(e,i){var s=Math.cos(e),l=Math.sin(e),d=i.y+l*(this.x-i.x)+s*(this.y-i.y);return this.x=i.x+s*(this.x-i.x)-l*(this.y-i.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(e){return e instanceof n?e:Array.isArray(e)?new n(e[0],e[1]):e},Tc}var Tt=ol(Vl());function ia(n,e){if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(!ia(n[i],e[i]))return!1;return!0}if(typeof n=="object"&&n!==null&&e!==null){if(typeof e!="object"||Object.keys(n).length!==Object.keys(e).length)return!1;for(const i in n)if(!ia(n[i],e[i]))return!1;return!0}return n===e}const wh=Math.PI/180,xu=180/Math.PI;function en(n){return n*wh}function Be(n){return n*xu}const W=[[0,0],[1,0],[1,1],[0,1]];function K(n){if(n<=0)return 0;if(n>=1)return 1;const e=n*n,i=e*n;return 4*(n<.5?i:3*(n-e)+i-.75)}function le(n,e,i,s){const l=new Pd(n,e,i,s);return function(d){return l.solve(d)}}const we=le(.25,.1,.25,1);function me(n,e,i){return Math.min(i,Math.max(e,n))}function Ce(n,e,i){return(i=me((i-n)/(e-n),0,1))*i*(3-2*i)}function Oe(n,e,i){const s=i-e,l=((n-e)%s+s)%s+e;return l===e?i:l}function Ae(n,e,i){if(!n.length)return i(null,[]);let s=n.length;const l=new Array(n.length);let d=null;n.forEach((f,g)=>{e(f,(x,b)=>{x&&(d=x),l[g]=b,--s==0&&i(d,l)})})}function ke(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}let Qe=1;function Ne(){return Qe++}function xt(n){return n<=1?1:Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Ft(n,e){n.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Rt(n,e,i){const s={};for(const l in n)s[l]=e.call(this,n[l],l,n);return s}function ai(n,e,i){const s={};for(const l in n)e.call(this,n[l],l,n)&&(s[l]=n[l]);return s}function fi(n){return Array.isArray(n)?n.map(fi):typeof n=="object"&&n?Rt(n,fi):n}function ci(n,e){for(let i=0;i<n.length;i++)if(e.indexOf(n[i])>=0)return!0;return!1}const wi={};function vi(n){wi[n]||(typeof console<"u"&&console.warn(n),wi[n]=!0)}function gn(n,e,i){return(i.y-n.y)*(e.x-n.x)>(e.y-n.y)*(i.x-n.x)}function Ln(n){let e=0;for(let i,s,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],s=n[f],e+=(s.x-i.x)*(i.y+s.y);return e}function Nn([n,e,i]){const s=en(e+90),l=en(i);return{x:n*Math.cos(s)*Math.sin(l),y:n*Math.sin(s)*Math.sin(l),z:n*Math.cos(l),azimuthal:e,polar:i}}function tn(n){return(typeof self<"u"||n!==void 0)&&typeof WorkerGlobalScope<"u"&&(n!==void 0?n:self)instanceof WorkerGlobalScope}function Xi(n){const e={};if(n.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,l,d)=>{const f=l||d;return e[s]=!f||f.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Mn=null;function Kn(n,e){return[n[4*e],n[4*e+1],n[4*e+2],n[4*e+3]]}function Qn(n,e,i,s){for(;e<i;){const l=e+i>>1;n[l]<s?e=l+1:i=l}return e}function Ir(n,e,i,s){for(;e<i;){const l=e+i>>1;n[l]<=s?e=l+1:i=l}return e}function xs(n){return n>0?1/(1.001-n):1+n}function rs(n){return n>0?1-1/(1.001-n):-n}function Th(n,e,i){return(n-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Qr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Qr.API_URL)return null;try{const n=new URL(Qr.API_URL);return n.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":n.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function ss(n){return Qr.API_URL_REGEX.test(n)}function Sh(n){return Qr.API_SPRITE_REGEX.test(n)}let Eh,jl,Ah,Ec,Ac,Bs;function bu(){return Eh==null&&(Eh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Eh}const Mo={now:()=>Ec!==void 0?Ec:performance.now(),setNow(n){Ec=n},restoreNow(){Ec=void 0},frame(n){const e=requestAnimationFrame(n);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(n,e=0){const{width:i,height:s}=n;Ac||(Ac=document.createElement("canvas"));const l=Ac.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(i>Ac.width||s>Ac.height)&&(Ac.width=i,Ac.height=s),l.clearRect(-e,-e,i+2*e,s+2*e),l.drawImage(n,0,0,i,s),l.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:n=>(jl||(jl=document.createElement("a")),jl.href=n,jl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Ah==null&&(Ah=window.matchMedia("(prefers-reduced-motion: reduce)")),Ah.matches)},hasCanvasFingerprintNoise(){if(Bs!==void 0)return Bs;if(!bu())return Bs=!1,!1;const n=new OffscreenCanvas(85,1),e=n.getContext("2d",{willReadFrequently:!0});let i=0;for(let l=0;l<n.width;++l)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(l,0,1,1);const s=e.getImageData(0,0,n.width,n.height);i=0;for(let l=0;l<s.data.length;++l)if(l%4!=3&&i++!==s.data[l])return Bs=!0,!0;return Bs=!1,!1}};function qs(n,e){const i=n.indexOf("?");if(i<0)return`${n}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(n.slice(i));for(const l in e)s.set(l,e[l]);return`${n.slice(0,i)}?${s.toString()}`}function bs(n,e={persistentParams:[]}){const i=n.indexOf("?");if(i<0)return n;const s=new URLSearchParams,l=new URLSearchParams(n.slice(i));for(const f of e.persistentParams){const g=l.get(f);g&&s.set(f,g)}const d=s.toString();return`${n.slice(0,i)}${d.length>0?`?${d}`:""}`}const Sa="mapbox-tiles";let Ro=500,to=50;const Ch=["language","worldview","jobid"];let na,wu;function al(){try{return caches}catch{}}function Tu(){const n=al();n&&na==null&&(na=n.open(Sa))}let Gf=1/0;const Su={supported:!1,testSupport:function(n){!Ea&&ll&&(ra?Od(n):ws=n)}};let ws,ll,Ea=!1,ra=!1;const Hf=typeof self<"u"?self:{};function Od(n){const e=n.createTexture();n.bindTexture(n.TEXTURE_2D,e);try{if(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,ll),n.isContextLost())return;Su.supported=!0}catch{}n.deleteTexture(e),Ea=!0}Hf.document&&(ll=Hf.document.createElement("img"),ll.onload=function(){ws&&Od(ws),ws=null,ra=!0},ll.onerror=function(){Ea=!0,ws=null},ll.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Eu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Eu);class ji extends Error{constructor(e,i,s){i===401&&ss(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Do=tn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Gl=function(n,e){if(!(/^file:/.test(i=n.url)||/^file:/.test(Do())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,l){const d=new AbortController,f=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Do(),referrerPolicy:s.referrerPolicy,signal:d.signal});let g=!1,x=!1;const b=(C=f.url).indexOf("sku=")>0&&ss(C);var C;s.type==="json"&&f.headers.set("Accept","application/json");const M=(P,F,V)=>{if(x)return;if(P&&P.message!=="SecurityError"&&vi(P.toString()),F&&V)return R(F);const q=Date.now();fetch(f).then($=>{if($.ok){const te=b?$.clone():null;return R($,te,q)}return l(new ji($.statusText,$.status,s.url))}).catch($=>{$.name!=="AbortError"&&l(new Error(`${$.message} ${s.url}`))})},R=(P,F,V)=>{(s.type==="arrayBuffer"?P.arrayBuffer():s.type==="json"?P.json():P.text()).then(q=>{x||(F&&V&&function($,te,ne){if(Tu(),na==null)return;const G=Xi(te.headers.get("Cache-Control")||"");if(G["no-store"])return;const ee={status:te.status,statusText:te.statusText,headers:new Headers};te.headers.forEach((Te,ve)=>ee.headers.set(ve,Te)),G["max-age"]&&ee.headers.set("Expires",new Date(ne+1e3*G["max-age"]).toUTCString());const re=ee.headers.get("Expires");if(!re||new Date(re).getTime()-ne<42e4)return;let ae=bs($.url,{persistentParams:Ch});if(te.status===206){const Te=$.headers.get("Range");if(!Te)return;ee.status=200,ae=qs(ae,{range:Te})}(function(Te,ve){if(wu===void 0)try{new Response(new ReadableStream),wu=!0}catch{wu=!1}wu?ve(Te.body):Te.blob().then(ve).catch(Se=>vi(Se.message))})(te,Te=>{const ve=new Response((Se=te.status)!==200&&Se!==404&&[101,103,204,205,304].includes(Se)?null:Te,ee);var Se;Tu(),na?.then(Me=>Me.put(ae,ve)).catch(Me=>vi(Me.message))})}(f,F,V),g=!0,l(null,q,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(q=>{x||l(new Error(q.message))})};return b?function(P,F){if(Tu(),na==null)return F(null);na.then(V=>{let q=bs(P.url,{persistentParams:Ch});const $=P.headers.get("Range");$&&(q=qs(q,{range:$})),V.match(q).then(te=>{const ne=function(G){if(!G)return!1;const ee=new Date(G.headers.get("Expires")||0),re=Xi(G.headers.get("Cache-Control")||"");return Number(ee)>Date.now()&&!re["no-cache"]}(te);V.delete(q).catch(F),ne&&V.put(q,te.clone()).catch(F),F(null,te,ne)}).catch(F)}).catch(F)}(f,M):M(null,null),{cancel:()=>{x=!0,g||d.abort()}}}(n,e);if(tn(self)&&self.worker.actor)return self.worker.actor.send("getResource",n,e,void 0,!0)}var i;return function(s,l){const d=new XMLHttpRequest;d.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(d.responseType="arraybuffer");for(const f in s.headers)d.setRequestHeader(f,s.headers[f]);return s.type==="json"&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials=s.credentials==="include",d.onerror=()=>{l(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||d.status===0)&&d.response!==null){let f=d.response;if(s.type==="json")try{f=JSON.parse(d.response)}catch(g){return l(g)}l(null,f,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else l(new ji(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(n,e)},cl=function(n,e){return Gl(ke(n,{type:"arrayBuffer"}),e)};function Hl(n){const e=document.createElement("a");return e.href=n,e.protocol===location.protocol&&e.host===location.host}const Cc="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Aa,ul;Aa=[],ul=0;const Au=function(n,e){if(Su.supported&&(n.headers||(n.headers={}),n.headers.accept="image/webp,*/*"),ul>=Qr.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:n,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Aa.push(d),d}ul++;let i=!1;const s=()=>{if(!i)for(i=!0,ul--;Aa.length&&ul<Qr.MAX_PARALLEL_IMAGE_REQUESTS;){const d=Aa.shift(),{requestParameters:f,callback:g,cancelled:x}=d;x||(d.cancel=Au(f,g).cancel)}},l=cl(n,(d,f,g,x)=>{s(),d?e(d):f&&(self.createImageBitmap?function(b,C){const M=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(M).then(R=>{C(null,R)}).catch(R=>{C(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(f,(b,C)=>e(b,C,g,x)):function(b,C){const M=new Image;M.onload=()=>{C(null,M),URL.revokeObjectURL(M.src),M.onload=null,requestAnimationFrame(()=>{M.src=Cc})},M.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(b)],{type:"image/png"});M.src=b.byteLength?URL.createObjectURL(R):Cc}(f,(b,C)=>e(b,C,g,x)))});return{cancel:()=>{l.cancel(),s()}}};var Cu,ql,Zs,Xs={exports:{}},Ic={exports:{}},Zl={exports:{}},sa=function(){if(Zs)return Xs.exports;Zs=1;var n=(Cu||(Cu=1,Ic.exports=function(i,s){var l,d,f,g,x,b,C,M;for(d=i.length-(l=3&i.length),f=s,x=3432918353,b=461845907,M=0;M<d;)C=255&i.charCodeAt(M)|(255&i.charCodeAt(++M))<<8|(255&i.charCodeAt(++M))<<16|(255&i.charCodeAt(++M))<<24,++M,f=27492+(65535&(g=5*(65535&(f=(f^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&i.charCodeAt(M+2))<<16;case 2:C^=(255&i.charCodeAt(M+1))<<8;case 1:f^=C=(65535&(C=(C=(65535&(C^=255&i.charCodeAt(M)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*b+(((C>>>16)*b&65535)<<16)&4294967295}return f^=i.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),Ic.exports),e=(ql||(ql=1,Zl.exports=function(i,s){for(var l,d=i.length,f=s^d,g=0;d>=4;)l=1540483477*(65535&(l=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++g;switch(d){case 3:f^=(255&i.charCodeAt(g+2))<<16;case 2:f^=(255&i.charCodeAt(g+1))<<8;case 1:f=1540483477*(65535&(f^=255&i.charCodeAt(g)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Zl.exports);return Xs.exports=n,Xs.exports.murmur3=n,Xs.exports.murmur2=e,Xs.exports}(),Mc=ol(sa);class hl{constructor(e,...i){ke(this,i[0]||{}),this.type=e}}class Xl extends hl{constructor(e,i={}){super("error",ke({error:e},i))}}function Iu(n,e,i){i[n]&&i[n].indexOf(e)!==-1||(i[n]=i[n]||[],i[n].push(e))}function Ih(n,e,i){if(i&&i[n]){const s=i[n].indexOf(e);s!==-1&&i[n].splice(s,1)}}class Rc{on(e,i){return this._listeners=this._listeners||{},Iu(e,i,this._listeners),this}off(e,i){return Ih(e,i,this._listeners),Ih(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Iu(e,i,this._oneTimeListeners),this):new Promise(s=>{this.once(e,s)})}fire(e,i){const s=typeof e=="string"?new hl(e,i):e,l=s.type;if(this.listens(l)){s.target=this;const d=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of d)x.call(this,s);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)Ih(l,x,this._oneTimeListeners),x.call(this,s);const g=this._eventedParent;g&&(ke(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),g.fire(s))}else s instanceof Xl&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class io{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new io(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new io({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return io.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var qf,Wl={},Dc=function(){if(qf)return Wl;qf=1;var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(d){return(d=Math.round(d))<0?0:d>255?255:d}function i(d){return e(d[d.length-1]==="%"?parseFloat(d)/100*255:parseInt(d))}function s(d){return(f=d[d.length-1]==="%"?parseFloat(d)/100:parseFloat(d))<0?0:f>1?1:f;var f}function l(d,f,g){return g<0?g+=1:g>1&&(g-=1),6*g<1?d+(f-d)*g*6:2*g<1?f:3*g<2?d+(f-d)*(2/3-g)*6:d}try{Wl.parseCSSColor=function(d){var f,g=d.replace(/ /g,"").toLowerCase();if(g in n)return n[g].slice();if(g[0]==="#")return g.length===4?(f=parseInt(g.substr(1),16))>=0&&f<=4095?[(3840&f)>>4|(3840&f)>>8,240&f|(240&f)>>4,15&f|(15&f)<<4,1]:null:g.length===7&&(f=parseInt(g.substr(1),16))>=0&&f<=16777215?[(16711680&f)>>16,(65280&f)>>8,255&f,1]:null;var x=g.indexOf("("),b=g.indexOf(")");if(x!==-1&&b+1===g.length){var C=g.substr(0,x),M=g.substr(x+1,b-(x+1)).split(","),R=1;switch(C){case"rgba":if(M.length!==4)return null;R=s(M.pop());case"rgb":return M.length!==3?null:[i(M[0]),i(M[1]),i(M[2]),R];case"hsla":if(M.length!==4)return null;R=s(M.pop());case"hsl":if(M.length!==3)return null;var P=(parseFloat(M[0])%360+360)%360/360,F=s(M[1]),V=s(M[2]),q=V<=.5?V*(F+1):V+F-V*F,$=2*V-q;return[e(255*l($,q,P+1/3)),e(255*l($,q,P)),e(255*l($,q,P-1/3)),R];default:return null}}return null}}catch{}return Wl}();class sn{constructor(e,i,s,l=1){this.r=e,this.g=i,this.b=s,this.a=l}static parse(e){if(!e)return;if(e instanceof sn)return e;if(typeof e!="string")return;const i=Dc.parseCSSColor(e);return i?new sn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,l]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${l})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:l,a:d}=this;return new c_(e,i,s,l,d)}toPremultipliedRenderColor(e){const{r:i,g:s,b:l,a:d}=this;return new Zf(e,i*d,s*d,l*d,d)}clone(){return new sn(this.r,this.g,this.b,this.a)}}class oa{constructor(e,i,s,l,d,f=!1){if(this.premultiplied=!1,this.premultiplied=f,e){const g=e.image.height,x=g*g;this.premultiplied?(i=d===0?0:i/d*(g-1),s=d===0?0:s/d*(g-1),l=d===0?0:l/d*(g-1)):(i*=g-1,s*=g-1,l*=g-1);const b=Math.floor(i),C=Math.floor(s),M=Math.floor(l),R=Math.ceil(i),P=Math.ceil(s),F=Math.ceil(l),V=i-b,q=s-C,$=l-M,te=e.image.data,ne=4*(b+C*x+M*g),G=4*(b+C*x+F*g),ee=4*(b+P*x+M*g),re=4*(b+P*x+F*g),ae=4*(R+C*x+M*g),Te=4*(R+C*x+F*g),ve=4*(R+P*x+M*g),Se=4*(R+P*x+F*g);if(ne<0||Se>=te.length)throw new Error("out of range");this.r=ei(ei(ei(te[ne],te[G],$),ei(te[ee],te[re],$),q),ei(ei(te[ae],te[Te],$),ei(te[ve],te[Se],$),q),V)/255*(this.premultiplied?d:1),this.g=ei(ei(ei(te[ne+1],te[G+1],$),ei(te[ee+1],te[re+1],$),q),ei(ei(te[ae+1],te[Te+1],$),ei(te[ve+1],te[Se+1],$),q),V)/255*(this.premultiplied?d:1),this.b=ei(ei(ei(te[ne+2],te[G+2],$),ei(te[ee+2],te[re+2],$),q),ei(ei(te[ae+2],te[Te+2],$),ei(te[ve+2],te[Se+2],$),q),V)/255*(this.premultiplied?d:1),this.a=d}else this.r=i,this.g=s,this.b=l,this.a=d}toArray(){const{r:e,g:i,b:s,a:l}=this;return[255*e,255*i,255*s,l]}toHslaArray(){let{r:e,g:i,b:s,a:l}=this;if(this.premultiplied){if(l===0)return[0,0,0,0];e/=l,i/=l,s/=l}const d=Math.min(Math.max(e,0),1),f=Math.min(Math.max(i,0),1),g=Math.min(Math.max(s,0),1),x=Math.min(d,f,g),b=Math.max(d,f,g),C=(x+b)/2;if(x===b)return[0,0,100*C,l];const M=b-x,R=C>.5?M/(2-b-x):M/(b+x);let P=0;return b===d?P=(f-g)/M+(f<g?6:0):b===f?P=(g-d)/M+2:b===g&&(P=(d-f)/M+4),P*=60,[Math.min(Math.max(P,0),360),Math.min(Math.max(100*R,0),100),Math.min(Math.max(100*C,0),100),l]}toArray01(){const{r:e,g:i,b:s,a:l}=this;return[e,i,s,l]}toArray01Scaled(e){const{r:i,g:s,b:l}=this;return[i*e,s*e,l*e]}toArray01Linear(){const{r:e,g:i,b:s,a:l}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),l]}}class c_ extends oa{constructor(e,i,s,l,d){super(e,i,s,l,d,!1)}}class Zf extends oa{constructor(e,i,s,l,d){super(e,i,s,l,d,!0)}}function ei(n,e,i){return n*(1-i)+e*i}function kd(n,e,i){return n.map((s,l)=>ei(s,e[l],i))}sn.black=new sn(0,0,0,1),sn.white=new sn(1,1,1,1),sn.transparent=new sn(0,0,0,0),sn.red=new sn(1,0,0,1),sn.blue=new sn(0,0,1,1);var Mh=Object.freeze({__proto__:null,array:kd,color:function(n,e,i){return new sn(ei(n.r,e.r,i),ei(n.g,e.g,i),ei(n.b,e.b,i),ei(n.a,e.a,i))},number:ei});function zc(n,...e){for(const i of e)for(const s in i)n[s]=i[s];return n}class yo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Rh{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,l]of i)this.bindings[s]=l}concat(e){return new Rh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Mu={kind:"null"},Wt={kind:"number"},un={kind:"string"},nn={kind:"boolean"},no={kind:"color"},dl={kind:"object"},on={kind:"value"},Bd={kind:"collator"},Dh={kind:"formatted"},zh={kind:"resolvedImage"};function Fs(n,e){return{kind:"array",itemType:n,N:e}}function Rr(n){if(n.kind==="array"){const e=Rr(n.itemType);return typeof n.N=="number"?`array<${e}, ${n.N}>`:n.itemType.kind==="value"?"array":`array<${e}>`}return n.kind}const u_=[Mu,Wt,un,nn,no,Dh,dl,Fs(on),zh];function $l(n,e){if(e.kind==="error")return null;if(n.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!$l(n.itemType,e.itemType))&&(typeof n.N!="number"||n.N===e.N))return null}else{if(n.kind===e.kind)return null;if(n.kind==="value"){for(const i of u_)if(!$l(i,e))return null}}return`Expected ${Rr(n)} but found ${Rr(e)} instead.`}function zo(n,e){return e.some(i=>i.kind===n.kind)}function Lh(n,e){return e.some(i=>i==="null"?n===null:i==="array"?Array.isArray(n):i==="object"?n&&!Array.isArray(n)&&typeof n=="object":i===typeof n)}function Ph(n,e){return n.kind==="array"&&e.kind==="array"?n.N===e.N&&Ph(n.itemType,e.itemType):n.kind===e.kind}class Ru{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oh{constructor(e,i,s,l,d){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=l,this.textColor=d}}class Ts{constructor(e){this.sections=e}static fromString(e){return new Ts([new Oh(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Ts?e:Ts.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const l=i.image.getPrimary().id.toString();e.push(["image",l]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class Ca{constructor(e,i={}){if(this.id=io.from(e),this.options=Object.assign({},i),i.transform){const{a:s,b:l,c:d,d:f,e:g,f:x}=i.transform;this.options.transform=new DOMMatrix([s,l,d,f,g,x])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:s,d:l,e:d,f}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:s,d:l,e:d,f}})}static parse(e){let i,s,l,d;try{({name:i,iconsetId:s,params:l,transform:d}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:f,b:g,c:x,d:b,e:C,f:M}=d||{};return new Ca({name:i,iconsetId:s},{params:l,transform:new DOMMatrix([f,g,x,b,C,M])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class Jr{constructor(e,i,s,l,d=!1){this.primaryId=io.from(e),this.primaryOptions=i,s&&(this.secondaryId=io.from(s)),this.secondaryOptions=l,this.available=d}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ca(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ca(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Jr.build({name:e}):e}static build(e,i,s,l){return!e||typeof e=="object"&&!("name"in e)?null:new Jr(e,s,i,l)}}function Lc(n,e,i,s){return typeof n=="number"&&n>=0&&n<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[n,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[n,e,i,s]:[n,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ii(n){if(n===null||typeof n=="string"||typeof n=="boolean"||typeof n=="number"||n instanceof sn||n instanceof Ru||n instanceof Ts||n instanceof Jr)return!0;if(Array.isArray(n)){for(const e of n)if(!Ii(e))return!1;return!0}if(typeof n=="object"){for(const e in n)if(!Ii(n[e]))return!1;return!0}return!1}function kt(n){if(n===null)return Mu;if(typeof n=="string")return un;if(typeof n=="boolean")return nn;if(typeof n=="number")return Wt;if(n instanceof sn)return no;if(n instanceof Ru)return Bd;if(n instanceof Ts)return Dh;if(n instanceof Jr)return zh;if(Array.isArray(n)){const e=n.length;let i;for(const s of n){const l=kt(s);if(i){if(i===l)continue;i=on;break}i=l}return Fs(i||on,e)}return dl}function vo(n){const e=typeof n;return n===null?"":e==="string"||e==="number"||e==="boolean"?String(n):n instanceof Ts||n instanceof Jr||n instanceof sn?n.toString():JSON.stringify(n)}class li{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ii(e[1]))return i.error("invalid value");const s=e[1];let l=kt(s);const d=i.expectedType;return l.kind!=="array"||l.N!==0||!d||d.kind!=="array"||typeof d.N=="number"&&d.N!==0||(l=d),new li(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof sn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Ts?this.value.serialize():this.value}}class mr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const fl={string:un,number:Wt,boolean:nn,object:dl};class Jt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,l=1;const d=e[0];if(d==="array"){let g,x;if(e.length>2){const b=e[1];if(typeof b!="string"||!(b in fl)||b==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);g=fl[b],l++}else g=on;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);x=e[2],l++}s=Fs(g,x)}else s=fl[d];const f=[];for(;l<e.length;l++){const g=i.parse(e[l],l,on);if(!g)return null;f.push(g)}return new Jt(s,f)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!$l(this.type,kt(s)))return s;if(i===this.args.length-1)throw new mr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Rr(kt(s))} but was expected to be of type ${Rr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const l=e.N;(typeof l=="number"||this.args.length>1)&&i.push(l)}}return i.concat(this.args.map(s=>s.serialize()))}}class pl{constructor(e){this.type=Dh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const l=[];let d=!1;for(let f=1;f<=e.length-1;++f){const g=e[f];if(d&&typeof g=="object"&&!Array.isArray(g)){d=!1;let x=null;if(g["font-scale"]&&(x=i.parseObjectValue(g["font-scale"],f,"font-scale",Wt),!x))return null;let b=null;if(g["text-font"]&&(b=i.parseObjectValue(g["text-font"],f,"text-font",Fs(un)),!b))return null;let C=null;if(g["text-color"]&&(C=i.parseObjectValue(g["text-color"],f,"text-color",no),!C))return null;const M=l[l.length-1];M.scale=x,M.font=b,M.textColor=C}else{const x=i.parse(e[f],f,on);if(!x)return null;const b=x.type.kind;if(b!=="string"&&b!=="value"&&b!=="null"&&b!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,l.push({content:x,scale:null,font:null,textColor:null})}}return new pl(l)}evaluate(e){return new Ts(this.sections.map(i=>{const s=i.content.evaluate(e);return Ph(kt(s),zh)?new Oh("",s,null,null,null):new Oh(vo(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class Pc{constructor(e,i,s,l){this._imageWarnHistory={},this.type=zh,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),l&&(this.paramsSecondary=l.params,this.iconsetIdSecondary=l.iconset?l.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const l=[];function d(){if(s<e.length){const g=i.parse(e[s],s++,un);return g?(l.push({image:g,options:{}}),!0):(i.error(l.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function f(){if(s<e.length){const x=e[s];if((g=x)===null||typeof g!="object"||Array.isArray(g))return!0;const b=x.params,C=x.iconset,M=i.concat(s);if(!b&&!C)return s++,!0;if(b){if(typeof b!="object"||b.constructor!==Object)return M.error('Image options "params" should be an object'),!1;const R={},P=M.concat(void 0,"params");for(const F in b){if(!F)return P.error("Image parameter name should be non-empty"),!1;const V=P.concat(void 0,F).parse(b[F],void 0,no,void 0,{typeAnnotation:"coerce"});if(!V)return!1;R[F]=V}l[l.length-1].options.params=R}if(C){if(typeof C!="object"||C.constructor!==Object)return M.error('Image options "iconset" should be an object'),!1;if(!C.id)return M.error('Image options "iconset" should have an "id" property'),!1;l[l.length-1].options.iconset=C}return s++,!0}var g;return!0}for(let g=0;g<2;g++)if(!d()||!f())return;return new Pc(l[0].image,l[1]?l[1].image:void 0,l[0].options,l[1]?l[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const l in i)if(i[l])try{s[l]=i[l].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,l=Jr.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(l&&e.availableImages){const d=l.getPrimary().id;if(l.available=e.availableImages.some(f=>io.isEqual(f,d)),l.available){const f=l.getSecondary()?l.getSecondary().id:null;f&&(l.available=e.availableImages.some(g=>io.isEqual(g,f)))}}return l}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const l in e)e[l]&&(s.params[l]=e[l].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function ml(n){return n instanceof Number?"number":n instanceof String?"string":n instanceof Boolean?"boolean":Array.isArray(n)?"array":n===null?"null":typeof n}const Fd={"to-boolean":nn,"to-color":no,"to-number":Wt,"to-string":un};class ro{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],l=[];let d=Mu;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const f=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);d=Fs(i.expectedType.itemType,f)}else{if(!(f>0&&Ii(e[1][0])))return null;d=Fs(kt(e[1][0]),f)}for(let g=0;g<f;g++){const x=e[1][g];let b;if(ml(x)==="array")b=i.parse(x,void 0,d.itemType);else{const C=ml(x);if(C!==d.itemType.kind)return i.error(`Expected ${d.itemType.kind} but found ${C}.`);b=i.registry.literal.parse(["literal",x===void 0?null:x],i)}if(!b)return null;l.push(b)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");d=Fd[s];for(let f=1;f<e.length;f++){const g=i.parse(e[f],f,on);if(!g)return null;l.push(g)}}return new ro(d,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const l of this.args){if(i=l.evaluate(e),s=null,i instanceof sn)return i;if(typeof i=="string"){const d=e.parseColor(i);if(d)return d}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Lc(i[0],i[1],i[2],i[3]),!s))return new sn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new mr(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const l=Number(i);if(!isNaN(l))return l}throw new mr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Ts.fromString(vo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Jr.build(vo(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):vo(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new pl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Pc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ss=["Unknown","Point","LineString","Polygon"];class Du{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ss[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(l*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=sn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Wr{constructor(e,i,s,l,d){this.name=e,this.type=i,this._evaluate=s,this.args=l,this._overloadIndex=d}evaluate(e){if(!this._evaluate){const i=Wr.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],l=Wr.definitions[s];if(!l)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,g=[];let x=null,b=-1;for(const[C,M]of f){if(Array.isArray(C)&&C.length!==e.length-1)continue;g.push(C),b++,x=new jh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const R=[];let P=!1;for(let F=1;F<e.length;F++){const V=e[F],q=Array.isArray(C)?C[F-1]:C.type,$=x.parse(V,1+R.length,q);if(!$){P=!0;break}R.push($)}if(!P)if(Array.isArray(C)&&C.length!==R.length)x.error(`Expected ${C.length} arguments, but found ${R.length} instead.`);else{for(let F=0;F<R.length;F++){const V=Array.isArray(C)?C[F]:C.type,q=R[F];x.concat(F+1).checkSubtype(V,q.type)}if(x.errors.length===0)return new Wr(s,d,M,R,b)}}if(g.length===1)i.errors.push(...x.errors);else{const C=(g.length?g:f.map(([R])=>R)).map(Xf).join(" | "),M=[];for(let R=1;R<e.length;R++){const P=i.parse(e[R],1+M.length);if(!P)return null;M.push(Rr(P.type))}i.error(`Expected arguments of type ${C}, but found (${M.join(", ")}) instead.`)}return null}static register(e,i){Wr.definitions=i;for(const s in i)e[s]=Wr}}function Xf(n){return Array.isArray(n)?`(${n.map(Rr).join(", ")})`:`(${Rr(n.type)}...)`}class Ia{constructor(e,i,s){this.type=Bd,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const l=s["case-sensitive"]===void 0?i.parse(!1,1,nn):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",nn);if(!l)return null;const d=s["diacritic-sensitive"]===void 0?i.parse(!1,1,nn):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",nn);if(!d)return null;let f=null;return s.locale&&(f=i.parseObjectValue(s.locale,1,"locale",un),!f)?null:new Ia(l,d,f)}evaluate(e){return new Ru(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Es(n,e,i=0,s=n.length-1,l=h_){for(;s>i;){if(s-i>600){const x=s-i+1,b=e-i+1,C=Math.log(x),M=.5*Math.exp(2*C/3),R=.5*Math.sqrt(C*M*(x-M)/x)*(b-x/2<0?-1:1);Es(n,e,Math.max(i,Math.floor(e-b*M/x+R)),Math.min(s,Math.floor(e+(x-b)*M/x+R)),l)}const d=n[e];let f=i,g=s;for(kh(n,i,e),l(n[s],d)>0&&kh(n,i,s);f<g;){for(kh(n,f,g),f++,g--;l(n[f],d)<0;)f++;for(;l(n[g],d)>0;)g--}l(n[i],d)===0?kh(n,i,g):(g++,kh(n,g,s)),g<=e&&(i=g+1),e<=g&&(s=g-1)}}function kh(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function h_(n,e){return n<e?-1:n>e?1:0}function xo(n){let e=0;for(let i,s,l=0,d=n.length,f=d-1;l<d;f=l++)i=n[l],s=n[f],e+=(s.x-i.x)*(i.y+s.y);return e}function Lo(n,e){n[0]=Math.min(n[0],e[0]),n[1]=Math.min(n[1],e[1]),n[2]=Math.max(n[2],e[0]),n[3]=Math.max(n[3],e[1])}function Oc(n,e){return!(n[0]<=e[0]||n[2]>=e[2]||n[1]<=e[1]||n[3]>=e[3])}function Yl(n,e,i){const s=n[0]-e[0],l=n[1]-e[1],d=n[0]-i[0],f=n[1]-i[1];return s*f-d*l==0&&s*d<=0&&l*f<=0}function kc(n,e,i=!1){let s=!1;for(let g=0,x=e.length;g<x;g++){const b=e[g];for(let C=0,M=b.length,R=M-1;C<M;R=C++){const P=b[R],F=b[C];if(Yl(n,P,F))return i;(d=P)[1]>(l=n)[1]!=(f=F)[1]>l[1]&&l[0]<(f[0]-d[0])*(l[1]-d[1])/(f[1]-d[1])+d[0]&&(s=!s)}}var l,d,f;return s}function Wf(n,e,i,s){const l=s[0]-i[0],d=s[1]-i[1],f=(n[0]-i[0])*d-l*(n[1]-i[1]),g=(e[0]-i[0])*d-l*(e[1]-i[1]);return f>0&&g<0||f<0&&g>0}function zu(n,e,i,s){return(l=[s[0]-i[0],s[1]-i[1]])[0]*(d=[e[0]-n[0],e[1]-n[1]])[1]-l[1]*d[0]!=0&&!(!Wf(n,e,i,s)||!Wf(i,s,n,e));var l,d}function $f(n){const e=new Tt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Tt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of n[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const so=8192;function Yf(n,e){const i=(180+n[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(i*l*so),Math.round(s*l*so)]}function Bh(n,e){for(let i=0;i<e.length;i++)if(kc(n,e[i]))return!0;return!1}function Nd(n,e,i){for(const s of i)for(let l=0,d=s.length,f=d-1;l<d;f=l++)if(zu(n,e,s[f],s[l]))return!0;return!1}function Kf(n,e){for(let i=0;i<n.length;++i)if(!kc(n[i],e))return!1;for(let i=0;i<n.length-1;++i)if(Nd(n[i],n[i+1],e))return!1;return!0}function bo(n,e){for(let i=0;i<e.length;i++)if(Kf(n,e[i]))return!0;return!1}function Kl(n,e,i){const s=[];for(let l=0;l<n.length;l++){const d=[];for(let f=0;f<n[l].length;f++){const g=Yf(n[l][f],i);Lo(e,g),d.push(g)}s.push(d)}return s}function Ud(n,e,i){const s=[];for(let l=0;l<n.length;l++){const d=Kl(n[l],e,i);s.push(d)}return s}function Fh(n,e,i,s){if(n[0]<i[0]||n[0]>i[2]){const l=.5*s;let d=n[0]-i[0]>l?-s:i[0]-n[0]>l?s:0;d===0&&(d=n[0]-i[2]>l?-s:i[2]-n[0]>l?s:0),n[0]+=d}Lo(e,n)}function _l(n,e,i,s){const l=Math.pow(2,s.z)*so,d=[s.x*so,s.y*so],f=[];if(!n)return f;for(const g of n)for(const x of g){const b=[x.x+d[0],x.y+d[1]];Fh(b,e,i,l),f.push(b)}return f}function Vd(n,e,i,s){const l=Math.pow(2,s.z)*so,d=[s.x*so,s.y*so],f=[];if(!n)return f;for(const x of n){const b=[];for(const C of x){const M=[C.x+d[0],C.y+d[1]];Lo(e,M),b.push(M)}f.push(b)}if(e[2]-e[0]<=l/2){(g=e)[0]=g[1]=1/0,g[2]=g[3]=-1/0;for(const x of f)for(const b of x)Fh(b,e,i,l)}var g;return f}class hs{constructor(e,i){this.type=nn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ii(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let l=0;l<s.features.length;++l){const d=s.features[l].geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new hs(s,s.features[l].geometry)}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new hs(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new hs(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const g=Kl(s.coordinates,d,f),x=_l(i.geometry(),l,d,f);if(!Oc(l,d))return!1;for(const b of x)if(!kc(b,g))return!1}if(s.type==="MultiPolygon"){const g=Ud(s.coordinates,d,f),x=_l(i.geometry(),l,d,f);if(!Oc(l,d))return!1;for(const b of x)if(!Bh(b,g))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const l=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],f=i.canonicalID();if(!f)return!1;if(s.type==="Polygon"){const g=Kl(s.coordinates,d,f),x=Vd(i.geometry(),l,d,f);if(!Oc(l,d))return!1;for(const b of x)if(!Kf(b,g))return!1}if(s.type==="MultiPolygon"){const g=Ud(s.coordinates,d,f),x=Vd(i.geometry(),l,d,f);if(!Oc(l,d))return!1;for(const b of x)if(!bo(b,g))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Lu={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Qf=1/298.257223563,Jf=Qf*(2-Qf),Pu=Math.PI/180;class Bc{static fromTile(e,i,s){const l=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),d=Math.atan(.5*(Math.exp(l)-Math.exp(-l)))/Pu;return new Bc(d,s)}static get units(){return Lu}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Lu[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Lu).join(", ")}`);const s=6378.137*Pu*(i?Lu[i]:1),l=Math.cos(e*Pu),d=1/(1-Jf*(1-l*l)),f=Math.sqrt(d);this.kx=s*f*l,this.ky=s*f*d*(1-Jf)}distance(e,i){const s=Lr(e[0]-i[0])*this.kx,l=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+l*l)}bearing(e,i){const s=Lr(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Pu}destination(e,i,s){const l=s*Pu;return this.offset(e,Math.sin(l)*i,Math.cos(l)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const l=e[s];for(let d=0,f=l.length,g=f-1;d<f;g=d++)i+=Lr(l[d][0]-l[g][0])*(l[d][1]+l[g][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let l=0;l<e.length-1;l++){const d=e[l],f=e[l+1],g=this.distance(d,f);if(s+=g,s>i)return Ou(d,f,(i-(s-g))/g)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[l,d]=i,f=Lr(s[0]-l)*this.kx,g=(s[1]-d)*this.ky;if(f!==0||g!==0){const x=(Lr(e[0]-l)*this.kx*f+(e[1]-d)*this.ky*g)/(f*f+g*g);x>1?(l=s[0],d=s[1]):x>0&&(l+=f/this.kx*x,d+=g/this.ky*x)}return f=Lr(e[0]-l)*this.kx,g=(e[1]-d)*this.ky,Math.sqrt(f*f+g*g)}pointOnLine(e,i){let s=1/0,l=e[0][0],d=e[0][1],f=0,g=0;for(let x=0;x<e.length-1;x++){let b=e[x][0],C=e[x][1],M=Lr(e[x+1][0]-b)*this.kx,R=(e[x+1][1]-C)*this.ky,P=0;M===0&&R===0||(P=(Lr(i[0]-b)*this.kx*M+(i[1]-C)*this.ky*R)/(M*M+R*R),P>1?(b=e[x+1][0],C=e[x+1][1]):P>0&&(b+=M/this.kx*P,C+=R/this.ky*P)),M=Lr(i[0]-b)*this.kx,R=(i[1]-C)*this.ky;const F=M*M+R*R;F<s&&(s=F,l=b,d=C,f=x,g=P)}return{point:[l,d],index:f,t:Math.max(0,Math.min(1,g))}}lineSlice(e,i,s){let l=this.pointOnLine(s,e),d=this.pointOnLine(s,i);if(l.index>d.index||l.index===d.index&&l.t>d.t){const b=l;l=d,d=b}const f=[l.point],g=l.index+1,x=d.index;!jd(s[g],f[0])&&g<=x&&f.push(s[g]);for(let b=g+1;b<=x;b++)f.push(s[b]);return jd(s[x],d.point)||f.push(d.point),f}lineSliceAlong(e,i,s){let l=0;const d=[];for(let f=0;f<s.length-1;f++){const g=s[f],x=s[f+1],b=this.distance(g,x);if(l+=b,l>e&&d.length===0&&d.push(Ou(g,x,(e-(l-b))/b)),l>=i)return d.push(Ou(g,x,(i-(l-b))/b)),d;l>e&&d.push(x)}return d}bufferPoint(e,i){const s=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-s,e[0]+l,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,l=i/this.kx;return[e[0]-l,e[1]-s,e[2]+l,e[3]+s]}insideBBox(e,i){return Lr(e[0]-i[0])>=0&&Lr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function jd(n,e){return n[0]===e[0]&&n[1]===e[1]}function Ou(n,e,i){const s=Lr(e[0]-n[0]);return[n[0]+s*i,n[1]+(e[1]-n[1])*i]}function Lr(n){for(;n<-180;)n+=360;for(;n>180;)n-=360;return n}class Nh{constructor(e=[],i=(s,l)=>s<l?-1:s>l?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,l=i[e];for(;e>0;){const d=e-1>>1,f=i[d];if(s(l,f)>=0)break;i[e]=f,e=d}i[e]=l}_down(e){const{data:i,compare:s}=this,l=this.length>>1,d=i[e];for(;e<l;){let f=1+(e<<1);const g=f+1;if(g<this.length&&s(i[g],i[f])<0&&(f=g),s(i[f],d)>=0)break;i[e]=i[f],e=f}i[e]=d}}var vt=8192;function oo(n,e){return e.dist-n.dist}const aa=100,Ql=50;function Jl(n){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==n[i])return!1;return!0}function ec(n){return n[1]-n[0]+1}function Po(n,e){const i=n[1]>=n[0]&&n[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function gl(n,e){if(n[0]>n[1])return[null,null];const i=ec(n);if(e){if(i===2)return[n,null];const s=Math.floor(i/2);return[[n[0],n[0]+s],[n[0]+s,n[1]]]}{if(i===1)return[n,null];const s=Math.floor(i/2)-1;return[[n[0],n[0]+s],[n[0]+s+1,n[1]]]}}function wo(n,e){const i=[1/0,1/0,-1/0,-1/0];if(!Po(e,n.length))return i;for(let s=e[0];s<=e[1];++s)Lo(i,n[s]);return i}function Li(n){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<n.length;++i)for(let s=0;s<n[i].length;++s)Lo(e,n[i][s]);return e}function la(n,e,i){if(Jl(n)||Jl(e))return NaN;let s=0,l=0;return n[2]<e[0]&&(s=e[0]-n[2]),n[0]>e[2]&&(s=n[0]-e[2]),n[1]>e[3]&&(l=n[1]-e[3]),n[3]<e[1]&&(l=e[1]-n[3]),i.distance([0,0],[s,l])}function d_(n){return 360*n-180}function To(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ku(n,e){const i=Math.pow(2,e.z),s=(n.y/vt+e.y)/i;return[d_((n.x/vt+e.x)/i),To(s)]}function yl(n,e){const i=[];for(let s=0;s<n.length;++s)i.push(ku(n[s],e));return i}function Jn(n,e,i){const s=i.pointOnLine(e,n).point;return i.distance(n,s)}function Uh(n,e,i,s,l){const d=i.slice(s[0],s[1]+1);let f=1/0;for(let g=e[0];g<=e[1];++g)if((f=Math.min(f,Jn(n[g],d,l)))===0)return 0;return f}function vl(n,e,i,s,l){const d=Math.min(l.pointToSegmentDistance(n,i,s),l.pointToSegmentDistance(e,i,s)),f=Math.min(l.pointToSegmentDistance(i,n,e),l.pointToSegmentDistance(s,n,e));return Math.min(d,f)}function ep(n,e,i,s,l){if(!Po(e,n.length)||!Po(s,i.length))return NaN;let d=1/0;for(let f=e[0];f<e[1];++f)for(let g=s[0];g<s[1];++g){if(zu(n[f],n[f+1],i[g],i[g+1]))return 0;d=Math.min(d,vl(n[f],n[f+1],i[g],i[g+1],l))}return d}function tp(n,e,i,s,l){if(!Po(e,n.length)||!Po(s,i.length))return NaN;let d=1/0;for(let f=e[0];f<=e[1];++f)for(let g=s[0];g<=s[1];++g)if((d=Math.min(d,l.distance(n[f],i[g])))===0)return d;return d}function Bu(n,e,i){if(kc(n,e,!0))return 0;let s=1/0;for(const l of e){const d=l.length;if(d<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[d-1]&&(s=Math.min(s,i.pointToSegmentDistance(n,l[d-1],l[0])))===0||(s=Math.min(s,Jn(n,l,i)))===0)return s}return s}function Fu(n,e,i,s){if(!Po(e,n.length))return NaN;for(let d=e[0];d<=e[1];++d)if(kc(n[d],i,!0))return 0;let l=1/0;for(let d=e[0];d<e[1];++d)for(const f of i)for(let g=0,x=f.length,b=x-1;g<x;b=g++){if(zu(n[d],n[d+1],f[b],f[g]))return 0;l=Math.min(l,vl(n[d],n[d+1],f[b],f[g],s))}return l}function Vh(n,e){for(const i of n)for(let s=0;s<=i.length-1;++s)if(kc(i[s],e,!0))return!0;return!1}function Gd(n,e,i,s=1/0){const l=Li(n),d=Li(e);if(s!==1/0&&la(l,d,i)>=s)return s;if(Oc(l,d)){if(Vh(n,e))return 0}else if(Vh(e,n))return 0;let f=s;for(const g of n)for(let x=0,b=g.length,C=b-1;x<b;C=x++)for(const M of e)for(let R=0,P=M.length,F=P-1;R<P;F=R++){if(zu(g[C],g[x],M[F],M[R]))return 0;f=Math.min(f,vl(g[C],g[x],M[F],M[R],i))}return f}function Ws(n,e,i,s,l,d,f){if(d===null||f===null)return;const g=la(wo(s,d),wo(l,f),i);g<e&&n.push({dist:g,range1:d,range2:f})}function Oo(n,e,i,s,l=1/0){let d=Math.min(s.distance(n[0],i[0][0]),l);if(d===0)return d;const f=new Nh([{dist:0,range1:[0,n.length-1],range2:[0,0]}],oo),g=e?Ql:aa,x=Li(i);for(;f.length;){const b=f.pop();if(b.dist>=d)continue;const C=b.range1;if(ec(C)<=g){if(!Po(C,n.length))return NaN;if(e){const M=Fu(n,C,i,s);if((d=Math.min(d,M))===0)return d}else for(let M=C[0];M<=C[1];++M){const R=Bu(n[M],i,s);if((d=Math.min(d,R))===0)return d}}else{const M=gl(C,e);if(M[0]!==null){const R=la(wo(n,M[0]),x,s);R<d&&f.push({dist:R,range1:M[0],range2:[0,0]})}if(M[1]!==null){const R=la(wo(n,M[1]),x,s);R<d&&f.push({dist:R,range1:M[1],range2:[0,0]})}}}return d}function tc(n,e,i,s,l,d=1/0){let f=Math.min(d,l.distance(n[0],i[0]));if(f===0)return f;const g=new Nh([{dist:0,range1:[0,n.length-1],range2:[0,i.length-1]}],oo),x=e?Ql:aa,b=s?Ql:aa;for(;g.length;){const C=g.pop();if(C.dist>=f)continue;const M=C.range1,R=C.range2;if(ec(M)<=x&&ec(R)<=b){if(!Po(M,n.length)||!Po(R,i.length))return NaN;if(e&&s?f=Math.min(f,ep(n,M,i,R,l)):e||s?e&&!s?f=Math.min(f,Uh(i,R,n,M,l)):!e&&s&&(f=Math.min(f,Uh(n,M,i,R,l))):f=Math.min(f,tp(n,M,i,R,l)),f===0)return f}else{const P=gl(M,e),F=gl(R,s);Ws(g,f,l,n,i,P[0],F[0]),Ws(g,f,l,n,i,P[0],F[1]),Ws(g,f,l,n,i,P[1],F[0]),Ws(g,f,l,n,i,P[1],F[1])}}return f}function ca(n,e,i,s,l=1/0){let d=l;const f=wo(n,[0,n.length-1]);for(const g of i)if(!(d!==1/0&&la(f,wo(g,[0,g.length-1]),s)>=d)&&(d=Math.min(d,tc(n,e,g,!0,s,d)),d===0))return d;return d}function ko(n,e,i,s,l=1/0){let d=l;const f=wo(n,[0,n.length-1]);for(const g of i){if(d!==1/0&&la(f,Li(g),s)>=d)continue;const x=Oo(n,e,g,s,d);if(isNaN(x))return x;if((d=Math.min(d,x))===0)return d}return d}function xl(n){return n==="Point"||n==="MultiPoint"||n==="LineString"||n==="MultiLineString"||n==="Polygon"||n==="MultiPolygon"}class ic{constructor(e,i){this.type=Wt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ii(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let l=0;l<s.features.length;++l)if(xl(s.features[l].geometry.type))return new ic(s,s.features[l].geometry)}else if(s.type==="Feature"){if(xl(s.geometry.type))return new ic(s,s.geometry)}else if(xl(s.type))return new ic(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(l,d,f){const g=[];for(const b of l)for(const C of b)g.push(ku(C,d));const x=new Bc(g[0][1],"meters");return f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString"?tc(g,!1,f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",x):f.type==="MultiLineString"?ca(g,!1,f.coordinates,x):f.type==="Polygon"||f.type==="MultiPolygon"?ko(g,!1,f.type==="Polygon"?[f.coordinates]:f.coordinates,x):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(l,d,f){const g=[];for(const b of l){const C=[];for(const M of b)C.push(ku(M,d));g.push(C)}const x=new Bc(g[0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ca(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let b=1/0;for(let C=0;C<f.coordinates.length;C++){const M=ca(f.coordinates[C],!0,g,x,b);if(isNaN(M))return M;if((b=Math.min(b,M))===0)return b}return b}if(f.type==="Polygon"||f.type==="MultiPolygon"){let b=1/0;for(let C=0;C<g.length;C++){const M=ko(g[C],!0,f.type==="Polygon"?[f.coordinates]:f.coordinates,x,b);if(isNaN(M))return M;if((b=Math.min(b,M))===0)return b}return b}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(l,d,f){const g=[];for(const b of function(C,M){const R=C.length;if(R<=1)return[C];const P=[];let F,V;for(let q=0;q<R;q++){const $=xo(C[q]);$!==0&&(C[q].area=Math.abs($),V===void 0&&(V=$<0),V===$<0?(F&&P.push(F),F=[C[q]]):F.push(C[q]))}return F&&P.push(F),P}(l)){const C=[];for(let M=0;M<b.length;++M)C.push(yl(b[M],d));g.push(C)}const x=new Bc(g[0][0][0][1],"meters");if(f.type==="Point"||f.type==="MultiPoint"||f.type==="LineString")return ko(f.type==="Point"?[f.coordinates]:f.coordinates,f.type==="LineString",g,x);if(f.type==="MultiLineString"){let b=1/0;for(let C=0;C<f.coordinates.length;C++){const M=ko(f.coordinates[C],!0,g,x,b);if(isNaN(M))return M;if((b=Math.min(b,M))===0)return b}return b}return f.type==="Polygon"||f.type==="MultiPolygon"?function(b,C,M){let R=1/0;for(const P of b)for(const F of C){const V=Gd(P,F,M,R);if(isNaN(V))return V;if((R=Math.min(R,V))===0)return R}return R}(f.type==="Polygon"?[f.coordinates]:f.coordinates,g,x):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function nc(n){if(n instanceof Wr&&(n.name==="get"&&n.args.length===1||n.name==="feature-state"||n.name==="has"&&n.args.length===1||n.name==="properties"||n.name==="geometry-type"||n.name==="id"||/^filter-/.test(n.name))||n instanceof hs||n instanceof ic)return!1;if(n instanceof rc)return n.featureConstant;let e=!0;return n.eachChild(i=>{e&&!nc(i)&&(e=!1)}),e}function Nu(n){if(n instanceof Wr&&n.name==="feature-state")return!1;let e=!0;return n.eachChild(i=>{e&&!Nu(i)&&(e=!1)}),e}function ds(n){if(n instanceof rc)return new Set([n.key]);let e=new Set;return n.eachChild(i=>{e=new Set([...e,...ds(i)])}),e}function Tr(n,e){if(n instanceof Wr&&e.indexOf(n.name)>=0)return!1;let i=!0;return n.eachChild(s=>{i&&!Tr(s,e)&&(i=!1)}),i}function cr(n,e,i){return[n,e,i].filter(Boolean).join("")}function bl(n,e){switch(n){case"string":return vo(e);case"number":return+e;case"boolean":return!!e;case"color":return sn.parse(e);case"formatted":return Ts.fromString(vo(e));case"resolvedImage":return Jr.build(vo(e))}return e}function ua(n,e,i,s){return s!==void 0&&(n=s*Math.round(n/s)),e!==void 0&&n<e&&(n=e),i!==void 0&&n>i&&(n=i),n}class rc{constructor(e,i,s,l=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=l}static parse(e,i){let s=i.expectedType;if(s==null&&(s=on),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const l=i.parse(e[1],1);if(!(l instanceof li))return i.error("Key name of 'config' expression must be a string literal.");let d,f=!0;const g=vo(l.value);if(e.length>=3){const x=i.parse(e[2],2);if(!(x instanceof li))return i.error("Scope of 'config' expression must be a string literal.");d=vo(x.value)}if(i.options){const x=cr(g,d,i._scope),b=i.options.get(x);b&&(f=nc(b.value||b.default))}return new rc(s,g,d,f)}evaluate(e){const i=cr(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:l,value:d,values:f,minValue:g,maxValue:x,stepValue:b}=s,C=s.default.evaluate(e);let M=C;if(d){const R=e.scope;e.scope=(R||"").split("").slice(1).join(""),M=d.evaluate(e),e.scope=R}return l&&(M=bl(l,M)),M===void 0||g===void 0&&x===void 0&&b===void 0||(typeof M=="number"?M=ua(M,g,x,b):Array.isArray(M)&&(M=M.map(R=>typeof R=="number"?ua(R,g,x,b):R))),d!==void 0&&M!==void 0&&f&&!f.includes(M)&&(M=C,l&&(M=bl(l,M))),(l&&l!==this.type||M!==void 0&&!Ph(kt(M),this.type))&&(M=bl(this.type.kind,M)),M}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Ma{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Ma(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class jh{constructor(e,i=[],s,l=new Rh,d=[],f,g){this.registry=e,this.path=i,this.key=i.map(x=>typeof x=="string"?`['${x}']`:`[${x}]`).join(""),this.scope=l,this.errors=d,this.expectedType=s,this._scope=f,this.options=g}parse(e,i,s,l,d={}){return i||s?this.concat(i,null,s,l)._parse(e,d):this._parse(e,d)}parseObjectValue(e,i,s,l,d,f={}){return this.concat(i,s,l,d)._parse(e,f)}_parse(e,i){function s(l,d,f){return f==="assert"?new Jt(d,[l]):f==="coerce"?new ro(d,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let d=l.parse(e,this);if(!d)return null;if(this.expectedType){const f=this.expectedType,g=d.type;if(f.kind!=="string"&&f.kind!=="number"&&f.kind!=="boolean"&&f.kind!=="object"&&f.kind!=="array"||g.kind!=="value")if(f.kind!=="color"&&f.kind!=="formatted"&&f.kind!=="resolvedImage"||g.kind!=="value"&&g.kind!=="string"){if(this.checkSubtype(f,g))return null}else d=s(d,f,i.typeAnnotation||"coerce");else d=s(d,f,i.typeAnnotation||"assert")}if(!(d instanceof li)&&d.type.kind!=="resolvedImage"&&Hd(d)){const f=new Du(this._scope,this.options);try{d=new li(d.type,d.evaluate(f))}catch(g){return this.error(g.message),null}}return d}return ro.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,l){let d=typeof e=="number"?this.path.concat(e):this.path;d=typeof i=="string"?d.concat(i):d;const f=l?this.scope.concat(l):this.scope;return new jh(this.registry,d,s||null,f,this.errors,this._scope,this.options)}error(e,...i){const s=`${this.key}${i.map(l=>`[${l}]`).join("")}`;this.errors.push(new yo(s,e))}checkSubtype(e,i){const s=$l(e,i);return s&&this.error(s),s}}function Hd(n){if(n instanceof Ma)return Hd(n.boundExpression);if(n instanceof Wr&&n.name==="error"||n instanceof Ia||n instanceof hs||n instanceof ic||n instanceof rc)return!1;const e=n instanceof ro||n instanceof Jt;let i=!0;return n.eachChild(s=>{i=e?i&&Hd(s):i&&s instanceof li}),!!i&&nc(n)&&Tr(n,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function sc(n,e){const i=n.length-1;let s,l,d=0,f=i,g=0;for(;d<=f;)if(g=Math.floor((d+f)/2),s=n[g],l=n[g+1],s<=e){if(g===i||e<l)return g;d=g+1}else{if(!(s>e))throw new mr("Input is not a number.");f=g-1}return 0}class wl{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[l,d]of s)this.labels.push(l),this.outputs.push(d)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Wt);if(!s)return null;const l=[];let d=null;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);for(let f=1;f<e.length;f+=2){const g=f===1?-1/0:e[f],x=e[f+1],b=f,C=f+1;if(typeof g!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',b);if(l.length&&l[l.length-1][0]>=g)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',b);const M=i.parse(x,C,d);if(!M)return null;d=d||M.type,l.push([g,M])}return new wl(d,s,l)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return s[0].evaluate(e);const d=i.length;return l>=i[d-1]?s[d-1].evaluate(e):s[sc(i,l)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const ip=.95047,Uu=1.08883,qd=4/29,ao=6/29,Ra=3*ao*ao,Tl=ao*ao*ao,Sl=Math.PI/180,np=180/Math.PI;function Gh(n){return n>Tl?Math.pow(n,1/3):n/Ra+qd}function oc(n){return n>ao?n*n*n:Ra*(n-qd)}function Fc(n){return 255*(n<=.0031308?12.92*n:1.055*Math.pow(n,1/2.4)-.055)}function lo(n){return(n/=255)<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4)}function fs(n){const e=lo(n.r),i=lo(n.g),s=lo(n.b),l=Gh((.4124564*e+.3575761*i+.1804375*s)/ip),d=Gh((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*d-16,a:500*(l-d),b:200*(d-Gh((.0193339*e+.119192*i+.9503041*s)/Uu)),alpha:n.a}}function Vu(n){let e=(n.l+16)/116,i=isNaN(n.a)?e:e+n.a/500,s=isNaN(n.b)?e:e-n.b/200;return e=1*oc(e),i=ip*oc(i),s=Uu*oc(s),new sn(Fc(3.2404542*i-1.5371385*e-.4985314*s),Fc(-.969266*i+1.8760108*e+.041556*s),Fc(.0556434*i-.2040259*e+1.0572252*s),n.alpha)}function rm(n,e,i){const s=e-n;return n+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Nc={forward:fs,reverse:Vu,interpolate:function(n,e,i){return{l:ei(n.l,e.l,i),a:ei(n.a,e.a,i),b:ei(n.b,e.b,i),alpha:ei(n.alpha,e.alpha,i)}}},Uc={forward:function(n){const{l:e,a:i,b:s}=fs(n),l=Math.atan2(s,i)*np;return{h:l<0?l+360:l,c:Math.sqrt(i*i+s*s),l:e,alpha:n.a}},reverse:function(n){const e=n.h*Sl,i=n.c;return Vu({l:n.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:n.alpha})},interpolate:function(n,e,i){return{h:rm(n.h,e.h,i),c:ei(n.c,e.c,i),l:ei(n.l,e.l,i),alpha:ei(n.alpha,e.alpha,i)}}};var sm=Object.freeze({__proto__:null,hcl:Uc,lab:Nc});class hr{constructor(e,i,s,l,d){this.type=e,this.operator=i,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,g]of d)this.labels.push(f),this.outputs.push(g)}static interpolationFactor(e,i,s,l){let d=0;if(e.name==="exponential")d=ju(i,e.base,s,l);else if(e.name==="linear")d=ju(i,1,s,l);else if(e.name==="cubic-bezier"){const f=e.controlPoints;d=new Pd(f[0],f[1],f[2],f[3]).solve(ju(i,1,s,l))}return d}static parse(e,i){let[s,l,d,...f]=e;if(!Array.isArray(l)||l.length===0)return i.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const b=l[1];if(typeof b!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:b}}else{if(l[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const b=l.slice(1);if(b.length!==4||b.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:b}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(d=i.parse(d,2,Wt),!d)return null;const g=[];let x=null;s==="interpolate-hcl"||s==="interpolate-lab"?x=no:i.expectedType&&i.expectedType.kind!=="value"&&(x=i.expectedType);for(let b=0;b<f.length;b+=2){const C=f[b],M=f[b+1],R=b+3,P=b+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(g.length&&g[g.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const F=i.parse(M,P,x);if(!F)return null;x=x||F.type,g.push([C,F])}return x.kind==="number"||x.kind==="color"||x.kind==="array"&&x.itemType.kind==="number"&&typeof x.N=="number"?new hr(x,s,l,d,g):i.error(`Type ${Rr(x)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const l=this.input.evaluate(e);if(l<=i[0])return s[0].evaluate(e);const d=i.length;if(l>=i[d-1])return s[d-1].evaluate(e);const f=sc(i,l),g=hr.interpolationFactor(this.interpolation,l,i[f],i[f+1]),x=s[f].evaluate(e),b=s[f+1].evaluate(e);return this.operator==="interpolate"?Mh[this.type.kind.toLowerCase()](x,b,g):this.operator==="interpolate-hcl"?Uc.reverse(Uc.interpolate(Uc.forward(x),Uc.forward(b),g)):Nc.reverse(Nc.interpolate(Nc.forward(x),Nc.forward(b),g))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function ju(n,e,i,s){const l=s-i,d=n-i;return l===0?0:e===1?d/l:(Math.pow(e,d)-1)/(Math.pow(e,l)-1)}class El{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const l=i.expectedType;l&&l.kind!=="value"&&(s=l);const d=[];for(const g of e.slice(1)){const x=i.parse(g,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!x)return null;s=s||x.type,d.push(x)}const f=l&&d.some(g=>$l(l,g.type));return new El(f?on:s,d)}evaluate(e){let i,s=null,l=0;for(const d of this.args){if(l++,s=d.evaluate(e),s&&s instanceof Jr&&!s.available&&(i||(i=s),s=null,l===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ac{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const f=e[d];if(typeof f!="string")return i.error(`Expected string, but found ${typeof f} instead.`,d);if(/[^a-zA-Z0-9_]/.test(f))return i.error("Variable names must contain only alphanumeric characters or '_'.",d);const g=i.parse(e[d+1],d+1);if(!g)return null;s.push([f,g])}const l=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return l?new ac(s,l):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Hh{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Wt),l=i.parse(e[2],2,Fs(i.expectedType||on));return s&&l?new Hh(l.type.itemType,s,l):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new mr(`Array index out of bounds: ${i} < 0.`);if(i>=s.length)throw new mr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i!==Math.floor(i))throw new mr(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class lc{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Wt),l=i.parse(e[2],2,Fs(i.expectedType||on));return s&&l?new lc(l.type.itemType,s,l):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new mr(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new mr(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const l=Math.floor(i),d=Math.ceil(i),f=s[l],g=s[d];if(typeof f!="number"||typeof g!="number")throw new mr(`Cannot interpolate between non-number values at index ${i}.`);const x=i-l;return f*(1-x)+g*x}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Al{constructor(e,i){this.type=nn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,on),l=i.parse(e[2],2,on);return s&&l?zo(s.type,[nn,un,Wt,Mu,on])?new Al(s,l):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Lh(i,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(kt(i))} instead.`);if(!Lh(s,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Rr(kt(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class qh{constructor(e,i,s){this.type=Wt,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,on),l=i.parse(e[2],2,on);if(!s||!l)return null;if(!zo(s.type,[nn,un,Wt,Mu,on]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Wt);return d?new qh(s,l,d):null}return new qh(s,l)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Lh(i,["boolean","string","number","null"]))throw new mr(`Expected first argument to be of type boolean, string, number or null, but found ${Rr(kt(i))} instead.`);if(!Lh(s,["string","array"]))throw new mr(`Expected second argument to be of type array or string, but found ${Rr(kt(s))} instead.`);if(this.fromIndex){const l=this.fromIndex.evaluate(e);return s.indexOf(i,l)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Vc{constructor(e,i,s,l,d,f){this.inputType=e,this.type=i,this.input=s,this.cases=l,this.outputs=d,this.otherwise=f}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const d={},f=[];for(let b=2;b<e.length-1;b+=2){let C=e[b];const M=e[b+1];Array.isArray(C)||(C=[C]);const R=i.concat(b);if(C.length===0)return R.error("Expected at least one branch label.");for(const F of C){if(typeof F!="number"&&typeof F!="string")return R.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return R.error("Numeric branch labels must be integer values.");if(s){if(R.checkSubtype(s,kt(F)))return null}else s=kt(F);if(d[String(F)]!==void 0)return R.error("Branch labels must be unique.");d[String(F)]=f.length}const P=i.parse(M,b,l);if(!P)return null;l=l||P.type,f.push(P)}const g=i.parse(e[1],1,on);if(!g)return null;const x=i.parse(e[e.length-1],e.length-1,l);return x?g.type.kind!=="value"&&i.concat(1).checkSubtype(s,g.type)?null:new Vc(s,l,g,d,f,x):null}evaluate(e){const i=this.input.evaluate(e);return(Ph(kt(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],l={};for(const f of i){const g=l[this.cases[f]];g===void 0?(l[this.cases[f]]=s.length,s.push([this.cases[f],[f]])):s[g][1].push(f)}const d=f=>this.inputType.kind==="number"?Number(f):f;for(const[f,g]of s)e.push(g.length===1?d(g[0]):g.map(d)),e.push(this.outputs[f].serialize());return e.push(this.otherwise.serialize()),e}}class rp{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const l=[];for(let f=1;f<e.length-1;f+=2){const g=i.parse(e[f],f,nn);if(!g)return null;const x=i.parse(e[f+1],f+1,s);if(!x)return null;l.push([g,x]),s=s||x.type}const d=i.parse(e[e.length-1],e.length-1,s);return d?new rp(s,l,d):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Gu{constructor(e,i,s,l){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,on),l=i.parse(e[2],2,Wt);if(!s||!l)return null;if(!zo(s.type,[Fs(on),un,on]))return i.error(`Expected first argument to be of type array or string, but found ${Rr(s.type)} instead`);if(e.length===4){const d=i.parse(e[3],3,Wt);return d?new Gu(s.type,s,l,d):null}return new Gu(s.type,s,l)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Lh(i,["string","array"]))throw new mr(`Expected first argument to be of type array or string, but found ${Rr(kt(i))} instead.`);if(this.endIndex){const l=this.endIndex.evaluate(e);return i.slice(s,l)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function cc(n,e){return n==="=="||n==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Zd(n,e,i,s){return s.compare(e,i)===0}function Da(n,e,i){const s=n!=="=="&&n!=="!=";return class ST{constructor(d,f,g){this.type=nn,this.lhs=d,this.rhs=f,this.collator=g,this.hasUntypedArgument=d.type.kind==="value"||f.type.kind==="value"}static parse(d,f){if(d.length!==3&&d.length!==4)return f.error("Expected two or three arguments.");const g=d[0];let x=f.parse(d[1],1,on);if(!x)return null;if(!cc(g,x.type))return f.concat(1).error(`"${g}" comparisons are not supported for type '${Rr(x.type)}'.`);let b=f.parse(d[2],2,on);if(!b)return null;if(!cc(g,b.type))return f.concat(2).error(`"${g}" comparisons are not supported for type '${Rr(b.type)}'.`);if(x.type.kind!==b.type.kind&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error(`Cannot compare types '${Rr(x.type)}' and '${Rr(b.type)}'.`);s&&(x.type.kind==="value"&&b.type.kind!=="value"?x=new Jt(b.type,[x]):x.type.kind!=="value"&&b.type.kind==="value"&&(b=new Jt(x.type,[b])));let C=null;if(d.length===4){if(x.type.kind!=="string"&&b.type.kind!=="string"&&x.type.kind!=="value"&&b.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(C=f.parse(d[3],3,Bd),!C)return null}return new ST(x,b,C)}evaluate(d){const f=this.lhs.evaluate(d),g=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const x=kt(f),b=kt(g);if(x.kind!==b.kind||x.kind!=="string"&&x.kind!=="number")throw new mr(`Expected arguments for "${n}" to be (string, string) or (number, number), but found (${x.kind}, ${b.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const x=kt(f),b=kt(g);if(x.kind!=="string"||b.kind!=="string")return e(d,f,g)}return this.collator?i(d,f,g,this.collator.evaluate(d)):e(d,f,g)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[n];return this.eachChild(f=>{d.push(f.serialize())}),d}}}const sp=Da("==",function(n,e,i){return e===i},Zd),Zh=Da("!=",function(n,e,i){return e!==i},function(n,e,i,s){return!Zd(0,e,i,s)}),om=Da("<",function(n,e,i){return e<i},function(n,e,i,s){return s.compare(e,i)<0}),Xd=Da(">",function(n,e,i){return e>i},function(n,e,i,s){return s.compare(e,i)>0}),Hu=Da("<=",function(n,e,i){return e<=i},function(n,e,i,s){return s.compare(e,i)<=0}),am=Da(">=",function(n,e,i){return e>=i},function(n,e,i,s){return s.compare(e,i)>=0});class jc{constructor(e,i,s,l,d,f){this.type=un,this.number=e,this.locale=i,this.currency=s,this.unit=l,this.minFractionDigits=d,this.maxFractionDigits=f}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Wt);if(!s)return null;const l=e[2];if(typeof l!="object"||Array.isArray(l))return i.error("NumberFormat options argument must be an object.");let d=null;if(l.locale&&(d=i.parseObjectValue(l.locale,2,"locale",un),!d))return null;let f=null;if(l.currency&&(f=i.parseObjectValue(l.currency,2,"currency",un),!f))return null;let g=null;if(l.unit&&(g=i.parseObjectValue(l.unit,2,"unit",un),!g))return null;let x=null;if(l["min-fraction-digits"]&&(x=i.parseObjectValue(l["min-fraction-digits"],2,"min-fraction-digits",Wt),!x))return null;let b=null;return l["max-fraction-digits"]&&(b=i.parseObjectValue(l["max-fraction-digits"],2,"max-fraction-digits",Wt),!b)?null:new jc(s,d,f,g,x,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Wd{constructor(e){this.type=Wt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Rr(s.type)} instead.`):new Wd(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new mr(`Expected value to be of type string or array, but found ${Rr(kt(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function qu(n){return function(){n=1831565813+(n|=0)|0;let e=Math.imul(n^n>>>15,1|n);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const uc={"==":sp,"!=":Zh,">":Xd,"<":om,">=":am,"<=":Hu,array:Jt,at:Hh,"at-interpolated":lc,boolean:Jt,case:rp,coalesce:El,collator:Ia,format:pl,image:Pc,in:Al,"index-of":qh,interpolate:hr,"interpolate-hcl":hr,"interpolate-lab":hr,length:Wd,let:ac,literal:li,match:Vc,number:Jt,"number-format":jc,object:Jt,slice:Gu,step:wl,string:Jt,"to-boolean":ro,"to-color":ro,"to-number":ro,"to-string":ro,var:Ma,within:hs,distance:ic,config:rc};function $d(n,[e,i,s,l]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const d=l?l.evaluate(n):1,f=Lc(e,i,s,d);if(f)throw new mr(f);return new sn(e/255,i/255,s/255,d)}function za(n,[e,i,s,l]){e=e.evaluate(n),i=i.evaluate(n),s=s.evaluate(n);const d=l?l.evaluate(n):1,f=function(b,C,M,R){return typeof b=="number"&&b>=0&&b<=360?typeof C=="number"&&C>=0&&C<=100&&typeof M=="number"&&M>=0&&M<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[b,C,M,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[b,C,M,R]:[b,C,M]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[b,C,M,R]:[b,C,M]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,d);if(f)throw new mr(f);const g=`hsla(${e}, ${i}%, ${s}%, ${d})`,x=sn.parse(g);if(!x)throw new mr(`Failed to parse HSLA color: ${g}`);return x}function Yd(n,e){return n in e}function La(n,e){const i=e[n];return i===void 0?null:i}function co(n){return{type:n}}function Cl(n){return{result:"success",value:n}}function Bo(n){return{result:"error",value:n}}function Zu(n,e){return!!n&&!!n.parameters&&n.parameters.indexOf(e)>-1}function Gc(n){return n["property-type"]==="data-driven"}function Hc(n){return Zu(n.expression,"measure-light")}function qc(n){return Zu(n.expression,"zoom")}function Xu(n){return!!n.expression&&n.expression.interpolated}function Wu(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)}function Zc(n){return n}function Xh(n,e){const i=e.type==="color",s=n.stops&&typeof n.stops[0][0]=="object",l=s||!(s||n.property!==void 0),d=n.type||(Xu(e)?"exponential":"interval");if(i&&((n=zc({},n)).stops&&(n.stops=n.stops.map(b=>[b[0],sn.parse(b[1])])),n.default=sn.parse(n.default?n.default:e.default)),n.colorSpace&&n.colorSpace!=="rgb"&&!sm[n.colorSpace])throw new Error(`Unknown color space: ${n.colorSpace}`);let f,g,x;if(d==="exponential")f=Pa;else if(d==="interval")f=ap;else if(d==="categorical"){f=op,g=Object.create(null);for(const b of n.stops)g[b[0]]=b[1];x=typeof n.stops[0][0]}else{if(d!=="identity")throw new Error(`Unknown function type "${d}"`);f=An}if(s){const b={},C=[];for(let P=0;P<n.stops.length;P++){const F=n.stops[P],V=F[0].zoom;b[V]===void 0&&(b[V]={zoom:V,type:n.type,property:n.property,default:n.default,stops:[]},C.push(V)),b[V].stops.push([F[0].value,F[1]])}const M=[];for(const P of C)M.push([b[P].zoom,Xh(b[P],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:hr.interpolationFactor.bind(void 0,R),zoomStops:M.map(P=>P[0]),evaluate:({zoom:P},F)=>Pa({stops:M,base:n.base},e,P).evaluate(P,F)}}if(l){const b=d==="exponential"?{name:"exponential",base:n.base!==void 0?n.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:hr.interpolationFactor.bind(void 0,b),zoomStops:n.stops.map(C=>C[0]),evaluate:({zoom:C})=>f(n,e,C,g,x)}}return{kind:"source",evaluate(b,C){const M=C&&C.properties?C.properties[n.property]:void 0;return M===void 0?So(n.default,e.default):f(n,e,M,g,x)}}}function So(n,e,i){return n!==void 0?n:e!==void 0?e:i!==void 0?i:void 0}function op(n,e,i,s,l){return So(typeof i===l?s[i]:void 0,n.default,e.default)}function ap(n,e,i){if(ml(i)!=="number")return So(n.default,e.default);const s=n.stops.length;if(s===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[s-1][0])return n.stops[s-1][1];const l=sc(n.stops.map(d=>d[0]),i);return n.stops[l][1]}function Pa(n,e,i){const s=n.base!==void 0?n.base:1;if(ml(i)!=="number")return So(n.default,e.default);const l=n.stops.length;if(l===1||i<=n.stops[0][0])return n.stops[0][1];if(i>=n.stops[l-1][0])return n.stops[l-1][1];const d=sc(n.stops.map(C=>C[0]),i),f=function(C,M,R,P){const F=P-R,V=C-R;return F===0?0:M===1?V/F:(Math.pow(M,V)-1)/(Math.pow(M,F)-1)}(i,s,n.stops[d][0],n.stops[d+1][0]),g=n.stops[d][1],x=n.stops[d+1][1];let b=Mh[e.type]||Zc;if(n.colorSpace&&n.colorSpace!=="rgb"){const C=sm[n.colorSpace];b=(M,R)=>C.reverse(C.interpolate(C.forward(M),C.forward(R),f))}return typeof g.evaluate=="function"?{evaluate(...C){const M=g.evaluate.apply(void 0,C),R=x.evaluate.apply(void 0,C);if(M!==void 0&&R!==void 0)return b(M,R,f)}}:b(g,x,f)}function An(n,e,i){return e.type==="color"?i=sn.parse(i):e.type==="formatted"?i=Ts.fromString(i.toString()):e.type==="resolvedImage"?i=Jr.build(i.toString()):ml(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),So(i,n.default,e.default)}Wr.register(uc,{error:[{kind:"error"},[un],(n,[e])=>{throw new mr(e.evaluate(n))}],typeof:[un,[on],(n,[e])=>Rr(kt(e.evaluate(n)))],"to-rgba":[Fs(Wt,4),[no],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Fs(Wt,4),[no],(n,[e])=>e.evaluate(n).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[no,[Wt,Wt,Wt],$d],rgba:[no,[Wt,Wt,Wt,Wt],$d],hsl:[no,[Wt,Wt,Wt],za],hsla:[no,[Wt,Wt,Wt,Wt],za],has:{type:nn,overloads:[[[un],(n,[e])=>Yd(e.evaluate(n),n.properties())],[[un,dl],(n,[e,i])=>Yd(e.evaluate(n),i.evaluate(n))]]},get:{type:on,overloads:[[[un],(n,[e])=>La(e.evaluate(n),n.properties())],[[un,dl],(n,[e,i])=>La(e.evaluate(n),i.evaluate(n))]]},"feature-state":[on,[un],(n,[e])=>La(e.evaluate(n),n.featureState||{})],properties:[dl,[],n=>n.properties()],"geometry-type":[un,[],n=>n.geometryType()],worldview:[un,[],n=>n.globals.worldview||""],id:[on,[],n=>n.id()],zoom:[Wt,[],n=>n.globals.zoom],pitch:[Wt,[],n=>n.globals.pitch||0],"distance-from-center":[Wt,[],n=>n.distanceFromCenter()],"measure-light":[Wt,[un],(n,[e])=>n.measureLight(e.evaluate(n))],"heatmap-density":[Wt,[],n=>n.globals.heatmapDensity||0],"line-progress":[Wt,[],n=>n.globals.lineProgress||0],"raster-value":[Wt,[],n=>n.globals.rasterValue||0],"raster-particle-speed":[Wt,[],n=>n.globals.rasterParticleSpeed||0],"sky-radial-progress":[Wt,[],n=>n.globals.skyRadialProgress||0],accumulated:[on,[],n=>n.globals.accumulated===void 0?null:n.globals.accumulated],"+":[Wt,co(Wt),(n,e)=>{let i=0;for(const s of e)i+=s.evaluate(n);return i}],"*":[Wt,co(Wt),(n,e)=>{let i=1;for(const s of e)i*=s.evaluate(n);return i}],"-":{type:Wt,overloads:[[[Wt,Wt],(n,[e,i])=>e.evaluate(n)-i.evaluate(n)],[[Wt],(n,[e])=>-e.evaluate(n)]]},"/":[Wt,[Wt,Wt],(n,[e,i])=>e.evaluate(n)/i.evaluate(n)],"%":[Wt,[Wt,Wt],(n,[e,i])=>e.evaluate(n)%i.evaluate(n)],ln2:[Wt,[],()=>Math.LN2],pi:[Wt,[],()=>Math.PI],e:[Wt,[],()=>Math.E],"^":[Wt,[Wt,Wt],(n,[e,i])=>Math.pow(e.evaluate(n),i.evaluate(n))],sqrt:[Wt,[Wt],(n,[e])=>Math.sqrt(e.evaluate(n))],log10:[Wt,[Wt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN10],ln:[Wt,[Wt],(n,[e])=>Math.log(e.evaluate(n))],log2:[Wt,[Wt],(n,[e])=>Math.log(e.evaluate(n))/Math.LN2],sin:[Wt,[Wt],(n,[e])=>Math.sin(e.evaluate(n))],cos:[Wt,[Wt],(n,[e])=>Math.cos(e.evaluate(n))],tan:[Wt,[Wt],(n,[e])=>Math.tan(e.evaluate(n))],asin:[Wt,[Wt],(n,[e])=>Math.asin(e.evaluate(n))],acos:[Wt,[Wt],(n,[e])=>Math.acos(e.evaluate(n))],atan:[Wt,[Wt],(n,[e])=>Math.atan(e.evaluate(n))],min:[Wt,co(Wt),(n,e)=>Math.min(...e.map(i=>i.evaluate(n)))],max:[Wt,co(Wt),(n,e)=>Math.max(...e.map(i=>i.evaluate(n)))],abs:[Wt,[Wt],(n,[e])=>Math.abs(e.evaluate(n))],round:[Wt,[Wt],(n,[e])=>{const i=e.evaluate(n);return i<0?-Math.round(-i):Math.round(i)}],floor:[Wt,[Wt],(n,[e])=>Math.floor(e.evaluate(n))],ceil:[Wt,[Wt],(n,[e])=>Math.ceil(e.evaluate(n))],"filter-==":[nn,[un,on],(n,[e,i])=>n.properties()[e.value]===i.value],"filter-id-==":[nn,[on],(n,[e])=>n.id()===e.value],"filter-type-==":[nn,[un],(n,[e])=>n.geometryType()===e.value],"filter-<":[nn,[un,on],(n,[e,i])=>{const s=n.properties()[e.value],l=i.value;return typeof s==typeof l&&s<l}],"filter-id-<":[nn,[on],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[nn,[un,on],(n,[e,i])=>{const s=n.properties()[e.value],l=i.value;return typeof s==typeof l&&s>l}],"filter-id->":[nn,[on],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[nn,[un,on],(n,[e,i])=>{const s=n.properties()[e.value],l=i.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[nn,[on],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[nn,[un,on],(n,[e,i])=>{const s=n.properties()[e.value],l=i.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[nn,[on],(n,[e])=>{const i=n.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[nn,[on],(n,[e])=>e.value in n.properties()],"filter-has-id":[nn,[],n=>n.id()!==null&&n.id()!==void 0],"filter-type-in":[nn,[Fs(un)],(n,[e])=>e.value.indexOf(n.geometryType())>=0],"filter-id-in":[nn,[Fs(on)],(n,[e])=>e.value.indexOf(n.id())>=0],"filter-in-small":[nn,[un,Fs(on)],(n,[e,i])=>i.value.indexOf(n.properties()[e.value])>=0],"filter-in-large":[nn,[un,Fs(on)],(n,[e,i])=>function(s,l,d,f){for(;d<=f;){const g=d+f>>1;if(l[g]===s)return!0;l[g]>s?f=g-1:d=g+1}return!1}(n.properties()[e.value],i.value,0,i.value.length-1)],all:{type:nn,overloads:[[[nn,nn],(n,[e,i])=>e.evaluate(n)&&i.evaluate(n)],[co(nn),(n,e)=>{for(const i of e)if(!i.evaluate(n))return!1;return!0}]]},any:{type:nn,overloads:[[[nn,nn],(n,[e,i])=>e.evaluate(n)||i.evaluate(n)],[co(nn),(n,e)=>{for(const i of e)if(i.evaluate(n))return!0;return!1}]]},"!":[nn,[nn],(n,[e])=>!e.evaluate(n)],"is-supported-script":[nn,[un],(n,[e])=>{const i=n.globals&&n.globals.isSupportedScript;return!i||i(e.evaluate(n))}],upcase:[un,[un],(n,[e])=>e.evaluate(n).toUpperCase()],downcase:[un,[un],(n,[e])=>e.evaluate(n).toLowerCase()],concat:[un,co(on),(n,e)=>e.map(i=>vo(i.evaluate(n))).join("")],"resolved-locale":[un,[Bd],(n,[e])=>e.evaluate(n).resolvedLocale()],random:[Wt,[Wt,Wt,on],(n,e)=>{const[i,s,l]=e.map(f=>f.evaluate(n));if(i>s||i===s)return i;let d;if(typeof l=="string")d=function(f){let g=0;if(f.length===0)return g;for(let x=0;x<f.length;x++)g=(g<<5)-g+f.charCodeAt(x),g|=0;return g}(l);else{if(typeof l!="number")throw new mr(`Invalid seed input: ${l}`);d=l}return i+qu(d)()*(s-i)}]});class rr{constructor(e,i,s,l){this.expression=e,this._warningHistory={},this._evaluator=new Du(s,l),this._defaultValue=i?function(d){return d.type==="color"&&(Wu(d.default)||Array.isArray(d.default))?new sn(0,0,0,0):d.type==="color"?sn.parse(d.default)||null:d.default===void 0?null:d.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ds(e)}evaluateWithoutErrorHandling(e,i,s,l,d,f,g,x){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,l,d,f,g,x){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=f||null,this._evaluator.featureTileCoord=g||null,this._evaluator.featureDistanceData=x||null;try{const b=this.expression.evaluate(this._evaluator);if(b==null||typeof b=="number"&&b!=b)return this._defaultValue;if(this._enumValues&&!(b in this._enumValues))throw new mr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(b)} instead.`);return b}catch(b){return this._warningHistory[b.message]||(this._warningHistory[b.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${b.message}`)),this._defaultValue}}}function Pr(n){return Array.isArray(n)&&n.length>0&&typeof n[0]=="string"&&n[0]in uc}function Fo(n,e,i,s){const l=new jh(uc,[],e?function(f){const g={color:no,string:un,number:Wt,enum:un,boolean:nn,formatted:Dh,resolvedImage:zh};return f.type==="array"?Fs(g[f.value]||on,f.length):g[f.type]}(e):void 0,void 0,void 0,i,s),d=l.parse(n,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?Cl(new rr(d,e,i,s)):Bo(l.errors)}class Oa{constructor(e,i,s,l){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=l,this.isStateDependent=e!=="constant"&&!Nu(i.expression),this.configDependencies=ds(i.expression)}evaluateWithoutErrorHandling(e,i,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,l,d,f)}evaluate(e,i,s,l,d,f){return this._styleExpression.evaluate(e,i,s,l,d,f)}}class ha{constructor(e,i,s,l,d,f){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Nu(i.expression),this.isLightConstant=d,this.isLineProgressConstant=f,this.configDependencies=ds(i.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,i,s,l,d,f){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,l,d,f)}evaluate(e,i,s,l,d,f){return this._styleExpression.evaluate(e,i,s,l,d,f)}interpolationFactor(e,i,s){return this.interpolationType?hr.interpolationFactor(this.interpolationType,e,i,s):0}}function Wh(n,e,i,s){if((n=Fo(n,e,i,s)).result==="error")return n;const l=n.value.expression,d=nc(l);if(!d&&!Gc(e))return Bo([new yo("","data expressions not supported")]);const f=Tr(l,["zoom","pitch","distance-from-center"]);if(!f&&!qc(e))return Bo([new yo("","zoom expressions not supported")]);const g=Tr(l,["measure-light"]);if(!g&&!Hc(e))return Bo([new yo("","measure-light expression not supported")]);const x=Tr(l,["line-progress"]);if(!x&&!function(M){return Zu(M.expression,"line-progress")}(e))return Bo([new yo("","line-progress expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,C=da(l);return C||f||b?C instanceof yo?Bo([C]):C instanceof hr&&!Xu(e)?Bo([new yo("",'"interpolate" expressions cannot be used with this property')]):Cl(C?new ha(d&&x?"camera":"composite",n.value,C.labels,C instanceof hr?C.interpolation:void 0,g,x):new Oa(d&&x?"constant":"source",n.value,g,x)):Bo([new yo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ka{constructor(e,i){this._parameters=e,this._specification=i,zc(this,Xh(this._parameters,this._specification))}static deserialize(e){return new ka(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function da(n){let e=null;if(n instanceof ac)e=da(n.result);else if(n instanceof El){for(const i of n.args)if(e=da(i),e)break}else(n instanceof wl||n instanceof hr)&&n.input instanceof Wr&&n.input.name==="zoom"&&(e=n);return e instanceof yo||n.eachChild(i=>{const s=da(i);s instanceof yo?e=s:e&&s&&e!==s&&(e=new yo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Kd,Or,$h=function(){if(Or)return Kd;Or=1,Kd=e;var n=3;function e(i,s,l){var d=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(s=f[1])+2*(l=f[2]);for(var g=0;g<this.d*this.d;g++){var x=f[n+g],b=f[n+g+1];d.push(x===b?null:f.subarray(x,b))}var C=f[n+d.length+1];this.keys=f.subarray(f[n+d.length],C),this.bboxes=f.subarray(C),this.insert=this._insertReadonly}else{this.d=s+2*l;for(var M=0;M<this.d*this.d;M++)d.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=l,this.scale=s/i,this.uid=0;var R=l/s*i;this.min=-R,this.max=i+R}return e.prototype.insert=function(i,s,l,d,f){this._forEachCell(s,l,d,f,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(f)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,l,d,f,g){this.cells[f].push(g)},e.prototype.query=function(i,s,l,d,f){var g=this.min,x=this.max;if(i<=g&&s<=g&&x<=l&&x<=d&&!f)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(i,s,l,d,this._queryCell,b,{},f),b},e.prototype._queryCell=function(i,s,l,d,f,g,x,b){var C=this.cells[f];if(C!==null)for(var M=this.keys,R=this.bboxes,P=0;P<C.length;P++){var F=C[P];if(x[F]===void 0){var V=4*F;(b?b(R[V+0],R[V+1],R[V+2],R[V+3]):i<=R[V+2]&&s<=R[V+3]&&l>=R[V+0]&&d>=R[V+1])?(x[F]=!0,g.push(M[F])):x[F]=!1}}},e.prototype._forEachCell=function(i,s,l,d,f,g,x,b){for(var C=this._convertToCellCoord(i),M=this._convertToCellCoord(s),R=this._convertToCellCoord(l),P=this._convertToCellCoord(d),F=C;F<=R;F++)for(var V=M;V<=P;V++){var q=this.d*V+F;if((!b||b(this._convertFromCellCoord(F),this._convertFromCellCoord(V),this._convertFromCellCoord(F+1),this._convertFromCellCoord(V+1)))&&f.call(this,i,s,l,d,q,g,x,b))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=n+this.cells.length+1+1,l=0,d=0;d<this.cells.length;d++)l+=this.cells[d].length;var f=new Int32Array(s+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;for(var g=s,x=0;x<i.length;x++){var b=i[x];f[n+x]=g,f.set(b,g),g+=b.length}return f[n+i.length]=g,f.set(this.keys,g),f[n+i.length+1]=g+=this.keys.length,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer},Kd}(),fa=ol($h);const Ba={};function Pt(n,e,i={}){Object.defineProperty(n,"_classRegistryKey",{value:e,writable:!1}),Ba[e]={klass:n,omit:i.omit||[]}}Pt(Object,"Object"),fa.serialize=function(n,e){const i=n.toArrayBuffer();return e&&e.add(i),{buffer:i}},fa.deserialize=function(n){return new fa(n.buffer)},Object.defineProperty(fa,"name",{value:"Grid"}),Pt(fa,"Grid"),typeof DOMMatrix<"u"&&Pt(DOMMatrix,"DOMMatrix"),Pt(sn,"Color"),Pt(Error,"Error"),Pt(Ts,"Formatted"),Pt(Oh,"FormattedSection"),Pt(ji,"AJAXError"),Pt(Jr,"ResolvedImage"),Pt(ka,"StylePropertyFunction"),Pt(rr,"StyleExpression",{omit:["_evaluator"]}),Pt(io,"ImageId"),Pt(Ca,"ImageVariant"),Pt(ha,"ZoomDependentExpression"),Pt(Oa,"ZoomConstantExpression"),Pt(Wr,"CompoundExpression",{omit:["_evaluate"]});for(const n in uc)Ba[uc[n]._classRegistryKey]||Pt(uc[n],`Expression${n}`);function lm(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}function Qd(n){return self.ImageBitmap&&n instanceof ImageBitmap}function Fa(n,e){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp)return n;if(lm(n)||Qd(n))return e&&e.add(n),n;if(ArrayBuffer.isView(n))return e&&e.add(n.buffer),n;if(n instanceof ImageData)return e&&e.add(n.data.buffer),n;if(Array.isArray(n)){const i=[];for(const s of n)i.push(Fa(s,e));return i}if(n instanceof Map){const i={$name:"Map",entries:[]};for(const[s,l]of n.entries())i.entries.push(Fa(s),Fa(l,e));return i}if(n instanceof Set){const i={$name:"Set"};let s=0;for(const l of n.values())i[++s]=Fa(l);return i}if(n instanceof DOMMatrix){const i={$name:"DOMMatrix"},s=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const l of s)i[l]=n[l];return i}if(typeof n=="bigint")return{$name:"BigInt",value:n.toString()};if(typeof n=="object"){const i=n.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const l=i.serialize?i.serialize(n,e):{};if(!i.serialize){for(const d in n)n.hasOwnProperty(d)&&(Ba[s].omit.indexOf(d)>=0||(l[d]=Fa(n[d],e)));n instanceof Error&&(l.message=n.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(l.$name=s),l}throw new Error("can't serialize object of type "+typeof n)}function Na(n){if(n==null||typeof n=="boolean"||typeof n=="number"||typeof n=="string"||n instanceof Boolean||n instanceof Number||n instanceof String||n instanceof Date||n instanceof RegExp||lm(n)||Qd(n)||ArrayBuffer.isView(n)||n instanceof ImageData)return n;if(Array.isArray(n))return n.map(Na);if(typeof n=="object"){const e=n.$name||"Object";if(e==="Map"){const l=n.entries||[],d=new Map;for(let f=0;f<l.length;f+=2)d.set(Na(l[f]),Na(l[f+1]));return d}if(e==="Set"){const l=new Set;for(const d of Object.keys(n))d!=="$name"&&l.add(Na(n[d]));return l}if(e==="DOMMatrix"){let l;return l=n.is2D?[n.a,n.b,n.c,n.d,n.e,n.f]:[n.m11,n.m12,n.m13,n.m14,n.m21,n.m22,n.m23,n.m24,n.m31,n.m32,n.m33,n.m34,n.m41,n.m42,n.m43,n.m44],new DOMMatrix(l)}if(e==="BigInt")return BigInt(n.value);const{klass:i}=Ba[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(n);const s=Object.create(i.prototype);for(const l of Object.keys(n))l!=="$name"&&(s[l]=Na(n[l]));return s}throw new Error("can't deserialize object of type "+typeof n)}const Zt={"Latin-1 Supplement":n=>n>=128&&n<=255,Arabic:n=>n>=1536&&n<=1791,"Arabic Supplement":n=>n>=1872&&n<=1919,"Arabic Extended-A":n=>n>=2208&&n<=2303,"Hangul Jamo":n=>n>=4352&&n<=4607,"Unified Canadian Aboriginal Syllabics":n=>n>=5120&&n<=5759,Khmer:n=>n>=6016&&n<=6143,"Unified Canadian Aboriginal Syllabics Extended":n=>n>=6320&&n<=6399,"General Punctuation":n=>n>=8192&&n<=8303,"Letterlike Symbols":n=>n>=8448&&n<=8527,"Number Forms":n=>n>=8528&&n<=8591,"Miscellaneous Technical":n=>n>=8960&&n<=9215,"Control Pictures":n=>n>=9216&&n<=9279,"Optical Character Recognition":n=>n>=9280&&n<=9311,"Enclosed Alphanumerics":n=>n>=9312&&n<=9471,"Geometric Shapes":n=>n>=9632&&n<=9727,"Miscellaneous Symbols":n=>n>=9728&&n<=9983,"Miscellaneous Symbols and Arrows":n=>n>=11008&&n<=11263,"CJK Radicals Supplement":n=>n>=11904&&n<=12031,"Kangxi Radicals":n=>n>=12032&&n<=12255,"Ideographic Description Characters":n=>n>=12272&&n<=12287,"CJK Symbols and Punctuation":n=>n>=12288&&n<=12351,Hiragana:n=>n>=12352&&n<=12447,Katakana:n=>n>=12448&&n<=12543,Bopomofo:n=>n>=12544&&n<=12591,"Hangul Compatibility Jamo":n=>n>=12592&&n<=12687,Kanbun:n=>n>=12688&&n<=12703,"Bopomofo Extended":n=>n>=12704&&n<=12735,"CJK Strokes":n=>n>=12736&&n<=12783,"Katakana Phonetic Extensions":n=>n>=12784&&n<=12799,"Enclosed CJK Letters and Months":n=>n>=12800&&n<=13055,"CJK Compatibility":n=>n>=13056&&n<=13311,"CJK Unified Ideographs Extension A":n=>n>=13312&&n<=19903,"Yijing Hexagram Symbols":n=>n>=19904&&n<=19967,"CJK Unified Ideographs":n=>n>=19968&&n<=40959,"Yi Syllables":n=>n>=40960&&n<=42127,"Yi Radicals":n=>n>=42128&&n<=42191,"Hangul Jamo Extended-A":n=>n>=43360&&n<=43391,"Hangul Syllables":n=>n>=44032&&n<=55215,"Hangul Jamo Extended-B":n=>n>=55216&&n<=55295,"Private Use Area":n=>n>=57344&&n<=63743,"CJK Compatibility Ideographs":n=>n>=63744&&n<=64255,"Arabic Presentation Forms-A":n=>n>=64336&&n<=65023,"Vertical Forms":n=>n>=65040&&n<=65055,"CJK Compatibility Forms":n=>n>=65072&&n<=65103,"Small Form Variants":n=>n>=65104&&n<=65135,"Arabic Presentation Forms-B":n=>n>=65136&&n<=65279,"Halfwidth and Fullwidth Forms":n=>n>=65280&&n<=65519,Osage:n=>n>=66736&&n<=66815,"CJK Unified Ideographs Extension B":n=>n>=131072&&n<=173791};function Dr(n){for(const e of n)if($u(e.charCodeAt(0)))return!0;return!1}function lp(n){for(const e of n)if(!Yh(e.charCodeAt(0)))return!1;return!0}function Yh(n){return!(Zt.Arabic(n)||Zt["Arabic Supplement"](n)||Zt["Arabic Extended-A"](n)||Zt["Arabic Presentation Forms-A"](n)||Zt["Arabic Presentation Forms-B"](n))}function $u(n){return!(n!==746&&n!==747&&(n<4352||!(Zt["Bopomofo Extended"](n)||Zt.Bopomofo(n)||Zt["CJK Compatibility Forms"](n)&&!(n>=65097&&n<=65103)||Zt["CJK Compatibility Ideographs"](n)||Zt["CJK Compatibility"](n)||Zt["CJK Radicals Supplement"](n)||Zt["CJK Strokes"](n)||!(!Zt["CJK Symbols and Punctuation"](n)||n>=12296&&n<=12305||n>=12308&&n<=12319||n===12336)||Zt["CJK Unified Ideographs Extension A"](n)||Zt["CJK Unified Ideographs"](n)||Zt["Enclosed CJK Letters and Months"](n)||Zt["Hangul Compatibility Jamo"](n)||Zt["Hangul Jamo Extended-A"](n)||Zt["Hangul Jamo Extended-B"](n)||Zt["Hangul Jamo"](n)||Zt["Hangul Syllables"](n)||Zt.Hiragana(n)||Zt["Ideographic Description Characters"](n)||Zt.Kanbun(n)||Zt["Kangxi Radicals"](n)||Zt["Katakana Phonetic Extensions"](n)||Zt.Katakana(n)&&n!==12540||!(!Zt["Halfwidth and Fullwidth Forms"](n)||n===65288||n===65289||n===65293||n>=65306&&n<=65310||n===65339||n===65341||n===65343||n>=65371&&n<=65503||n===65507||n>=65512&&n<=65519)||!(!Zt["Small Form Variants"](n)||n>=65112&&n<=65118||n>=65123&&n<=65126)||Zt["Unified Canadian Aboriginal Syllabics"](n)||Zt["Unified Canadian Aboriginal Syllabics Extended"](n)||Zt["Vertical Forms"](n)||Zt["Yijing Hexagram Symbols"](n)||Zt["Yi Syllables"](n)||Zt["Yi Radicals"](n))))}function Jd(n){return!($u(n)||function(e){return!!(Zt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Zt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Zt["Letterlike Symbols"](e)||Zt["Number Forms"](e)||Zt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Zt["Control Pictures"](e)&&e!==9251||Zt["Optical Character Recognition"](e)||Zt["Enclosed Alphanumerics"](e)||Zt["Geometric Shapes"](e)||Zt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Zt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Zt["CJK Symbols and Punctuation"](e)||Zt.Katakana(e)||Zt["Private Use Area"](e)||Zt["CJK Compatibility Forms"](e)||Zt["Small Form Variants"](e)||Zt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(n))}function Il(n){return Zt.Arabic(n)||Zt["Arabic Supplement"](n)||Zt["Arabic Extended-A"](n)||Zt["Arabic Presentation Forms-A"](n)||Zt["Arabic Presentation Forms-B"](n)}function Kh(n){return n>=1424&&n<=2303||Zt["Arabic Presentation Forms-A"](n)||Zt["Arabic Presentation Forms-B"](n)}function cp(n,e){return!(!e&&Kh(n)||n>=2304&&n<=3583||n>=3840&&n<=4255||Zt.Khmer(n))}function up(n){for(const e of n)if(Kh(e.charCodeAt(0)))return!0;return!1}const $s={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let ef=null,As=$s.unavailable,Ua=null;const hc=function(n){n&&typeof n=="string"&&n.indexOf("NetworkError")>-1&&(As=$s.error),ef&&ef(n)};function Qh(){Yu.fire(new hl("pluginStateChange",{pluginStatus:As,pluginURL:Ua}))}const Yu=new Rc,Xc=function(){return As},cm=function(){if(As!==$s.deferred||!Ua)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");As=$s.loading,Qh(),Ua&&cl({url:Ua},n=>{n?hc(n):(As=$s.loaded,Qh())})},Va={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>As===$s.loaded||Va.applyArabicShaping!=null,isLoading:()=>As===$s.loading,setState(n){As=n.pluginStatus,Ua=n.pluginURL},isParsing:()=>As===$s.parsing,isParsed:()=>As===$s.parsed,getPluginURL:()=>Ua};class hn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const l of i)if(!cp(l.charCodeAt(0),s))return!1;return!0}(e,Va.isLoaded())}}class Ku{constructor(e,i,s,l){this.property=e,this.value=i,this.expression=function(d,f,g,x){if(Wu(d))return new ka(d,f);if(Pr(d)||Array.isArray(d)&&d.length>0){const b=Wh(d,f,g,x);if(b.result==="error")throw new Error(b.value.map(C=>`${C.key}: ${C.message}`).join(", "));return b.value}{let b=d;return typeof d=="string"&&f.type==="color"&&(b=sn.parse(d)),{kind:"constant",configDependencies:new Set,evaluate:()=>b}}}(i===void 0?e.specification.default:i,e.specification,s,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s){return this.property.possiblyEvaluate(this,e,i,s)}}class ja{constructor(e,i,s){this.property=e,this.value=new Ku(e,void 0,i,s)}transitioned(e,i){return new dp(this.property,this.value,i,ke({},e.transition,this.transition),e.now)}untransitioned(){return new dp(this.property,this.value,null,{},0)}}class hp{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return fi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ja(this._values[e].property,this._scope,this._options)),this._values[e].value=new Ku(this._values[e].property,i===null?void 0:fi(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const l in e){const d=e[l];if(l.endsWith("-transition")){const f=l.slice(0,-11);s[f]&&this.setTransition(f,d)}else s.hasOwnProperty(l)&&this.setValue(l,d)}}getTransition(e){return fi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ja(this._values[e].property)),this._values[e].transition=fi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const l=this.getTransition(i);l!==void 0&&(e[`${i}-transition`]=l)}return e}transitioned(e,i){const s=new fp(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(e,i._values[l]);return s}untransitioned(){const e=new fp(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class dp{constructor(e,i,s,l,d){const f=l.delay||0,g=l.duration||0;d=d||0,this.property=e,this.value=i,this.begin=d+f,this.end=this.begin+g,e.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const l=e.now||0,d=this.value.possiblyEvaluate(e,i,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(l<this.begin)return f.possiblyEvaluate(e,i,s);{const g=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(e,i,s),d,K(g))}}return d}}class fp{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const l=new $c(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,s);return l}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class um{constructor(e,i,s){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this.configDependencies=new Set}getValue(e){return fi(this._values[e].value)}setValue(e,i){this._values[e]=new Ku(this._values[e].property,i===null?void 0:fi(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s){const l=new $c(this._properties);for(const d of Object.keys(this._values))l._values[d]=this._values[d].possiblyEvaluate(e,i,s);return l}}class Wc{constructor(e,i,s){this.property=e,this.value=i,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,l){return this.property.evaluate(this.value,this.parameters,e,i,s,l)}}class $c{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class dt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const l=Mh[this.specification.type];return l?l(e,i,s):e}}class St{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,l){return new Wc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},s,l)}:e.expression,i)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Wc(this,{kind:"constant",value:void 0},e.parameters);const l=Mh[this.specification.type];return l?new Wc(this,{kind:"constant",value:l(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,l,d,f){return e.kind==="constant"?e.value:e.evaluate(i,s,l,d,f)}}class Ga{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,l){return!!e.expression.evaluate(i,null,{},s,l)}interpolate(){return!1}}class sr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new hn(0,{});for(const s in e){const l=e[s];l.specification.overridable&&this.overridableProperties.push(s);const d=this.defaultPropertyValues[s]=new Ku(l,void 0),f=this.defaultTransitionablePropertyValues[s]=new ja(l);this.defaultTransitioningPropertyValues[s]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=d.possiblyEvaluate(i)}}}Pt(St,"DataDrivenProperty"),Pt(dt,"DataConstantProperty"),Pt(Ga,"ColorRampProperty");var Re=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ys(n){return n instanceof Number||n instanceof String||n instanceof Boolean?n.valueOf():n}function Jh(n){if(Array.isArray(n))return n.map(Jh);if(n instanceof Object&&!(n instanceof Number||n instanceof String||n instanceof Boolean)){const e={};for(const i in n)e[i]=Jh(n[i]);return e}return Ys(n)}function ed(n){if(n===!0||n===!1)return!0;if(!Array.isArray(n)||n.length===0)return!1;switch(n[0]){case"has":return n.length>=2&&n[1]!=="$id"&&n[1]!=="$type";case"in":return n.length>=3&&(typeof n[1]!="string"||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return n.length!==3||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!ed(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function tf(n,e="",i=null,s="fill"){if(n==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ed(n)||(n=Qu(n));const l=n;let d=!0;try{d=function(C){if(!Yc(C))return C;let M=Jh(C);return mp(M),M=pp(M),M}(l)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(l,null,2)}
        `)}let f=null,g=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){g=Re[`filter_${s}`];const C=Fo(d,g,e,i);if(C.result==="error")throw new Error(C.value.map(M=>`${M.key}: ${M.message}`).join(", "));f=(M,R,P)=>C.value.evaluate(M,R,{},P)}let x=null,b=null;if(d!==l){const C=Fo(l,g,e,i);if(C.result==="error")throw new Error(C.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,R,P,F,V)=>C.value.evaluate(M,R,{},P,void 0,void 0,F,V),b=!nc(C.value.expression)}return{filter:f,dynamicFilter:x||void 0,needGeometry:gp(d),needFeature:!!b}}function pp(n){if(!Array.isArray(n))return n;const e=function(i){if(_p.has(i[0])){for(let s=1;s<i.length;s++)if(Yc(i[s]))return!0}return i}(n);return e===!0?e:e.map(i=>pp(i))}function mp(n){let e=!1;const i=[];if(n[0]==="case"){for(let s=1;s<n.length-1;s+=2)e=e||Yc(n[s]),i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="match"){e=e||Yc(n[1]);for(let s=2;s<n.length-1;s+=2)i.push(n[s+1]);i.push(n[n.length-1])}else if(n[0]==="step"){e=e||Yc(n[1]);for(let s=1;s<n.length-1;s+=2)i.push(n[s+1])}e&&(n.length=0,n.push("any",...i));for(let s=1;s<n.length;s++)mp(n[s])}function Yc(n){if(!Array.isArray(n))return!1;if((e=n[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<n.length;i++)if(Yc(n[i]))return!0;return!1}const _p=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hm(n,e){return n<e?-1:n>e?1:0}function gp(n){if(!Array.isArray(n))return!1;if(n[0]==="within"||n[0]==="distance")return!0;for(let e=1;e<n.length;e++)if(gp(n[e]))return!0;return!1}function Qu(n){if(!n)return!0;const e=n[0];return n.length<=1?e!=="any":e==="=="?nf(n[1],n[2],"=="):e==="!="?Ju(nf(n[1],n[2],"==")):e==="<"||e===">"||e==="<="||e===">="?nf(n[1],n[2],e):e==="any"?(i=n.slice(1),["any"].concat(i.map(Qu))):e==="all"?["all"].concat(n.slice(1).map(Qu)):e==="none"?["all"].concat(n.slice(1).map(Qu).map(Ju)):e==="in"?rf(n[1],n.slice(2)):e==="!in"?Ju(rf(n[1],n.slice(2))):e==="has"?dm(n[1]):e!=="!has"||Ju(dm(n[1]));var i}function nf(n,e,i){switch(n){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,n,e]}}function rf(n,e){if(e.length===0)return!1;switch(n){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",n,["literal",e.sort(hm)]]:["filter-in-small",n,["literal",e]]}}function dm(n){switch(n){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",n]}}function Ju(n){return["!",n]}const eh="";function dc(n,e){return e?`${n}${eh}${e}`:n}const td="-transition",Ml=new Set(["fill","line","background","hillshade","raster"]);class ps extends Rc{constructor(e,i,s,l,d){if(super(),this.id=e.id,this.fqid=dc(this.id,s),this.type=e.type,this.scope=s,this.lut=l,this.options=d,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const f=Fo(this.filter,Re[`filter_${e.type}`]);f.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...f.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new um(i.layout,this.scope,d),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new hp(i.paint,this.scope,d);for(const f in e.paint)this.setPaintProperty(f,e.paint[f]);for(const f in e.layout)this.setLayoutProperty(f,e.layout[f]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new $c(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Ml.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(td)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const s=this._transitionablePaint,l=s._properties.properties;if(e.endsWith(td)){const M=e.slice(0,-11);return l[M]&&s.setTransition(M,i||void 0),!1}if(!l[e])return!1;const d=s._values[e],f=d.value.isDataDriven(),g=d.value;s.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...s.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const x=s._values[e].value,b=x.isDataDriven(),C=e.endsWith("pattern")||e==="line-dasharray";return b||f||C||this._handleOverridablePaintPropertyUpdate(e,g,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return ai({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Wc&&Gc(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=tf(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,s,l,d,f,g,x,b){}}const f_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class id{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Gi(n,e=1){let i=0,s=0;return{members:n.map(l=>{const d=f_[l.type].BYTES_PER_ELEMENT,f=i=nd(i,Math.max(e,d)),g=l.components||1;return s=Math.max(s,d),i+=d*g,{name:l.name,type:l.type,components:g,offset:f}}),size:nd(i,Math.max(s,e)),alignment:e}}function nd(n,e){return Math.ceil(n/e)*e}class No extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.int16[l+0]=i,this.int16[l+1]=s,e}}No.prototype.bytesPerElement=4,Pt(No,"StructArrayLayout2i4");class th extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const d=3*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=l,e}}th.prototype.bytesPerElement=6,Pt(th,"StructArrayLayout3i6");class Kc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,l)}emplace(e,i,s,l,d){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=d,e}}Kc.prototype.bytesPerElement=8,Pt(Kc,"StructArrayLayout4i8");class pa extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}pa.prototype.bytesPerElement=4,Pt(pa,"StructArrayLayout1f4");class sf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const d=4*e,f=2*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.float32[f+1]=l,e}}sf.prototype.bytesPerElement=8,Pt(sf,"StructArrayLayout2i1f8");class rd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=s,this.int16[d+2]=l,e}}rd.prototype.bytesPerElement=8,Pt(rd,"StructArrayLayout3i8");class ih extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,l,d)}emplace(e,i,s,l,d,f){const g=5*e;return this.int16[g+0]=i,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=d,this.int16[g+4]=f,e}}ih.prototype.bytesPerElement=10,Pt(ih,"StructArrayLayout5i10");class fc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,l,d,f,g)}emplace(e,i,s,l,d,f,g,x){const b=6*e,C=12*e,M=3*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.uint8[C+4]=l,this.uint8[C+5]=d,this.uint8[C+6]=f,this.uint8[C+7]=g,this.float32[M+2]=x,e}}fc.prototype.bytesPerElement=12,Pt(fc,"StructArrayLayout2i4ub1f12");class uo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const d=3*e;return this.float32[d+0]=i,this.float32[d+1]=s,this.float32[d+2]=l,e}}uo.prototype.bytesPerElement=12,Pt(uo,"StructArrayLayout3f12");class ma extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,l,d)}emplace(e,i,s,l,d,f){const g=6*e,x=3*e;return this.uint16[g+0]=i,this.uint16[g+1]=s,this.uint16[g+2]=l,this.uint16[g+3]=d,this.float32[x+2]=f,e}}ma.prototype.bytesPerElement=12,Pt(ma,"StructArrayLayout4ui1f12");class Rl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,l)}emplace(e,i,s,l,d){const f=4*e;return this.uint16[f+0]=i,this.uint16[f+1]=s,this.uint16[f+2]=l,this.uint16[f+3]=d,e}}Rl.prototype.bytesPerElement=8,Pt(Rl,"StructArrayLayout4ui8");class Qc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,d,f)}emplace(e,i,s,l,d,f,g){const x=6*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=l,this.int16[x+3]=d,this.int16[x+4]=f,this.int16[x+5]=g,e}}Qc.prototype.bytesPerElement=12,Pt(Qc,"StructArrayLayout6i12");class Jc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M,R){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,s,l,d,f,g,x,b,C,M,R)}emplace(e,i,s,l,d,f,g,x,b,C,M,R,P){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=s,this.int16[F+2]=l,this.int16[F+3]=d,this.uint16[F+4]=f,this.uint16[F+5]=g,this.uint16[F+6]=x,this.uint16[F+7]=b,this.int16[F+8]=C,this.int16[F+9]=M,this.int16[F+10]=R,this.int16[F+11]=P,e}}Jc.prototype.bytesPerElement=24,Pt(Jc,"StructArrayLayout4i4ui4i24");class eu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,d,f)}emplace(e,i,s,l,d,f,g){const x=10*e,b=5*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=l,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=g,e}}eu.prototype.bytesPerElement=20,Pt(eu,"StructArrayLayout3i3f20");class zr extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,l)}emplace(e,i,s,l,d){const f=4*e;return this.float32[f+0]=i,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=d,e}}zr.prototype.bytesPerElement=16,Pt(zr,"StructArrayLayout4f16");class tu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}tu.prototype.bytesPerElement=4,Pt(tu,"StructArrayLayout1ul4");class os extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.uint16[l+0]=i,this.uint16[l+1]=s,e}}os.prototype.bytesPerElement=4,Pt(os,"StructArrayLayout2ui4");class Uo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M,R,P){const F=this.length;return this.resize(F+1),this.emplace(F,e,i,s,l,d,f,g,x,b,C,M,R,P)}emplace(e,i,s,l,d,f,g,x,b,C,M,R,P,F){const V=20*e,q=10*e;return this.int16[V+0]=i,this.int16[V+1]=s,this.int16[V+2]=l,this.int16[V+3]=d,this.int16[V+4]=f,this.float32[q+3]=g,this.float32[q+4]=x,this.float32[q+5]=b,this.float32[q+6]=C,this.int16[V+14]=M,this.uint32[q+8]=R,this.uint16[V+18]=P,this.uint16[V+19]=F,e}}Uo.prototype.bytesPerElement=40,Pt(Uo,"StructArrayLayout5i4f1i1ul2ui40");class _a extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,l,d,f,g)}emplace(e,i,s,l,d,f,g,x){const b=8*e;return this.int16[b+0]=i,this.int16[b+1]=s,this.int16[b+2]=l,this.int16[b+4]=d,this.int16[b+5]=f,this.int16[b+6]=g,this.int16[b+7]=x,e}}_a.prototype.bytesPerElement=16,Pt(_a,"StructArrayLayout3i2i2i16");class of extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,l,d)}emplace(e,i,s,l,d,f){const g=4*e,x=8*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=l,this.int16[x+6]=d,this.int16[x+7]=f,e}}of.prototype.bytesPerElement=16,Pt(of,"StructArrayLayout2f1f2i16");class Vo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,d,f)}emplace(e,i,s,l,d,f,g){const x=20*e,b=5*e;return this.uint8[x+0]=i,this.uint8[x+1]=s,this.float32[b+1]=l,this.float32[b+2]=d,this.float32[b+3]=f,this.float32[b+4]=g,e}}Vo.prototype.bytesPerElement=20,Pt(Vo,"StructArrayLayout2ub4f20");class Sr extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const l=this.length;return this.resize(l+1),this.emplace(l,e,i,s)}emplace(e,i,s,l){const d=3*e;return this.uint16[d+0]=i,this.uint16[d+1]=s,this.uint16[d+2]=l,e}}Sr.prototype.bytesPerElement=6,Pt(Sr,"StructArrayLayout3ui6");class kr extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee){const re=this.length;return this.resize(re+1),this.emplace(re,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee)}emplace(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee,re){const ae=30*e,Te=15*e,ve=60*e;return this.int16[ae+0]=i,this.int16[ae+1]=s,this.int16[ae+2]=l,this.float32[Te+2]=d,this.float32[Te+3]=f,this.uint16[ae+8]=g,this.uint16[ae+9]=x,this.uint32[Te+5]=b,this.uint32[Te+6]=C,this.uint32[Te+7]=M,this.uint16[ae+16]=R,this.uint16[ae+17]=P,this.uint16[ae+18]=F,this.float32[Te+10]=V,this.float32[Te+11]=q,this.uint8[ve+48]=$,this.uint8[ve+49]=te,this.uint8[ve+50]=ne,this.uint32[Te+13]=G,this.int16[ae+28]=ee,this.uint8[ve+58]=re,e}}kr.prototype.bytesPerElement=60,Pt(kr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class nh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee,re,ae,Te,ve,Se,Me,je,ct,et,at,ft,He){const st=this.length;return this.resize(st+1),this.emplace(st,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee,re,ae,Te,ve,Se,Me,je,ct,et,at,ft,He)}emplace(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne,G,ee,re,ae,Te,ve,Se,Me,je,ct,et,at,ft,He,st){const Ve=20*e,Ge=40*e,_t=80*e;return this.float32[Ve+0]=i,this.float32[Ve+1]=s,this.int16[Ge+4]=l,this.int16[Ge+5]=d,this.int16[Ge+6]=f,this.int16[Ge+7]=g,this.int16[Ge+8]=x,this.int16[Ge+9]=b,this.int16[Ge+10]=C,this.int16[Ge+11]=M,this.int16[Ge+12]=R,this.uint16[Ge+13]=P,this.uint16[Ge+14]=F,this.uint16[Ge+15]=V,this.uint16[Ge+16]=q,this.uint16[Ge+17]=$,this.uint16[Ge+18]=te,this.uint16[Ge+19]=ne,this.uint16[Ge+20]=G,this.uint16[Ge+21]=ee,this.uint16[Ge+22]=re,this.uint16[Ge+23]=ae,this.uint16[Ge+24]=Te,this.uint16[Ge+25]=ve,this.uint16[Ge+26]=Se,this.uint16[Ge+27]=Me,this.uint32[Ve+14]=je,this.float32[Ve+15]=ct,this.float32[Ve+16]=et,this.float32[Ve+17]=at,this.float32[Ve+18]=ft,this.uint8[_t+76]=He,this.uint16[Ge+39]=st,e}}nh.prototype.bytesPerElement=80,Pt(nh,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class sd extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,s,l,d,f)}emplace(e,i,s,l,d,f,g){const x=6*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=l,this.float32[x+3]=d,this.float32[x+4]=f,this.float32[x+5]=g,e}}sd.prototype.bytesPerElement=24,Pt(sd,"StructArrayLayout6f24");class Ha extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,s,l,d)}emplace(e,i,s,l,d,f){const g=5*e;return this.float32[g+0]=i,this.float32[g+1]=s,this.float32[g+2]=l,this.float32[g+3]=d,this.float32[g+4]=f,e}}Ha.prototype.bytesPerElement=20,Pt(Ha,"StructArrayLayout5f20");class rh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,l,d,f,g)}emplace(e,i,s,l,d,f,g,x){const b=7*e;return this.float32[b+0]=i,this.float32[b+1]=s,this.float32[b+2]=l,this.float32[b+3]=d,this.float32[b+4]=f,this.float32[b+5]=g,this.float32[b+6]=x,e}}rh.prototype.bytesPerElement=28,Pt(rh,"StructArrayLayout7f28");class af extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,l,d,f,g,x,b,C,M)}emplace(e,i,s,l,d,f,g,x,b,C,M,R){const P=11*e;return this.float32[P+0]=i,this.float32[P+1]=s,this.float32[P+2]=l,this.float32[P+3]=d,this.float32[P+4]=f,this.float32[P+5]=g,this.float32[P+6]=x,this.float32[P+7]=b,this.float32[P+8]=C,this.float32[P+9]=M,this.float32[P+10]=R,e}}af.prototype.bytesPerElement=44,Pt(af,"StructArrayLayout11f44");class qa extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b){const C=this.length;return this.resize(C+1),this.emplace(C,e,i,s,l,d,f,g,x,b)}emplace(e,i,s,l,d,f,g,x,b,C){const M=9*e;return this.float32[M+0]=i,this.float32[M+1]=s,this.float32[M+2]=l,this.float32[M+3]=d,this.float32[M+4]=f,this.float32[M+5]=g,this.float32[M+6]=x,this.float32[M+7]=b,this.float32[M+8]=C,e}}qa.prototype.bytesPerElement=36,Pt(qa,"StructArrayLayout9f36");class Za extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const l=2*e;return this.float32[l+0]=i,this.float32[l+1]=s,e}}Za.prototype.bytesPerElement=8,Pt(Za,"StructArrayLayout2f8");class lf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,l){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,s,l)}emplace(e,i,s,l,d){const f=6*e;return this.uint32[3*e+0]=i,this.uint16[f+2]=s,this.uint16[f+3]=l,this.uint16[f+4]=d,e}}lf.prototype.bytesPerElement=12,Pt(lf,"StructArrayLayout1ul3ui12");class sh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}sh.prototype.bytesPerElement=2,Pt(sh,"StructArrayLayout1ui2");class iu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q){const $=this.length;return this.resize($+1),this.emplace($,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q)}emplace(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$){const te=16*e;return this.float32[te+0]=i,this.float32[te+1]=s,this.float32[te+2]=l,this.float32[te+3]=d,this.float32[te+4]=f,this.float32[te+5]=g,this.float32[te+6]=x,this.float32[te+7]=b,this.float32[te+8]=C,this.float32[te+9]=M,this.float32[te+10]=R,this.float32[te+11]=P,this.float32[te+12]=F,this.float32[te+13]=V,this.float32[te+14]=q,this.float32[te+15]=$,e}}iu.prototype.bytesPerElement=64,Pt(iu,"StructArrayLayout16f64");class pc extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,l,d,f,g){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,l,d,f,g)}emplace(e,i,s,l,d,f,g,x){const b=10*e,C=5*e;return this.uint16[b+0]=i,this.uint16[b+1]=s,this.uint16[b+2]=l,this.uint16[b+3]=d,this.float32[C+2]=f,this.float32[C+3]=g,this.float32[C+4]=x,e}}pc.prototype.bytesPerElement=20,Pt(pc,"StructArrayLayout4ui3f20");class cf extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}cf.prototype.bytesPerElement=2,Pt(cf,"StructArrayLayout1i2");class oh extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}oh.prototype.bytesPerElement=1,Pt(oh,"StructArrayLayout1ub1");class yp extends id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}yp.prototype.size=40;class od extends Uo{get(e){return new yp(this,e)}}Pt(od,"CollisionBoxArray");class fm extends id{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}fm.prototype.size=60;class vp extends kr{get(e){return new fm(this,e)}}Pt(vp,"PlacedSymbolArray");class as extends id{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}as.prototype.size=80;class ms extends nh{get(e){return new as(this,e)}}Pt(ms,"SymbolInstanceArray");class uf extends pa{getoffsetX(e){return this.float32[1*e+0]}}Pt(uf,"GlyphOffsetArray");class xp extends No{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Pt(xp,"SymbolLineVertexArray");class bp extends id{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}bp.prototype.size=12;class wp extends lf{get(e){return new bp(this,e)}}Pt(wp,"FeatureIndexArray");class Tp extends os{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Pt(Tp,"FillExtrusionCentroidArray");class ad extends id{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ad.prototype.size=6;class hf extends th{get(e){return new ad(this,e)}}Pt(hf,"FillExtrusionWallArray");const pm=Gi([{name:"a_pos",components:2,type:"Int16"}],4),mm=Gi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ld=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class or{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,l){let d=this.segments[this.segments.length-1];return e>or.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${or.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>or.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==l)&&(d={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},l!==void 0&&(d.sortKey=l),this.segments.push(d)),d}prepareSegment(e,i,s,l){return this._prepareSegment(e,i.length,s.length,l)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,l){return new or([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function df(n,e){return 256*(n=me(Math.floor(n),0,255))+me(Math.floor(e),0,255)}or.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt(or,"SegmentVector");const ah=Gi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ff=Gi([{name:"a_pattern_b",components:4,type:"Uint16"}]),pf=Gi([{name:"a_dash",components:4,type:"Uint16"}]);class mc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,l){this.ids.push(cd(e)),this.positions.push(i,s,l)}eachPosition(e,i){const s=cd(e);let l=0,d=this.ids.length-1;for(;l<d;){const f=l+d>>1;this.ids[f]>=s?d=f:l=f+1}for(;this.ids[l]===s;)i(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,i){const s=new Float64Array(e.ids),l=new Uint32Array(e.positions);return ud(s,l,0,s.length-1),i&&(i.add(s.buffer),i.add(l.buffer)),{ids:s,positions:l}}static deserialize(e){const i=new mc;let s;i.ids=e.ids,i.positions=e.positions;for(const l of i.ids)l!==s&&i.uniqueIds.push(l),s=l;return i.indexed=!0,i}}function cd(n){const e=+n;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Mc(String(n))}function ud(n,e,i,s){for(;i<s;){const l=n[i+s>>1];let d=i-1,f=s+1;for(;;){do d++;while(n[d]<l);do f--;while(n[f]>l);if(d>=f)break;nu(n,d,f),nu(e,3*d,3*f),nu(e,3*d+1,3*f+1),nu(e,3*d+2,3*f+2)}f-i<s-f?(ud(n,e,i,f),i=f+1):(ud(n,e,f+1,s),s=f)}}function nu(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}Pt(mc,"FeaturePositionMap");class Xa{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class jo extends Xa{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class _r extends Xa{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Wa extends Xa{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class lh extends Xa{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Go extends Xa{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Sp extends Xa{constructor(e){super(e),this.current=sn.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const mf=new Float32Array(16);class $a extends Xa{constructor(e){super(e),this.current=mf}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let l=1;l<16;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const Mr=new Float32Array(9),Ya=new Float32Array(4);class hd extends Xa{constructor(e){super(e),this.current=Ya}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let l=0;l<4;l++)if(s[l]!==this.current[l]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function _f(n){return[df(255*n.r,255*n.g),df(255*n.b,255*n.a)]}class Dl{constructor(e,i,s,l){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=s,this.context=l}setUniform(e,i,s,l,d){const f=l.constantOr(this.value);i.set(e,d,f instanceof sn?f.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):f)}getBinding(e,i){return this.type==="color"?new Sp(e):new _r(e)}}class Eo{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,l,d){let f=null;d!=="u_pattern"&&d!=="u_dash"||(f=this.pattern),d==="u_pattern_b"&&(f=this.patternTransition),d==="u_pixel_ratio"&&(f=this.pixelRatio),f&&i.set(e,d,f)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Go(e):new _r(e)}}class Ka{constructor(e,i,s,l){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(d=>({name:`a_${d}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,i,s,l,d,f,g,x){const b=this.paintVertexArray.length,C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new hn(0,{brightness:f,worldview:x}),i,{},d,l,g):this.expression.kind==="constant"&&this.expression.value,M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:f,worldview:x}),i,{},d,l,g):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(b,e,C,M?null:this.context.lut)}updatePaintArray(e,i,s,l,d,f,g,x){const b=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:g,worldview:x},s,l,void 0,d):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:g,worldview:x}),s,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,b,C?null:this.context.lut)}_setPaintValue(e,i,s,l){if(this.type==="color"){const d=_f(s.toPremultipliedRenderColor(l));for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ho{constructor(e,i,s,l,d,f){this.expression=e,this.uniformNames=i.map(g=>`u_${g}_t`),this.type=s,this.useIntegerZoom=l,this.context=d,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new f}populatePaintArray(e,i,s,l,d,f,g,x){const b=this.expression.evaluate(new hn(this.context.zoom,{brightness:f,worldview:x}),i,{},d,l,g),C=this.expression.evaluate(new hn(this.context.zoom+1,{brightness:f,worldview:x}),i,{},d,l,g),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:f,worldview:x}),i,{},d,l,g):this.lutExpression.value)==="none",R=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(R,e,b,C,M?null:this.context.lut)}updatePaintArray(e,i,s,l,d,f,g,x){const b=this.expression.evaluate({zoom:this.context.zoom,brightness:g,worldview:x},s,l,void 0,d),C=this.expression.evaluate({zoom:this.context.zoom+1,brightness:g,worldview:x},s,l,void 0,d),M=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new hn(0,{brightness:g,worldview:x}),s,l,void 0,d):this.lutExpression.value)==="none";this._setPaintValue(e,i,b,C,M?null:this.context.lut)}_setPaintValue(e,i,s,l,d){if(this.type==="color"){const f=_f(s.toPremultipliedRenderColor(d)),g=_f(s.toPremultipliedRenderColor(d));for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],g[0],g[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,l,d){const f=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,g=me(this.expression.interpolationFactor(f,this.context.zoom,this.context.zoom+1),0,1);i.set(e,d,g)}getBinding(e,i){return new _r(e)}}class Ns{constructor(e,i,s,l,d){this.expression=e,this.layerId=d,this.paintVertexAttributes=(s==="array"?pf:ah).members;for(let f=0;f<i.length;++f);this.paintVertexArray=new l,this.paintTransitionVertexArray=new Rl}populatePaintArray(e,i,s,l){const d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,l,d,f,g){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(e,i,s,l){if(!l||!s)return;const d=l[s[0]],f=l[s[1]];if(d){if(d){const{tl:g,br:x,pixelRatio:b}=d;for(let C=e;C<i;C++)this.paintVertexArray.emplace(C,g[0],g[1],x[0],x[1],b)}if(f){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:g,br:x}=f;for(let b=e;b<i;b++)this.paintTransitionVertexArray.emplace(b,g[0],g[1],x[0],x[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,ff.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Ks{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const l=[];for(const d in e.paint._values){const f=e.paint.get(d);if(d.endsWith("-use-theme")||!s(d)||!(f instanceof Wc&&Gc(f.property.specification)))continue;const g=r(d,e.type),x=f.value,b=f.property.specification.type,C=!!f.property.useIntegerZoom,M=d==="line-dasharray"||d.endsWith("pattern"),R=e.paint.get(`${d}-use-theme`),P=d==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(x.kind!=="constant"||P)if(x.kind==="source"||P||M){const F=_(d,b,"source");this.binders[d]=M?new Ns(x,g,b,F,e.id):new Ka(x,g,b,F),l.push(`/a_${d}`)}else{const F=_(d,b,"composite");this.binders[d]=new Ho(x,g,b,C,i,F),l.push(`/z_${d}`)}else this.binders[d]=M?new Eo(x.value,g):new Dl(x.value,g,b,i),l.push(`/u_${d}`);R&&(this.binders[d].lutExpression=R.value)}this.cacheKey=l.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ka||i instanceof Ho?i.maxValue:0}populatePaintArrays(e,i,s,l,d,f,g,x){for(const b in this.binders){const C=this.binders[b];C.context=this.context,(C instanceof Ka||C instanceof Ho||C instanceof Ns)&&C.populatePaintArray(e,i,s,l,d,f,g,x)}}setConstantPatternPositions(e,i){for(const s in this.binders){const l=this.binders[s];l instanceof Eo&&l.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Ns?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,l,d,f,g,x,b,C){let M=!1;const R=Object.keys(e),P=R.length!==0&&!x,F=P?R:i.uniqueIds;this.context.lut=d.lut;for(const V in this.binders){const q=this.binders[V];if(q.context=this.context,(q instanceof Ka||q instanceof Ho||q instanceof Ns)&&q.expression&&q.expression.kind&&q.expression.kind!=="constant"&&(q.expression.isStateDependent===!0||q.expression.isLightConstant===!1)){const $=d.paint.get(V);q.expression=$.value;for(const te of F){const ne=e[te.toString()];i.eachPosition(te,(G,ee,re)=>{const ae=l.feature(G);q.updatePaintArray(ee,re,ae,ne,f,g,b,C)})}if(!P)for(const te of s.uniqueIds){const ne=e[te.toString()];s.eachPosition(te,(G,ee,re)=>{const ae=l.feature(G);q.updatePaintArray(ee,re,ae,ne,f,g,b,C)})}M=!0}}return M}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Dl||s instanceof Eo)&&e.push(...s.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Ka||s instanceof Ho||s instanceof Ns)for(let l=0;l<s.paintVertexAttributes.length;l++)e.push(s.paintVertexAttributes[l].name);if(s instanceof Ns)for(let l=0;l<ff.members.length;l++)e.push(ff.members[l].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const s=this.binders[i];if(s instanceof Dl||s instanceof Eo||s instanceof Ho)for(const l of s.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const l=this.binders[s];if(l instanceof Dl||l instanceof Eo||l instanceof Ho)for(const d of l.uniformNames)i.push({name:d,property:s,binding:l.getBinding(e,d)})}return i}setUniforms(e,i,s,l,d){for(const{name:f,property:g,binding:x}of s)this.binders[g].setUniform(e,x,d,l.get(g),f)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ka||i instanceof Ho||i instanceof Ns)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Ns&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Ka||s instanceof Ho||s instanceof Ns)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ka||i instanceof Ho||i instanceof Ns)&&i.destroy()}}}class c{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const l of e)this.programConfigurations[l.id]=new Ks(l,i,s);this.needsUpload=!1,this._featureMap=new mc,this._featureMapWithoutIds=new mc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,l,d,f,g,x,b){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(e,i,l,d,f,g,x,b);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,l,d,f,g,x){for(const b of s)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,b,l,d,f,g||0,x)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function r(n,e){return t[n]||[n.replace(`${e}-`,"").replace(/-/g,"_")]}const u={"line-pattern":{source:ma,composite:ma},"fill-pattern":{source:ma,composite:ma},"fill-extrusion-pattern":{source:ma,composite:ma},"line-dasharray":{source:Rl,composite:Rl}},p={color:{source:Za,composite:zr},number:{source:pa,composite:Za}};function _(n,e,i){const s=u[n];return s&&s[i]||p[e][i]}Pt(Dl,"ConstantBinder"),Pt(Eo,"PatternConstantBinder"),Pt(Ka,"SourceExpressionBinder"),Pt(Ns,"PatternCompositeBinder"),Pt(Ho,"CompositeExpressionBinder"),Pt(Ks,"ProgramConfiguration",{omit:["_buffers"]}),Pt(c,"ProgramConfigurationSet");const v=vt/Math.PI/2,w=5,A=6,D=16383,L=64,k=[L,32,16],O=-v,N=v;function Z(n,e,i,s=v){return i=en(i),[n*Math.sin(i)*s,-e*s,n*Math.cos(i)*s]}function j(n,e,i){return Z(Math.cos(en(n)),Math.sin(en(n)),e,i)}const X=63710088e-1,Y=2*Math.PI*X;class J{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new J(Oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,l=e.lat*i,d=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((e.lng-this.lng)*i);return X*Math.acos(Math.min(d,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new oe({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return j(this.lat,this.lng,v+e*v/X)}static convert(e){if(e instanceof J)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new J(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new J(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class oe{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const s=e;this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]])}else{const s=e;this.setSouthWest(s[0]).setNorthEast(s[1])}}setNorthEast(e){return this._ne=e instanceof J?new J(e.lng,e.lat):J.convert(e),this}setSouthWest(e){return this._sw=e instanceof J?new J(e.lng,e.lat):J.convert(e),this}extend(e){const i=this._sw,s=this._ne;let l,d;if(e instanceof J)l=e,d=e;else{if(!(e instanceof oe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(oe.convert(e)):this.extend(J.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(J.convert(e)):this;if(l=e._sw,d=e._ne,!l||!d)return this}return i||s?(i.lng=Math.min(l.lng,i.lng),i.lat=Math.min(l.lat,i.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new J(l.lng,l.lat),this._ne=new J(d.lng,d.lat)),this}getCenter(){return new J((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new J(this.getWest(),this.getNorth())}getSouthEast(){return new J(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=J.convert(e);let l=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&l}static convert(e){if(e)return e instanceof oe?e:new oe(e)}}const ce=0,ye=25.5;function fe(n){return Y*Math.cos(n*Math.PI/180)}function de(n){return(180+n)/360}function he(n){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+n*Math.PI/360)))/360}function _e(n,e){return n/fe(e)}function be(n){return 360*n-180}function De(n){return 360/Math.PI*Math.atan(Math.exp((180-360*n)*Math.PI/180))-90}function ze(n,e){return n*fe(De(e))}const qe=85.051129;function We(n){return Math.cos(en(me(n,-85.051129,qe)))}function rt(n,e){const i=me(e,ce,ye),s=Math.pow(2,i);return We(n)*Y/(512*s)}function Ie(n){return 1/Math.cos(n*Math.PI/180)}function Ue(n,e=0){const i=Math.exp(Math.PI*(1-(n.y+e/vt)/(1<<n.z)*2));return 80150034*i/(i*i+1)/vt/(1<<n.z)}class Ee{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=J.convert(e);return new Ee(de(s.lng),he(s.lat),_e(i,s.lat))}toLngLat(){return new J(be(this.x),De(this.y))}toAltitude(){return ze(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Y*Ie(De(this.y))}}function $e(n,e,i,s,l,d,f,g,x){const b=(e+s)/2,C=(i+l)/2,M=new Tt(b,C);g(M),function(R,P,F,V,q,$){const te=F-q,ne=V-$;return Math.abs((V-P)*te-(F-R)*ne)/Math.hypot(te,ne)}(M.x,M.y,d.x,d.y,f.x,f.y)>=x?($e(n,e,i,b,C,d,M,g,x),$e(n,b,C,s,l,M,f,g,x)):n.push(f)}function Fe(n,e,i){let s=n[0],l=s.x,d=s.y;e(s);const f=[s];for(let g=1;g<n.length;g++){const x=n[g],{x:b,y:C}=x;e(x),$e(f,l,d,b,C,s,x,e,i),l=b,d=C,s=x}return f}function tt(n,e,i,s){if(s(e,i)){const l=e.add(i)._mult(.5);tt(n,e,l,s),tt(n,l,i,s)}else n.push(i)}function gt(n,e){let i=n[0];const s=[i];for(let l=1;l<n.length;l++){const d=n[l];tt(s,i,d,e),i=d}return s}const Ye=Math.pow(2,14)-1,ht=-Ye-1;function Ot(n,e){const i=Math.round(n.x*e),s=Math.round(n.y*e);return n.x=me(i,ht,Ye),n.y=me(s,ht,Ye),(i<n.x||i>n.x+1||s<n.y||s>n.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),n}function zt(n,e,i){const s=n.loadGeometry(),l=n.extent,d=vt/l;if(e&&i&&i.projection.isReprojectedInTileSpace){const f=1<<e.z,{scale:g,x,y:b,projection:C}=i,M=R=>{const P=be((e.x+R.x/l)/f),F=De((e.y+R.y/l)/f),V=C.project(P,F);R.x=(V.x*g-x)*l,R.y=(V.y*g-b)*l};for(let R=0;R<s.length;R++)if(n.type!==1)s[R]=Fe(s[R],M,1);else{const P=[];for(const F of s[R])F.x<0||F.x>=l||F.y<0||F.y>=l||(M(F),P.push(F));s[R]=P}}for(const f of s)for(const g of f)Ot(g,d);return s}function Dt(n,e){return{type:n.type,id:n.id,properties:n.properties,geometry:e?zt(n):[]}}var Ht,$t,Lt,qt,Xt,ui,Ti,Bi={};function Wi(){if($t)return Ht;$t=1;var n=Vl();function e(l,d,f,g,x){this.properties={},this.extent=f,this.type=0,this._pbf=l,this._geometry=-1,this._keys=g,this._values=x,l.readFields(i,this,d)}function i(l,d,f){l==1?d.id=f.readVarint():l==2?function(g,x){for(var b=g.readVarint()+g.pos;g.pos<b;){var C=x._keys[g.readVarint()],M=x._values[g.readVarint()];x.properties[C]=M}}(f,d):l==3?d.type=f.readVarint():l==4&&(d._geometry=f.pos)}function s(l){for(var d,f,g=0,x=0,b=l.length,C=b-1;x<b;C=x++)g+=((f=l[C]).x-(d=l[x]).x)*(d.y+f.y);return g}return Ht=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var l=this._pbf;l.pos=this._geometry;for(var d,f=l.readVarint()+l.pos,g=1,x=0,b=0,C=0,M=[];l.pos<f;){if(x<=0){var R=l.readVarint();g=7&R,x=R>>3}if(x--,g===1||g===2)b+=l.readSVarint(),C+=l.readSVarint(),g===1&&(d&&M.push(d),d=[]),d.push(new n(b,C));else{if(g!==7)throw new Error("unknown command "+g);d&&d.push(d[0].clone())}}return d&&M.push(d),M},e.prototype.bbox=function(){var l=this._pbf;l.pos=this._geometry;for(var d=l.readVarint()+l.pos,f=1,g=0,x=0,b=0,C=1/0,M=-1/0,R=1/0,P=-1/0;l.pos<d;){if(g<=0){var F=l.readVarint();f=7&F,g=F>>3}if(g--,f===1||f===2)(x+=l.readSVarint())<C&&(C=x),x>M&&(M=x),(b+=l.readSVarint())<R&&(R=b),b>P&&(P=b);else if(f!==7)throw new Error("unknown command "+f)}return[C,R,M,P]},e.prototype.toGeoJSON=function(l,d,f){var g,x,b=this.extent*Math.pow(2,f),C=this.extent*l,M=this.extent*d,R=this.loadGeometry(),P=e.types[this.type];function F($){for(var te=0;te<$.length;te++){var ne=$[te];$[te]=[360*(ne.x+C)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ne.y+M)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(g=0;g<R.length;g++)V[g]=R[g][0];F(R=V);break;case 2:for(g=0;g<R.length;g++)F(R[g]);break;case 3:for(R=function($){var te=$.length;if(te<=1)return[$];for(var ne,G,ee=[],re=0;re<te;re++){var ae=s($[re]);ae!==0&&(G===void 0&&(G=ae<0),G===ae<0?(ne&&ee.push(ne),ne=[$[re]]):ne.push($[re]))}return ne&&ee.push(ne),ee}(R),g=0;g<R.length;g++)for(x=0;x<R[g].length;x++)F(R[g][x])}R.length===1?R=R[0]:P="Multi"+P;var q={type:"Feature",geometry:{type:P,coordinates:R},properties:this.properties};return"id"in this&&(q.id=this.id),q},Ht}function Zn(){if(qt)return Lt;qt=1;var n=Wi();function e(s,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(i,this,l),this.length=this._features.length}function i(s,l,d){s===15?l.version=d.readVarint():s===1?l.name=d.readString():s===5?l.extent=d.readVarint():s===2?l._features.push(d.pos):s===3?l._keys.push(d.readString()):s===4&&l._values.push(function(f){for(var g=null,x=f.readVarint()+f.pos;f.pos<x;){var b=f.readVarint()>>3;g=b===1?f.readString():b===2?f.readFloat():b===3?f.readDouble():b===4?f.readVarint64():b===5?f.readVarint():b===6?f.readSVarint():b===7?f.readBoolean():null}return g}(d))}return Lt=e,e.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var l=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,l,this.extent,this._keys,this._values)},Lt}function gi(){return Ti||(Ti=1,Bi.VectorTile=function(){if(ui)return Xt;ui=1;var n=Zn();function e(i,s,l){if(i===3){var d=new n(l,l.readVarint()+l.pos);d.length&&(s[d.name]=d)}}return Xt=function(i,s){this.layers=i.readFields(e,{},s)},Xt}(),Bi.VectorTileFeature=Wi(),Bi.VectorTileLayer=Zn()),Bi}var mi=gi();const ii="3d_elevation_id",an="level";class dr{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,l){const d=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&d!==void 0&&!Number.isNaN(d)?s(l?l(d):d):i&&(this._valid=!1),this}}class wn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const Pi=new wn((n,e,i)=>n.reset(e).require(ii,s=>{i.id=s}).optional("fixed_height_relative",s=>{i.constantHeight=s},Fi.decodeRelativeHeight).geometry(s=>{i.bounds=s},$f).success(),(n,e,i)=>n.reset(e).require(ii,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height_relative",s=>{i.height=s},Fi.decodeRelativeHeight).geometry(s=>{i.position=s},Fi.getPoint).success()),On=new wn((n,e,i)=>n.reset(e).require(ii,s=>{i.id=s}).optional("fixed_height",s=>{i.constantHeight=s},Fi.decodeMetricHeight).geometry(s=>{i.bounds=s},$f).success(),(n,e,i)=>n.reset(e).require(ii,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height",s=>{i.height=s},Fi.decodeMetricHeight).geometry(s=>{i.position=s},Fi.getPoint).success());class Fi{static getPoint(e){return Io(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],s=[],l=e.length,d=new dr;for(let g=0;g<l;g++){const x=e.feature(g),b=x.properties.hasOwnProperty("version")?String(x.properties.version):void 0,C=(f=b)?f==="1.0.1"?On:void 0:Pi;if(C===void 0){vi(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const M=x.properties.hasOwnProperty("type")?x.properties.type:void 0;if(M){if(mi.VectorTileFeature.types[x.type]==="Point"&&M==="curve_point"){const R={};C.parseVertex(d,x,R)&&i.push(R)}else if(mi.VectorTileFeature.types[x.type]==="Polygon"&&M==="curve_meta"){const R={};C.parseFeature(d,x,R)&&s.push(R)}}}var f;return{vertices:i,features:s}}}class Tn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const l=qn(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/l;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,!0}}class Cn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const l=yi(i,this.dir);if(Math.abs(l)<1e-6)return!1;const d=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/l;return s[0]=this.pos[0]+this.dir[0]*d,s[1]=this.pos[1]+this.dir[1]*d,s[2]=this.pos[2]+this.dir[2]*d,!0}closestPointOnSphere(e,i,s){if(function(P,F){var V=P[0],q=P[1],$=P[2],te=F[0],ne=F[1],G=F[2];return Math.abs(V-te)<=xe*Math.max(1,Math.abs(V),Math.abs(te))&&Math.abs(q-ne)<=xe*Math.max(1,Math.abs(q),Math.abs(ne))&&Math.abs($-G)<=xe*Math.max(1,Math.abs($),Math.abs(G))}(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[l,d,f]=this.dir,g=this.pos[0]-e[0],x=this.pos[1]-e[1],b=this.pos[2]-e[2],C=l*l+d*d+f*f,M=2*(g*l+x*d+b*f),R=M*M-4*C*(g*g+x*x+b*b-i*i);if(R<0){const P=Math.max(-M/2,0),F=g+l*P,V=x+d*P,q=b+f*P,$=Math.hypot(F,V,q);return s[0]=F*i/$,s[1]=V*i/$,s[2]=q*i/$,!1}{const P=(-M-Math.sqrt(R))/(2*C);if(P<0){const F=Math.hypot(g,x,b);return s[0]=g*i/F,s[1]=x*i/F,s[2]=b*i/F,!1}return s[0]=g+l*P,s[1]=x+d*P,s[2]=b+f*P,!0}}}class yn{constructor(e,i,s,l,d){this.TL=e,this.TR=i,this.BR=s,this.BL=l,this.horizon=d}static fromInvProjectionMatrix(e,i,s){const l=[-1,1,1],d=[1,1,1],f=[1,-1,1],g=[-1,-1,1],x=cn(l,l,e),b=cn(d,d,e),C=cn(f,f,e),M=cn(g,g,e);return new yn(x,b,C,M,i/s)}}function Sn(n,e,i){let s=1/0,l=-1/0;const d=[];for(const f of n){vr(d,f,e);const g=yi(d,i);s=Math.min(s,g),l=Math.max(l,g)}return[s,l]}function Ki(n,e){let i=!0;for(let s=0;s<n.planes.length;s++){const l=n.planes[s];let d=0;for(let f=0;f<e.length;f++)d+=yi(l,e[f])+l[3]>=0;if(d===0)return 0;d!==e.length&&(i=!1)}return i?2:1}function Rn(n,e){for(const i of n.projections){const s=Sn(e,n.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Xn(n,e){let i=0;const s=[0,0,0,0];for(let f=0;f<n.length;f++)s[0]=n[f][0],s[1]=n[f][1],s[2]=n[f][2],s[3]=1,(l=s)[0]*(d=e)[0]+l[1]*d[1]+l[2]*d[2]+l[3]*d[3]>=0&&i++;var l,d;return i}class dn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Hi.fromPoints(this.points),this.projections=[],this.frustumEdges=[vr([],this.points[2],this.points[3]),vr([],this.points[0],this.points[3]),vr([],this.points[4],this.points[0]),vr([],this.points[5],this.points[1]),vr([],this.points[6],this.points[2]),vr([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const l=[0,-s[2],s[1]],d=[s[2],0,-s[0]];this.projections.push({axis:l,projection:Sn(this.points,this.points[0],l)}),this.projections.push({axis:d,projection:Sn(this.points,this.points[0],d)})}}static fromInvProjectionMatrix(e,i,s,l){const d=Math.pow(2,s),f=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const C=ys([],b,e),M=1/C[3]/i*d;return(R=C)[0]=(P=C)[0]*(F=[M,M,l?1/C[3]:M,M])[0],R[1]=P[1]*F[1],R[2]=P[2]*F[2],R[3]=P[3]*F[3],R;var R,P,F}),g=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const C=Ci([],nr([],vr([],f[b[0]],f[b[1]]),vr([],f[b[2]],f[b[1]]))),M=-yi(C,f[b[1]]);return C.concat(M)}),x=[];for(let b=0;b<f.length;b++)x.push([f[b][0],f[b][1],f[b][2]]);return new dn(x,g)}intersectsPrecise(e,i,s){for(let l=0;l<i.length;l++)if(!Xn(e,i[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!Xn(e,this.planes[l]))return 0;for(const l of s)for(const d of this.frustumEdges){const f=nr([],l,d),g=Vr(f);if(g===0)continue;Le(f,f,1/g);const x=Sn(this.points,this.points[0],f),b=Sn(e,this.points[0],f);if(x[0]>b[1]||b[0]>x[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(yi([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class Hi{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const l of e)Oi(i,i,l),zn(s,s,l);return new Hi(i,s)}static fromTileIdAndHeight(e,i,s){const l=1<<e.canonical.z,d=e.canonical.x,f=e.canonical.y;return new Hi([d/l,f/l,i],[(d+1)/l,(f+1)/l,s])}static applyTransform(e,i){const s=e.getCorners();for(let l=0;l<s.length;++l)cn(s[l],s[l],i);return Hi.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],l=[...s];for(let d=0;d<3;d++)for(let f=0;f<3;f++){const g=i[4*f+d],x=g*e.min[f],b=g*e.max[f];s[d]+=Math.min(x,b),l[d]+=Math.max(x,b)}return new Hi(s,l)}static projectAabbCorners(e,i){const s=e.getCorners();for(let l=0;l<s.length;++l)cn(s[l],s[l],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=Le([],bn([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Ur(this.min),l=Ur(this.max);for(let d=0;d<i.length;d++)s[d]=i[d]?this.min[d]:this.center[d],l[d]=i[d]?this.center[d]:this.max[d];return l[2]=this.max[2],new Hi(s,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Ki(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Ki(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Rn(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Rn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Pt(Hi,"Aabb");class ls{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],l=-i[0],d=(e.extent+1)*this.metersToTile;return[new Tt(Math.trunc(e.position[0]+s*d),Math.trunc(e.position[1]+l*d)),new Tt(Math.trunc(e.position[0]-s*d),Math.trunc(e.position[1]-l*d))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Cs{constructor(e,i,s,l,d,f){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||l.length!==0)){this.vertices=l,this.edges=d,this.edges=this.edges.filter(g=>{return g.a<this.vertices.length&&g.b<this.vertices.length&&!((x=this.vertices[g.a].position)[0]===(b=this.vertices[g.b].position)[0]&&x[1]===b[1]);var x,b}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const g of this.vertices)this.vertexProps.push({dir:Io(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,g.height),this.heightRange.max=Math.max(this.heightRange.max,g.height);for(const g of this.edges){const x=this.vertices[g.a].position,b=this.vertices[g.b].position,C=ea(vs(),b,x),M=ta(C),R=go(vs(),C,1/M);this.edgeProps.push({vec:C,dir:R,len:M});const P=this.vertexProps[g.a].dir,F=this.vertexProps[g.b].dir;wa(P,P,R),wa(F,F,R)}for(const g of this.vertexProps)g.dir[0]===0&&g.dir[1]===0||Ta(g.dir,g.dir);this.tessellate(f)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,l]=i;return ei(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,l)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return rn(0,0,1);const l=s[0],d=this.edges[l],f=this.edgeProps[l].vec,g=rn(f[0],f[1],(this.vertices[d.b].height-this.vertices[d.a].height)*i),x=rn(g[1],-g[0],0);nr(x,x,g);const b=Vr(x);return b>0?Le(x,x,1/b):rn(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,l=0;const d=Io(e.x,e.y);for(let f=0;f<this.edges.length;f++){const g=this.edges[f],x=this.edgeProps[f].dir,b=new Tn(d,this.edgeProps[f].dir),C=this.vertices[g.a].position,M=this.vertices[g.b].position,R=vs(),P=vs(),F=b.intersectsPlane(C,this.vertexProps[g.a].dir,R),V=b.intersectsPlane(M,this.vertexProps[g.b].dir,P);if(!F||!V)continue;const q=ea(vs(),P,R),$=ea(vs(),d,R),te=qn(q,q),ne=te>0?qn($,q)/te:0,G=me(ne,0,1),ee=Math.abs((ne-G)*this.edgeProps[f].len),re=ea(vs(),d,C),ae=ee+Math.abs(qn(re,Io(x[1],-x[0])));ae<s&&(i=f,s=ae,l=G)}return[i,l]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const s=this.edges[i].a,l=this.edges[i].b,{position:d,height:f,extent:g}=this.vertices[s],{position:x,height:b,extent:C}=this.vertices[l],M=this.vertexProps[s].dir,R=this.vertexProps[l].dir,P=rn(d[0]/e,d[1]/e,f),F=rn(x[0]/e,x[1]/e,b),V=rn(M[1],-M[0],0);Le(V,V,g);const q=rn(R[1],-R[0],0);if(Le(q,q,C),this.distSqLines(rn(P[0]+.5*V[0],P[1]+.5*V[1],P[2]+.5*V[2]),rn(F[0]-.5*q[0],F[1]-.5*q[1],F[2]-.5*q[2]),rn(P[0]-.5*V[0],P[1]-.5*V[1],P[2]-.5*V[2]),rn(F[0]+.5*q[0],F[1]+.5*q[1],F[2]+.5*q[2]))<=.0025000000000000005)continue;const $=this.vertices.length,te=wa(vs(),d,x);this.vertices.push({position:go(te,te,.5),height:.5*(f+b),extent:.5*(g+C)});const ne=wa(vs(),M,R);this.vertexProps.push({dir:Ta(ne,ne)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:s,b:$}),this.edges.push({a:$,b:l});const G=ea(vs(),this.vertices[$].position,d),ee=ta(G),re={vec:G,dir:go(vs(),G,1/ee),len:ee};this.edgeProps.push(re),this.edgeProps.push(re)}}distSqLines(e,i,s,l){const d=wt(ir(),i,e),f=wt(ir(),l,s),g=wt(ir(),e,s),x=yi(d,d),b=yi(d,f),C=yi(d,g),M=yi(f,f),R=yi(f,g),P=x*M-b*b;if(P===0){const q=yi(g,f)/yi(f,f);return hi(Hn(ir(),s,l,q),e)}const F=(b*R-C*M)/P,V=(x*R-b*C)/P;return hi(Hn(ir(),e,i,F),Hn(ir(),s,l,V))}}class Qs{static parseFrom(e,i){const s=Fi.parse(e);if(!s)return[];let{vertices:l,features:d}=s;const f=1/Ue(i);d.sort((C,M)=>C.id-M.id),l.sort((C,M)=>C.id-M.id||C.idx-M.idx),l=l.filter((C,M,R)=>M===R.findIndex(P=>P.id===C.id&&P.idx===C.idx));const g=new Array;let x=0;const b=l.length;for(const C of d){if(C.constantHeight){g.push(new Cs(C.id,C.bounds,C.constantHeight));continue}for(;x!==b&&l[x].id<C.id;)x++;if(x===b||l[x].id!==C.id)continue;const M=new Array,R=new Array,P=x;for(;x!==b&&l[x].id===C.id;){const F=l[x];if(M.push({position:F.position,height:F.height,extent:F.extent}),x!==P&&l[x-1].idx===F.idx-1){const V=x-P;R.push({a:V-1,b:V})}x++}g.push(new Cs(C.id,C.bounds,void 0,M,R,f))}return g}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[ii];return Number.isNaN(s)?void 0:i.find(l=>l.id===s)}}class qo{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*vt,this.yOffset=(e.y*this.zScale-i.y)*vt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const l=this.constantElevation(i,s);return l??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*Ce(0,i,e>=0?e:Math.abs(.5*e))}}Pt(Cs,"ElevationFeature");class Us{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new No,this.indexArray=new Sr,this.segments=new or,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new pa),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,s,l){const d=this.layers[0],f=[];let g=null;d.type==="circle"&&(g=d.layout.get("circle-sort-key"));for(const{feature:b,id:C,index:M,sourceLayerIndex:R}of e){const P=this.layers[0]._featureFilter.needGeometry,F=Dt(b,P);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),F,s))continue;const V=g?g.evaluate(F,{},s):void 0,q={id:C,properties:b.properties,type:b.type,sourceLayerIndex:R,index:M,geometry:P?F.geometry:zt(b,s,l),patterns:{},sortKey:V};f.push(q)}g&&f.sort((b,C)=>b.sortKey-C.sortKey);let x=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Qc,x=l.projection);for(const b of f){const{geometry:C,index:M,sourceLayerIndex:R}=b,P=e[M].feature;this.addFeature(b,C,M,i.availableImages,s,x,i.brightness,i.elevationFeatures),i.featureIndex.insert(P,C,M,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ld.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,mm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,l,d,f,g,x){let b;this.elevationMode!=="none"&&(b=Qs.getElevationFeature(e,x));for(const C of i)for(const M of C){const R=M.x,P=M.y;if(R<0||R>=vt||P<0||P>=vt)continue;if(f){const q=f.projectTilePoint(R,P,d),$=f.upVector(d,R,P);this.addGlobeExtVertex(q,$),this.addGlobeExtVertex(q,$),this.addGlobeExtVertex(q,$),this.addGlobeExtVertex(q,$)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=F.vertexLength;if(this.addCircleVertex(R,P,-1,-1),this.addCircleVertex(R,P,1,-1),this.addCircleVertex(R,P,1,1),this.addCircleVertex(R,P,-1,1),this.elevationMode!=="none"){const q=b?b.pointElevation(new Tt(R,P)):0;this.hasElevation=this.hasElevation||q!==0;for(let $=0;$<4;$++)this.elevatedLayoutVertexArray.emplaceBack(q)}this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},l,d,g,void 0,this.worldview)}addCircleVertex(e,i,s,l){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(l+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Is(n,e){for(let i=0;i<n.length;i++)if(ga(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ga(n,e[i]))return!0;return!!ch(n,e)}function es(n,e,i){return!!ga(n,e)||!!_c(e,n,i)}function Zo(n,e){if(n.length===1)return zl(e,n[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let l=0;l<s.length;l++)if(ga(n,s[l]))return!0}for(let i=0;i<n.length;i++)if(zl(e,n[i]))return!0;for(let i=0;i<e.length;i++)if(ch(n,e[i]))return!0;return!1}function ts(n,e,i){if(n.length>1){if(ch(n,e))return!0;for(let s=0;s<e.length;s++)if(_c(e[s],n,i))return!0}for(let s=0;s<n.length;s++)if(_c(n[s],e,i))return!0;return!1}function ch(n,e){if(n.length===0||e.length===0)return!1;for(let i=0;i<n.length-1;i++){const s=n[i],l=n[i+1];for(let d=0;d<e.length-1;d++)if(gf(s,l,e[d],e[d+1]))return!0}return!1}function gf(n,e,i,s){return gn(n,i,s)!==gn(e,i,s)&&gn(n,e,i)!==gn(n,e,s)}function uh(n,e,i){return(n.x-i.x)*(e.y-i.y)-(n.y-i.y)*(e.x-i.x)}function Qa(n,e,i,s){const l=uh(n,e,s),d=uh(n,e,i);if(Math.sign(l)===Math.sign(d))return;const f=uh(i,s,n),g=f+d-l;return Math.sign(f)!==Math.sign(g)?[f/(f-g),d/(d-l)]:void 0}function _c(n,e,i){const s=i*i;if(e.length===1)return n.distSqr(e[0])<s;for(let l=1;l<e.length;l++)if(hh(n,e[l-1],e[l])<s)return!0;return!1}function hh(n,e,i){const s=e.distSqr(i);if(s===0)return n.distSqr(e);const l=((n.x-e.x)*(i.x-e.x)+(n.y-e.y)*(i.y-e.y))/s;return n.distSqr(l<0?e:l>1?i:i.sub(e)._mult(l)._add(e))}function zl(n,e){let i,s,l,d=!1;for(let f=0;f<n.length;f++){i=n[f];for(let g=0,x=i.length-1;g<i.length;x=g++)s=i[g],l=i[x],s.y>e.y!=l.y>e.y&&e.x<(l.x-s.x)*(e.y-s.y)/(l.y-s.y)+s.x&&(d=!d)}return d}function ga(n,e){let i=!1;for(let s=0,l=n.length-1;s<n.length;l=s++){const d=n[s],f=n[l];d.y>e.y!=f.y>e.y&&e.x<(f.x-d.x)*(e.y-d.y)/(f.y-d.y)+d.x&&(i=!i)}return i}function ru(n,e,i,s,l){for(const f of n)if(e<=f.x&&i<=f.y&&s>=f.x&&l>=f.y)return!0;const d=[new Tt(e,i),new Tt(e,l),new Tt(s,l),new Tt(s,i)];if(n.length>2){for(const f of d)if(ga(n,f))return!0}for(let f=0;f<n.length-1;f++)if(gc(n[f],n[f+1],d))return!0;return!1}function gc(n,e,i){const s=i[0],l=i[2];if(n.x<s.x&&e.x<s.x||n.x>l.x&&e.x>l.x||n.y<s.y&&e.y<s.y||n.y>l.y&&e.y>l.y)return!1;const d=gn(n,e,i[0]);return d!==gn(n,e,i[1])||d!==gn(n,e,i[2])||d!==gn(n,e,i[3])}function Ja(n,e,i,s,l,d){let f=e.y-n.y,g=n.x-e.x;if(d=d||0){const x=f*f+g*g;if(x===0)return!0;const b=Math.sqrt(x);f/=b,g/=b}return!((i.x-n.x)*f+(i.y-n.y)*g-d<0||(s.x-n.x)*f+(s.y-n.y)*g-d<0||(l.x-n.x)*f+(l.y-n.y)*g-d<0)}function Ep(n,e,i,s,l,d,f){return!(Ja(n,e,s,l,d,f)||Ja(e,i,s,l,d,f)||Ja(i,n,s,l,d,f)||Ja(s,l,n,e,i,f)||Ja(l,d,n,e,i,f)||Ja(d,s,n,e,i,f))}function yf(n,e,i){const s=e.paint.get(n).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(n)}function _m(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])}function kg(n,e,i,s,l){if(!e[0]&&!e[1])return n;const d=Tt.convert(e)._mult(l);i==="viewport"&&d._rotate(-s);const f=[];for(let g=0;g<n.length;g++)f.push(n[g].sub(d));return f}function p_(n,e,i,s){const l=Tt.convert(n)._mult(s);return e==="viewport"&&l._rotate(-i),l}let m_,dd;function Ap(n,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[n*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}Pt(Us,"CircleBucket",{omit:["layers"]});class dh{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=fd(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const s=function(d,f,g){var x=Ap(256*d,256*(f=Math.pow(2,g)-f-1),g),b=Ap(256*(d+1),256*(f+1),g);return x[0]+","+x[1]+","+b[0]+","+b[1]}(this.x,this.y,this.z),l=function(d,f,g){let x,b="";for(let C=d;C>0;C--)x=1<<C-1,b+=(f&x?1:0)+(g&x?2:0);return b}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class __{constructor(e,i){this.wrap=e,this.canonical=i,this.key=fd(e,i.z,i.z,i.x,i.y)}}class Ms{constructor(e,i,s,l,d){this.overscaledZ=e,this.wrap=i,this.canonical=new dh(s,+l,+d),this.key=i===0&&e===s?this.canonical.key:fd(i,e,s,l,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Ms(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ms(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return fd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return fd(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Ms(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new Ms(i,this.wrap,i,s,l),new Ms(i,this.wrap,i,s+1,l),new Ms(i,this.wrap,i,s,l+1),new Ms(i,this.wrap,i,s+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Ms(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Ms(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new __(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function fd(n,e,i,s,l){const d=1<<Math.min(i,22);let f=d*(l%d)+s%d;return n&&i<22&&(f+=d*d*((n<0?-2*n-1:2*n)%(1<<2*(22-i)))),16*(32*f+i)+(e-i)}const Bg=[n=>{let e=n.canonical.x-1,i=n.wrap;return e<0&&(e=(1<<n.canonical.z)-1,i--),new Ms(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>{let e=n.canonical.x+1,i=n.wrap;return e===1<<n.canonical.z&&(e=0,i++),new Ms(n.overscaledZ,i,n.canonical.z,e,n.canonical.y)},n=>new Ms(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,(n.canonical.y===0?1<<n.canonical.z:n.canonical.y)-1),n=>new Ms(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y===(1<<n.canonical.z)-1?0:n.canonical.y+1)];Pt(dh,"CanonicalTileID"),Pt(Ms,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Fg=Gi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pd}=Fg,Ng=Gi([{name:"a_pos_3",components:3,type:"Int16"}]);var g_=Gi([{name:"a_pos",type:"Int16",components:2}]);function xr(n){return n*v/X}const y_=[new Hi([O,O,O],[N,N,N]),new Hi([O,O,O],[0,0,N]),new Hi([0,O,O],[N,0,N]),new Hi([O,0,O],[0,N,N]),new Hi([0,0,O],[N,N,N])];function Ug(n,e,i,s=!0){const l=Le([],n._camera.position,n.worldSize),d=[e,i,1,1];ys(d,d,n.pixelMatrixInverse),Ps(d,d,1/d[3]);const f=Ci([],vr([],d,l)),g=n.globeMatrix,x=[g[12],g[13],g[14]],b=vr([],x,l),C=Vr(b),M=Ci([],b),R=n.worldSize/(2*Math.PI),P=yi(M,f),F=Math.asin(R/C);if(F<Math.acos(P)){if(!s)return null;const Se=[],Me=[];Le(Se,f,C/P),Ci(Me,vr(Me,Se,b)),Ci(f,bn(f,b,Le(f,Me,Math.tan(F)*C)))}const V=[];new Cn(l,f).closestPointOnSphere(x,R,V);const q=Ci([],Kn(g,0)),$=Ci([],Kn(g,1)),te=Ci([],Kn(g,2)),ne=yi(q,V),G=yi($,V),ee=yi(te,V),re=Be(Math.asin(-G/R));let ae=Be(Math.atan2(ne,ee));ae=n.center.lng+function(Se,Me){const je=(Me-Se+180)%360-180;return je<-180?je+360:je}(n.center.lng,ae);const Te=de(ae),ve=me(he(re),0,1);return new Ee(Te,ve)}class Vg{constructor(e,i,s){this.a=vr([],e,s),this.b=vr([],i,s),this.center=s;const l=Ci([],this.a),d=Ci([],this.b);this.angle=Math.acos(yi(l,d))}}function v_(n,e){if(n.angle===0)return null;let i;return i=n.a[e]===0?1/n.angle*.5*Math.PI:1/n.angle*Math.atan(n.b[e]/n.a[e]/Math.sin(n.angle)-1/Math.tan(n.angle)),i<0||i>1?null:function(s,l,d,f){const g=Math.sin(d);return s*(Math.sin((1-f)*d)/g)+l*(Math.sin(f*d)/g)}(n.a[e],n.b[e],n.angle,me(i,0,1))+n.center[e]}function yc(n){if(n.z<=1)return y_[n.z+2*n.y+n.x];const e=xf(vf(n));return Hi.fromPoints(e)}function su(n,e,i){return Le(n,n,1-i),Bt(n,n,e,i)}function Cp(n,e,i){for(const s of n)cn(s,s,e),Le(s,s,i)}function md(n,e,i,s){const l=e/n.worldSize,d=n.globeMatrix;if(i.z<=1){const ve=yc(i).getCorners();return Cp(ve,d,l),Hi.fromPoints(ve)}const f=vf(i,s),g=xf(f,v+xr(n._tileCoverLift));Cp(g,d,l);const x=Number.MAX_VALUE,b=[-x,-x,-x],C=[x,x,x];if(f.contains(n.center)){for(const Me of g)Oi(C,C,Me),zn(b,b,Me);b[2]=0;const ve=n.point,Se=[ve.x*l,ve.y*l,0];return Oi(C,C,Se),zn(b,b,Se),new Hi(C,b)}if(n._tileCoverLift>0){for(const ve of g)Oi(C,C,ve),zn(b,b,ve);return new Hi(C,b)}const M=[d[12]*l,d[13]*l,d[14]*l],R=f.getCenter(),P=me(n.center.lat,-85.051129,qe),F=me(R.lat,-85.051129,qe),V=de(n.center.lng),q=he(P);let $=V-de(R.lng);const te=q-he(F);$>.5?$-=1:$<-.5&&($+=1);let ne=0;Math.abs($)>Math.abs(te)?ne=$>=0?1:3:(ne=te>=0?0:2,Bt(M,M,[d[4]*l,d[5]*l,d[6]*l],-Math.sin(en(te>=0?f.getSouth():f.getNorth()))*v));const G=g[ne],ee=g[(ne+1)%4],re=new Vg(G,ee,M),ae=[v_(re,0)||G[0],v_(re,1)||G[1],v_(re,2)||G[2]],Te=ou(n.zoom);if(Te>0){const ve=function({x:Me,y:je,z:ct},et,at,ft,He){const st=1/(1<<ct);let Ve=Me*st,Ge=Ve+st,_t=je*st,yt=_t+st,Qt=0;const jt=(Ve+Ge)/2-ft;return jt>.5?Qt=-1:jt<-.5&&(Qt=1),Ve=((Ve+Qt)*et-(ft*=et))*at+ft,Ge=((Ge+Qt)*et-ft)*at+ft,_t=(_t*et-(He*=et))*at+He,yt=(yt*et-He)*at+He,[[Ve,yt,0],[Ge,yt,0],[Ge,_t,0],[Ve,_t,0]]}(i,e,n._pixelsPerMercatorPixel,V,q);for(let Me=0;Me<g.length;Me++)su(g[Me],ve[Me],Te);const Se=bn([],ve[ne],ve[(ne+1)%4]);Le(Se,Se,.5),su(ae,Se,Te)}for(const ve of g)Oi(C,C,ve),zn(b,b,ve);return C[2]=Math.min(G[2],ee[2]),Oi(C,C,ae),zn(b,b,ae),new Hi(C,b)}function vf({x:n,y:e,z:i},s=!1){const l=1/(1<<i),d=new J(be(n*l),e===(1<<i)-1&&s?-90:De((e+1)*l)),f=new J(be((n+1)*l),e===0&&s?90:De(e*l));return new oe(d,f)}function xf(n,e=v){const i=en(n.getNorth()),s=en(n.getSouth()),l=Math.cos(i),d=Math.cos(s),f=Math.sin(i),g=Math.sin(s),x=n.getWest(),b=n.getEast();return[Z(d,g,x,e),Z(d,g,b,e),Z(l,f,b,e),Z(l,f,x,e)]}function _d(n,e,i,s){const l=1<<i.z,d=(n/vt+i.x)/l;return j(De((e/vt+i.y)/l),be(d),s)}function vc({min:n,max:e}){return D/Math.max(e[0]-n[0],e[1]-n[1],e[2]-n[2])}const Ll=new Float64Array(16);function fh(n){const e=vc(n),i=us(Ll,[e,e,e]);return Yn(i,i,ki([],n.min))}function x_(n){const e=(s=n.min,(i=Ll)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const l=1/vc(n);return xn(e,e,[l,l,l])}function gm(n){const e=vt/(2*Math.PI);return n/(2*Math.PI)/e}function b_(n,e){return vt/(512*Math.pow(2,n))*vc(yc(e))}function w_(n,e,i,s,l){const d=gm(i),f=[n,e,-i/(2*Math.PI)],g=Yt(new Float64Array(16));return Yn(g,g,f),xn(g,g,[d,d,d]),Nr(g,g,en(-l)),_n(g,g,en(-s)),g}function ou(n){return Ce(w,A,n)}function jg(n,e){const i=j(e.lat,e.lng),s=function(F){const V=j(F._center.lat,F._center.lng);let q=nr([],rn(0,1,0),V);const $=Kr([],-F.angle,V);q=cn(q,q,$),Kr($,-F._pitch,q);const te=Ci([],V);return Le(te,te,xr(F.cameraToCenterDistance/F.pixelsPerMeter)),cn(te,te,$),bn([],V,te)}(n);return f=(l=wt([],s,i))[0],g=l[1],x=l[2],b=(d=i)[0],C=d[1],M=d[2],P=(R=Math.sqrt(f*f+g*g+x*x)*Math.sqrt(b*b+C*C+M*M))&&yi(l,d)/R,Math.acos(Math.min(Math.max(P,-1),1));var l,d,f,g,x,b,C,M,R,P}function Ip(n,e){return jg(n,e)>Math.PI/2*1.01}const T_=en(85),Gg=Math.cos(T_),Av=Math.sin(T_),S_=pi(),ym=n=>{const e=[];return n.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),n.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Hg(n,e,i,s,l,d,f,g,x){if(d&&n.queryGeometry.isAboveHorizon)return!1;d&&(x*=n.pixelToTileUnitsFactor);const b=n.tileID.canonical,C=i.projection.upVectorScale(b,i.center.lat,i.worldSize).metersToTile;for(const M of e)for(const R of M){const P=R.add(g),F=l&&i.elevation?i.elevation.exaggeration()*l.getElevationAt(P.x,P.y,!0):0,V=i.projection.projectTilePoint(P.x,P.y,b);if(F>0){const ne=i.projection.upVector(b,P.x,P.y);V.x+=ne[0]*C*F,V.y+=ne[1]*C*F,V.z+=ne[2]*C*F}const q=d?P:Cv(V.x,V.y,V.z,s),$=d?n.tilespaceRays.map(ne=>qg(ne,F)):n.queryGeometry.screenGeometry,te=ys([],[V.x,V.y,V.z,1],s);if(!f&&d?x*=te[3]/i.cameraToCenterDistance:f&&!d&&(x*=i.cameraToCenterDistance/te[3]),d){const ne=De((R.y/vt+b.y)/(1<<b.z));x/=i.projection.pixelsPerMeter(ne,1)/_e(1,ne)}if(es($,q,x))return!0}return!1}function Cv(n,e,i,s){const l=ys([],[n,e,i,1],s);return new Tt(l[0]/l[3],l[1]/l[3])}const bf=rn(0,0,0),Iv=rn(0,0,1);function qg(n,e){const i=ir();return bf[2]=e,n.intersectsPlane(bf,Iv,i),new Tt(i[0],i[1])}class Un extends Us{}let vm,Mp,xm,E_;function bm(n,{width:e,height:i},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*i*s)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*i*s);return n.width=e,n.height=i,n.data=l,n}function wf(n,e,i){const{width:s,height:l}=e;s===n.width&&l===n.height||(Tf(n,e,{x:0,y:0},{x:0,y:0},{width:Math.min(n.width,s),height:Math.min(n.height,l)},i,null),n.width=s,n.height=l,n.data=e.data)}function Tf(n,e,i,s,l,d,f,g){if(l.width===0||l.height===0)return e;if(l.width>n.width||l.height>n.height||i.x>n.width-l.width||i.y>n.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||s.x>e.width-l.width||s.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const x=n.data,b=e.data,C=d===4&&g;for(let M=0;M<l.height;M++){const R=((i.y+M)*n.width+i.x)*d,P=((s.y+M)*e.width+s.x)*d;if(C)for(let F=0;F<l.width;F++){const V=R+F*d+3,q=P+F*d;b[q+0]=255,b[q+1]=255,b[q+2]=255,b[q+3]=x[V]}else if(f)for(let F=0;F<l.width;F++){const V=R+F*d,q=P+F*d,$=new sn(x[V+0]/255,x[V+1]/255,x[V+2]/255,x[V+3]).toNonPremultipliedRenderColor(f).toArray();b[q+0]=$[0],b[q+1]=$[1],b[q+2]=$[2],b[q+3]=$[3]}else for(let F=0;F<l.width*d;F++)b[P+F]=x[R+F]}return e}Pt(Un,"HeatmapBucket",{omit:["layers"]});class ya{constructor(e,i){bm(this,e,1,i)}resize(e){wf(this,new ya(e),1)}clone(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,l,d){Tf(e,i,s,l,d,1,null)}}class cs{constructor(e,i){bm(this,e,4,i)}resize(e){wf(this,new cs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,l,d,f,g){Tf(e,i,s,l,d,4,f,g)}}class Zg{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Rp(n){const e={},i=n.resolution||256,s=n.clips?n.clips.length:1,l=n.image||new cs({width:i,height:s}),d=(f,g,x)=>{e[n.evaluationKey]=x;const b=n.expression.evaluate(e),C=b?b.toNonPremultipliedRenderColor(null):null;C&&(l.data[f+g+0]=Math.floor(255*C.r),l.data[f+g+1]=Math.floor(255*C.g),l.data[f+g+2]=Math.floor(255*C.b),l.data[f+g+3]=Math.floor(255*C.a))};if(n.clips)for(let f=0,g=0;f<s;++f,g+=4*i)for(let x=0,b=0;x<i;x++,b+=4){const C=x/(i-1),{start:M,end:R}=n.clips[f];d(g,b,M*(1-C)+R*C)}else for(let f=0,g=0;f<i;f++,g+=4)d(0,g,f/(i-1));return l}Pt(ya,"AlphaImage"),Pt(cs,"RGBAImage");const Xg=Gi([{name:"a_pos",components:2,type:"Int16"}],4),Wg=Gi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),wm=Gi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Cr=Gi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function gd(n,e,i=2){const s=e&&e.length,l=s?e[0]*i:n.length;let d=Vs(n,0,l,i,!0);const f=[];if(!d||d.next===d.prev)return f;let g,x,b;if(s&&(d=function(C,M,R,P){const F=[];for(let V=0,q=M.length;V<q;V++){const $=Vs(C,M[V]*P,V<q-1?M[V+1]*P:C.length,P,!1);$===$.next&&($.steiner=!0),F.push(Rv($))}F.sort(C_);for(let V=0;V<F.length;V++)R=I_(F[V],R);return R}(n,e,d,i)),n.length>80*i){g=1/0,x=1/0;let C=-1/0,M=-1/0;for(let R=i;R<l;R+=i){const P=n[R],F=n[R+1];P<g&&(g=P),F<x&&(x=F),P>C&&(C=P),F>M&&(M=F)}b=Math.max(C-g,M-x),b=b!==0?32767/b:0}return vd(d,f,i,g,x,b,0),f}function Vs(n,e,i,s,l){let d;if(l===function(f,g,x,b){let C=0;for(let M=g,R=x-b;M<x;M+=b)C+=(f[R]-f[M])*(f[M+1]+f[R+1]),R=M;return C}(n,e,i,s)>0)for(let f=e;f<i;f+=s)d=el(f/s|0,n[f],n[f+1],d);else for(let f=i-s;f>=e;f-=s)d=el(f/s|0,n[f],n[f+1],d);return d&&xd(d,d.next)&&(wd(d),d=d.next),d}function yd(n,e){if(!n)return n;e||(e=n);let i,s=n;do if(i=!1,s.steiner||!xd(s,s.next)&&br(s.prev,s,s.next)!==0)s=s.next;else{if(wd(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function vd(n,e,i,s,l,d,f){if(!n)return;!f&&d&&function(x,b,C,M){let R=x;do R.z===0&&(R.z=Sm(R.x,R.y,b,C,M)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==x);R.prevZ.nextZ=null,R.prevZ=null,function(P){let F,V=1;do{let q,$=P;P=null;let te=null;for(F=0;$;){F++;let ne=$,G=0;for(let re=0;re<V&&(G++,ne=ne.nextZ,ne);re++);let ee=V;for(;G>0||ee>0&&ne;)G!==0&&(ee===0||!ne||$.z<=ne.z)?(q=$,$=$.nextZ,G--):(q=ne,ne=ne.nextZ,ee--),te?te.nextZ=q:P=q,q.prevZ=te,te=q;$=ne}te.nextZ=null,V*=2}while(F>1)}(R)}(n,s,l,d);let g=n;for(;n.prev!==n.next;){const x=n.prev,b=n.next;if(d?Tm(n,s,l,d):A_(n))e.push(x.i,n.i,b.i),wd(n),n=b.next,g=b.next;else if((n=b)===g){f?f===1?vd(n=$g(yd(n),e),e,i,s,l,d,2):f===2&&Yg(n,e,i,s,l,d):vd(yd(n),e,i,s,l,d,1);break}}}function A_(n){const e=n.prev,i=n,s=n.next;if(br(e,i,s)>=0)return!1;const l=e.x,d=i.x,f=s.x,g=e.y,x=i.y,b=s.y,C=Math.min(l,d,f),M=Math.min(g,x,b),R=Math.max(l,d,f),P=Math.max(g,x,b);let F=s.next;for(;F!==e;){if(F.x>=C&&F.x<=R&&F.y>=M&&F.y<=P&&Dp(l,g,d,x,f,b,F.x,F.y)&&br(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Tm(n,e,i,s){const l=n.prev,d=n,f=n.next;if(br(l,d,f)>=0)return!1;const g=l.x,x=d.x,b=f.x,C=l.y,M=d.y,R=f.y,P=Math.min(g,x,b),F=Math.min(C,M,R),V=Math.max(g,x,b),q=Math.max(C,M,R),$=Sm(P,F,e,i,s),te=Sm(V,q,e,i,s);let ne=n.prevZ,G=n.nextZ;for(;ne&&ne.z>=$&&G&&G.z<=te;){if(ne.x>=P&&ne.x<=V&&ne.y>=F&&ne.y<=q&&ne!==l&&ne!==f&&Dp(g,C,x,M,b,R,ne.x,ne.y)&&br(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,G.x>=P&&G.x<=V&&G.y>=F&&G.y<=q&&G!==l&&G!==f&&Dp(g,C,x,M,b,R,G.x,G.y)&&br(G.prev,G,G.next)>=0))return!1;G=G.nextZ}for(;ne&&ne.z>=$;){if(ne.x>=P&&ne.x<=V&&ne.y>=F&&ne.y<=q&&ne!==l&&ne!==f&&Dp(g,C,x,M,b,R,ne.x,ne.y)&&br(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;G&&G.z<=te;){if(G.x>=P&&G.x<=V&&G.y>=F&&G.y<=q&&G!==l&&G!==f&&Dp(g,C,x,M,b,R,G.x,G.y)&&br(G.prev,G,G.next)>=0)return!1;G=G.nextZ}return!0}function $g(n,e){let i=n;do{const s=i.prev,l=i.next.next;!xd(s,l)&&Em(s,i,i.next,l)&&bd(s,l)&&bd(l,s)&&(e.push(s.i,i.i,l.i),wd(i),wd(i.next),i=n=l),i=i.next}while(i!==n);return yd(i)}function Yg(n,e,i,s,l,d){let f=n;do{let g=f.next.next;for(;g!==f.prev;){if(f.i!==g.i&&Dv(f,g)){let x=Kg(f,g);return f=yd(f,f.next),x=yd(x,x.next),vd(f,e,i,s,l,d,0),void vd(x,e,i,s,l,d,0)}g=g.next}f=f.next}while(f!==n)}function C_(n,e){let i=n.x-e.x;return i===0&&(i=n.y-e.y,i===0)&&(i=(n.next.y-n.y)/(n.next.x-n.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function I_(n,e){const i=function(l,d){let f=d;const g=l.x,x=l.y;let b,C=-1/0;if(xd(l,f))return f;do{if(xd(l,f.next))return f.next;if(x<=f.y&&x>=f.next.y&&f.next.y!==f.y){const V=f.x+(x-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(V<=g&&V>C&&(C=V,b=f.x<f.next.x?f:f.next,V===g))return b}f=f.next}while(f!==d);if(!b)return null;const M=b,R=b.x,P=b.y;let F=1/0;f=b;do{if(g>=f.x&&f.x>=R&&g!==f.x&&M_(x<P?g:C,x,R,P,x<P?C:g,x,f.x,f.y)){const V=Math.abs(x-f.y)/(g-f.x);bd(f,l)&&(V<F||V===F&&(f.x>b.x||f.x===b.x&&Mv(b,f)))&&(b=f,F=V)}f=f.next}while(f!==M);return b}(n,e);if(!i)return e;const s=Kg(i,n);return yd(s,s.next),yd(i,i.next)}function Mv(n,e){return br(n.prev,n,e.prev)<0&&br(e.next,n,n.next)<0}function Sm(n,e,i,s,l){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-i)*l|0)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Rv(n){let e=n,i=n;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==n);return i}function M_(n,e,i,s,l,d,f,g){return(l-f)*(e-g)>=(n-f)*(d-g)&&(n-f)*(s-g)>=(i-f)*(e-g)&&(i-f)*(d-g)>=(l-f)*(s-g)}function Dp(n,e,i,s,l,d,f,g){return!(n===f&&e===g)&&M_(n,e,i,s,l,d,f,g)}function Dv(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function(i,s){let l=i;do{if(l.i!==i.i&&l.next.i!==i.i&&l.i!==s.i&&l.next.i!==s.i&&Em(l,l.next,i,s))return!0;l=l.next}while(l!==i);return!1}(n,e)&&(bd(n,e)&&bd(e,n)&&function(i,s){let l=i,d=!1;const f=(i.x+s.x)/2,g=(i.y+s.y)/2;do l.y>g!=l.next.y>g&&l.next.y!==l.y&&f<(l.next.x-l.x)*(g-l.y)/(l.next.y-l.y)+l.x&&(d=!d),l=l.next;while(l!==i);return d}(n,e)&&(br(n.prev,n,e.prev)||br(n,e.prev,e))||xd(n,e)&&br(n.prev,n,n.next)>0&&br(e.prev,e,e.next)>0)}function br(n,e,i){return(e.y-n.y)*(i.x-e.x)-(e.x-n.x)*(i.y-e.y)}function xd(n,e){return n.x===e.x&&n.y===e.y}function Em(n,e,i,s){const l=Cm(br(n,e,i)),d=Cm(br(n,e,s)),f=Cm(br(i,s,n)),g=Cm(br(i,s,e));return l!==d&&f!==g||!(l!==0||!Am(n,i,e))||!(d!==0||!Am(n,s,e))||!(f!==0||!Am(i,n,s))||!(g!==0||!Am(i,e,s))}function Am(n,e,i){return e.x<=Math.max(n.x,i.x)&&e.x>=Math.min(n.x,i.x)&&e.y<=Math.max(n.y,i.y)&&e.y>=Math.min(n.y,i.y)}function Cm(n){return n>0?1:n<0?-1:0}function bd(n,e){return br(n.prev,n,n.next)<0?br(n,e,n.next)>=0&&br(n,n.prev,e)>=0:br(n,e,n.prev)<0||br(n,n.next,e)<0}function Kg(n,e){const i=Im(n.i,n.x,n.y),s=Im(e.i,e.x,e.y),l=n.next,d=e.prev;return n.next=e,e.prev=n,i.next=l,l.prev=i,s.next=i,i.prev=s,d.next=s,s.prev=d,s}function el(n,e,i,s){const l=Im(n,e,i);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function wd(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Im(n,e,i){return{i:n,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function zp(n,e){const i=n.length;if(i<=1)return[n];const s=[];let l,d;for(let f=0;f<i;f++){const g=Ln(n[f]);g!==0&&(n[f].area=Math.abs(g),d===void 0&&(d=g<0),d===g<0?(l&&s.push(l),l=[n[f]]):l.push(n[f]))}if(l&&s.push(l),e>1)for(let f=0;f<s.length;f++)s[f].length<=e||(Es(s[f],e,1,s[f].length-1,Lp),s[f]=s[f].slice(0,e));return s}function Lp(n,e){return e.area-n.area}function va(n,e,i=1){if(!n)return null;const s=typeof n=="string"?Jr.from(n).getPrimary():n.getPrimary(),l=typeof n=="string"?null:n.getSecondary();for(const d of[s,l]){if(!d)continue;const f=d.id.toString();e.has(f)||e.set(f,[]),d.scaleSelf(i),e.get(f).push(d)}return{primary:s.toString(),secondary:l?l.toString():null}}function Mm(n,e,i,s){const l=s.patternDependencies;let d=!1;for(const f of e){const g=f.paint.get(`${n}-pattern`);g.isConstant()||(d=!0),va(g.constantOr(null),l,i)&&(d=!0)}return d}function Sf(n,e,i,s,l,d){const f=d.patternDependencies;for(const g of e){const x=g.paint.get(`${n}-pattern`).value;if(x.kind!=="constant"){let b=x.evaluate({zoom:s},i,{},d.availableImages);b=b&&b.name?b.name:b;const C=va(b,f,l);if(!C)continue;const{primary:M,secondary:R}=C;M&&(i.patterns[g.id]=[M,R].filter(Boolean))}}return i}class xc{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class Td{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Td;let i=[];for(const b of e)i.push(...b.portals);if(i.length===0)return new Td;const s=(b,C)=>b<=0&&C<=0||b>=vt&&C>=vt;for(const b of i){const C=b.va,M=b.vb;(s(C.x,M.x)||s(C.y,M.y))&&(b.type="border")}const l=i.filter(b=>b.type!=="unevaluated"),d=i.filter(b=>b.type==="unevaluated");if(d.length===0)return new Td;d.sort((b,C)=>b.hash===C.hash?b.isTunnel===C.isTunnel?0:b.isTunnel?-1:1:b.hash<C.hash?1:-1),i=l.concat(d);let f=l.length,g=f,x=f;do if(g++,g===i.length||i[f].hash!==i[g].hash){if(g-f==2){x<f&&(i[x]=i[f],i[f]=null);const b=i[x],C=i[g-1];b.type=b.isTunnel!==C.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:C.connection.a},x++}f=g}while(f!==i.length);return i.splice(x),i.sort((b,C)=>b.hash<C.hash?1:-1),{portals:i}}}Pt(Td,"ElevationPortalGraph"),Pt(xc,"ElevationPolygons");class zv{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,s){let l=e[2];s!=null&&(l*=s);const d=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),f=this.vertexLookup.get(d);if(f!=null)return f;const g=this.outPositions.length;this.vertexLookup.set(d,g);const x=Math.trunc(16384*i[0]),b=Math.trunc(16384*i[1]),C=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],l),this.outNormals.emplaceBack(x,b,C),g}addVertices(e,i,...s){const l=[];for(const d of s){const f=this.addVertex(d,e,i);l.push(f)}return l}addTriangles(e,i,s){if(i&&s){const l=s.length===1,d=rn(0,0,0);for(let f=0;f<e.length;f+=3){const g=i[e[f+0]],x=i[e[f+1]],b=i[e[f+2]],C=l?s[0]:s[e[f+1]],M=l?s[0]:s[e[f+2]],R=this.addVertex(rn(g.x,g.y,l?s[0]:s[e[f+0]]),d),P=this.addVertex(rn(x.x,x.y,C),d),F=this.addVertex(rn(b.x,b.y,M),d);this.outIndices.emplaceBack(R,P,F)}}else for(let l=0;l<e.length;l+=3)this.outIndices.emplaceBack(e[l+0],e[l+1],e[l+2])}addQuad(e,i){const s=this.addVertices(i,void 0,...e.map(x=>rn(x.coord.x,x.coord.y,x.height))),[l,d,f,g]=s;this.addTriangles([l,d,f,f,g,l])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Rs{constructor(e,i,s,l){this.unevaluatedPortals=new Td,this.portalPolygons=new xc,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new sf,this.vertexNormals=new rd,this.indexArray=new Sr,this.tileToMeters=Ue(e),this.bridgeProgramConfigurations=new c(i,{zoom:s,lut:l},d=>d!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new c(i,{zoom:s,lut:l},d=>d!=="fill-bridge-guard-rail-color")}addVertices(e,i){const s=this.unevalVertices.length;for(let l=0;l<e.length;l++)this.unevalVertices.push(e[l]),this.unevalHeights.push(i[l]);return s}addTriangles(e,i,s){const l=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const d of e)l.push(d+i)}addRenderableRing(e,i,s,l,d,f){const g=[new Tt(d.min.x,d.min.y),new Tt(d.max.x,d.min.y),new Tt(d.max.x,d.max.y),new Tt(d.min.x,d.max.y)];for(let x=0;x<s-1;x++){const b=i+x,C=b+1,M=this.unevalVertices[b],R=this.unevalVertices[C];if(!(M.x>=d.min.x&&M.x<=d.max.x&&M.y>=d.min.y&&M.y<=d.max.y||R.x>=d.min.x&&R.x<=d.max.x&&R.y>=d.min.y&&R.y<=d.max.y||gc(M,R,g))||this.isOnBorder(M.x,R.x)||this.isOnBorder(M.y,R.y))continue;const P=Rs.computeEdgeHash(this.unevalVertices[b],this.unevalVertices[C]);let F,V=this.vertexHashLookup.get(Rs.computePosHash(M));V!=null?F=V.next:(V=this.vertexHashLookup.get(Rs.computePosHash(R)),F=V!=null?V.prev:P),this.unevalEdges.push({polygonIdx:e,a:b,b:C,hash:P,portalHash:F,isTunnel:l,type:"unevaluated",featureInfo:f})}}addPortalCandidates(e,i,s,l,d){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:d});const f=i[0];this.vertexHashLookup.clear();let g=Rs.computeEdgeHash(f[f.length-2],f[f.length-1]);for(let x=0;x<f.length-1;x++){const b=f[x+0],C=f[x+1],M=Io(C.x-b.x,C.y-b.y),R=ta(M);if(R===0)continue;let P="unevaluated";const F=l.pointElevation(b),V=l.pointElevation(C);Math.abs(F)<.01&&Math.abs(V)<.01?P="entrance":(this.isOnBorder(b.x,C.x)||this.isOnBorder(b.y,C.y))&&(P="border");const q=Rs.computeEdgeHash(b,C);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:b,vb:C,vab:M,length:R,hash:q,isTunnel:s,type:P});const $=Rs.computePosHash(b);this.vertexHashLookup.set($,{prev:g,next:q}),g=q}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},l=new zv(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const d=i(),f=i(),g=i(),x=(R,P)=>{R.sort((V,q)=>V.type===P&&q.type!==P?-1:V.type!==P&&q.type===P?1:0);const F=R.findIndex(V=>V.type!==P);return F>=0?F:R.length};let b=0;this.unevalEdges.length>0&&(b=x(this.unevalEdges,"none"),this.constructBridgeStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:b},this.tileToMeters)),s(g);const C=i(),M=i();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(b),P=x(R,"tunnel")+b;this.unevalEdges.push(...R),this.constructTunnelStructures(l,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:b},{min:b,max:P})}s(C),l.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(M),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(f),l.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(d),this.maskSegments=or.simpleSegment(0,M.primitiveOffset,0,M.primitiveLength),this.depthSegments=or.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength),this.renderableBridgeSegments=or.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength),this.renderableTunnelSegments=or.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.shadowCasterSegments=or.simpleSegment(0,d.primitiveOffset,0,d.primitiveLength)}update(e,i,s,l,d,f,g,x){this.bridgeProgramConfigurations.updatePaintArrays(e,i,d,s,l,f,g,x),this.tunnelProgramConfigurations.updatePaintArrays(e,i,d,s,l,f,g,x)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,wm.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Cr.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,l,d){const f=(g,x)=>{for(let b=0;b<x.length-1;b++){const C=x[b].featureIndex,M=x[b+1].vertexStart,R=e.feature(C);g.populatePaintArrays(M,R,C,{},s,i,l,void 0,d)}};f(this.bridgeProgramConfigurations,this.bridgeFeatureSections),f(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,l,d){const f=new Map;for(let g=l;g<d;g++){const x=s[g],b=x.a,C=x.b,M=Rs.computePosHash(e[b]),R=Rs.computePosHash(e[C]);f.has(M)||f.set(M,{}),f.has(R)||f.set(R,{});const P=f.get(M),F=f.get(R);i[b]<=0&&i[C]<=0||(P.to=C,F.from=b)}return f}constructBridgeStructures(e,i,s,l,d,f){e.clearVertexLookup();const g=this.computeVertexConnections(i,s,l,d.min,d.max),x=1/f,b=.5*x,C=P=>rn(i[P].x,i[P].y,s[P]*x),M=P=>{const F=g.get(Rs.computePosHash(i[P])),V=F.from,q=F.to;if(!V||!q)return;const $=C(V),te=C(P),ne=C(q),G=rn(0,0,0);if(!_o($,te)){const re=vr(ir(),te,$);bn(G,G,Ci(re,re))}if(!_o(ne,te)){const re=vr(ir(),ne,te);bn(G,G,Ci(re,re))}const ee=Nl(G);return ee>0?Le(G,G,1/ee):void 0};let R=Number.POSITIVE_INFINITY;this.sortSubarray(l,d.min,d.max,(P,F)=>P.featureInfo.featureIndex-F.featureInfo.featureIndex);for(let P=d.min;P<d.max;P++){const F=l[P];if(!F.featureInfo.guardRailEnabled)continue;const V=this.prepareEdgePoints(i,s,F,(_i,Vt)=>_i>Vt);if(V==null)continue;const q=V[0],$=V[1],te=rn(q.coord.x,q.coord.y,x*q.height),ne=rn($.coord.x,$.coord.y,x*$.height);if(_o(te,ne))continue;const G=vr(ir(),ne,te);Ci(G,G);const ee=_i=>Ci(_i,_i),re=M(F.a)||G,ae=M(F.b)||G,Te=ee(rn(re[1],-re[0],0)),ve=ee(rn(ae[1],-ae[0],0)),Se=ee(nr(ir(),Te,re)),Me=ee(nr(ir(),ve,ae)),je=ir(),ct=[bn(ir(),te,Le(je,vr(je,Te,Se),b)),bn(ir(),te,Le(je,bn(je,Te,Se),b)),bn(ir(),te,Le(je,Se,b)),te],et=[bn(ir(),ne,Le(je,vr(je,ve,Me),b)),bn(ir(),ne,Le(je,bn(je,ve,Me),b)),bn(ir(),ne,Le(je,Me,b)),ne];R=this.addFeatureSection(F.featureInfo.featureIndex,R,this.bridgeFeatureSections,e);const[at,ft]=e.addVertices(Te,f,ct[0],ct[1]),[He,st]=e.addVertices(ve,f,et[0],et[1]);e.addTriangles([at,ft,He,ft,st,He]);const[Ve,Ge]=e.addVertices(Se,f,ct[1],ct[2]),[_t,yt]=e.addVertices(Me,f,et[1],et[2]);e.addTriangles([Ve,Ge,_t,Ge,yt,_t]);const[Qt,jt]=e.addVertices(ki(Te,Te),f,ct[2],ct[3]),[At,mt]=e.addVertices(ki(ve,ve),f,et[2],et[3]);e.addTriangles([Qt,jt,At,jt,mt,At])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,l,d,f){e.clearVertexLookup();let g=Number.POSITIVE_INFINITY;const x=(C,M)=>C.featureInfo.featureIndex-M.featureInfo.featureIndex;this.sortSubarray(l,d.min,d.max,x),this.sortSubarray(l,f.min,f.max,x);const b=C=>Ci(C,C);for(let C=d.min;C<d.max;C++){const M=this.prepareEdgePoints(i,s,l[C],(V,q)=>V<q);if(M==null)continue;const[R,P]=M,F=b(rn(-(P.coord.y-R.coord.y),P.coord.x-R.coord.x,0));g=this.addFeatureSection(l[C].featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([R,P,{coord:P.coord,height:l[C].isTunnel?-.1:0},{coord:R.coord,height:l[C].isTunnel?-.1:0}],F)}for(let C=f.min;C<f.max;C++){const M=l[C];M.isTunnel&&([M.a,M.b]=[M.b,M.a]);const R=i[M.a],P=i[M.b],F=b(rn(-(P.y-R.y),P.x-R.x,0));g=this.addFeatureSection(M.featureInfo.featureIndex,g,this.tunnelFeatureSections,e),e.addQuad([{coord:P,height:0},{coord:R,height:0},{coord:R,height:s[M.a]+4},{coord:P,height:s[M.b]+4}],F),e.addQuad([{coord:R,height:0},{coord:P,height:0},{coord:P,height:s[M.b]+4},{coord:R,height:s[M.a]+4}],F)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,s,l){let d=i[s.a],f=i[s.b];const g=l(d,0),x=l(f,0);if(g&&x)return[{coord:e[s.a],height:d},{coord:e[s.b],height:f}];if(!g&&!x)return;const b=e[s.a].clone(),C=e[s.b].clone();if(g){if(!x){const M=f/(f-d);C.x=ei(C.x,b.x,M),C.y=ei(C.y,b.y,M),f=ei(f,d,M)}}else{const M=d/(d-f);b.x=ei(b.x,C.x,M),b.y=ei(b.y,C.y,M),d=ei(d,f,M)}return[{coord:b,height:d},{coord:C,height:f}]}prepareEdges(e,i){if(i.length===0)return;i.sort((g,x)=>g.hash===x.hash?x.polygonIdx-g.polygonIdx:x.hash>g.hash?1:-1);let s=0,l=0,d=0,f=i[s].polygonIdx;do l++,(l===i.length||i[s].hash!==i[l].hash)&&((l-s==1||i[l-1].polygonIdx!==f)&&(d<s&&(i[d]=i[s],i[s]=null),i[d].type="none",d++),s=l,s!==i.length&&(f=i[s].polygonIdx));while(s!==i.length);if(i.splice(d),i.length!==0&&e.length!==0){i.sort((b,C)=>b.portalHash<C.portalHash?1:-1);let g=0,x=0;for(;g!==i.length&&x!==e.length;){const b=i[g],C=e[x];b.portalHash>C.hash?g++:C.hash>b.portalHash?x++:(b.type=C.type,g++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=vt&&i>=vt}addFeatureSection(e,i,s,l){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:l.getVertexCount()}),l.clearVertexLookup()),i}sortSubarray(e,i,s,l){const d=e.slice(i,s);d.sort(l),e.splice(i,d.length,...d)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Rs.computePosHash(e))<<32n|BigInt(Rs.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var R_,Qg={exports:{}},Jg=(R_||(R_=1,function(n,e){(function(i){function s(se,ue){return se>ue?1:se<ue?-1:0}var l=function(se,ue){se===void 0&&(se=s),ue===void 0&&(ue=!1),this._compare=se,this._root=null,this._size=0,this._noDuplicates=!!ue},d={size:{configurable:!0}};function f(se,ue,Xe,bt,Ct){var Et=Ct-bt;if(Et>0){var Ut=bt+Math.floor(Et/2),ni={key:ue[Ut],data:Xe[Ut],parent:se};return ni.left=f(ni,ue,Xe,bt,Ut),ni.right=f(ni,ue,Xe,Ut+1,Ct),ni}return null}function g(se,ue,Xe,bt,Ct){if(!(Xe>=bt)){for(var Et=se[Xe+bt>>1],Ut=Xe-1,ni=bt+1;;){do Ut++;while(Ct(se[Ut],Et)<0);do ni--;while(Ct(se[ni],Et)>0);if(Ut>=ni)break;var Ni=se[Ut];se[Ut]=se[ni],se[ni]=Ni,Ni=ue[Ut],ue[Ut]=ue[ni],ue[ni]=Ni}g(se,ue,Xe,ni,Ct),g(se,ue,ni+1,bt,Ct)}}l.prototype.rotateLeft=function(se){var ue=se.right;ue&&(se.right=ue.left,ue.left&&(ue.left.parent=se),ue.parent=se.parent),se.parent?se===se.parent.left?se.parent.left=ue:se.parent.right=ue:this._root=ue,ue&&(ue.left=se),se.parent=ue},l.prototype.rotateRight=function(se){var ue=se.left;ue&&(se.left=ue.right,ue.right&&(ue.right.parent=se),ue.parent=se.parent),se.parent?se===se.parent.left?se.parent.left=ue:se.parent.right=ue:this._root=ue,ue&&(ue.right=se),se.parent=ue},l.prototype._splay=function(se){for(;se.parent;){var ue=se.parent;ue.parent?ue.left===se&&ue.parent.left===ue?(this.rotateRight(ue.parent),this.rotateRight(ue)):ue.right===se&&ue.parent.right===ue?(this.rotateLeft(ue.parent),this.rotateLeft(ue)):ue.left===se&&ue.parent.right===ue?(this.rotateRight(ue),this.rotateLeft(ue)):(this.rotateLeft(ue),this.rotateRight(ue)):ue.left===se?this.rotateRight(ue):this.rotateLeft(ue)}},l.prototype.splay=function(se){for(var ue,Xe,bt,Ct,Et;se.parent;)(Xe=(ue=se.parent).parent)&&Xe.parent?((bt=Xe.parent).left===Xe?bt.left=se:bt.right=se,se.parent=bt):(se.parent=null,this._root=se),Ct=se.left,Et=se.right,se===ue.left?(Xe&&(Xe.left===ue?(ue.right?(Xe.left=ue.right,Xe.left.parent=Xe):Xe.left=null,ue.right=Xe,Xe.parent=ue):(Ct?(Xe.right=Ct,Ct.parent=Xe):Xe.right=null,se.left=Xe,Xe.parent=se)),Et?(ue.left=Et,Et.parent=ue):ue.left=null,se.right=ue,ue.parent=se):(Xe&&(Xe.right===ue?(ue.left?(Xe.right=ue.left,Xe.right.parent=Xe):Xe.right=null,ue.left=Xe,Xe.parent=ue):(Et?(Xe.left=Et,Et.parent=Xe):Xe.left=null,se.right=Xe,Xe.parent=se)),Ct?(ue.right=Ct,Ct.parent=ue):ue.right=null,se.left=ue,ue.parent=se)},l.prototype.replace=function(se,ue){se.parent?se===se.parent.left?se.parent.left=ue:se.parent.right=ue:this._root=ue,ue&&(ue.parent=se.parent)},l.prototype.minNode=function(se){if(se===void 0&&(se=this._root),se)for(;se.left;)se=se.left;return se},l.prototype.maxNode=function(se){if(se===void 0&&(se=this._root),se)for(;se.right;)se=se.right;return se},l.prototype.insert=function(se,ue){var Xe=this._root,bt=null,Ct=this._compare;if(this._noDuplicates)for(;Xe;){if(bt=Xe,Ct(Xe.key,se)===0)return;Xe=Ct(Xe.key,se)<0?Xe.right:Xe.left}else for(;Xe;)bt=Xe,Xe=Ct(Xe.key,se)<0?Xe.right:Xe.left;return Xe={key:se,data:ue,left:null,right:null,parent:bt},bt?Ct(bt.key,Xe.key)<0?bt.right=Xe:bt.left=Xe:this._root=Xe,this.splay(Xe),this._size++,Xe},l.prototype.find=function(se){for(var ue=this._root,Xe=this._compare;ue;){var bt=Xe(ue.key,se);if(bt<0)ue=ue.right;else{if(!(bt>0))return ue;ue=ue.left}}return null},l.prototype.contains=function(se){for(var ue=this._root,Xe=this._compare;ue;){var bt=Xe(se,ue.key);if(bt===0)return!0;ue=bt<0?ue.left:ue.right}return!1},l.prototype.remove=function(se){var ue=this.find(se);if(!ue)return!1;if(this.splay(ue),ue.left)if(ue.right){var Xe=this.minNode(ue.right);Xe.parent!==ue&&(this.replace(Xe,Xe.right),Xe.right=ue.right,Xe.right.parent=Xe),this.replace(ue,Xe),Xe.left=ue.left,Xe.left.parent=Xe}else this.replace(ue,ue.left);else this.replace(ue,ue.right);return this._size--,!0},l.prototype.removeNode=function(se){if(!se)return!1;if(this.splay(se),se.left)if(se.right){var ue=this.minNode(se.right);ue.parent!==se&&(this.replace(ue,ue.right),ue.right=se.right,ue.right.parent=ue),this.replace(se,ue),ue.left=se.left,ue.left.parent=ue}else this.replace(se,se.left);else this.replace(se,se.right);return this._size--,!0},l.prototype.erase=function(se){var ue=this.find(se);if(ue){this.splay(ue);var Xe=ue.left,bt=ue.right,Ct=null;Xe&&(Xe.parent=null,Ct=this.maxNode(Xe),this.splay(Ct),this._root=Ct),bt&&(Xe?Ct.right=bt:this._root=bt,bt.parent=Ct),this._size--}},l.prototype.pop=function(){var se=this._root,ue=null;if(se){for(;se.left;)se=se.left;ue={key:se.key,data:se.data},this.remove(se.key)}return ue},l.prototype.next=function(se){var ue=se;if(ue)if(ue.right)for(ue=ue.right;ue&&ue.left;)ue=ue.left;else for(ue=se.parent;ue&&ue.right===se;)se=ue,ue=ue.parent;return ue},l.prototype.prev=function(se){var ue=se;if(ue)if(ue.left)for(ue=ue.left;ue&&ue.right;)ue=ue.right;else for(ue=se.parent;ue&&ue.left===se;)se=ue,ue=ue.parent;return ue},l.prototype.forEach=function(se){for(var ue=this._root,Xe=[],bt=!1,Ct=0;!bt;)ue?(Xe.push(ue),ue=ue.left):Xe.length>0?(se(ue=Xe.pop(),Ct++),ue=ue.right):bt=!0;return this},l.prototype.range=function(se,ue,Xe,bt){for(var Ct=[],Et=this._compare,Ut=this._root;Ct.length!==0||Ut;)if(Ut)Ct.push(Ut),Ut=Ut.left;else{if(Et((Ut=Ct.pop()).key,ue)>0)break;if(Et(Ut.key,se)>=0&&Xe.call(bt,Ut))return this;Ut=Ut.right}return this},l.prototype.keys=function(){for(var se=this._root,ue=[],Xe=[],bt=!1;!bt;)se?(ue.push(se),se=se.left):ue.length>0?(se=ue.pop(),Xe.push(se.key),se=se.right):bt=!0;return Xe},l.prototype.values=function(){for(var se=this._root,ue=[],Xe=[],bt=!1;!bt;)se?(ue.push(se),se=se.left):ue.length>0?(se=ue.pop(),Xe.push(se.data),se=se.right):bt=!0;return Xe},l.prototype.at=function(se){for(var ue=this._root,Xe=[],bt=!1,Ct=0;!bt;)if(ue)Xe.push(ue),ue=ue.left;else if(Xe.length>0){if(ue=Xe.pop(),Ct===se)return ue;Ct++,ue=ue.right}else bt=!0;return null},l.prototype.load=function(se,ue,Xe){if(se===void 0&&(se=[]),ue===void 0&&(ue=[]),Xe===void 0&&(Xe=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bt=se.length;return Xe&&g(se,ue,0,bt-1,this._compare),this._root=f(null,se,ue,0,bt),this._size=bt,this},l.prototype.min=function(){var se=this.minNode(this._root);return se?se.key:null},l.prototype.max=function(){var se=this.maxNode(this._root);return se?se.key:null},l.prototype.isEmpty=function(){return this._root===null},d.size.get=function(){return this._size},l.createTree=function(se,ue,Xe,bt,Ct){return new l(Xe,Ct).load(se,ue,bt)},Object.defineProperties(l.prototype,d);var x=0,b=1,C=2,M=3,R=0,P=1,F=2,V=3;function q(se,ue,Xe){ue===null?(se.inOut=!1,se.otherInOut=!0):(se.isSubject===ue.isSubject?(se.inOut=!ue.inOut,se.otherInOut=ue.otherInOut):(se.inOut=!ue.otherInOut,se.otherInOut=ue.isVertical()?!ue.inOut:ue.inOut),ue&&(se.prevInResult=!$(ue,Xe)||ue.isVertical()?ue.prevInResult:ue));var bt=$(se,Xe);se.resultTransition=bt?function(Ct,Et){var Ut,ni=!Ct.inOut,Ni=!Ct.otherInOut;switch(Et){case R:Ut=ni&&Ni;break;case P:Ut=ni||Ni;break;case V:Ut=ni^Ni;break;case F:Ut=Ct.isSubject?ni&&!Ni:Ni&&!ni}return Ut?1:-1}(se,Xe):0}function $(se,ue){switch(se.type){case x:switch(ue){case R:return!se.otherInOut;case P:return se.otherInOut;case F:return se.isSubject&&se.otherInOut||!se.isSubject&&!se.otherInOut;case V:return!0}break;case C:return ue===R||ue===P;case M:return ue===F;case b:return!1}return!1}var te=function(se,ue,Xe,bt,Ct){this.left=ue,this.point=se,this.otherEvent=Xe,this.isSubject=bt,this.type=Ct||x,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ne={inResult:{configurable:!0}};function G(se,ue){return se[0]===ue[0]&&se[1]===ue[1]}te.prototype.isBelow=function(se){var ue=this.point,Xe=this.otherEvent.point;return this.left?(ue[0]-se[0])*(Xe[1]-se[1])-(Xe[0]-se[0])*(ue[1]-se[1])>0:(Xe[0]-se[0])*(ue[1]-se[1])-(ue[0]-se[0])*(Xe[1]-se[1])>0},te.prototype.isAbove=function(se){return!this.isBelow(se)},te.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ne.inResult.get=function(){return this.resultTransition!==0},te.prototype.clone=function(){var se=new te(this.point,this.left,this.otherEvent,this.isSubject,this.type);return se.contourId=this.contourId,se.resultTransition=this.resultTransition,se.prevInResult=this.prevInResult,se.isExteriorRing=this.isExteriorRing,se.inOut=this.inOut,se.otherInOut=this.otherInOut,se},Object.defineProperties(te.prototype,ne);var ee=11102230246251565e-32,re=134217729,ae=(3+8*ee)*ee;function Te(se,ue,Xe,bt,Ct){var Et,Ut,ni,Ni,Ui=ue[0],Ai=bt[0],mn=0,kn=0;Ai>Ui==Ai>-Ui?(Et=Ui,Ui=ue[++mn]):(Et=Ai,Ai=bt[++kn]);var Vi=0;if(mn<se&&kn<Xe)for(Ai>Ui==Ai>-Ui?(ni=Et-((Ut=Ui+Et)-Ui),Ui=ue[++mn]):(ni=Et-((Ut=Ai+Et)-Ai),Ai=bt[++kn]),Et=Ut,ni!==0&&(Ct[Vi++]=ni);mn<se&&kn<Xe;)Ai>Ui==Ai>-Ui?(ni=Et-((Ut=Et+Ui)-(Ni=Ut-Et))+(Ui-Ni),Ui=ue[++mn]):(ni=Et-((Ut=Et+Ai)-(Ni=Ut-Et))+(Ai-Ni),Ai=bt[++kn]),Et=Ut,ni!==0&&(Ct[Vi++]=ni);for(;mn<se;)ni=Et-((Ut=Et+Ui)-(Ni=Ut-Et))+(Ui-Ni),Ui=ue[++mn],Et=Ut,ni!==0&&(Ct[Vi++]=ni);for(;kn<Xe;)ni=Et-((Ut=Et+Ai)-(Ni=Ut-Et))+(Ai-Ni),Ai=bt[++kn],Et=Ut,ni!==0&&(Ct[Vi++]=ni);return Et===0&&Vi!==0||(Ct[Vi++]=Et),Vi}function ve(se){return new Float64Array(se)}var Se=33306690738754716e-32,Me=22204460492503146e-32,je=11093356479670487e-47,ct=ve(4),et=ve(8),at=ve(12),ft=ve(16),He=ve(4);function st(se,ue,Xe){var bt=function(Ct,Et,Ut,ni,Ni,Ui){var Ai=(Et-Ui)*(Ut-Ni),mn=(Ct-Ni)*(ni-Ui),kn=Ai-mn;if(Ai===0||mn===0||Ai>0!=mn>0)return kn;var Vi=Math.abs(Ai+mn);return Math.abs(kn)>=Se*Vi?kn:-function(fr,jn,pn,wr,Wn,Bn,Gn){var vn,Mi,En,pr,ti,Yi,$n,yr,er,jr,In,Br,Xo,js,zs,Wo,xh,Gr,is=fr-Wn,Gs=pn-Wn,ho=jn-Bn,Js=wr-Bn;ct[0]=(zs=(yr=is-($n=(Yi=re*is)-(Yi-is)))*(jr=Js-(er=(Yi=re*Js)-(Yi-Js)))-((js=is*Js)-$n*er-yr*er-$n*jr))-((In=zs-(xh=(yr=ho-($n=(Yi=re*ho)-(Yi-ho)))*(jr=Gs-(er=(Yi=re*Gs)-(Yi-Gs)))-((Wo=ho*Gs)-$n*er-yr*er-$n*jr)))+(ti=zs-In))+(ti-xh),ct[1]=(Xo=js-((Br=js+In)-(ti=Br-js))+(In-ti))-((In=Xo-Wo)+(ti=Xo-In))+(ti-Wo),ct[2]=Br-((Gr=Br+In)-(ti=Gr-Br))+(In-ti),ct[3]=Gr;var kf=function(HD,yw){for(var vw=yw[0],R0=1;R0<4;R0++)vw+=yw[R0];return vw}(0,ct),ag=Me*Gn;if(kf>=ag||-kf>=ag||(vn=fr-(is+(ti=fr-is))+(ti-Wn),En=pn-(Gs+(ti=pn-Gs))+(ti-Wn),Mi=jn-(ho+(ti=jn-ho))+(ti-Bn),pr=wr-(Js+(ti=wr-Js))+(ti-Bn),vn===0&&Mi===0&&En===0&&pr===0)||(ag=je*Gn+ae*Math.abs(kf),(kf+=is*pr+Js*vn-(ho*En+Gs*Mi))>=ag||-kf>=ag))return kf;He[0]=(zs=(yr=vn-($n=(Yi=re*vn)-(Yi-vn)))*(jr=Js-(er=(Yi=re*Js)-(Yi-Js)))-((js=vn*Js)-$n*er-yr*er-$n*jr))-((In=zs-(xh=(yr=Mi-($n=(Yi=re*Mi)-(Yi-Mi)))*(jr=Gs-(er=(Yi=re*Gs)-(Yi-Gs)))-((Wo=Mi*Gs)-$n*er-yr*er-$n*jr)))+(ti=zs-In))+(ti-xh),He[1]=(Xo=js-((Br=js+In)-(ti=Br-js))+(In-ti))-((In=Xo-Wo)+(ti=Xo-In))+(ti-Wo),He[2]=Br-((Gr=Br+In)-(ti=Gr-Br))+(In-ti),He[3]=Gr;var xA=Te(4,ct,4,He,et);He[0]=(zs=(yr=is-($n=(Yi=re*is)-(Yi-is)))*(jr=pr-(er=(Yi=re*pr)-(Yi-pr)))-((js=is*pr)-$n*er-yr*er-$n*jr))-((In=zs-(xh=(yr=ho-($n=(Yi=re*ho)-(Yi-ho)))*(jr=En-(er=(Yi=re*En)-(Yi-En)))-((Wo=ho*En)-$n*er-yr*er-$n*jr)))+(ti=zs-In))+(ti-xh),He[1]=(Xo=js-((Br=js+In)-(ti=Br-js))+(In-ti))-((In=Xo-Wo)+(ti=Xo-In))+(ti-Wo),He[2]=Br-((Gr=Br+In)-(ti=Gr-Br))+(In-ti),He[3]=Gr;var bA=Te(xA,et,4,He,at);He[0]=(zs=(yr=vn-($n=(Yi=re*vn)-(Yi-vn)))*(jr=pr-(er=(Yi=re*pr)-(Yi-pr)))-((js=vn*pr)-$n*er-yr*er-$n*jr))-((In=zs-(xh=(yr=Mi-($n=(Yi=re*Mi)-(Yi-Mi)))*(jr=En-(er=(Yi=re*En)-(Yi-En)))-((Wo=Mi*En)-$n*er-yr*er-$n*jr)))+(ti=zs-In))+(ti-xh),He[1]=(Xo=js-((Br=js+In)-(ti=Br-js))+(In-ti))-((In=Xo-Wo)+(ti=Xo-In))+(ti-Wo),He[2]=Br-((Gr=Br+In)-(ti=Gr-Br))+(In-ti),He[3]=Gr;var wA=Te(bA,at,4,He,ft);return ft[wA-1]}(Ct,Et,Ut,ni,Ni,Ui,Vi)}(se[0],se[1],ue[0],ue[1],Xe[0],Xe[1]);return bt>0?-1:bt<0?1:0}function Ve(se,ue){var Xe=se.point,bt=ue.point;return Xe[0]>bt[0]?1:Xe[0]<bt[0]?-1:Xe[1]!==bt[1]?Xe[1]>bt[1]?1:-1:function(Ct,Et,Ut,ni){return Ct.left!==Et.left?Ct.left?1:-1:st(Ut,Ct.otherEvent.point,Et.otherEvent.point)!==0?Ct.isBelow(Et.otherEvent.point)?-1:1:!Ct.isSubject&&Et.isSubject?1:-1}(se,ue,Xe)}function Ge(se,ue,Xe){var bt=new te(ue,!1,se,se.isSubject),Ct=new te(ue,!0,se.otherEvent,se.isSubject);return G(se.point,se.otherEvent.point)&&console.warn("what is that, a collapsed segment?",se),bt.contourId=Ct.contourId=se.contourId,Ve(Ct,se.otherEvent)>0&&(se.otherEvent.left=!0,Ct.left=!1),se.otherEvent.otherEvent=Ct,se.otherEvent=bt,Xe.push(Ct),Xe.push(bt),Xe}function _t(se,ue){return se[0]*ue[1]-se[1]*ue[0]}function yt(se,ue){return se[0]*ue[0]+se[1]*ue[1]}function Qt(se,ue,Xe){var bt=function(Ni,Ui,Ai,mn,kn){var Vi=[Ui[0]-Ni[0],Ui[1]-Ni[1]],fr=[mn[0]-Ai[0],mn[1]-Ai[1]];function jn(Yi,$n,yr){return[Yi[0]+$n*yr[0],Yi[1]+$n*yr[1]]}var pn=[Ai[0]-Ni[0],Ai[1]-Ni[1]],wr=_t(Vi,fr),Wn=wr*wr,Bn=yt(Vi,Vi);if(Wn>0){var Gn=_t(pn,fr)/wr;if(Gn<0||Gn>1)return null;var vn=_t(pn,Vi)/wr;return vn<0||vn>1?null:Gn===0||Gn===1?[jn(Ni,Gn,Vi)]:vn===0||vn===1?[jn(Ai,vn,fr)]:[jn(Ni,Gn,Vi)]}if((Wn=(wr=_t(pn,Vi))*wr)>0)return null;var Mi=yt(Vi,pn)/Bn,En=Mi+yt(Vi,fr)/Bn,pr=Math.min(Mi,En),ti=Math.max(Mi,En);return pr<=1&&ti>=0?pr===1?[jn(Ni,pr>0?pr:0,Vi)]:ti===0?[jn(Ni,ti<1?ti:1,Vi)]:[jn(Ni,pr>0?pr:0,Vi),jn(Ni,ti<1?ti:1,Vi)]:null}(se.point,se.otherEvent.point,ue.point,ue.otherEvent.point),Ct=bt?bt.length:0;if(Ct===0||Ct===1&&(G(se.point,ue.point)||G(se.otherEvent.point,ue.otherEvent.point))||Ct===2&&se.isSubject===ue.isSubject)return 0;if(Ct===1)return G(se.point,bt[0])||G(se.otherEvent.point,bt[0])||Ge(se,bt[0],Xe),G(ue.point,bt[0])||G(ue.otherEvent.point,bt[0])||Ge(ue,bt[0],Xe),1;var Et=[],Ut=!1,ni=!1;return G(se.point,ue.point)?Ut=!0:Ve(se,ue)===1?Et.push(ue,se):Et.push(se,ue),G(se.otherEvent.point,ue.otherEvent.point)?ni=!0:Ve(se.otherEvent,ue.otherEvent)===1?Et.push(ue.otherEvent,se.otherEvent):Et.push(se.otherEvent,ue.otherEvent),Ut&&ni||Ut?(ue.type=b,se.type=ue.inOut===se.inOut?C:M,Ut&&!ni&&Ge(Et[1].otherEvent,Et[0].point,Xe),2):ni?(Ge(Et[0],Et[1].point,Xe),3):Et[0]!==Et[3].otherEvent?(Ge(Et[0],Et[1].point,Xe),Ge(Et[1],Et[2].point,Xe),3):(Ge(Et[0],Et[1].point,Xe),Ge(Et[3].otherEvent,Et[2].point,Xe),3)}function jt(se,ue){if(se===ue)return 0;if(st(se.point,se.otherEvent.point,ue.point)!==0||st(se.point,se.otherEvent.point,ue.otherEvent.point)!==0)return G(se.point,ue.point)?se.isBelow(ue.otherEvent.point)?-1:1:se.point[0]===ue.point[0]?se.point[1]<ue.point[1]?-1:1:Ve(se,ue)===1?ue.isAbove(se.point)?-1:1:se.isBelow(ue.point)?-1:1;if(se.isSubject!==ue.isSubject)return se.isSubject?-1:1;var Xe=se.point,bt=ue.point;return Xe[0]===bt[0]&&Xe[1]===bt[1]?(Xe=se.otherEvent.point)[0]===(bt=ue.otherEvent.point)[0]&&Xe[1]===bt[1]?0:se.contourId>ue.contourId?1:-1:Ve(se,ue)===1?1:-1}var At=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function mt(se,ue,Xe,bt){var Ct,Et=se+1,Ut=ue[se].point,ni=ue.length;for(Et<ni&&(Ct=ue[Et].point);Et<ni&&Ct[0]===Ut[0]&&Ct[1]===Ut[1];){if(!Xe[Et])return Et;++Et<ni&&(Ct=ue[Et].point)}for(Et=se-1;Xe[Et]&&Et>bt;)Et--;return Et}At.prototype.isExterior=function(){return this.holeOf==null};var _i=Gt,Vt=Gt;function Gt(se,ue){if(!(this instanceof Gt))return new Gt(se,ue);if(this.data=se||[],this.length=this.data.length,this.compare=ue||ri,this.length>0)for(var Xe=(this.length>>1)-1;Xe>=0;Xe--)this._down(Xe)}function ri(se,ue){return se<ue?-1:se>ue?1:0}Gt.prototype={push:function(se){this.data.push(se),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var se=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),se}},peek:function(){return this.data[0]},_up:function(se){for(var ue=this.data,Xe=this.compare,bt=ue[se];se>0;){var Ct=se-1>>1,Et=ue[Ct];if(Xe(bt,Et)>=0)break;ue[se]=Et,se=Ct}ue[se]=bt},_down:function(se){for(var ue=this.data,Xe=this.compare,bt=this.length>>1,Ct=ue[se];se<bt;){var Et=1+(se<<1),Ut=Et+1,ni=ue[Et];if(Ut<this.length&&Xe(ue[Ut],ni)<0&&(Et=Ut,ni=ue[Ut]),Xe(ni,Ct)>=0)break;ue[se]=ni,se=Et}ue[se]=Ct}},_i.default=Vt;var Si=Math.max,bi=Math.min,Di=0;function Ei(se,ue,Xe,bt,Ct,Et){var Ut,ni,Ni,Ui,Ai,mn;for(Ut=0,ni=se.length-1;Ut<ni;Ut++)if(Ui=se[Ut+1],Ai=new te(Ni=se[Ut],!1,void 0,ue),mn=new te(Ui,!1,Ai,ue),Ai.otherEvent=mn,Ni[0]!==Ui[0]||Ni[1]!==Ui[1]){Ai.contourId=mn.contourId=Xe,Et||(Ai.isExteriorRing=!1,mn.isExteriorRing=!1),Ve(Ai,mn)>0?mn.left=!0:Ai.left=!0;var kn=Ni[0],Vi=Ni[1];Ct[0]=bi(Ct[0],kn),Ct[1]=bi(Ct[1],Vi),Ct[2]=Si(Ct[2],kn),Ct[3]=Si(Ct[3],Vi),bt.push(Ai),bt.push(mn)}}var zi=[];function fn(se,ue,Xe){typeof se[0][0][0]=="number"&&(se=[se]),typeof ue[0][0][0]=="number"&&(ue=[ue]);var bt=function(Vi,fr,jn){var pn=null;return Vi.length*fr.length==0&&(jn===R?pn=zi:jn===F?pn=Vi:jn!==P&&jn!==V||(pn=Vi.length===0?fr:Vi)),pn}(se,ue,Xe);if(bt)return bt===zi?null:bt;var Ct=[1/0,1/0,-1/0,-1/0],Et=[1/0,1/0,-1/0,-1/0],Ut=function(Vi,fr,jn,pn,wr){var Wn,Bn,Gn,vn,Mi,En,pr=new _i(null,Ve);for(Gn=0,vn=Vi.length;Gn<vn;Gn++)for(Mi=0,En=(Wn=Vi[Gn]).length;Mi<En;Mi++)(Bn=Mi===0)&&Di++,Ei(Wn[Mi],!0,Di,pr,jn,Bn);for(Gn=0,vn=fr.length;Gn<vn;Gn++)for(Mi=0,En=(Wn=fr[Gn]).length;Mi<En;Mi++)Bn=Mi===0,wr===F&&(Bn=!1),Bn&&Di++,Ei(Wn[Mi],!1,Di,pr,pn,Bn);return pr}(se,ue,Ct,Et,Xe);if(bt=function(Vi,fr,jn,pn,wr){var Wn=null;return(jn[0]>pn[2]||pn[0]>jn[2]||jn[1]>pn[3]||pn[1]>jn[3])&&(wr===R?Wn=zi:wr===F?Wn=Vi:wr!==P&&wr!==V||(Wn=Vi.concat(fr))),Wn}(se,ue,Ct,Et,Xe))return bt===zi?null:bt;for(var ni=function(Vi){var fr,jn,pn=function(Gn){var vn,Mi,En,pr,ti=[];for(Mi=0,En=Gn.length;Mi<En;Mi++)((vn=Gn[Mi]).left&&vn.inResult||!vn.left&&vn.otherEvent.inResult)&&ti.push(vn);for(var Yi=!1;!Yi;)for(Yi=!0,Mi=0,En=ti.length;Mi<En;Mi++)Mi+1<En&&Ve(ti[Mi],ti[Mi+1])===1&&(pr=ti[Mi],ti[Mi]=ti[Mi+1],ti[Mi+1]=pr,Yi=!1);for(Mi=0,En=ti.length;Mi<En;Mi++)(vn=ti[Mi]).otherPos=Mi;for(Mi=0,En=ti.length;Mi<En;Mi++)(vn=ti[Mi]).left||(pr=vn.otherPos,vn.otherPos=vn.otherEvent.otherPos,vn.otherEvent.otherPos=pr);return ti}(Vi),wr={},Wn=[],Bn=function(){if(!wr[fr]){var Gn=Wn.length,vn=function(ti,Yi,$n){var yr=new At;if(ti.prevInResult!=null){var er=ti.prevInResult,jr=er.outputContourId;if(er.resultTransition>0){var In=Yi[jr];if(In.holeOf!=null){var Br=In.holeOf;Yi[Br].holeIds.push($n),yr.holeOf=Br,yr.depth=Yi[jr].depth}else Yi[jr].holeIds.push($n),yr.holeOf=jr,yr.depth=Yi[jr].depth+1}else yr.holeOf=null,yr.depth=Yi[jr].depth}else yr.holeOf=null,yr.depth=0;return yr}(pn[fr],Wn,Gn),Mi=function(ti){wr[ti]=!0,ti<pn.length&&pn[ti]&&(pn[ti].outputContourId=Gn)},En=fr,pr=fr;for(vn.points.push(pn[fr].point);Mi(En),Mi(En=pn[En].otherPos),vn.points.push(pn[En].point),!((En=mt(En,pn,wr,pr))==pr||En>=pn.length)&&pn[En];);Wn.push(vn)}};for(fr=0,jn=pn.length;fr<jn;fr++)Bn();return Wn}(function(Vi,fr,jn,pn,wr,Wn){for(var Bn,Gn,vn,Mi=new l(jt),En=[],pr=Math.min(pn[2],wr[2]);Vi.length!==0;){var ti=Vi.pop();if(En.push(ti),Wn===R&&ti.point[0]>pr||Wn===F&&ti.point[0]>pn[2])break;if(ti.left){Gn=Bn=Mi.insert(ti),Bn=Bn!==(vn=Mi.minNode())?Mi.prev(Bn):null,Gn=Mi.next(Gn);var Yi=Bn?Bn.key:null;if(q(ti,Yi,Wn),Gn&&Qt(ti,Gn.key,Vi)===2&&(q(ti,Yi,Wn),q(Gn.key,ti,Wn)),Bn&&Qt(Bn.key,ti,Vi)===2){var $n=Bn;q(Yi,($n=$n!==vn?Mi.prev($n):null)?$n.key:null,Wn),q(ti,Yi,Wn)}}else Gn=Bn=Mi.find(ti=ti.otherEvent),Bn&&Gn&&(Bn=Bn!==vn?Mi.prev(Bn):null,Gn=Mi.next(Gn),Mi.remove(ti),Gn&&Bn&&Qt(Bn.key,Gn.key,Vi))}return En}(Ut,0,0,Ct,Et,Xe)),Ni=[],Ui=0;Ui<ni.length;Ui++){var Ai=ni[Ui];if(Ai.isExterior()){for(var mn=[Ai.points],kn=0;kn<Ai.holeIds.length;kn++)mn.push(ni[Ai.holeIds[kn]].points);Ni.push(mn)}}return Ni}var Vn={UNION:P,DIFFERENCE:F,INTERSECTION:R,XOR:V};i.diff=function(se,ue){return fn(se,ue,F)},i.intersection=function(se,ue){return fn(se,ue,R)},i.operations=Vn,i.union=function(se,ue){return fn(se,ue,P)},i.xor=function(se,ue){return fn(se,ue,V)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,Qg.exports)),Qg.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Rm(n,e,i,s){const l=[],d=s===0?(f,g,x,b,C,M)=>{f.push(new Tt(M,x+(M-g)/(b-g)*(C-x)))}:(f,g,x,b,C,M)=>{f.push(new Tt(g+(M-x)/(C-x)*(b-g),M))};for(const f of n){const g=[];for(const x of f){if(x.length<=2)continue;const b=[];for(let R=0;R<x.length-1;R++){const P=x[R].x,F=x[R].y,V=x[R+1].x,q=x[R+1].y,$=s===0?P:F,te=s===0?V:q;$<e?te>e&&d(b,P,F,V,q,e):$>i?te<i&&d(b,P,F,V,q,i):b.push(x[R]),te<e&&$>=e&&d(b,P,F,V,q,e),te>i&&$<=i&&d(b,P,F,V,q,i)}let C=x[x.length-1];const M=s===0?C.x:C.y;M>=e&&M<=i&&b.push(C),b.length&&(C=b[b.length-1],b[0].x===C.x&&b[0].y===C.y||b.push(b[0]),g.push(b))}g.length&&l.push(g)}return l}function Lv(n,e){const i=D_(n),s=D_([e]),l=Jg.intersection(i,s);return l==null?[]:ey(l)}function Pv(n,e){let s=D_(n,65536);for(;e.valid();e.next()){const[l,d]=e.get(),f=l.x*65536,g=l.y*65536,x=d.x*65536,b=d.y*65536,C=x-f,M=b-g,R=Math.hypot(C,M),P=Math.trunc(M/R*3),F=-Math.trunc(C/R*3);s=Jg.diff(s,[[[f,g],[x,b],[x+P,b+F],[f+P,g+F],[f,g]]])}return ey(s,1/65536)}function D_(n,e=1){return[n.map(i=>i.map(s=>[s.x*e,s.y*e]))]}function ey(n,e=1){return n.map(i=>i.map((s,l)=>{const d=s.map(f=>new Tt(f[0]*e,f[1]*e).round());return l>0&&d.reverse(),d}))}class Dm{constructor(e,i){this.layoutVertexArray=new No,this.indexArray=new Sr,this.lineIndexArray=new os,this.triangleSegments=new or,this.lineSegments=new or,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new pa)}update(e,i,s,l,d,f,g,x){this.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,x)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Wg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,l,d,f,g){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,l,d,f,void 0,g)}}class ph{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Dm(e,!1),this.elevationBufferData=new Dm(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,s,l){this.hasPattern=Mm("fill",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("fill-sort-key"),f=[];for(const{feature:g,id:x,index:b,sourceLayerIndex:C}of e){const M=this.layers[0]._featureFilter.needGeometry,R=Dt(g,M);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),R,s))continue;const P=d?d.evaluate(R,{},s,i.availableImages):void 0,F={id:x,properties:g.properties,type:g.type,sourceLayerIndex:C,index:b,geometry:M?R.geometry:zt(g,s,l),patterns:{},sortKey:P};f.push(F)}d&&f.sort((g,x)=>g.sortKey-x.sortKey);for(const g of f){const{geometry:x,index:b,sourceLayerIndex:C}=g;if(this.hasPattern){const M=Sf("fill",this.layers,g,this.zoom,this.pixelRatio,i);this.patternFeatures.push(M)}else this.addFeature(g,x,b,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[b].feature,x,b,C,this.index)}}update(e,i,s,l,d,f,g){this.bufferData.update(e,i,s,l,d,f,g,this.worldview),this.elevationBufferData.update(e,i,s,l,d,f,g,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,l,d,f,g,this.worldview)}addFeatures(e,i,s,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,l,f,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,l,d,f=[],g,x){const b=zp(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,b,l,s,x):this.addGeometry(b,this.bufferData),this.bufferData.populatePaintArrays(e,s,d,f,l,g,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,d,f,l,g,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,l,d){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,l,d,this.worldview))}addElevatedRoadFeature(e,i,s,l,d){const f=new Array,g=Qs.getElevationFeature(e,d);if(!g)return void this.addGeometry(i,this.bufferData);{const b=this.clipPolygonsToTile(i,1);b.length>0&&f.push({polygons:b,elevationFeature:g,elevationTileID:s})}const x={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:l};for(const b of f)if(b.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Rs(b.elevationTileID,this.layers,this.zoom,this.lut));const M=b.elevationFeature.isTunnel();let R=0;e.properties.hasOwnProperty(an)&&(R=+e.properties[an]);for(const P of b.polygons)this.elevatedStructures.addPortalCandidates(b.elevationFeature.id,P,M,b.elevationFeature,R)}b.elevationFeature.constantHeight==null&&(b.polygons=this.prepareElevatedPolygons(b.polygons,b.elevationFeature,b.elevationTileID));const C=new qo(s,b.elevationTileID);this.addElevatedGeometry(b.polygons,C,b.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,l,x)}}addElevatedGeometry(e,i,s,l,d,f){const g={elevation:s,elevationSampler:i,bias:l,index:d,featureInfo:f},[x,b]=this.addGeometry(e,this.elevationBufferData,g);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:x,max:b}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,x),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,b))}addGeometry(e,i,s){let l=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,f=null;s&&(f=s.elevationSampler.constantElevation(s.elevation,s.bias),f!=null&&(l=f,d=f));const g=(x,b,C)=>{if(s!=null)if(b.push(x),f!=null)i.elevatedLayoutVertexArray.emplaceBack(f),C.push(f);else{const M=s.elevationSampler.pointElevation(x,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(M),C.push(M),l=Math.min(l,M),d=Math.max(d,M)}};for(const x of e){let b=0;for(const ne of x)b+=ne.length;const C=i.triangleSegments.prepareSegment(b,i.layoutVertexArray,i.indexArray),M=C.vertexLength,R=[],P=[],F=[],V=[],q=[],$=i.layoutVertexArray.length;for(const ne of x){if(ne.length===0)continue;ne!==x[0]&&P.push(R.length/2);const G=i.lineSegments.prepareSegment(ne.length,i.layoutVertexArray,i.lineIndexArray),ee=G.vertexLength;s&&q.push(i.layoutVertexArray.length-$),g(ne[0],F,V),i.layoutVertexArray.emplaceBack(ne[0].x,ne[0].y),i.lineIndexArray.emplaceBack(ee+ne.length-1,ee),R.push(ne[0].x),R.push(ne[0].y);for(let re=1;re<ne.length;re++)g(ne[re],F,V),i.layoutVertexArray.emplaceBack(ne[re].x,ne[re].y),i.lineIndexArray.emplaceBack(ee+re-1,ee+re),R.push(ne[re].x),R.push(ne[re].y);G.vertexLength+=ne.length,G.primitiveLength+=ne.length}const te=gd(R,P);for(let ne=0;ne<te.length;ne+=3)i.indexArray.emplaceBack(M+te[ne],M+te[ne+1],M+te[ne+2]);if(te.length>0&&s&&this.elevationMode==="hd-road-base"){const ne=s.elevation.isTunnel(),G=s.elevation.safeArea,ee=this.elevatedStructures.addVertices(F,V);this.elevatedStructures.addTriangles(te,ee,ne);const re=q.length;if(re>0){for(let ae=0;ae<re-1;ae++)this.elevatedStructures.addRenderableRing(s.index,q[ae]+ee,q[ae+1]-q[ae],ne,G,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,q[re-1]+ee,F.length-q[re-1],ne,G,s.featureInfo)}}C.vertexLength+=b,C.primitiveLength+=te.length/3}return[l,d]}prepareElevatedPolygons(e,i,s){const l=1/Ue(s),d=[];for(const f of e){const g=Pv(f,new ls(i,l));d.push(...g)}return d}clipPolygonsToTile(e,i){const s=-i,l=-i,d=vt+i,f=vt+i;let g=0;const x=[],b=[];for(;g<e.length;g++){const R=e[g],P=$f(R);(P.min.x>=s&&P.max.x<=d&&P.min.y>=l&&P.max.y<=f?x:b).push(R)}if(x.length===e.length)return e;const C=[new Tt(s,l),new Tt(d,l),new Tt(d,f),new Tt(s,f),new Tt(s,l)],M=x;for(const R of b)M.push(...Lv(R,C));return M}}let Ef,z_,ty,Sd;Pt(ph,"FillBucket",{omit:["layers","patternFeatures"]}),Pt(Dm,"FillBufferData"),Pt(Rs,"ElevatedStructures");class Ed{constructor(e,i,s,l){if(this.triangleCount=i.length/3,this.min=new Tt(0,0),this.max=new Tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[d,f]=[e[0].clone(),e[0].clone()];for(let M=1;M<e.length;++M){const R=e[M];d.x=Math.min(d.x,R.x),d.y=Math.min(d.y,R.y),f.x=Math.max(f.x,R.x),f.y=Math.max(f.y,R.y)}if(l){const M=Math.ceil(Math.max(f.x-d.x,f.y-d.y)/l);s=Math.max(s,M)}if(s===0)return;this.min=d,this.max=f;const g=this.max.sub(this.min);g.x=Math.max(g.x,1),g.y=Math.max(g.y,1);const x=Math.max(g.x,g.y)/s;this.cellsX=Math.max(1,Math.ceil(g.x/x)),this.cellsY=Math.max(1,Math.ceil(g.y/x)),this.xScale=1/x,this.yScale=1/x;const b=[];for(let M=0;M<this.triangleCount;M++){const R=e[i[3*M+0]].sub(this.min),P=e[i[3*M+1]].sub(this.min),F=e[i[3*M+2]].sub(this.min),V=Pl(Math.floor(Math.min(R.x,P.x,F.x)),this.xScale,this.cellsX),q=Pl(Math.floor(Math.max(R.x,P.x,F.x)),this.xScale,this.cellsX),$=Pl(Math.floor(Math.min(R.y,P.y,F.y)),this.yScale,this.cellsY),te=Pl(Math.floor(Math.max(R.y,P.y,F.y)),this.yScale,this.cellsY),ne=new Tt(0,0),G=new Tt(0,0),ee=new Tt(0,0),re=new Tt(0,0);for(let ae=$;ae<=te;++ae){ne.y=G.y=ae*x,ee.y=re.y=(ae+1)*x;for(let Te=V;Te<=q;++Te)ne.x=ee.x=Te*x,G.x=re.x=(Te+1)*x,(Ep(R,P,F,ne,G,re)||Ep(R,P,F,ne,re,ee))&&b.push({cellIdx:ae*this.cellsX+Te,triIdx:M})}}if(b.length===0)return;b.sort((M,R)=>M.cellIdx-R.cellIdx||M.triIdx-R.triIdx);let C=0;for(;C<b.length;){const M=b[C].cellIdx,R={start:this.payload.length,len:0};for(;C<b.length&&b[C].cellIdx===M;)++R.len,this.payload.push(b[C++].triIdx);this.cells[M]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Pl(e.x-this.min.x,this.xScale,this.cellsX),l=Pl(e.y-this.min.y,this.yScale,this.cellsY),d=this.cells[l*this.cellsX+s];if(d){this._lazyInitLookup();for(let f=0;f<d.len;f++){const g=this.payload[d.start+f],x=Math.floor(g/8),b=1<<g%8;if(!(this.lookup[x]&b)&&(this.lookup[x]|=b,i.push(g),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const l=Pl(e.x-this.min.x,this.xScale,this.cellsX),d=Pl(i.x-this.min.x,this.xScale,this.cellsX),f=Pl(e.y-this.min.y,this.yScale,this.cellsY),g=Pl(i.y-this.min.y,this.yScale,this.cellsY);for(let x=f;x<=g;x++)for(let b=l;b<=d;b++){const C=this.cells[x*this.cellsX+b];if(C)for(let M=0;M<C.len;M++){const R=this.payload[C.start+M],P=Math.floor(R/8),F=1<<R%8;if(!(this.lookup[P]&F)&&(this.lookup[P]|=F,s.push(R),s.length===this.triangleCount))return}}}}function Pl(n,e,i){return Math.max(0,Math.min(i-1,Math.floor(n*e)))}Pt(Ed,"TriangleGridIndex");class Pp{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}populate(e,i,s,l){const d=[];for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Dt(f,C);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),M,s))continue;const R={id:g,properties:f.properties,type:f.type,sourceLayerIndex:b,index:x,geometry:C?M.geometry:zt(f,s,l),patterns:{}};d.push(R)}for(const f of d){const{geometry:g,index:x,sourceLayerIndex:b}=f;this.addFeature(f,g,x,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[x].feature,g,x,b,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,l,d,f,g){}destroy(){}addFeature(e,i,s,l,d,f=[],g){for(const x of zp(i,2)){const b=[],C=[],M=[],R=new Tt(1/0,1/0),P=new Tt(-1/0,-1/0);for(const q of x)if(q.length!==0){q!==x[0]&&M.push(C.length/2);for(let $=0;$<q.length;$++)C.push(q[$].x),C.push(q[$].y),b.push(q[$]),R.x=Math.min(R.x,q[$].x),R.y=Math.min(R.y,q[$].y),P.x=Math.max(P.x,q[$].x),P.y=Math.max(P.y,q[$].y)}const F=gd(C,M),V=new Ed(b,F,8,256);this.footprints.push({vertices:b,indices:F,grid:V,min:R,max:P})}}}Pt(Pp,"ClipBucket",{omit:["layers"]});const L_=Gi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),P_=Gi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),zm=Gi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iy=Gi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),ny=Gi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Ov=Gi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ry}=L_,mh=Number.MAX_SAFE_INTEGER;function sy(n,e,i,s){return n.order<e||n.order===mh||!(n.clipMask&i)||function(l,d){return d.length!==0&&d.find(f=>f===l)===void 0}(s,n.clipScope)}function Lm(n,e){return n.x-e.x||n.y-e.y}function oy(n,e){return Lm(n.min,e.min)===0&&Lm(n.max,e.max)===0}function Af(n,e){return!(n.min.x>e.max.x||n.max.x<e.min.x||n.min.y>e.max.y||n.max.y<e.min.y)}function Cf(n,e){if(n.length!==e.length)return!1;for(let i=0;i<n.length;i++)if(n[i].sourceId!==e[i].sourceId||!oy(n[i],e[i])||n[i].order!==e[i].order||n[i].clipMask!==e[i].clipMask||!ia(n[i].clipScope,e[i].clipScope))return!1;return!0}function Pm(n,e,i){const s=1/vt,l=1/(1<<i.canonical.z),d=(e.x*s+i.canonical.x)*l+i.wrap,f=(e.y*s+i.canonical.y)*l;return{min:new Tt((n.x*s+i.canonical.x)*l+i.wrap,(n.y*s+i.canonical.y)*l),max:new Tt(d,f)}}function kv(n,e,i){const s=1<<i.canonical.z,l=((e.x-i.wrap)*s-i.canonical.x)*vt,d=(e.y*s-i.canonical.y)*vt;return{min:new Tt(((n.x-i.wrap)*s-i.canonical.x)*vt,(n.y*s-i.canonical.y)*vt),max:new Tt(l,d)}}function If(n,e,i,s,l,d,f){const g=n.indices,x=n.vertices,b=[];for(let C=s;C<s+l;C+=3){const M=e[i[C+0]+d],R=e[i[C+1]+d],P=e[i[C+2]+d],F=Math.min(M.x,R.x,P.x),V=Math.max(M.x,R.x,P.x),q=Math.min(M.y,R.y,P.y),$=Math.max(M.y,R.y,P.y);b.length=0,n.grid.query(new Tt(F,q),new Tt(V,$),b);for(let te=0;te<b.length;te++){const ne=b[te];if(Ep(x[g[3*ne+0]],x[g[3*ne+1]],x[g[3*ne+2]],M,R,P,f))return!0}}return!1}function ay(n,e,i,s){if(!n||!i)return!1;let l=n.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<n.vertices.length)return ay(i,s,n,e);const d=e.canonical,f=s.canonical,g=Math.pow(2,f.z-d.z);l=n.vertices.map(x=>new Tt((x.x+d.x*vt)*g-f.x*vt,(x.y+d.y*vt)*g-f.y*vt))}return If(i,l,n.indices,0,n.indices.length,0,0)}function O_(n,e,i,s){const l=Math.pow(2,s.z-i.z);return new Tt((n+i.x*vt)*l-s.x*vt,(e+i.y*vt)*l-s.y*vt)}function k_(n,e){const i=[];e.grid.queryPoint(n,i);const s=e.indices,l=e.vertices;for(let d=0;d<i.length;d++){const f=i[d];if(ga([l[s[3*f+0]],l[s[3*f+1]],l[s[3*f+2]]],n))return!0}return!1}const Om=[new Tt(0,0),new Tt(vt,0),new Tt(vt,vt),new Tt(0,vt)];function B_(n,e){const i=[];let s=[];if(!e||n.length<2)return[n];if(n.length===2)return gc(n[0],n[1],Om)?[n]:[];for(let l=0;l<n.length+2;l++){const d=n[l%n.length],f=n[(l+1)%n.length],g=gc(l===0?n[n.length-1]:n[(l-1)%n.length],d,Om),x=gc(d,f,Om),b=g||x;b&&s.push(d),b&&x||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const Op=mi.VectorTileFeature.types,ly=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],km=["fill-extrusion-flood-light-ground-radius"],Bv=Math.pow(2,13),Fv=Math.pow(2,15)-1,Bm=new Tt(0,1),bc=2147483648;function _h(n,e,i,s,l,d,f,g){n.emplaceBack((e<<1)+f,(i<<1)+d,(Math.floor(s*Bv)<<1)+l,Math.round(g))}function Ad(n,e,i){n.emplaceBack(e.x*vt,e.y*vt,i?1:0)}function kp(n,e,i,s,l,d){n.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+l,d)}function Cd(n,e,i){n.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class au{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class lu{constructor(){this.centroidXY=new Tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class cu{constructor(){this.acc=new Tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let l=!!this.borders;i.x<e.min.x?(e.min.x=i.x,l=!0):i.x>e.max.x&&(e.max.x=i.x,l=!0),i.y<e.min.y?(e.min.y=i.y,l=!0):i.y>e.max.y&&(e.max.y=i.y,l=!0),((i.x===0||i.x===vt)&&i.x===s.x)!=((i.y===0||i.y===vt)&&i.y===s.y)&&this.processBorderOverlap(i,s),l&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ei(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>vt!=e.x>vt&&this.addBorderIntersection(1,ei(i.y,e.y,(vt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ei(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>vt!=e.y>vt&&this.addBorderIntersection(3,ei(i.x,e.x,(vt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Tt(0,0):new Tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function Mf(n,e){const i=n.add(e)._unit(),s=me(n.x*i.x+n.y*i.y,-1,1);var l,d,f;return l=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(l)))/4*Fv*((d=n).x*(f=e).y-d.y*f.x<0?-1:1)}const Bp=[n=>n.x<0,n=>n.x>vt,n=>n.y<0,n=>n.y>vt];function gh(n,e,i,s){const l=[4];if(s===0)return l;i._mult(s);const d=n.sub(i),f=e.sub(i),g=[n,e,d,f];for(let x=0;x<4;x++)for(const b of g)if(Bp[x](b)){l.push(x);break}return l}class cy{constructor(e){this.vertexArray=new ih,this.indexArray=new Sr,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut},i=>km.includes(i)),this._segments=new or,this.hiddenByLandmarkVertexArray=new oh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new or}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,l=!1){const d=e.length;if(d>2){let f=Math.max(0,this._segments.get().length-1);const g=this._segments._prepareSegment(4*d,this.vertexArray.length,2*this._segmentToGroundQuads[f].length);let x;f!==this._segments.get().length-1&&(f++,this._segmentToGroundQuads[f]=[],this._segmentToRegionTriCounts[f]=[0,0,0,0,0]);{const b=e[0],C=e[1];x=Mf(b.sub(e[d-1])._perp()._unit(),C.sub(b)._perp()._unit())}for(let b=0;b<d;b++){const C=b===d-1?0:b+1,M=e[b],R=e[C],P=e[C===d-1?0:C+1],F=R.sub(M)._perp()._unit(),V=Mf(F,P.sub(R)._perp()._unit()),q=x,$=V;if(Df(M,R,i)||l&&N_(M,i)&&N_(R,i)){x=V;continue}const te=g.vertexLength;kp(this.vertexArray,M,R,1,1,q),kp(this.vertexArray,M,R,1,0,q),kp(this.vertexArray,M,R,0,1,$),kp(this.vertexArray,M,R,0,0,$),g.vertexLength+=4;const ne=gh(M,R,F,s);for(const G of ne)this._segmentToGroundQuads[f].push({id:te,region:G}),this._segmentToRegionTriCounts[f][G]+=2,g.primitiveLength+=2;x=V}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((l,d)=>l.region-d.region);for(let s=0;s<i;s++){const l=this._segmentToGroundQuads[s],d=e[s],f=this._segmentToRegionTriCounts[s];f.reduce((x,b)=>x+b,0);let g=0;for(let x=0;x<=4;x++){const b=f[x];if(b!==0){let C=this.regionSegments[x];C||(C=this.regionSegments[x]=new or);const M={vertexOffset:d.vertexOffset,primitiveOffset:d.primitiveOffset+g,vertexLength:d.vertexLength,primitiveLength:b};C.get().push(M)}g+=b}for(let x=0;x<l.length;x++){const b=l[x].id;this.indexArray.emplaceBack(b,b+1,b+3),this.indexArray.emplaceBack(b,b+3,b+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,l,d,f,g){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,l,d,f,void 0,g)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,P_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,l,d,f,g,x){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,l,d,f,g,x)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const s=e.flags&bc?1:0;for(let l=e.groundVertexArrayOffset;l<i;++l)this.hiddenByLandmarkVertexArray.emplace(l,s);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ny.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Fp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Sr,this.footprintVertices=new No,this.footprintSegments=[],this.layoutVertexArray=new Kc,this.centroidVertexArray=new Tp,this.wallVertexArray=new hf,this.indexArray=new Sr,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut},i=>ly.includes(i)),this.segments=new or,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new cy(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,s,l){this.features=[],this.hasPattern=Mm("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ue(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:d,id:f,index:g,sourceLayerIndex:x}of e){const b=this.layers[0]._featureFilter.needGeometry,C=Dt(d,b);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),C,s))continue;const M={id:f,sourceLayerIndex:x,index:g,geometry:b?C.geometry:zt(d,s,l),properties:d.properties,type:d.type,patterns:{}},R=this.layoutVertexArray.length,P=Op[M.type]==="Polygon";if(this.hasPattern)this.features.push(Sf("fill-extrusion",this.layers,M,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const F of M.geometry)for(const V of B_(F,P))this.addFeature(M,[V],g,s,{},i.availableImages,l,i.brightness);else this.addFeature(M,M.geometry,g,s,{},i.availableImages,l,i.brightness);i.featureIndex.insert(d,M.geometry,g,x,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,l,d,f){for(const g of this.features){const x=Op[g.type]==="Polygon",{geometry:b}=g;if(this.wallMode)for(const C of b)for(const M of B_(C,x))this.addFeature(g,[M],g.index,i,s,l,d,f);else this.addFeature(g,b,g.index,i,s,l,d,f)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,l,d,f,g){this.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,this.worldview),this.groundEffect.update(e,i,d,s,l,f,g,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ry),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,iy.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Ov.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,zm.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,l,d,f,g,x){const b=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,C=[new Tt(0,0),new Tt(vt,vt)],M=g.projection,R=M.name==="globe",P=this.wallMode||Op[e.type]==="Polygon",F=new cu;F.centroidDataIndex=this.centroidData.length;const V=new lu,q=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,$=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);let te;if(V.height=$,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Qc),this.wallMode){if(R)return void vi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;te=function(Se){const Me=Se[0].x===Se[Se.length-1].x&&Se[0].y===Se[Se.length-1].y;(function(At){let mt=0;const _i=At.length;for(let Vt=0;Vt<_i;Vt++)mt+=(At[(Vt+1)%_i].x-At[Vt].x)*(At[(Vt+1)%_i].y+At[Vt].y);return mt>=0})(Se)||(Se=Se.reverse());const ct={geometry:[],joinNormals:[],indices:[]},et=[],at=[],ft=[];let He=Se.length;for(;He>=2&&Se[He-1].equals(Se[He-2]);)He--;if(He<(Me?3:2))return ct;let st,Ve,Ge,_t,yt,Qt=0;for(;Qt<He-1&&Se[Qt].equals(Se[Qt+1]);)Qt++;Me&&(st=Se[He-2],yt=Se[Qt].sub(st)._unit()._perp());for(let At=Qt;At<He;At++){if(Ge=At===He-1?Me?Se[Qt+1]:void 0:Se[At+1],Ge&&Se[At].equals(Ge))continue;yt&&(_t=yt),st&&(Ve=st),st=Se[At],yt=Ge?Ge.sub(st)._unit()._perp():_t,_t=_t||yt;let mt=_t.add(yt);mt.x===0&&mt.y===0||mt._unit();const _i=mt.x*yt.x+mt.y*yt.y,Vt=_i!==0?1/_i:1/0,Gt=_t.x*yt.y-_t.y*yt.x>0;let ri="miter";const Si=2;ri==="miter"&&Vt>Si&&(ri="bevel"),ri==="bevel"&&(Vt>100&&(ri="flipbevel"),Vt<Si&&(ri="miter"));const bi=(Di,Ei,zi,fn)=>{const Vn=new Tt(Di.x,Di.y),se=new Tt(Di.x,Di.y);Vn.x+=Ei.x*fn,Vn.y+=Ei.y*fn,se.x-=Ei.x*Math.max(zi,1),se.y-=Ei.y*Math.max(zi,1),ft.push(Ei),et.push(Vn),at.push(se)};if(ri==="miter")mt._mult(Vt),bi(st,mt,0,0);else if(ri==="flipbevel")mt=yt.mult(-1),bi(st,mt,0,0),bi(st,mt.mult(-1),0,0);else{const Di=-Math.sqrt(Vt*Vt-1),Ei=Gt?Di:0,zi=Gt?0:Di;Ve&&bi(st,_t,Ei,zi),Ge&&bi(st,yt,Ei,zi)}}ct.geometry=[...et,...at.reverse(),et[0]],ct.joinNormals=[...ft,...ft.reverse(),ft[ft.length-1]];const jt=ct.geometry.length-1;for(let At=0;At<jt/2;At++)if(At+1<jt/2){let mt=At,_i=At+1,Vt=jt-1-At,Gt=jt-2-At;mt=mt===0?jt-1:mt-1,_i=_i===0?jt-1:_i-1,Vt=Vt===0?jt-1:Vt-1,Gt=Gt===0?jt-1:Gt-1,ct.indices.push(Vt),ct.indices.push(_i),ct.indices.push(mt),ct.indices.push(Vt),ct.indices.push(Gt),ct.indices.push(_i)}return ct}(i[0]),i=[te.geometry]}const ne=(Se,Me)=>Se<(Me.length-1)/2||Se===Me.length-1,G=this.wallMode?[i]:zp(i,500);for(let Se=G.length-1;Se>=0;Se--){const Me=G[Se];(Me.length===0||(ee=Me[0]).every(je=>je.x<=0)||ee.every(je=>je.x>=vt)||ee.every(je=>je.y<=0)||ee.every(je=>je.y>=vt))&&G.splice(Se,1)}var ee;let re;if(R)re=U_(G,C,l);else{re=[];for(const Se of G)re.push({polygon:Se,bounds:C})}const ae=P?this.edgeRadius:0,Te=ae>0&&this.zoom<17,ve=(Se,Me)=>{if(Se.length===0)return!1;const je=Se[Se.length-1];return Me.x===je.x&&Me.y===je.y};for(const{polygon:Se,bounds:Me}of re){let je=0,ct=0;for(const He of Se)P&&!He[0].equals(He[He.length-1])&&He.push(He[0]),ct+=P?He.length-1:He.length;const et=this.segments.prepareSegment((P?5:4)*ct,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const at={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},ft=new au;if(ft.vertexOffset=this.footprintVertices.length,ft.indexOffset=3*this.footprintIndices.length,ft.ringIndices=[],P){const He=[],st=[];je=et.vertexLength;for(let Ge=0;Ge<Se.length;Ge++){const _t=Se[Ge];_t.length&&Ge!==0&&st.push(He.length/2);const yt=[];let Qt,jt;Qt=_t[1].sub(_t[0])._perp()._unit(),ft.ringIndices.push(_t.length-1);for(let At=1;At<_t.length;At++){const mt=_t[At],_i=_t[At===_t.length-1?1:At+1],Vt=mt.clone();if(ae){jt=_i.sub(mt)._perp()._unit();const Gt=Qt.add(jt)._unit(),ri=ae*Math.min(4,1/(Qt.x*Gt.x+Qt.y*Gt.y));Vt.x+=ri*Gt.x,Vt.y+=ri*Gt.y,Vt.x=Math.round(Vt.x),Vt.y=Math.round(Vt.y),Qt=jt}if(!q||ae!==0&&!Te||ve(yt,Vt)||yt.push(Vt),_h(this.layoutVertexArray,Vt.x,Vt.y,0,0,1,1,0),this.wallMode){const Gt=ne(At,_t);Ad(this.wallVertexArray,te.joinNormals[At],!Gt)}et.vertexLength++,this.footprintVertices.emplaceBack(mt.x,mt.y),He.push(mt.x,mt.y),R&&Cd(this.layoutVertexExtArray,M.projectTilePoint(Vt.x,Vt.y,l),M.upVector(l,Vt.x,Vt.y))}q&&(ae===0||Te)&&(yt.length!==0&&ve(yt,yt[0])&&yt.pop(),this.groundEffect.addData(yt,Me,b))}const Ve=this.wallMode?te.indices:gd(He,st);for(let Ge=0;Ge<Ve.length;Ge+=3)this.footprintIndices.emplaceBack(ft.vertexOffset+Ve[Ge+0],ft.vertexOffset+Ve[Ge+1],ft.vertexOffset+Ve[Ge+2]),this.indexArray.emplaceBack(je+Ve[Ge],je+Ve[Ge+2],je+Ve[Ge+1]),et.primitiveLength++;ft.indexCount+=Ve.length,ft.vertexCount+=this.footprintVertices.length-ft.vertexOffset}for(let He=0;He<Se.length;He++){const st=Se[He];F.startRing(V,st[0]);let Ve=st.length>4&&uy(st[st.length-2],st[0],st[1]),Ge=ae?Nv(st[st.length-2],st[0],st[1],ae):0;const _t=[];let yt,Qt,jt;Qt=st[1].sub(st[0])._perp()._unit();let At=!0;for(let mt=1,_i=0;mt<st.length;mt++){let Vt=st[mt-1],Gt=st[mt];const ri=st[mt===st.length-1?1:mt+1];if(F.appendEdge(V,Gt,Vt),Df(Gt,Vt,Me)){ae&&(Qt=ri.sub(Gt)._perp()._unit(),At=!At);continue}const Si=Gt.sub(Vt)._perp(),bi=Si.x/(Math.abs(Si.x)+Math.abs(Si.y)),Di=Si.y>0?1:0,Ei=Vt.dist(Gt);if(_i+Ei>32768&&(_i=0),ae){jt=ri.sub(Gt)._perp()._unit();let se=F_(Vt,Gt,ri,Rf(Qt,jt),ae);isNaN(se)&&(se=0);const ue=Gt.sub(Vt)._unit();Vt=Vt.add(ue.mult(Ge))._round(),Gt=Gt.add(ue.mult(-se))._round(),Ge=se,Qt=jt,q&&this.zoom>=17&&(ve(_t,Vt)||_t.push(Vt),ve(_t,Gt)||_t.push(Gt))}const zi=et.vertexLength,fn=st.length>4&&uy(Vt,Gt,ri);let Vn=Np(_i,Ve,At);if(_h(this.layoutVertexArray,Vt.x,Vt.y,bi,Di,0,0,Vn),_h(this.layoutVertexArray,Vt.x,Vt.y,bi,Di,0,1,Vn),this.wallMode){const se=ne(mt-1,st),ue=te.joinNormals[mt-1];Ad(this.wallVertexArray,ue,se),Ad(this.wallVertexArray,ue,se)}if(_i+=Ei,Vn=Np(_i,fn,!At),Ve=fn,_h(this.layoutVertexArray,Gt.x,Gt.y,bi,Di,0,0,Vn),_h(this.layoutVertexArray,Gt.x,Gt.y,bi,Di,0,1,Vn),this.wallMode){const se=ne(mt,st),ue=te.joinNormals[mt];Ad(this.wallVertexArray,ue,se),Ad(this.wallVertexArray,ue,se)}if(et.vertexLength+=4,this.indexArray.emplaceBack(zi+0,zi+1,zi+2),this.indexArray.emplaceBack(zi+1,zi+3,zi+2),et.primitiveLength+=2,ae){const se=je+(mt===1?st.length-2:mt-2),ue=mt===1?je:se+1;if(this.indexArray.emplaceBack(zi+1,se,zi+3),this.indexArray.emplaceBack(se,ue,zi+3),et.primitiveLength+=2,yt===void 0&&(yt=zi),!Df(ri,st[mt],Me)){const Xe=mt===st.length-1?yt:et.vertexLength;this.indexArray.emplaceBack(zi+2,zi+3,Xe),this.indexArray.emplaceBack(zi+3,Xe+1,Xe),this.indexArray.emplaceBack(zi+3,ue,Xe+1),et.primitiveLength+=3}At=!At}if(R){const se=this.layoutVertexExtArray,ue=M.projectTilePoint(Vt.x,Vt.y,l),Xe=M.projectTilePoint(Gt.x,Gt.y,l),bt=M.upVector(l,Vt.x,Vt.y),Ct=M.upVector(l,Gt.x,Gt.y);Cd(se,ue,bt),Cd(se,ue,bt),Cd(se,Xe,Ct),Cd(se,Xe,Ct)}}P&&(je+=st.length-1),q&&ae&&this.zoom>=17&&(_t.length!==0&&ve(_t,_t[0])&&_t.pop(),this.groundEffect.addData(_t,Me,b,ae>0))}this.footprintSegments.push(ft),at.triangleCount=this.indexArray.length-at.triangleArrayOffset,this.polygonSegments.push(at),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=F.borders?Bm:this.encodeCentroid(F,V),this.centroidData.push(V),F.borders){this.featuresOnBorder.push(F);const Se=this.featuresOnBorder.length-1;for(let Me=0;Me<F.borders.length;Me++)F.borders[Me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Me].push(Se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,l,x,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,s,d,f,l,x,this.worldview),this.maxHeight=Math.max(this.maxHeight,$)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let g=0;g<this.centroidData.length;g++){const x=this.centroidData[g],b=+(x.min.y+x.max.y>vt),C=2*b+(+(x.min.x+x.max.x>vt)^b);for(let M=0;M<x.polygonSegLen;M++){const R=x.polygonSegIdx+M;e.push({centroidIdx:g,subtile:C,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const i=new Sr;e.sort((g,x)=>g.triangleSegmentIdx===x.triangleSegmentIdx?g.subtile-x.subtile:g.triangleSegmentIdx-x.triangleSegmentIdx);let s=0,l=0,d=0;for(const g of e){if(g.triangleSegmentIdx!==s)break;d++}const f=e.length;for(;l!==e.length;){s=e[l].triangleSegmentIdx;let g=0,x=l,b=l;for(let C=x;C<d&&e[C].subtile===g;C++)b++;for(;x!==d;){const C=e[x];g=C.subtile;const M=this.centroidData[C.centroidIdx].min.clone(),R=this.centroidData[C.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let F=x;F<b;F++){const V=e[F],q=this.polygonSegments[V.polygonSegmentIdx],$=this.centroidData[V.centroidIdx].min,te=this.centroidData[V.centroidIdx].max,ne=this.indexArray.uint16;for(let G=q.triangleArrayOffset;G<q.triangleArrayOffset+q.triangleCount;G++)i.emplaceBack(ne[3*G],ne[3*G+1],ne[3*G+2]);P.primitiveLength+=q.triangleCount,M.x=Math.min(M.x,$.x),M.y=Math.min(M.y,$.y),R.x=Math.max(R.x,te.x),R.y=Math.max(R.y,te.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:M,max:R}),x=b;for(let F=x;F<d&&e[F].subtile===e[x].subtile;F++)b++}l=d;for(let C=l;C<f&&e[C].triangleSegmentIdx===e[l].triangleSegmentIdx;C++)d++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const l=new or;if(this.wallMode){for(const V of this.triangleSubSegments)l.segments.push(V.segment);return l}let d=0,f=0;const g=1<<e.canonical.z;if(i){const V=i.getMinMaxForTile(e);V&&(d=V.min,f=V.max)}f+=this.maxHeight;const x=e.toUnwrapped();let b;const C=[x.canonical.x/g+x.wrap,x.canonical.y/g],M=[(x.canonical.x+1)/g+x.wrap,(x.canonical.y+1)/g],R=(V,q,$)=>[V[0]*(1-$[0])+q[0]*$[0],V[1]*(1-$[1])+q[1]*$[1]],P=[],F=[];for(const V of this.triangleSubSegments){P[0]=V.min.x/vt,P[1]=V.min.y/vt,F[0]=V.max.x/vt,F[1]=V.max.y/vt;const q=R(C,M,P),$=R(C,M,F);if(new Hi([q[0],q[1],d],[$[0],$[1],f]).intersectsPrecise(s)===0){b&&(l.segments.push(b),b=void 0);continue}const te=V.segment;b&&b.vertexOffset!==te.vertexOffset&&(l.segments.push(b),b=void 0),b?(b.vertexLength+=te.vertexLength,b.primitiveLength+=te.primitiveLength):b={vertexOffset:te.vertexOffset,primitiveLength:te.primitiveLength,vertexLength:te.vertexLength,primitiveOffset:te.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&l.segments.push(b),l}encodeCentroid(e,i){const s=e.centroid(),l=i.span(),d=Math.min(7,Math.round(l.x*this.tileToMeter/10)),f=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new Tt(me(s.x,1,vt-1)<<3|d,me(s.y,1,vt-1)<<3|f)}encodeBorderCentroid(e){if(!e.borders)return new Tt(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const l=i[0][0]!==s?0:1;return new Tt(6|(i[0][0]!==s?0:65528),(i[l][0]+i[l][1])/2<<3|6)}{const l=i[2][0]!==s?2:3;return new Tt((i[l][0]+i[l][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=bc,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,l=e.flags&bc?Bm:e.centroidXY,d=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==l.y||d!==l.x){for(let f=i;f<s;++f)this.centroidVertexArray.emplace(f,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());if(Cf(this.activeReplacements,l))return;if(this.activeReplacements=l,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const f of this.centroidData)f.flags&=2147483647;const d=[];for(const f of this.activeReplacements){if(f.order<s)continue;const g=Math.max(1,Math.pow(2,f.footprintTileId.canonical.z-e.canonical.z));for(const x of this.centroidData)if(!(x.flags&bc||f.min.x>x.max.x||x.min.x>f.max.x||f.min.y>x.max.y||x.min.y>f.max.y))for(let b=0;b<x.footprintSegLen;b++){const C=this.footprintSegments[x.footprintSegIdx+b];if(d.length=0,Vp(this.footprintVertices,C.vertexOffset,C.vertexCount,f.footprintTileId.canonical,e.canonical,d),If(f.footprint,d,this.footprintIndices.uint16,C.indexOffset,C.indexCount,-C.vertexOffset,-g)){x.flags|=bc;break}}}for(const f of this.centroidData)this.writeCentroidToBuffer(f);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let l=!1;for(let d=0;d<s.footprintSegLen;d++){const f=this.footprintSegments[s.footprintSegIdx+d];let g=0;for(const x of f.ringIndices){for(let b=g,C=x+g-1;b<x+g;C=b++){const M=this.footprintVertices.int16[2*(b+f.vertexOffset)+0],R=this.footprintVertices.int16[2*(b+f.vertexOffset)+1],P=this.footprintVertices.int16[2*(C+f.vertexOffset)+1];R>i!=P>i&&e<(this.footprintVertices.int16[2*(C+f.vertexOffset)+0]-M)*(i-R)/(P-R)+M&&(l=!l)}g=x}}return l}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,l=!0;const d=4*(e+vt)*vt+(i+vt);if(this.partLookup.hasOwnProperty(d)){const f=this.partLookup[d];return f?{height:f.height,hidden:!!(f.flags&bc)}:void 0}for(const f of this.centroidData)e>f.max.x||f.min.x>e||i>f.max.y||f.min.y>i||this.footprintContainsPoint(e,i,f)&&f&&f.height>s&&(s=f.height,this.partLookup[d]=f,l=!!(f.flags&bc));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:l};this.partLookup[d]=void 0}}function Rf(n,e){const i=n.add(e)._unit();return n.x*i.x+n.y*i.y}function Nv(n,e,i,s){const l=e.sub(n)._perp()._unit(),d=i.sub(e)._perp()._unit();return F_(n,e,i,Rf(l,d),s)}function F_(n,e,i,s,l){const d=Math.sqrt(1-s*s);return Math.min(n.dist(e)/3,e.dist(i)/3,l*d/s)}function Df(n,e,i){return n.x<i[0].x&&e.x<i[0].x||n.x>i[1].x&&e.x>i[1].x||n.y<i[0].y&&e.y<i[0].y||n.y>i[1].y&&e.y>i[1].y}function N_(n,e){return n.x<e[0].x||n.x>e[1].x||n.y<e[0].y||n.y>e[1].y}function uy(n,e,i){if(n.x<0||n.x>=vt||e.x<0||e.x>=vt||i.x<0||i.x>=vt)return!1;const s=i.sub(e),l=s.perp(),d=n.sub(e);return(s.x*d.x+s.y*d.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(d.x*d.x+d.y*d.y))>-.866&&l.x*d.x+l.y*d.y<0}function Np(n,e,i){const s=e?2|n:-3&n;return i?1|s:-2&s}function Up(){const n=Math.PI/32,e=Math.tan(n),i=X;return i*Math.sqrt(1+2*e*e)-i}function U_(n,e,i){const s=1<<i.z,l=be(i.x/s),d=be((i.x+1)/s),f=De(i.y/s),g=De((i.y+1)/s);return function(x,b,C,M,R=0,P){const F=[];if(!x.length||!C||!M)return F;const V=(re,ae)=>{for(const Te of re)F.push({polygon:Te,bounds:ae})},q=Math.ceil(Math.log2(C)),$=Math.ceil(Math.log2(M)),te=q-$,ne=[];for(let re=0;re<Math.abs(te);re++)ne.push(te>0?0:1);for(let re=0;re<Math.min(q,$);re++)ne.push(0),ne.push(1);let G=x;if(G=Rm(G,b[0].y-R,b[1].y+R,1),G=Rm(G,b[0].x-R,b[1].x+R,0),!G.length)return F;const ee=[];for(ne.length?ee.push({polygons:G,bounds:b,depth:0}):V(G,b);ee.length;){const re=ee.pop(),ae=re.depth,Te=ne[ae],ve=re.bounds[0],Se=re.bounds[1],Me=Te===0?ve.x:ve.y,je=Te===0?Se.x:Se.y,ct=P?P(Te,Me,je):.5*(Me+je),et=Rm(re.polygons,Me-R,ct+R,Te),at=Rm(re.polygons,ct-R,je+R,Te);if(et.length){const ft=[ve,new Tt(Te===0?ct:Se.x,Te===1?ct:Se.y)];ne.length>ae+1?ee.push({polygons:et,bounds:ft,depth:ae+1}):V(et,ft)}if(at.length){const ft=[new Tt(Te===0?ct:ve.x,Te===1?ct:ve.y),Se];ne.length>ae+1?ee.push({polygons:at,bounds:ft,depth:ae+1}):V(at,ft)}}return F}(n,e,Math.ceil((d-l)/11.25),Math.ceil((f-g)/11.25),1,(x,b,C)=>{if(x===0)return .5*(b+C);{const M=De((i.y+b/vt)/s);return(he(.5*(De((i.y+C/vt)/s)+M))*s-i.y)*vt}})}function Vp(n,e,i,s,l,d){const f=Math.pow(2,s.z-l.z);for(let g=0;g<i;g++){let x=n.int16[2*(g+e)+0],b=n.int16[2*(g+e)+1];x=(x+l.x*vt)*f-s.x*vt,b=(b+l.y*vt)*f-s.y*vt,d.push(new Tt(x,b))}}let Fm,jp;Pt(Fp,"FillExtrusionBucket",{omit:["layers","features"]}),Pt(lu,"PartData"),Pt(au,"FootprintSegment"),Pt(cu,"BorderCentroidData"),Pt(cy,"GroundEffect");class yh extends Tt{constructor(e,i,s){super(e,i),this.z=s}}class hy extends yh{constructor(e,i,s,l){super(e,i,s),this.w=l}}function Gp(n,e,i,s){const l=i==="x"?"y":"x",d=(s-n[i])/(e[i]-n[i]);n[l]=Math.round(n[l]+(e[l]-n[l])*d),n[i]=s,n.hasOwnProperty("z")&&(n.z=ei(n.z,e.z,d)),n.hasOwnProperty("w")&&(n.w=ei(n.w,e.w,d))}function a(n,e,i,s){const l=i,d=s;for(const f of["x","y"]){let g=n,x=e;g[f]>=x[f]&&(g=e,x=n),g[f]<l&&x[f]>l&&Gp(g,x,f,l),g[f]<d&&x[f]>d&&Gp(x,g,f,d)}}function h(n,e,i,s,l,d){const f=[];for(let g=0;g<n.length;g++){const x=n[g];let b;const C=f.length;let M=0;for(let R=0;R<x.length-1;R++){let P=x[R],F=x[R+1],V=0;const q=M;let $,te;d&&(V=Math.hypot(F.x-P.x,F.y-P.y),M+=V,$=P,te=F),P.x<e&&F.x<e||(P.x<e?P=new Tt(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x<e&&(F=new Tt(e,P.y+(e-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y<i&&F.y<i||(P.y<i?P=new Tt(P.x+(i-P.y)/(F.y-P.y)*(F.x-P.x),i)._round():F.y<i&&(F=new Tt(P.x+(i-P.y)/(F.y-P.y)*(F.x-P.x),i)._round()),P.x>=s&&F.x>=s||(P.x>=s?P=new Tt(s,P.y+(s-P.x)/(F.x-P.x)*(F.y-P.y))._round():F.x>=s&&(F=new Tt(s,P.y+(s-P.x)/(F.x-P.x)*(F.y-P.y))._round()),P.y>=l&&F.y>=l||(P.y>=l?P=new Tt(P.x+(l-P.y)/(F.y-P.y)*(F.x-P.x),l)._round():F.y>=l&&(F=new Tt(P.x+(l-P.y)/(F.y-P.y)*(F.x-P.x),l)._round()),b&&P.equals(b[b.length-1])||(b=[P],f.push(b),d&&d.push({progress:{min:q+S($,te,P)*V,max:1},parentIndex:g,prevPoint:$,nextPoint:te})),b.push(F),d&&(d[d.length-1].progress.max=q+S($,te,F)*V,d[d.length-1].nextPoint=te)))))}if(d&&M>0)for(let R=C;R<f.length;R++)d[R].progress.min/=M,d[R].progress.max/=M}return f}function y(n,e,i,s,l){if(n.length<2)return void s.push(n);const d=[];for(;e.valid();){const[b,C]=e.get();for(let M=0;M<n.length-1;M++){const R=n[M],P=n[M+1],F=Qa(R,P,b,C);if(F){const[V]=F,q=new Tt(ei(R.x,P.x,V),ei(R.y,P.y,V));d.push({t:M+V,distance:0,point:q})}}e.next()}if(d.length===0)return void s.push(n);d.sort((b,C)=>b.t-C.t);let f=0,g=0,x=[];for(s.push(x);f!==n.length;){if(g===d.length){for(;f!==n.length;)x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++;break}d[g].t<=f?(x.length!==0&&x[x.length-1].equals(d[g].point)||x.push(d[g].point),Math.trunc(d[g].t),g++):(x.length!==0&&x[x.length-1].equals(n[f])||x.push(n[f]),f++)}}function S(n,e,i){return n.x!==e.x?(i.x-n.x)/(e.x-n.x):n.y!==e.y?(i.y-n.y)/(e.y-n.y):0}function z(n,e){return n.x*e.x+n.y*e.y}function U(n,e){if(n.length===1){let i=0;const s=e[i++];let l;for(;!l||s.equals(l);)if(l=e[i++],!l)return 1/0;for(;i<e.length;i++){const d=e[i],f=n[0],g=l.sub(s),x=d.sub(s),b=f.sub(s),C=z(g,g),M=z(g,x),R=z(x,x),P=z(b,g),F=z(b,x),V=C*R-M*M,q=(R*P-M*F)/V,$=(C*F-M*P)/V,te=s.z*(1-q-$)+l.z*q+d.z*$;if(isFinite(te))return te}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function ie(n,e,i,s,l,d,f,g){const x=f*l.getElevationAt(n,e,!0,!0),b=d[0]!==0,C=b?d[1]===0?f*(d[0]/7-450):f*function(M,R,P){const F=Math.floor(R[0]/8),V=Math.floor(R[1]/8),q=10*(R[0]-8*F),$=10*(R[1]-8*V),te=M.getElevationAt(F,V,!0,!0),ne=M.getMeterToDEM(P),G=Math.floor(.5*(q*ne-1)),ee=Math.floor(.5*($*ne-1)),re=M.tileCoordToPixel(F,V),ae=2*G+1,Te=2*ee+1,ve=function(at,ft,He,st,Ve){return[at.getElevationAtPixel(ft,He,!0),at.getElevationAtPixel(ft+Ve,He,!0),at.getElevationAtPixel(ft,He+Ve,!0),at.getElevationAtPixel(ft+st,He+Ve,!0)]}(M,re.x-G,re.y-ee,ae,Te),Se=Math.abs(ve[0]-ve[1]),Me=Math.abs(ve[2]-ve[3]),je=Math.abs(ve[0]-ve[2])+Math.abs(ve[1]-ve[3]),ct=Math.min(.25,.5*ne*(Se+Me)/ae),et=Math.min(.25,.5*ne*je/Te);return te+Math.max(ct*q,et*$)}(l,d,g):x;return{base:x+(i===0?-1:i),top:b?Math.max(C+s,x+i+2):x+s}}class ge{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Pe{constructor(){this.tasks={},this.taskQueue=[],Ft(["process"],this),this.invoker=new ge(this.process),this.nextId=0}add(e,i){const s=this.nextId++,l=function({type:d,isSymbolTile:f,zoom:g}){return g=g||0,d==="message"?0:d!=="maybePrepare"||f?d!=="parseTile"||f?d==="parseTile"&&f?300-g:d==="maybePrepare"&&f?400-g:500:200-g:100-g}(i);if(l===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:l,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let l=0;l<this.taskQueue.length;l++){const d=this.tasks[this.taskQueue[l]];d.priority<i&&(i=d.priority,e=l)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class lt{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Ft(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new Pe}send(e,i,s,l,d=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=f,this.callbacks[g]=s);const x=new Set;return this.target.postMessage({id:g,type:e,hasCallback:!!s,targetMapId:l,mustQueue:d,sourceMapId:this.mapId,data:Fa(i,x)},x),{cancel:()=>{s&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const l=this.cancelCallbacks[s];delete this.cancelCallbacks[s],l&&l.cancel()}else if(i.mustQueue||tn(self)){const l=this.callbacks[s],d=this.scheduler.add(()=>this.processTask(s,i),l&&l.metadata||{type:"message"});d&&(this.cancelCallbacks[s]=d)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Na(i.error)):s(null,Na(i.data)))}else{const s=new Set,l=i.hasCallback?(f,g)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?Fa(f):null,data:Fa(g,s)},s)}:()=>{},d=Na(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,d,l);else if(this.parent.getWorkerSource){const f=i.type.split("."),{source:g,scope:x}=d;this.parent.getWorkerSource(i.sourceMapId,f[0],g,x)[f[1]](d,l)}else l(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Mt={workerUrl:"",workerClass:null,workerParams:void 0};const Nt="mapboxgl_preloaded_worker_pool";class ut{constructor(){this.active={}}acquire(e,i=ut.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(Mt.workerClass!=null?new Mt.workerClass:new self.Worker(Mt.workerUrl,Mt.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Nt]}numActive(){return Object.keys(this.active).length}}ut.workerCount=2;class pt{constructor(e,i,s="Worker",l=ut.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ne();const d=this.workerPool.acquire(this.id,l);for(let f=0;f<d.length;f++){const g=new pt.Actor(d[f],i,this.id);g.name=`${s} ${f}`,this.actors.push(g)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){Ae(this.actors,(l,d)=>{l.send(e,i,d)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let $i,Zi;function gr(){return $i||($i=new ut),$i}pt.Actor=lt;class it{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,s/i.BYTES_PER_ELEMENT),s}createFloatArray(e){const i=new Float32Array(e),s=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,s/i.BYTES_PER_ELEMENT),s}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let s=0;s<e.length;++s)this.module.heapU8[i+s]=e.charCodeAt(s);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,s=e.facadeGlazingColorRgb,l=e.roofColorRgb,d=e.wallColorRgb,f=e.normalScale;this.module.setStyle(i[0],i[1],i[2],s[0],s[1],s[2],l[0],l[1],l[2],d[0],d[1],d[2],f[0],f[1],f[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,s){this.module.setFacadeOptions(e,i,s)}generateMesh(e,i){for(const g of e){const x=this.createStringBuffer(g.roofType),b=[0],C=[];for(const P of g.coordinates)if(Array.isArray(P)){for(const F of P)C.push(F.x),C.push(F.y);b.push(C.length)}const M=this.createIntArray(b),R=this.createFloatArray(C);this.module.addFeature(g.id,g.sourceId,g.minHeight,g.height,x,g.roofType.length,R,M,b.length-1),this.module.free(x),this.module.free(M),this.module.free(R)}for(const g of i){let x;x=g.entrances?JSON.parse(g.entrances):[];const b=this.createFloatArray(x),C=[];for(const R of g.coordinates)C.push(R.x),C.push(R.y);const M=this.createFloatArray(C);this.module.addFacade(g.sourceId,g.crossPerc,g.distanceToRoad,b,x.length,M,C.length),this.module.free(b),this.module.free(M)}if(!this.module.generateMesh()){const g=this.module.getLastError();return this.readStringBuffer(g)}const s=this.module.getMeshCount(),l=new Array(s);for(let g=0;g<s;g++){const x=this.module.getPositionsPtr(g),b=this.module.getPositionsLength(g),C=new Float32Array(this.module.heapF32.buffer,x,b),M=this.module.getNormalsPtr(g),R=this.module.getNormalsLength(g),P=new Float32Array(this.module.heapF32.buffer,M,R),F=this.module.getColorsPtr(g),V=this.module.getColorsLength(g),q=new Uint8Array(this.module.heapU8.buffer,F,V),$=this.module.getAOPtr(g),te=this.module.getAOLength(g),ne=new Float32Array(this.module.heapF32.buffer,$,te),G=this.module.getIndicesPtr(g),ee=this.module.getIndicesLength(g),re=new Int32Array(this.module.heap32.buffer,G,ee),ae=this.module.getBuildingPart(g),Te=this.readStringBuffer(ae);l[g]={positions:C,normals:P,colors:q,ao:ne,indices:re,buildingPart:Te}}const d=this.module.getRingCount(),f=[];for(let g=0;g<d;g++){const x=this.module.getRingPtr(g),b=this.module.getRingLength(g),C=new Float32Array(this.module.heapF32.buffer,x,b);f.push(C)}return{meshes:l,modifiedPolygonRings:f}}}let Ze,ot,It,xi,Dn,Ri=null,qi=null,Ds=null,ur=null;function uu(){return tn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ot||Qr.DRACO_URL}function dy(){if(tn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(xi)return xi;const n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return xi=WebAssembly.validate(n)?Qr.MESHOPT_SIMD_URL:Qr.MESHOPT_URL,xi}const fy={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},tE={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},V_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function $x(n,e,i){const s=i.json.bufferViews.length,l=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:l,byteLength:n.byteLength},i.buffers[l]=n}const Uv="KHR_draco_mesh_compression";function iE(n,e){const i=n.extensions&&n.extensions[Uv];if(!i)return;const s=new It.Decoder,l=Jx(e,i.bufferView),d=new It.Mesh;if(!s.DecodeArrayToMesh(l,l.byteLength,d))throw new Error("Failed to decode Draco mesh");const f=e.json.accessors[n.indices],g=fy[f.componentType],x=f.count*g.BYTES_PER_ELEMENT,b=It._malloc(x);g===Uint16Array?s.GetTrianglesUInt16Array(d,x,b):s.GetTrianglesUInt32Array(d,x,b),$x(It.memory.buffer.slice(b,b+x),f,e),It._free(b);for(const C of Object.keys(i.attributes)){const M=s.GetAttributeByUniqueId(d,i.attributes[C]),R=e.json.accessors[n.attributes[C]],P=tE[R.componentType],F=R.count*V_[R.type]*fy[R.componentType].BYTES_PER_ELEMENT,V=It._malloc(F);s.GetAttributeDataArrayForAllPoints(d,M,It[P],F,V),$x(It.memory.buffer.slice(V,V+F),R,e),It._free(V)}s.destroy(),d.destroy(),delete n.extensions[Uv]}const py="EXT_meshopt_compression";function nE(n,e){if(!n.extensions||!n.extensions[py])return;const i=n.extensions[py],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),l=new Uint8Array(i.count*i.byteStride);Dn.decodeGltfBuffer(l,i.count,i.byteStride,s,i.mode,i.filter),n.buffer=e.buffers.length,n.byteOffset=0,e.buffers[n.buffer]=l.buffer,delete n.extensions[py]}const Yx=1179937895,Kx=new TextDecoder("utf8");function Qx(n,e){return new URL(n,e).href}function rE(n,e,i,s){return fetch(Qx(n.uri,s)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[i]=l})}function Jx(n,e){const i=n.json.bufferViews[e];return new Uint8Array(n.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function sE(n,e,i,s){if(n.uri){const l=Qx(n.uri,s);return fetch(l).then(d=>d.blob()).then(d=>createImageBitmap(d)).then(d=>{e.images[i]=d})}if(n.bufferView!==void 0){const l=Jx(e,n.bufferView),d=new Blob([l],{type:n.mimeType});return createImageBitmap(d).then(f=>{e.images[i]=f})}}function e1(n,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(n,e,1)[0]===Yx){const C=new Uint32Array(n,e);let M=2;const R=(C[M++]>>2)-3,P=C[M++]>>2;if(M++,s.json=JSON.parse(Kx.decode(C.subarray(M,M+P))),M+=P,M<R){const F=C[M++];M++;const V=e+(M<<2);s.buffers[0]=n.slice(V,V+F)}}else s.json=JSON.parse(Kx.decode(new Uint8Array(n,e)));const{buffers:l,images:d,meshes:f,extensionsUsed:g,bufferViews:x}=s.json;let b=Promise.resolve();if(l){const C=[];for(let M=0;M<l.length;M++){const R=l[M];R.uri?C.push(rE(R,s,M,i)):s.buffers[M]||(s.buffers[M]=null)}b=Promise.all(C)}return b.then(()=>{const C=[],M=g&&g.includes(Uv),R=g&&g.includes(py);if(M&&C.push(function(){if(!It)return Ze??(Ze=function(P){let F,V=null;function q(){F=new Uint8Array(V.buffer)}function $(){throw new Error("Unexpected Draco error.")}const te={a:{a:$,d:function(ne,G,ee){return F.copyWithin(ne,G,G+ee)},c:function(ne){const G=F.length,ee=Math.max(ne>>>0,Math.ceil(1.2*G)),re=Math.ceil((ee-G)/65536);try{return V.grow(re),q(),!0}catch{return!1}},b:$}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,te):P.then(ne=>ne.arrayBuffer()).then(ne=>WebAssembly.instantiate(ne,te))).then(ne=>{const{Rb:G,Qb:ee,P:re,T:ae,X:Te,Ja:ve,La:Se,Qa:Me,Va:je,Wa:ct,eb:et,jb:at,f:ft,e:He,yb:st,zb:Ve,Ab:Ge,Bb:_t,Db:yt,Gb:Qt}=ne.instance.exports;V=He;const jt=(()=>{let At=0,mt=0,_i=0,Vt=0;return Gt=>{_i&&(G(Vt),G(At),mt+=_i,_i=At=0),At||(mt+=128,At=ee(mt));const ri=Gt.length+7&-8;let Si=At;ri>=mt&&(_i=ri,Si=Vt=ee(ri));for(let bi=0;bi<Gt.length;bi++)F[Si+bi]=Gt[bi];return Si}})();return q(),ft(),{memory:He,_free:G,_malloc:ee,Mesh:class{constructor(){this.ptr=re()}destroy(){ae(this.ptr)}},Decoder:class{constructor(){this.ptr=ve()}destroy(){at(this.ptr)}DecodeArrayToMesh(At,mt,_i){const Vt=jt(At),Gt=Se(this.ptr,Vt,mt,_i.ptr);return!!Te(Gt)}GetAttributeByUniqueId(At,mt){return{ptr:Me(this.ptr,At.ptr,mt)}}GetTrianglesUInt16Array(At,mt,_i){je(this.ptr,At.ptr,mt,_i)}GetTrianglesUInt32Array(At,mt,_i){ct(this.ptr,At.ptr,mt,_i)}GetAttributeDataArrayForAllPoints(At,mt,_i,Vt,Gt){et(this.ptr,At.ptr,mt.ptr,_i,Vt,Gt)}},DT_INT8:st(),DT_UINT8:Ve(),DT_INT16:Ge(),DT_UINT16:_t(),DT_UINT32:yt(),DT_FLOAT32:Qt()}})}(fetch(uu())),Ze.then(P=>{It=P,Ze=void 0}))}()),R&&C.push(function(){if(Dn)return;const P=function(F){let V;const q=WebAssembly.instantiateStreaming(F,{}).then(ne=>{V=ne.instance,V.exports.__wasm_call_ctors()}),$={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},te={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:q,supported:!0,decodeGltfBuffer(ne,G,ee,re,ae,Te){(function(ve,Se,Me,je,ct,et,at){const ft=ve.exports.sbrk,He=je+3&-4,st=ft(He*ct),Ve=ft(et.length),Ge=new Uint8Array(ve.exports.memory.buffer);Ge.set(et,Ve);const _t=Se(st,je,ct,Ve,et.length);if(_t===0&&at&&at(st,He,ct),Me.set(Ge.subarray(st,st+je*ct)),ft(st-ft(0)),_t!==0)throw new Error(`Malformed buffer data: ${_t}`)})(V,V.exports[te[ae]],ne,G,ee,re,V.exports[$[Te]])}}}(fetch(dy()));return P.ready.then(()=>{Dn=P})}()),d)for(let P=0;P<d.length;P++)C.push(sE(d[P],s,P,i));return(C.length?Promise.all(C):Promise.resolve()).then(()=>{if(M&&f)for(const{primitives:P}of f)for(const F of P)iE(F,s);if(R&&f&&x)for(const P of x)nE(P,s);return s})})}class t1{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(ur!=null||Ds!=null)return null;if(qi!=null)return qi;const e=fetch(Qr.BUILDING_GEN_URL);return qi=function(i){let s,l,d,f;function g(){s=new Uint8Array(f.buffer),l=new Int32Array(f.buffer),d=new Float32Array(f.buffer)}function x(){throw new Error("Unexpected BuildingGen error.")}const b=()=>{},C={a:{a:x,f:function(M){const R=s.length,P=Math.max(M>>>0,Math.ceil(1.2*R)),F=Math.ceil((P-R)/65536);try{return f.grow(F),g(),!0}catch{return!1}},g:x,b,c:b,d:b,e:b}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,C):i.then(M=>M.arrayBuffer()).then(M=>WebAssembly.instantiate(M,C))).then(M=>{const R=M.instance.exports;return(0,R.g)(),f=R.f,g(),new it({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setFacadeOptions:R.k,addFeature:R.l,addFacade:R.m,generateMesh:R.n,getLastError:R.o,getMeshCount:R.p,getPositionsPtr:R.q,getPositionsLength:R.r,getNormalsPtr:R.s,getNormalsLength:R.t,getColorsPtr:R.u,getColorsLength:R.v,getAOPtr:R.w,getAOLength:R.x,getIndicesPtr:R.y,getIndicesLength:R.z,getBuildingPart:R.A,getRingCount:R.B,getRingPtr:R.C,getRingLength:R.D,free:R.E,malloc:R.F,heapU8:s,heap32:l,heapF32:d})})}(e).then(i=>(qi=null,ur=i,ur)).catch(i=>{vi("Could not load building-gen"),qi=null,Ds=i}),qi}()}populate(e,i,s,l){}update(e,i,s,l,d,f,g){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let i1,n1;Pt(t1,"BuildingBucket",{omit:["layers"]});const oE=Gi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),aE=Gi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:lE}=oE,cE=Gi([{name:"a_packed",components:3,type:"Float32"}]),{members:uE}=cE,hE=Gi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:dE}=hE;class r1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new ya({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=xt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const l=[];let d=e.length%2==1?-e[e.length-1]*s:0,f=e[0]*s,g=!0;l.push({left:d,right:f,isDash:g,zeroLength:e[0]===0});let x=e[0];for(let b=1;b<e.length;b++){g=!g;const C=e[b];d=x*s,x+=C,f=x*s,l.push({left:d,right:f,isDash:g,zeroLength:C===0})}return l}addRoundDash(e,i,s){const l=i/2;for(let d=-s;d<=s;d++){const f=this.width*(this.nextRow+s+d);let g=0,x=e[g];for(let b=0;b<this.width;b++){b/x.right>1&&(x=e[++g]);const C=Math.abs(b-x.left),M=Math.abs(b-x.right),R=Math.min(C,M);let P;const F=d/s*(l+1);if(x.isDash){const V=l-Math.abs(F);P=Math.sqrt(R*R+V*V)}else P=l-Math.sqrt(R*R+F*F);this.image.data[f+b]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,i){for(let x=e.length-1;x>=0;--x){const b=e[x],C=e[x+1];b.zeroLength?e.splice(x,1):C&&C.isDash===b.isDash&&(C.left=b.left,e.splice(x,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const d=this.width*this.nextRow;let f=0,g=e[f];for(let x=0;x<this.width;x++){x/g.right>1&&(g=e[++f]);const b=Math.abs(x-g.left),C=Math.abs(x-g.right),M=Math.min(b,C);this.image.data[d+x]=Math.max(0,Math.min(255,(g.isDash?M:-M)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const l=i==="round",d=l?7:0,f=2*d+1;if(this.nextRow+f>this.height)return vi("LineAtlas out of space"),null;e.length===0&&e.push(1);let g=0;for(let C=0;C<e.length;C++)e[C]<0&&(vi("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),g+=e[C];if(g!==0){const C=this.width/g,M=this.getDashRanges(e,this.width,C);l?this.addRoundDash(M,C,d):this.addRegularDash(M,i==="square"?.5*C:0)}const x=this.nextRow+d;this.nextRow+=f;const b={tl:[x,d],br:[g,0]};return this.positions[s]=b,b}}Pt(r1,"LineAtlas");const fE=mi.VectorTileFeature.types,pE=Math.cos(Math.PI/180*37.5),mE=Math.cos(Math.PI/180*5);class Vv{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new fc,this.layoutVertexArray2=new uo,this.patternVertexArray=new uo,this.indexArray=new Sr,this.programConfigurations=new c(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new or,this.maxLineLength=0,this.zOffsetVertexArray=new uo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:vt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,s,l){this.hasPattern=Mm("line",this.layers,this.pixelRatio,i);const d=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ue(s);const f=this.layers[0].layout.get("line-elevation-reference");if(f==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),P=R.isConstant()&&!R.constantOr(0);this.elevationType=f!=="sea"&&f!=="ground"&&P?"none":"offset",this.elevationType==="offset"&&f==="none"&&vi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const g=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&g!==void 0;const x=[];for(const{feature:R,id:P,index:F,sourceLayerIndex:V}of e){const q=this.layers[0]._featureFilter.needGeometry,$=Dt(R,q);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),$,s))continue;const te=d?d.evaluate($,{},s):void 0,ne={id:P,properties:R.properties,type:R.type,sourceLayerIndex:V,index:F,geometry:q?$.geometry:zt(R,s,l),patterns:{},sortKey:te};x.push(ne)}d&&x.sort((R,P)=>R.sortKey-P.sortKey);const{lineAtlas:b,featureIndex:C}=i,M=this.addConstantDashes(b);for(const R of x){const{geometry:P,index:F,sourceLayerIndex:V}=R;if(M&&this.addFeatureDashes(R,b),this.hasPattern){const q=Sf("line",this.layers,R,this.zoom,this.pixelRatio,i);this.patternFeatures.push(q)}else this.addFeature(R,P,F,s,b.positions,i.availableImages,i.brightness,i.elevationFeatures);C.insert(e[F].feature,P,F,V,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const l=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if(l.kind!=="constant"||d.kind!=="constant")i=!0;else{const f=d.value,g=l.value;if(!g)continue;e.addDash(g,f)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const l of this.layers){const d=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(d.kind==="constant"&&f.kind==="constant")continue;let g,x;if(d.kind==="constant"){if(g=d.value,!g)continue}else g=d.evaluate({zoom:s},e);x=f.kind==="constant"?f.value:f.evaluate({zoom:s},e),i.addDash(g,x),e.patterns[l.id]=[i.getKey(g,x)]}}update(e,i,s,l,d,f,g,x){this.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,x)}addFeatures(e,i,s,l,d,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,i,s,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uE)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,dE)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,aE.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lE),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,s,l,d,f,g,x){const b=this.layers[0].layout,C=b.get("line-join").evaluate(e,{}),M=b.get("line-cap").evaluate(e,{}),R=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=b.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const V=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,l,x,C,M,R,P)){const[q,$]=this.clipRuntimeLinesToTile(i,1);for(let te=0;te<q.length;te++){const ne=q[te],G=$[te],ee={progress:{min:G.progress.min,max:G.progress.max},nextDir:this.computeSegNextDir(G,ne),prevDir:this.computeSegPrevDir(G,ne)};this.addLine(ne,e,l,C,M,R,P,ee)}this.fillNonElevatedRoadSegment(V)}}else for(const V of i)this.addLine(V,e,l,C,M,R,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,f,l,g,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return h(e,-i,-i,vt+i,vt+i)}clipRuntimeLinesToTile(e,i){const s=[];return[h(e,-i,-i,vt+i,vt+i,s),s]}addElevatedRoadFeature(e,i,s,l,d,f,g,x){const b=[],C=Qs.getElevationFeature(e,l);if(C){const M=this.clipLinesToTile(i,1),R=this.prepareElevatedLines(M,C,s);for(const P of R)b.push({geometry:P,elevation:C,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(b.length===0)return!1;for(const M of b){const R=this.layoutVertexArray.length;this.addLine(M.geometry,e,s,d,f,g,x);const P=new qo(s,M.elevationTileID);if(M.elevation)for(let F=R;F<this.layoutVertexArray.length;F++){const V=new Tt(this.layoutVertexArray.int16[6*F]>>1,this.layoutVertexArray.int16[6*F+1]>>1),q=P.pointElevation(V,M.elevation,.05);this.updateHeightRange(q),this.zOffsetVertexArray.emplaceBack(q,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const l=[],d=1/Ue(s);for(const f of e)y(f,new ls(i,d),0,l);return l}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,l,d,f,g,x){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const b=l==="none";this.patternJoinNone=this.hasPattern&&b,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=x&&x.progress.min>0,M=x&&x.progress.max<1;if(this.lineClips){let Te={min:this.lineClips.start,max:this.lineClips.end},ve=1;if(x){const je=this.lineClips.end-this.lineClips.start;Te=function(ct,et,at){return{min:Th(ct.min,et,at),max:Th(ct.max,et,at)}}(x.progress,{min:0,max:1},Te),je>0&&(ve=(Te.max-Te.min)/je)}const Se=+i.properties.mapbox_clip_feature_len,Me=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Se)||Number.isNaN(Me)){for(let ct=0;ct<e.length-1;ct++)this.totalDistance+=e[ct].dist(e[ct+1]);const je=this.totalDistance/(Te.max-Te.min);this.totalFeatureLength=Number.isFinite(je)?je:0,this.lineClips.start=Te.min,this.lineClips.end=Te.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Se,this.distance=Me*ve,this.lineClips.start=Te.min,this.lineClips.end=Te.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const R=fE[i.type]==="Polygon";let P=e.length;for(;P>=2&&e[P-1].equals(e[P-2]);)P--;let F=0;for(;F<P-1&&e[F].equals(e[F+1]);)F++;if(P<(R?3:2))return;l==="bevel"&&(f=1.05);const V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let q,$,te,ne,G,ee,re,ae;x&&x.prevDir&&(ee=x.prevDir.perp()),x&&x.nextDir&&(re=x.nextDir.perp()),this.e1=this.e2=-1,R&&(q=e[P-2],G=e[F].sub(q)._unit()._perp());for(let Te=F;Te<P;Te++){if(te=Te===P-1?R?e[F+1]:void 0:e[Te+1],te&&e[Te].equals(te))continue;G&&(ne=G),q&&($=q),q=e[Te],ae=this.evaluateLineProgressFeatures($?$.dist(q):0),G=te?te.sub(q)._unit()._perp():ne,ne=ne||G;const ve=$&&te;let Se=ve?l:R||b?"butt":d;const Me=ne.x*G.x+ne.y*G.y;if(b){const Ve=function(Ge){if(Ge.patternJoinNone){const _t=Ge.segmentPoints.length/2,yt=Ge.lineSoFar-Ge.segmentStart;for(let Qt=0;Qt<_t;++Qt){const jt=Ge.segmentPoints[2*Qt+1],At=Math.round(Ge.segmentPoints[2*Qt])+.5+.25*jt;Ge.patternVertexArray.emplaceBack(At,yt,Ge.segmentStart),Ge.patternVertexArray.emplaceBack(At,yt,Ge.segmentStart)}Ge.segmentPoints.length=0}Ge.e1=Ge.e2=-1};if(ve&&Me<mE){this.updateDistance($,q),this.addCurrentVertex(q,ne,1,1,V,ae),Ve(this),this.addCurrentVertex(q,G,-1,-1,V,ae);continue}if($){if(!te){this.updateDistance($,q),this.addCurrentVertex(q,ne,1,1,V,ae),Ve(this);continue}Se="miter"}}let je=ne.add(G);je.x===0&&je.y===0||je._unit();const ct=je.x*G.x+je.y*G.y,et=ct!==0?1/ct:1/0,at=2*Math.sqrt(2-2*ct),ft=ct<pE&&$&&te,He=ne.x*G.y-ne.y*G.x>0,st=this.overscaling<=16?15*vt/(512*this.overscaling):0;if(ve&&Se==="round"){if(et<g)Se="miter";else if(et<=2){const Ve=jv(q,-10,vt+10);Se=this.elevationType==="offset"&&(Ve||this.hasCrossSlope)?"miter":"fakeround"}}if(Se==="miter"&&et>f&&(Se="bevel"),Se==="bevel"&&(et>2&&(Se="flipbevel"),et<f&&(Se="miter")),$&&!(Se==="miter"&&ft)&&this.updateDistance($,q),Se==="miter")if(ft){const Ve=q.dist($);if(Ve>2*st){const _t=q.sub(q.sub($)._mult(st/Ve)._round());this.updateDistance($,_t),this.addCurrentVertex(_t,ne,0,0,V,ae),$=_t}this.updateDistance($,q),je._mult(et),this.addCurrentVertex(q,je,0,0,V,ae);const Ge=q.dist(te);if(Ge>2*st){const _t=q.add(te.sub(q)._mult(st/Ge)._round());this.updateDistance(q,_t),this.addCurrentVertex(_t,G,0,0,V,ae),q=_t}}else je._mult(et),this.addCurrentVertex(q,je,0,0,V,ae);else if(Se==="flipbevel"){if(et>100)je=G.mult(-1);else{const Ve=et*ne.add(G).mag()/ne.sub(G).mag();je._perp()._mult(Ve*(He?-1:1))}this.addCurrentVertex(q,je,0,0,V,ae),this.addCurrentVertex(q,je.mult(-1),0,0,V,ae)}else if(Se==="bevel"||Se==="fakeround"){ae!=null&&$&&this.addCurrentVertex(q,re||ne,-1,-1,V,ae);const Ve=q.dist($)<=2*st&&Se!=="bevel",Ge=je.mult(He?1:-1);Ge._mult(et);const _t=G.mult(He?-1:1),yt=ne.mult(He?-1:1),Qt=this.evaluateLineProgressFeatures(this.distance);if(ae==null&&(this.addHalfVertex(q,Ge.x,Ge.y,!1,!He,0,V,Qt),Ve||this.addHalfVertex(q,Ge.x+2*yt.x,Ge.y+2*yt.y,!1,He,0,V,Qt)),Se==="fakeround"){const jt=Math.round(180*at/Math.PI/20);this.addHalfVertex(q,yt.x,yt.y,!1,He,0,V,Qt);for(let At=0;At<jt;At++){let mt=At/jt;if(mt!==.5){const Vt=mt-.5;mt+=mt*Vt*(mt-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*Vt*Vt+(.848013+Me*(.215638*Me-1.06021)))}const _i=_t.sub(yt)._mult(mt)._add(yt)._unit();this.addHalfVertex(q,_i.x,_i.y,!1,He,0,V,Qt)}this.addHalfVertex(q,_t.x,_t.y,!1,He,0,V,Qt)}Ve||ae!=null||this.addHalfVertex(q,Ge.x+2*_t.x,Ge.y+2*_t.y,!1,He,0,V,Qt),ae!=null&&te&&this.addCurrentVertex(q,ee||G,1,1,V,ae)}else if(Se==="butt")this.addCurrentVertex(q,je,0,0,V,ae);else if(Se==="square"){if(!$){const Ve=C?0:-1;this.addCurrentVertex(q,je,Ve,Ve,V,ae)}if(this.addCurrentVertex(q,je,0,0,V,ae),$){const Ve=M?0:1;this.addCurrentVertex(q,je,Ve,Ve,V,ae)}}else if(Se==="round"){if($){const Ve=!ve&&re?re:ne;this.addCurrentVertex(q,Ve,0,0,V,ae),!ve&&M||this.addCurrentVertex(q,Ve,1,1,V,ae,!0)}if(te){const Ve=!ve&&ee?ee:G;!ve&&C||this.addCurrentVertex(q,Ve,-1,-1,V,ae,!0),this.addCurrentVertex(q,Ve,0,0,V,ae)}}}}addVerticesTo(e,i,s,l,d,f,g,x,b,C){const M=(i.w-e.w)/this.tessellationStep|0;let R=0;const P=this.scaledDistance;if(M>1){this.lineSoFar=e.w;const V=(i.x-e.x)/M,q=(i.y-e.y)/M,$=(i.z-e.z)/M,te=(i.w-e.w)/M;for(let ne=1;ne<M;++ne){e.x+=V,e.y+=q,e.z+=$,this.lineSoFar+=te,R+=te;const G=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(e,s,l,C,!1,g,b,G),this.addHalfVertex(e,d,f,C,!0,-x,b,G)}}this.lineSoFar=i.w,this.scaledDistance=P;const F=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,l,C,!1,g,b,F),this.addHalfVertex(i,d,f,C,!0,-x,b,F)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):vi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,l,d,f,g=!1){const x=i.x+i.y*s,b=i.y-i.x*s,C=i.y*l-i.x,M=-i.y-i.x*l;if(f!=null){const R=this.elevationType==="offset",P=-10,F=vt+10,V=f.zOffset,q=new hy(e.x,e.y,V,this.lineSoFar),$=!!R&&jv(e,P,F),te=this.lineSoFar,ne=this.distance;if(this.currentVertex)if($){const G=this.currentVertexIsOutside,ee=this.currentVertex,re=new hy(e.x,e.y,V,this.lineSoFar);if(a(ee,re,P,F),!jv(re,P,F)){if(G){this.e1=this.e2=-1,this.distance-=ee.dist(q),this.lineSoFar=ee.w;const ae=this.evaluateLineProgressFeatures(ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ee,x,b,g,!1,s,d,ae),this.addHalfVertex(ee,C,M,g,!0,-l,d,ae),this.prevDistance=this.distance}this.distance=this.prevDistance+ee.dist(re),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ee,re,x,b,C,M,s,l,d,g),this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}}else{const G=this.currentVertex;if(this.currentVertexIsOutside){a(G,q,P,F),this.e1=this.e2=-1,this.distance-=G.dist(q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=G.w;const ee=this.evaluateLineProgressFeatures(G.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(G,x,b,g,!1,s,d,ee),this.addHalfVertex(G,C,M,g,!0,-l,d,ee),this.prevDistance=this.distance,this.distance=ne,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(G,q,x,b,C,M,s,l,d,g)}else $||(this.addHalfVertex(e,x,b,g,!1,s,d,f),this.addHalfVertex(e,C,M,g,!0,-l,d,f));this.currentVertex=q,this.currentVertexIsOutside=$,this.lineSoFar=te}else this.addHalfVertex(e,x,b,g,!1,s,d,f),this.addHalfVertex(e,C,M,g,!0,-l,d,f)}addHalfVertex({x:e,y:i},s,l,d,f,g,x,b){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),f||this.segmentPoints.push(this.lineSoFar-this.segmentStart,g)),this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(i<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(g===0?0:g<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const M=ei(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,M)}const C=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),x.primitiveLength++),f?this.e2=C:this.e1=C,b!=null&&this.zOffsetVertexArray.emplaceBack(b.zOffset,b.variableWidth,b.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function jv(n,e,i){return n.x<e||n.x>i||n.y<e||n.y>i}let s1,o1;function a1(n,e,i){return e*(vt/(n.tileSize*Math.pow(2,i-n.tileID.overscaledZ)))}Pt(Vv,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const l1=(n,e,i)=>(1-i)*n+i*e;function c1(n,e){return 1/a1(n,1,e.tileZoom)}function u1(n,e,i,s){return n.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const h1=n=>{const e=[];d1(n)&&e.push("RENDER_LINE_DASH"),n.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=n.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),n.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=n.layout.get("line-join").constantOr("miter")==="none",l=!!n.paint.get("line-pattern").constantOr(1);return s&&l&&e.push("LINE_JOIN_NONE"),e};function d1(n){const e=n.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let Gv;const f1=()=>Gv||(Gv={layout:s1||(s1=new sr({"line-cap":new St(Re.layout_line["line-cap"]),"line-join":new St(Re.layout_line["line-join"]),"line-miter-limit":new dt(Re.layout_line["line-miter-limit"]),"line-round-limit":new dt(Re.layout_line["line-round-limit"]),"line-sort-key":new St(Re.layout_line["line-sort-key"]),"line-z-offset":new St(Re.layout_line["line-z-offset"]),"line-elevation-reference":new dt(Re.layout_line["line-elevation-reference"]),"line-cross-slope":new dt(Re.layout_line["line-cross-slope"]),visibility:new dt(Re.layout_line.visibility),"line-width-unit":new dt(Re.layout_line["line-width-unit"])})),paint:o1||(o1=new sr({"line-opacity":new St(Re.paint_line["line-opacity"]),"line-color":new St(Re.paint_line["line-color"]),"line-translate":new dt(Re.paint_line["line-translate"]),"line-translate-anchor":new dt(Re.paint_line["line-translate-anchor"]),"line-width":new St(Re.paint_line["line-width"]),"line-gap-width":new St(Re.paint_line["line-gap-width"]),"line-offset":new St(Re.paint_line["line-offset"]),"line-blur":new St(Re.paint_line["line-blur"]),"line-dasharray":new St(Re.paint_line["line-dasharray"]),"line-pattern":new St(Re.paint_line["line-pattern"]),"line-pattern-cross-fade":new dt(Re.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ga(Re.paint_line["line-gradient"]),"line-trim-offset":new dt(Re.paint_line["line-trim-offset"]),"line-trim-fade-range":new dt(Re.paint_line["line-trim-fade-range"]),"line-trim-color":new dt(Re.paint_line["line-trim-color"]),"line-emissive-strength":new dt(Re.paint_line["line-emissive-strength"]),"line-border-width":new St(Re.paint_line["line-border-width"]),"line-border-color":new St(Re.paint_line["line-border-color"]),"line-occlusion-opacity":new dt(Re.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},Gv);class _E extends St{possiblyEvaluate(e,i){return i=new hn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,l){return i=ke({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,l)}}let j_;function p1(n,e){return e>0?e+2*n:n}const gE=Gi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),yE=Gi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),vE=Gi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Gi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const xE=Gi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),bE=Gi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),wE=Gi([{name:"a_texb",components:2,type:"Uint16"}]),TE=Gi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),SE=Gi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const m1=Gi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),EE=Gi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Gi([{name:"triangle",components:3,type:"Uint16"}]),Gi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Gi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Gi([{type:"Float32",name:"offsetX"}]),Gi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _s=24;function AE(n,e,i){return n.sections.forEach(s=>{s.text=function(l,d,f){const g=d.layout.get("text-transform").evaluate(f,{});return g==="uppercase"?l=l.toLocaleUpperCase():g==="lowercase"&&(l=l.toLocaleLowerCase()),Va.applyArabicShaping&&(l=Va.applyArabicShaping(l)),l}(s.text,e,i)}),n}const G_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function CE(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}function IE(n){return n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""||n===""}var _1,Hv,g1,qv={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function ME(){return _1||(_1=1,qv.read=function(n,e,i,s,l){var d,f,g=8*l-s-1,x=(1<<g)-1,b=x>>1,C=-7,M=i?l-1:0,R=i?-1:1,P=n[e+M];for(M+=R,d=P&(1<<-C)-1,P>>=-C,C+=g;C>0;d=256*d+n[e+M],M+=R,C-=8);for(f=d&(1<<-C)-1,d>>=-C,C+=s;C>0;f=256*f+n[e+M],M+=R,C-=8);if(d===0)d=1-b;else{if(d===x)return f?NaN:1/0*(P?-1:1);f+=Math.pow(2,s),d-=b}return(P?-1:1)*f*Math.pow(2,d-s)},qv.write=function(n,e,i,s,l,d){var f,g,x,b=8*d-l-1,C=(1<<b)-1,M=C>>1,R=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=s?0:d-1,F=s?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(g=isNaN(e)?1:0,f=C):(f=Math.floor(Math.log(e)/Math.LN2),e*(x=Math.pow(2,-f))<1&&(f--,x*=2),(e+=f+M>=1?R/x:R*Math.pow(2,1-M))*x>=2&&(f++,x/=2),f+M>=C?(g=0,f=C):f+M>=1?(g=(e*x-1)*Math.pow(2,l),f+=M):(g=e*Math.pow(2,M-1)*Math.pow(2,l),f=0));l>=8;n[i+P]=255&g,P+=F,g/=256,l-=8);for(f=f<<l|g,b+=l;b>0;n[i+P]=255&f,P+=F,f/=256,b-=8);n[i+P-F]|=128*V}),qv}function y1(){if(g1)return Hv;g1=1,Hv=e;var n=ME();function e(G){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(G)?G:new Uint8Array(G||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,s=1/i,l=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function d(G){return G.type===e.Bytes?G.readVarint()+G.pos:G.pos+1}function f(G,ee,re){return re?4294967296*ee+(G>>>0):4294967296*(ee>>>0)+(G>>>0)}function g(G,ee,re){var ae=ee<=16383?1:ee<=2097151?2:ee<=268435455?3:Math.floor(Math.log(ee)/(7*Math.LN2));re.realloc(ae);for(var Te=re.pos-1;Te>=G;Te--)re.buf[Te+ae]=re.buf[Te]}function x(G,ee){for(var re=0;re<G.length;re++)ee.writeVarint(G[re])}function b(G,ee){for(var re=0;re<G.length;re++)ee.writeSVarint(G[re])}function C(G,ee){for(var re=0;re<G.length;re++)ee.writeFloat(G[re])}function M(G,ee){for(var re=0;re<G.length;re++)ee.writeDouble(G[re])}function R(G,ee){for(var re=0;re<G.length;re++)ee.writeBoolean(G[re])}function P(G,ee){for(var re=0;re<G.length;re++)ee.writeFixed32(G[re])}function F(G,ee){for(var re=0;re<G.length;re++)ee.writeSFixed32(G[re])}function V(G,ee){for(var re=0;re<G.length;re++)ee.writeFixed64(G[re])}function q(G,ee){for(var re=0;re<G.length;re++)ee.writeSFixed64(G[re])}function $(G,ee){return(G[ee]|G[ee+1]<<8|G[ee+2]<<16)+16777216*G[ee+3]}function te(G,ee,re){G[re]=ee,G[re+1]=ee>>>8,G[re+2]=ee>>>16,G[re+3]=ee>>>24}function ne(G,ee){return(G[ee]|G[ee+1]<<8|G[ee+2]<<16)+(G[ee+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(G,ee,re){for(re=re||this.length;this.pos<re;){var ae=this.readVarint(),Te=ae>>3,ve=this.pos;this.type=7&ae,G(Te,ee,this),this.pos===ve&&this.skip(ae)}return ee},readMessage:function(G,ee){return this.readFields(G,ee,this.readVarint()+this.pos)},readFixed32:function(){var G=$(this.buf,this.pos);return this.pos+=4,G},readSFixed32:function(){var G=ne(this.buf,this.pos);return this.pos+=4,G},readFixed64:function(){var G=$(this.buf,this.pos)+$(this.buf,this.pos+4)*i;return this.pos+=8,G},readSFixed64:function(){var G=$(this.buf,this.pos)+ne(this.buf,this.pos+4)*i;return this.pos+=8,G},readFloat:function(){var G=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,G},readDouble:function(){var G=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,G},readVarint:function(G){var ee,re,ae=this.buf;return ee=127&(re=ae[this.pos++]),re<128?ee:(ee|=(127&(re=ae[this.pos++]))<<7,re<128?ee:(ee|=(127&(re=ae[this.pos++]))<<14,re<128?ee:(ee|=(127&(re=ae[this.pos++]))<<21,re<128?ee:function(Te,ve,Se){var Me,je,ct=Se.buf;if(Me=(112&(je=ct[Se.pos++]))>>4,je<128||(Me|=(127&(je=ct[Se.pos++]))<<3,je<128)||(Me|=(127&(je=ct[Se.pos++]))<<10,je<128)||(Me|=(127&(je=ct[Se.pos++]))<<17,je<128)||(Me|=(127&(je=ct[Se.pos++]))<<24,je<128)||(Me|=(1&(je=ct[Se.pos++]))<<31,je<128))return f(Te,Me,ve);throw new Error("Expected varint not more than 10 bytes")}(ee|=(15&(re=ae[this.pos]))<<28,G,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var G=this.readVarint();return G%2==1?(G+1)/-2:G/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var G=this.readVarint()+this.pos,ee=this.pos;return this.pos=G,G-ee>=12&&l?function(re,ae,Te){return l.decode(re.subarray(ae,Te))}(this.buf,ee,G):function(re,ae,Te){for(var ve="",Se=ae;Se<Te;){var Me,je,ct,et=re[Se],at=null,ft=et>239?4:et>223?3:et>191?2:1;if(Se+ft>Te)break;ft===1?et<128&&(at=et):ft===2?(192&(Me=re[Se+1]))==128&&(at=(31&et)<<6|63&Me)<=127&&(at=null):ft===3?(je=re[Se+2],(192&(Me=re[Se+1]))==128&&(192&je)==128&&((at=(15&et)<<12|(63&Me)<<6|63&je)<=2047||at>=55296&&at<=57343)&&(at=null)):ft===4&&(je=re[Se+2],ct=re[Se+3],(192&(Me=re[Se+1]))==128&&(192&je)==128&&(192&ct)==128&&((at=(15&et)<<18|(63&Me)<<12|(63&je)<<6|63&ct)<=65535||at>=1114112)&&(at=null)),at===null?(at=65533,ft=1):at>65535&&(at-=65536,ve+=String.fromCharCode(at>>>10&1023|55296),at=56320|1023&at),ve+=String.fromCharCode(at),Se+=ft}return ve}(this.buf,ee,G)},readBytes:function(){var G=this.readVarint()+this.pos,ee=this.buf.subarray(this.pos,G);return this.pos=G,ee},readPackedVarint:function(G,ee){if(this.type!==e.Bytes)return G.push(this.readVarint(ee));var re=d(this);for(G=G||[];this.pos<re;)G.push(this.readVarint(ee));return G},readPackedSVarint:function(G){if(this.type!==e.Bytes)return G.push(this.readSVarint());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readSVarint());return G},readPackedBoolean:function(G){if(this.type!==e.Bytes)return G.push(this.readBoolean());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readBoolean());return G},readPackedFloat:function(G){if(this.type!==e.Bytes)return G.push(this.readFloat());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readFloat());return G},readPackedDouble:function(G){if(this.type!==e.Bytes)return G.push(this.readDouble());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readDouble());return G},readPackedFixed32:function(G){if(this.type!==e.Bytes)return G.push(this.readFixed32());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readFixed32());return G},readPackedSFixed32:function(G){if(this.type!==e.Bytes)return G.push(this.readSFixed32());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readSFixed32());return G},readPackedFixed64:function(G){if(this.type!==e.Bytes)return G.push(this.readFixed64());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readFixed64());return G},readPackedSFixed64:function(G){if(this.type!==e.Bytes)return G.push(this.readSFixed64());var ee=d(this);for(G=G||[];this.pos<ee;)G.push(this.readSFixed64());return G},skip:function(G){var ee=7&G;if(ee===e.Varint)for(;this.buf[this.pos++]>127;);else if(ee===e.Bytes)this.pos=this.readVarint()+this.pos;else if(ee===e.Fixed32)this.pos+=4;else{if(ee!==e.Fixed64)throw new Error("Unimplemented type: "+ee);this.pos+=8}},writeTag:function(G,ee){this.writeVarint(G<<3|ee)},realloc:function(G){for(var ee=this.length||16;ee<this.pos+G;)ee*=2;if(ee!==this.length){var re=new Uint8Array(ee);re.set(this.buf),this.buf=re,this.length=ee}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(G){this.realloc(4),te(this.buf,G,this.pos),this.pos+=4},writeSFixed32:function(G){this.realloc(4),te(this.buf,G,this.pos),this.pos+=4},writeFixed64:function(G){this.realloc(8),te(this.buf,-1&G,this.pos),te(this.buf,Math.floor(G*s),this.pos+4),this.pos+=8},writeSFixed64:function(G){this.realloc(8),te(this.buf,-1&G,this.pos),te(this.buf,Math.floor(G*s),this.pos+4),this.pos+=8},writeVarint:function(G){(G=+G||0)>268435455||G<0?function(ee,re){var ae,Te;if(ee>=0?(ae=ee%4294967296|0,Te=ee/4294967296|0):(Te=~(-ee/4294967296),4294967295^(ae=~(-ee%4294967296))?ae=ae+1|0:(ae=0,Te=Te+1|0)),ee>=18446744073709552e3||ee<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");re.realloc(10),function(ve,Se,Me){Me.buf[Me.pos++]=127&ve|128,ve>>>=7,Me.buf[Me.pos++]=127&ve|128,ve>>>=7,Me.buf[Me.pos++]=127&ve|128,ve>>>=7,Me.buf[Me.pos++]=127&ve|128,Me.buf[Me.pos]=127&(ve>>>=7)}(ae,0,re),function(ve,Se){var Me=(7&ve)<<4;Se.buf[Se.pos++]|=Me|((ve>>>=3)?128:0),ve&&(Se.buf[Se.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Se.buf[Se.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Se.buf[Se.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Se.buf[Se.pos++]=127&ve|((ve>>>=7)?128:0),ve&&(Se.buf[Se.pos++]=127&ve)))))}(Te,re)}(G,this):(this.realloc(4),this.buf[this.pos++]=127&G|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=127&(G>>>=7)|(G>127?128:0),G<=127||(this.buf[this.pos++]=G>>>7&127))))},writeSVarint:function(G){this.writeVarint(G<0?2*-G-1:2*G)},writeBoolean:function(G){this.writeVarint(!!G)},writeString:function(G){G=String(G),this.realloc(4*G.length),this.pos++;var ee=this.pos;this.pos=function(ae,Te,ve){for(var Se,Me,je=0;je<Te.length;je++){if((Se=Te.charCodeAt(je))>55295&&Se<57344){if(!Me){Se>56319||je+1===Te.length?(ae[ve++]=239,ae[ve++]=191,ae[ve++]=189):Me=Se;continue}if(Se<56320){ae[ve++]=239,ae[ve++]=191,ae[ve++]=189,Me=Se;continue}Se=Me-55296<<10|Se-56320|65536,Me=null}else Me&&(ae[ve++]=239,ae[ve++]=191,ae[ve++]=189,Me=null);Se<128?ae[ve++]=Se:(Se<2048?ae[ve++]=Se>>6|192:(Se<65536?ae[ve++]=Se>>12|224:(ae[ve++]=Se>>18|240,ae[ve++]=Se>>12&63|128),ae[ve++]=Se>>6&63|128),ae[ve++]=63&Se|128)}return ve}(this.buf,G,this.pos);var re=this.pos-ee;re>=128&&g(ee,re,this),this.pos=ee-1,this.writeVarint(re),this.pos+=re},writeFloat:function(G){this.realloc(4),n.write(this.buf,G,this.pos,!0,23,4),this.pos+=4},writeDouble:function(G){this.realloc(8),n.write(this.buf,G,this.pos,!0,52,8),this.pos+=8},writeBytes:function(G){var ee=G.length;this.writeVarint(ee),this.realloc(ee);for(var re=0;re<ee;re++)this.buf[this.pos++]=G[re]},writeRawMessage:function(G,ee){this.pos++;var re=this.pos;G(ee,this);var ae=this.pos-re;ae>=128&&g(re,ae,this),this.pos=re-1,this.writeVarint(ae),this.pos+=ae},writeMessage:function(G,ee,re){this.writeTag(G,e.Bytes),this.writeRawMessage(ee,re)},writePackedVarint:function(G,ee){ee.length&&this.writeMessage(G,x,ee)},writePackedSVarint:function(G,ee){ee.length&&this.writeMessage(G,b,ee)},writePackedBoolean:function(G,ee){ee.length&&this.writeMessage(G,R,ee)},writePackedFloat:function(G,ee){ee.length&&this.writeMessage(G,C,ee)},writePackedDouble:function(G,ee){ee.length&&this.writeMessage(G,M,ee)},writePackedFixed32:function(G,ee){ee.length&&this.writeMessage(G,P,ee)},writePackedSFixed32:function(G,ee){ee.length&&this.writeMessage(G,F,ee)},writePackedFixed64:function(G,ee){ee.length&&this.writeMessage(G,V,ee)},writePackedSFixed64:function(G,ee){ee.length&&this.writeMessage(G,q,ee)},writeBytesField:function(G,ee){this.writeTag(G,e.Bytes),this.writeBytes(ee)},writeFixed32Field:function(G,ee){this.writeTag(G,e.Fixed32),this.writeFixed32(ee)},writeSFixed32Field:function(G,ee){this.writeTag(G,e.Fixed32),this.writeSFixed32(ee)},writeFixed64Field:function(G,ee){this.writeTag(G,e.Fixed64),this.writeFixed64(ee)},writeSFixed64Field:function(G,ee){this.writeTag(G,e.Fixed64),this.writeSFixed64(ee)},writeVarintField:function(G,ee){this.writeTag(G,e.Varint),this.writeVarint(ee)},writeSVarintField:function(G,ee){this.writeTag(G,e.Varint),this.writeSVarint(ee)},writeStringField:function(G,ee){this.writeTag(G,e.Bytes),this.writeString(ee)},writeFloatField:function(G,ee){this.writeTag(G,e.Fixed32),this.writeFloat(ee)},writeDoubleField:function(G,ee){this.writeTag(G,e.Fixed64),this.writeDouble(ee)},writeBooleanField:function(G,ee){this.writeVarintField(G,!!ee)}},Hv}var my=ol(y1());const Zv=3;function RE(n,e,i){e.glyphs=[],n===1&&i.readMessage(DE,e)}function DE(n,e,i){if(n===3){const{id:s,bitmap:l,width:d,height:f,left:g,top:x,advance:b}=i.readMessage(zE,{});e.glyphs.push({id:s,bitmap:new ya({width:d+2*Zv,height:f+2*Zv},l),metrics:{width:d,height:f,left:g,top:x,advance:b}})}else n===4?e.ascender=i.readSVarint():n===5&&(e.descender=i.readSVarint())}function zE(n,e,i){n===1?e.id=i.readVarint():n===2?e.bitmap=i.readBytes():n===3?e.width=i.readVarint():n===4?e.height=i.readVarint():n===5?e.left=i.readSVarint():n===6?e.top=i.readSVarint():n===7&&(e.advance=i.readVarint())}const LE=Zv,xa={horizontal:1,vertical:2,horizontalOnly:3};class H_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new H_;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new H_;return i.image=e,i}}class Nm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const l=new Nm;for(let d=0;d<e.sections.length;d++){const f=e.sections[d];f.image?l.addImageSection(f,s):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let l="";for(let d=0;d<i.length;d++){const f=i.charCodeAt(d+1)||null,g=i.charCodeAt(d-1)||null;l+=!s&&(f&&Jd(f)&&!G_[i[d+1]]||g&&Jd(g)&&!G_[i[d-1]])||!G_[i[d]]?i[d]:G_[i[d]]}return l}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&_y[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&_y[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new Nm;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(H_.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void vi("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCodePoint(l),this.sections.push(H_.forImage(s)),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Xv(n,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V=1){const q=Nm.fromFeature(n,l,V);M===xa.vertical&&q.verticalizePunctuation(R);let $=[];const te=function(ae,Te,ve,Se,Me,je){if(!ae)return[];const ct=[],et=function(st,Ve,Ge,_t,yt,Qt){let jt=0;for(let At=0;At<st.length();At++){const mt=st.getSection(At);jt+=v1(st.getCodePoint(At),mt,_t,yt,Ve,Qt)}return jt/Math.max(1,Math.ceil(jt/Ge))}(ae,Te,ve,Se,Me,je),at=ae.text.indexOf("")>=0;let ft=0;for(let st=0;st<ae.length();st++){const Ve=ae.getSection(st),Ge=ae.getCodePoint(st);if(_y[Ge]||(ft+=v1(Ge,Ve,Se,Me,Te,je)),st<ae.length()-1){const _t=!((He=Ge)<11904||!(Zt["Bopomofo Extended"](He)||Zt.Bopomofo(He)||Zt["CJK Compatibility Forms"](He)||Zt["CJK Compatibility Ideographs"](He)||Zt["CJK Compatibility"](He)||Zt["CJK Radicals Supplement"](He)||Zt["CJK Strokes"](He)||Zt["CJK Symbols and Punctuation"](He)||Zt["CJK Unified Ideographs Extension A"](He)||Zt["CJK Unified Ideographs"](He)||Zt["Enclosed CJK Letters and Months"](He)||Zt["Halfwidth and Fullwidth Forms"](He)||Zt.Hiragana(He)||Zt["Ideographic Description Characters"](He)||Zt["Kangxi Radicals"](He)||Zt["Katakana Phonetic Extensions"](He)||Zt.Katakana(He)||Zt["Vertical Forms"](He)||Zt["Yi Radicals"](He)||Zt["Yi Syllables"](He)));(PE[Ge]||_t||Ve.image)&&ct.push(b1(st+1,ft,et,ct,OE(Ge,ae.getCodePoint(st+1),_t&&at),!1))}}var He;return w1(b1(ae.length(),ft,et,ct,0,!0))}(q,b,d,e,s,P),{processBidirectionalText:ne,processStyledBidirectionalText:G}=Va;if(ne&&q.sections.length===1){const ae=ne(q.toString(),te);for(const Te of ae){const ve=new Nm;ve.text=Te,ve.sections=q.sections;for(let Se=0;Se<Te.length;Se++)ve.sectionIndex.push(0);$.push(ve)}}else if(G){const ae=G(q.text,q.sectionIndex,te);for(const Te of ae){const ve=new Nm;ve.text=Te[0],ve.sectionIndex=Te[1],ve.sections=q.sections,$.push(ve)}}else $=function(ae,Te){const ve=[],Se=ae.text;let Me=0;for(const je of Te)ve.push(ae.substring(Me,je)),Me=je;return Me<Se.length&&ve.push(ae.substring(Me,Se.length)),ve}(q,te);const ee=[],re={positionedLines:ee,text:q.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:M,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ae,Te,ve,Se,Me,je,ct,et,at,ft,He,st){let Ve=0,Ge=0,_t=0;const yt=et==="right"?1:et==="left"?0:.5;let Qt=!1;for(const Gt of Me){const ri=Gt.getSections();for(const Si of ri){if(Si.image)continue;const bi=Te[Si.fontStack];if(bi&&(Qt=bi.ascender!==void 0&&bi.descender!==void 0,!Qt))break}if(!Qt)break}let jt=0;for(const Gt of Me){Gt.trim();const ri=Gt.getMaxScale(),Si=(ri-1)*_s,bi={positionedGlyphs:[],lineOffset:0};ae.positionedLines[jt]=bi;const Di=bi.positionedGlyphs;let Ei=0;if(!Gt.length()){Ge+=je,++jt;continue}let zi=0,fn=0;for(let se=0;se<Gt.length();se++){const ue=Gt.getSection(se),Xe=Gt.getSectionIndex(se),bt=Gt.getCodePoint(se);let Ct=ue.scale,Et=null,Ut=null,ni=null,Ni=_s,Ui=0;at===xa.vertical&&((At=bt)===12312||At===12313||At===12316||At===12540||At===12448)&&(at=xa.horizontal);const Ai=!(at===xa.horizontal||!He&&!$u(bt)||He&&(_y[bt]||Il(bt)));if(ue.image){const mn=Se.get(ue.image.toString());if(!mn)continue;ni=ue.image,ae.iconsInText=ae.iconsInText||!0,Ut=mn.paddedRect;const kn=mn.displaySize;Ct=Ct*_s/st,Et={width:kn[0],height:kn[1],left:0,top:-3,advance:Ai?kn[1]:kn[0],localGlyph:!1},Ui=Qt?-Et.height*Ct:ri*_s-17-kn[1]*Ct,Ni=Et.advance;const Vi=(Ai?kn[0]:kn[1])*Ct-_s*ri;Vi>0&&Vi>Ei&&(Ei=Vi)}else{const mn=ve[ue.fontStack];if(!mn)continue;mn[bt]&&(Ut=mn[bt]);const kn=Te[ue.fontStack];if(!kn)continue;const Vi=kn.glyphs[bt];if(!Vi)continue;if(Et=Vi.metrics,Ni=bt!==8203?_s:0,Qt){const fr=kn.ascender!==void 0?Math.abs(kn.ascender):0,jn=kn.descender!==void 0?Math.abs(kn.descender):0,pn=(fr+jn)*Ct;zi<pn&&(zi=pn,fn=(fr-jn)/2*Ct),Ui=-fr*Ct}else Ui=(ri-Ct)*_s-17}Ai?(ae.verticalizable=!0,Di.push({glyph:bt,image:ni,x:Ve,y:Ge+Ui,vertical:Ai,scale:Ct,localGlyph:Et.localGlyph,fontStack:ue.fontStack,sectionIndex:Xe,metrics:Et,rect:Ut}),Ve+=Ni*Ct+ft):(Di.push({glyph:bt,image:ni,x:Ve,y:Ge+Ui,vertical:Ai,scale:Ct,localGlyph:Et.localGlyph,fontStack:ue.fontStack,sectionIndex:Xe,metrics:Et,rect:Ut}),Ve+=Et.advance*Ct+ft)}Di.length!==0&&(_t=Math.max(Ve-ft,_t),Qt?T1(Di,yt,Ei,fn,je*ri/2):T1(Di,yt,Ei,0,je/2)),Ve=0;const Vn=je*ri+Ei;bi.lineOffset=Math.max(Ei,Si),Ge+=Vn,++jt}var At;const mt=Ge,{horizontalAlign:_i,verticalAlign:Vt}=Wv(ct);(function(Gt,ri,Si,bi,Di,Ei){const zi=(ri-Si)*Di,fn=-Ei*bi;for(const Vn of Gt)for(const se of Vn.positionedGlyphs)se.x+=zi,se.y+=fn})(ae.positionedLines,yt,_i,Vt,_t,mt),ae.top+=-Vt*mt,ae.bottom=ae.top+mt,ae.left+=-_i*_t,ae.right=ae.left+_t,ae.hasBaseline=Qt}(re,e,i,s,$,f,g,x,M,b,R,F),!function(ae){for(const Te of ae)if(Te.positionedGlyphs.length!==0)return!1;return!0}(ee))return re}const _y={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},PE={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function v1(n,e,i,s,l,d){if(e.image){const f=s.get(e.image.toString());return f?f.displaySize[0]*e.scale*_s/d+l:0}{const f=i[e.fontStack],g=f&&f.glyphs[n];return g?g.metrics.advance*e.scale+l:0}}function x1(n,e,i,s){const l=Math.pow(n-e,2);return s?n<e?l/2:2*l:l+Math.abs(i)*i}function OE(n,e,i){let s=0;return n===10&&(s-=1e4),i&&(s+=150),n!==40&&n!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function b1(n,e,i,s,l,d){let f=null,g=x1(e,i,l,d);for(const x of s){const b=x1(e-x.x,i,l,d)+x.badness;b<=g&&(f=x,g=b)}return{index:n,x:e,priorBreak:f,badness:g}}function w1(n){return n?w1(n.priorBreak).concat(n.index):[]}function Wv(n){let e=.5,i=.5;switch(n){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(n){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function T1(n,e,i,s,l){if(!(e||i||s||l))return;const d=n.length-1,f=n[d],g=(f.x+f.metrics.advance*f.scale)*e;for(let x=0;x<=d;x++)n[x].x-=g,n[x].y+=i+s+l}function S1(n){return n.imagePrimary!==void 0&&n.top!==void 0&&n.bottom!==void 0&&n.left!==void 0&&n.right!==void 0}function kE(n,e,i,s){const{horizontalAlign:l,verticalAlign:d}=Wv(s),f=i[0]-n.displaySize[0]*l,g=i[1]-n.displaySize[1]*d;return{imagePrimary:n,imageSecondary:e,top:g,bottom:g+n.displaySize[1],left:f,right:f+n.displaySize[0]}}function E1(n,e,i,s,l,d){const f=n.imagePrimary;let g;if(f.content){const q=f.content,$=f.pixelRatio||1;g=[q[0]/$,q[1]/$,f.displaySize[0]-q[2]/$,f.displaySize[1]-q[3]/$]}const x=e.left*d,b=e.right*d;let C,M,R,P;i==="width"||i==="both"?(P=l[0]+x-s[3],M=l[0]+b+s[1]):(P=l[0]+(x+b-f.displaySize[0])/2,M=P+f.displaySize[0]);const F=e.top*d,V=e.bottom*d;return i==="height"||i==="both"?(C=l[1]+F-s[0],R=l[1]+V+s[2]):(C=l[1]+(F+V-f.displaySize[1])/2,R=C+f.displaySize[1]),{imagePrimary:f,imageSecondary:void 0,top:C,right:M,bottom:R,left:P,collisionPadding:g}}function A1(n){return!n.imagePrimary.stretchX}function C1(n){return!n.imagePrimary.stretchY}function I1(n){return{width:n.right-n.left,height:n.bottom-n.top}}const vh=128;function M1(n,e,i){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new hn(n+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:d}=s;let f=0;for(;f<l.length&&l[f]<=n;)f++;f=Math.max(0,f-1);let g=f;for(;g<l.length&&l[g]<n+1;)g++;g=Math.min(l.length-1,g);const x=l[f],b=l[g];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:b,interpolationType:d}:{kind:"camera",minZoom:x,maxZoom:b,minSize:s.evaluate(new hn(x,{worldview:i})),maxSize:s.evaluate(new hn(b,{worldview:i})),interpolationType:d}}}function $v(n,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:l}){return n.kind==="source"?s/vh:n.kind==="composite"?ei(s/vh,l/vh,i):e}function q_(n,e,i=1){let s=0,l=0;if(n.kind==="constant")l=n.layoutSize*i;else if(n.kind!=="source"){const{interpolationType:d,minZoom:f,maxZoom:g}=n,x=d?me(hr.interpolationFactor(d,e,f,g),0,1):0;n.kind==="camera"?l=ei(n.minSize,n.maxSize,x)*i:s=x*i}return{uSizeT:s,uSize:l}}class Id extends Tt{constructor(e,i,s,l,d){super(e,i),this.angle=l,this.z=s,d!==void 0&&(this.segment=d)}clone(){return new Id(this.x,this.y,this.z,this.angle,this.segment)}}function R1(n,e,i,s,l){if(e.segment===void 0)return!0;let d=e,f=e.segment+1,g=0;for(;g>-i/2;){if(f--,f<0)return!1;g-=n[f].dist(d),d=n[f]}g+=n[f].dist(n[f+1]),f++;const x=[];let b=0;for(;g<i/2;){const C=n[f],M=n[f+1];if(!M)return!1;let R=n[f-1].angleTo(C)-C.angleTo(M);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),x.push({distance:g,angleDelta:R}),b+=R;g-x[0].distance>s;)b-=x.shift().angleDelta;if(b>l)return!1;f++,g+=C.dist(M)}return!0}function D1(n){let e=0;for(let i=0;i<n.length-1;i++)e+=n[i].dist(n[i+1]);return e}function z1(n,e,i){return n?.6*e*i:0}function L1(n,e){return Math.max(n?n.right-n.left:0,e?e.right-e.left:0)}function BE(n,e,i,s,l,d){const f=z1(i,l,d),g=L1(i,s)*d;let x=0;const b=D1(n)/2;for(let C=0;C<n.length-1;C++){const M=n[C],R=n[C+1],P=M.dist(R);if(x+P>b){const F=(b-x)/P,V=ei(M.x,R.x,F),q=ei(M.y,R.y,F),$=new Id(V,q,0,R.angleTo(M),C);return!f||R1(n,$,g,f,e)?$:void 0}x+=P}}function FE(n,e,i,s,l,d,f,g,x){const b=z1(s,d,f),C=L1(s,l),M=C*f,R=n[0].x===0||n[0].x===x||n[0].y===0||n[0].y===x;return e-M<e/4&&(e=M+e/4),P1(n,R?e/2*g%e:(C/2+2*d)*f*g%e,e,b,i,M,R,!1,x)}function P1(n,e,i,s,l,d,f,g,x){const b=d/2,C=D1(n);let M=0,R=e-i,P=[];for(let F=0;F<n.length-1;F++){const V=n[F],q=n[F+1],$=V.dist(q),te=q.angleTo(V);for(;R+i<M+$;){R+=i;const ne=(R-M)/$,G=ei(V.x,q.x,ne),ee=ei(V.y,q.y,ne);if(G>=0&&G<x&&ee>=0&&ee<x&&R-b>=0&&R+b<=C){const re=new Id(G,ee,0,te,F);s&&!R1(n,re,d,s,l)||P.push(re)}}M+=$}return g||P.length||f||(P=P1(n,M/2,i,s,l,d,f,!0,x)),P}function O1(n){let e=0,i=0;for(const f of n)e+=f.w*f.h,i=Math.max(i,f.w);n.sort((f,g)=>g.h-f.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let l=0,d=0;for(const f of n)for(let g=s.length-1;g>=0;g--){const x=s[g];if(!(f.w>x.w||f.h>x.h)){if(f.x=x.x,f.y=x.y,d=Math.max(d,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===x.w&&f.h===x.h){const b=s.pop();g<s.length&&(s[g]=b)}else f.h===x.h?(x.x+=f.w,x.w-=f.w):f.w===x.w?(x.y+=f.h,x.h-=f.h):(s.push({x:x.x+f.w,y:x.y,w:x.w-f.w,h:f.h}),x.y+=f.h,x.h-=f.h);break}}return{w:l,h:d,fill:e/(l*d)||0}}Pt(Id,"Anchor");const Hp=1;class Z_{static getImagePositionScale(e,i,s){if(i&&e&&e.options&&e.options.transform){const l=e.options.transform;return{x:l.a,y:l.d}}return{x:s,y:s}}constructor(e,i,s,l){this.paddedRect=e;const{pixelRatio:d,version:f,stretchX:g,stretchY:x,content:b,sdf:C,usvg:M}=i;this.pixelRatio=d,this.stretchX=g,this.stretchY=x,this.content=b,this.version=f,this.padding=s,this.sdf=C,this.usvg=M,this.scale=Z_.getImagePositionScale(l,M,d)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Yv(n,e,i){const s=Ca.parse(n),l=function(d,f,g=[1,1]){return{x:0,y:0,w:(d.data?d.data.width:d.width*g[0])+2*f,h:(d.data?d.data.height:d.height*g[1])+2*f}}(e,i,[s.options.transform.a,s.options.transform.d]);return{bin:l,imagePosition:new Z_(l,e,i,s),imageVariant:s}}class k1{constructor(e,i,s){const l=new Map,d=new Map;this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,Hp,f),this.addImages(i,d,2,f);const{w:g,h:x}=O1(f),b=new cs({width:g||1,height:x||1});for(const[C,M]of e.entries()){const R=l.get(C).paddedRect;cs.copy(M.data,b,{x:0,y:0},{x:R.x+Hp,y:R.y+Hp},M.data,s,M.sdf)}for(const[C,M]of i.entries()){const R=d.get(C),P=R.paddedRect;let F=R.padding;const V=P.x+F,q=P.y+F,$=M.data.width,te=M.data.height;F=F>1?F-1:F,cs.copy(M.data,b,{x:0,y:0},{x:V,y:q},M.data,s),cs.copy(M.data,b,{x:0,y:te-F},{x:V,y:q-F},{width:$,height:F},s),cs.copy(M.data,b,{x:0,y:0},{x:V,y:q+te},{width:$,height:F},s),cs.copy(M.data,b,{x:$-F,y:0},{x:V-F,y:q},{width:F,height:te},s),cs.copy(M.data,b,{x:0,y:0},{x:V+$,y:q},{width:F,height:te},s),cs.copy(M.data,b,{x:$-F,y:te-F},{x:V-F,y:q-F},{width:F,height:F},s),cs.copy(M.data,b,{x:0,y:te-F},{x:V+$,y:q-F},{width:F,height:F},s),cs.copy(M.data,b,{x:0,y:0},{x:V+$,y:q+te},{width:F,height:F},s),cs.copy(M.data,b,{x:$-F,y:0},{x:V-F,y:q+te},{width:F,height:F},s)}this.lut=s,this.image=b,this.iconPositions=l,this.patternPositions=d}addImages(e,i,s,l){for(const[d,f]of e.entries()){const{bin:g,imagePosition:x,imageVariant:b}=Yv(d,f,s);i.set(d,x),l.push(g),f.hasRenderCallback&&this.haveRenderCallbacks.push(b.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const l of e.getUpdatedImages(s)){for(const d of this.iconPositions.keys()){const f=Ca.parse(d);if(io.isEqual(f.id,l)){const g=e.getImage(l,s);this.patchUpdatedImage(this.iconPositions.get(d),g,i)}}for(const d of this.patternPositions.keys()){const f=Ca.parse(d);if(io.isEqual(f.id,l)){const g=e.getImage(l,s);this.patchUpdatedImage(this.patternPositions.get(d),g,i)}}}}patchUpdatedImage(e,i,s){if(!e||!i||e.version===i.version)return;e.version=i.version;const[l,d]=e.tl,f=e.sdf;if(this.lut||f){const g={width:i.data.width,height:i.data.height},x=new cs(g);cs.copy(i.data,x,{x:0,y:0},{x:0,y:0},g,this.lut,f),s.update(x,{position:{x:l,y:d}})}else s.update(i.data,{position:{x:l,y:d}})}}Pt(Z_,"ImagePosition"),Pt(k1,"ImageAtlas");const gy=1e20;function B1(n,e,i,s,l,d,f,g,x){for(let b=e;b<e+s;b++)F1(n,i*d+b,d,l,f,g,x);for(let b=i;b<i+l;b++)F1(n,b*d+e,1,s,f,g,x)}function F1(n,e,i,s,l,d,f){d[0]=0,f[0]=-1e20,f[1]=gy,l[0]=n[e];for(let g=1,x=0,b=0;g<s;g++){l[g]=n[e+g*i];const C=g*g;do{const M=d[x];b=(l[g]-l[M]+C-M*M)/(g-M)/2}while(b<=f[x]&&--x>-1);x++,d[x]=g,f[x]=b,f[x+1]=gy}for(let g=0,x=0;g<s;g++){for(;f[x+1]<g;)x++;const b=d[x],C=g-b;n[e+g*i]=l[b]+C*C}}const hu=2,Kv={none:0,ideographs:1,all:2};class Um{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,s){const l=[],d=this.urls[i]||Qr.GLYPHS_URL;for(const f in e)for(const g of e[f])l.push({stack:f,id:g});Ae(l,({stack:f,id:g},x)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=b.glyphs[g];if(C!==void 0)return void x(null,{stack:f,id:g,glyph:C});if(C=this._tinySDF(b,f,g),C)return b.glyphs[g]=C,void x(null,{stack:f,id:g,glyph:C});const M=Math.floor(g/256);if(256*M>65535)return vi("glyphs > 65535 not supported"),void x(null,{stack:f,id:g,glyph:C});if(b.ranges[M])return void x(null,{stack:f,id:g,glyph:C});let R=b.requests[M];R||(R=b.requests[M]=[],Um.loadGlyphRange(f,M,d,this.requestManager,(P,F)=>{if(F){b.ascender=F.ascender,b.descender=F.descender;for(const V in F.glyphs)this._doesCharSupportLocalGlyph(+V)||(b.glyphs[+V]=F.glyphs[+V]);b.ranges[M]=!0}for(const V of R)V(P,F);delete b.requests[M]})),R.push((P,F)=>{P?x(P):F&&x(null,{stack:f,id:g,glyph:F.glyphs[g]||null})})},(f,g)=>{if(f)s(f);else if(g){const x={};for(const{stack:b,id:C,glyph:M}of g)x[b]===void 0&&(x[b]={}),x[b].glyphs===void 0&&(x[b].glyphs={}),x[b].glyphs[C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics},x[b].ascender=this.entries[b].ascender,x[b].descender=this.entries[b].descender;s(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Kv.none&&(this.localGlyphMode===Kv.all?!!this.localFontFamily:!!this.localFontFamily&&(Zt["CJK Unified Ideographs"](e)||Zt["Hangul Syllables"](e)||Zt.Hiragana(e)||Zt.Katakana(e)||Zt["CJK Symbols and Punctuation"](e)||Zt["CJK Unified Ideographs Extension A"](e)||Zt["CJK Unified Ideographs Extension B"](e)||Zt.Osage(e)))}_tinySDF(e,i,s){const l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),d=e.tinySDF=new Um.TinySDF({fontFamily:l,fontWeight:V,fontSize:24*hu,buffer:3*hu,radius:8*hu}),d.fontWeight=V}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const f=String.fromCodePoint(s),{data:g,width:x,height:b,glyphWidth:C,glyphHeight:M,glyphLeft:R,glyphTop:P,glyphAdvance:F}=d.draw(f);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new ya({width:x,height:b},g),metrics:{width:C/hu,height:M/hu,left:R/hu,top:P/hu-27,advance:F/hu,localGlyph:!0}}}}Um.loadGlyphRange=function(n,e,i,s,l){const d=256*e,f=d+255,g=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",n).replace("{range}",`${d}-${f}`),Eu.Glyphs);cl(g,(x,b)=>{if(x)l(x);else if(b){const C={},M=function(R){return new my(R).readFields(RE,{})}(b);for(const R of M.glyphs)C[R.id]=R;l(null,{glyphs:C,ascender:M.ascender,descender:M.descender})}})},Um.TinySDF=class{constructor({fontSize:n=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:l="sans-serif",fontWeight:d="normal",fontStyle:f="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=i;const g=this.size=n+4*e,x=this._createCanvas(g),b=this.ctx=x.getContext("2d",{willReadFrequently:!0});b.font=`${f} ${d} ${n}px ${l}`,b.textBaseline="alphabetic",b.textAlign="left",b.fillStyle="black",this.gridOuter=new Float64Array(g*g),this.gridInner=new Float64Array(g*g),this.f=new Float64Array(g),this.z=new Float64Array(g+1),this.v=new Uint16Array(g)}_createCanvas(n){const e=document.createElement("canvas");return e.width=e.height=n,e}draw(n){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:l,actualBoundingBoxRight:d}=this.ctx.measureText(n),f=Math.ceil(i),g=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-l))),x=Math.min(this.size-this.buffer,f+Math.ceil(s)),b=g+2*this.buffer,C=x+2*this.buffer,M=Math.max(b*C,0),R=new Uint8ClampedArray(M),P={data:R,width:b,height:C,glyphWidth:g,glyphHeight:x,glyphTop:f,glyphLeft:0,glyphAdvance:e};if(g===0||x===0)return P;const{ctx:F,buffer:V,gridInner:q,gridOuter:$}=this;F.clearRect(V,V,g,x),F.fillText(n,V,V+f);const te=F.getImageData(V,V,g,x);$.fill(gy,0,M),q.fill(0,0,M);for(let ne=0;ne<x;ne++)for(let G=0;G<g;G++){const ee=te.data[4*(ne*g+G)+3]/255;if(ee===0)continue;const re=(ne+V)*b+G+V;if(ee===1)$[re]=0,q[re]=gy;else{const ae=.5-ee;$[re]=ae>0?ae*ae:0,q[re]=ae<0?ae*ae:0}}B1($,0,0,b,C,b,this.f,this.v,this.z),B1(q,V,V,g,x,b,this.f,this.v,this.z);for(let ne=0;ne<M;ne++){const G=Math.sqrt($[ne])-Math.sqrt(q[ne]);R[ne]=Math.round(255-255*(G/this.radius+this.cutoff))}return P}};const qp=Hp;function N1(n,e){return n+e[1]-e[0]}function U1(n,e,i,s,l=1){const d=[],f=n.imagePrimary,g=f.pixelRatio,x=f.paddedRect.w-2*qp,b=f.paddedRect.h-2*qp,C=(n.right-n.left)*l,M=(n.bottom-n.top)*l,R=f.stretchX||[[0,x]],P=f.stretchY||[[0,b]],F=R.reduce(N1,0),V=P.reduce(N1,0),q=x-F,$=b-V;let te=0,ne=F,G=0,ee=V,re=0,ae=q,Te=0,ve=$;if(f.content&&s){const Me=f.content;te=yy(R,0,Me[0]),G=yy(P,0,Me[1]),ne=yy(R,Me[0],Me[2]),ee=yy(P,Me[1],Me[3]),re=Me[0]-te,Te=Me[1]-G,ae=Me[2]-Me[0]-ne,ve=Me[3]-Me[1]-ee}const Se=(Me,je,ct,et)=>{const at=vy(Me.stretch-te,ne,C,n.left*l),ft=xy(Me.fixed-re,ae,Me.stretch,F),He=vy(je.stretch-G,ee,M,n.top*l),st=xy(je.fixed-Te,ve,je.stretch,V),Ve=vy(ct.stretch-te,ne,C,n.left*l),Ge=xy(ct.fixed-re,ae,ct.stretch,F),_t=vy(et.stretch-G,ee,M,n.top*l),yt=xy(et.fixed-Te,ve,et.stretch,V),Qt=new Tt(at,He),jt=new Tt(Ve,He),At=new Tt(Ve,_t),mt=new Tt(at,_t),_i=new Tt(ft/g,st/g),Vt=new Tt(Ge/g,yt/g),Gt=e*Math.PI/180;if(Gt){const zi=Math.sin(Gt),fn=Math.cos(Gt),Vn=[fn,-zi,zi,fn];Qt._matMult(Vn),jt._matMult(Vn),mt._matMult(Vn),At._matMult(Vn)}const ri=Me.stretch+Me.fixed,Si=ct.stretch+ct.fixed,bi=je.stretch+je.fixed,Di=et.stretch+et.fixed,Ei=n.imageSecondary;return{tl:Qt,tr:jt,bl:mt,br:At,texPrimary:{x:f.paddedRect.x+qp+ri,y:f.paddedRect.y+qp+bi,w:Si-ri,h:Di-bi},texSecondary:Ei?{x:Ei.paddedRect.x+qp+ri,y:Ei.paddedRect.y+qp+bi,w:Si-ri,h:Di-bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:_i,pixelOffsetBR:Vt,minFontScaleX:ae/g/C,minFontScaleY:ve/g/M,isSDF:i}};if(s&&(f.stretchX||f.stretchY)){const Me=V1(R,q,F),je=V1(P,$,V);for(let ct=0;ct<Me.length-1;ct++){const et=Me[ct],at=Me[ct+1];for(let ft=0;ft<je.length-1;ft++)d.push(Se(et,je[ft],at,je[ft+1]))}}else d.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:b+1}));return d}function yy(n,e,i){let s=0;for(const l of n)s+=Math.max(e,Math.min(i,l[1]))-Math.max(e,Math.min(i,l[0]));return s}function V1(n,e,i){const s=[{fixed:-1,stretch:0}];for(const[l,d]of n){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(d-l)})}return s.push({fixed:e+qp,stretch:i}),s}function vy(n,e,i,s){return n/e*i+s}function xy(n,e,i,s){return n-e*i/s}function NE(n,e,i,s){const l=e+n.positionedLines[s].lineOffset;return s===0?i+l/2:i+(l+(e+n.positionedLines[s-1].lineOffset))/2}function UE(n,e=1,i=!1){let s=1/0,l=1/0,d=-1/0,f=-1/0;const g=n[0];for(let P=0;P<g.length;P++){const F=g[P];(!P||F.x<s)&&(s=F.x),(!P||F.y<l)&&(l=F.y),(!P||F.x>d)&&(d=F.x),(!P||F.y>f)&&(f=F.y)}const x=Math.min(d-s,f-l);let b=x/2;const C=new Nh([],VE);if(x===0)return new Tt(s,l);for(let P=s;P<d;P+=x)for(let F=l;F<f;F+=x)C.push(new Vm(P+b,F+b,b,n));let M=function(P){let F=0,V=0,q=0;const $=P[0];for(let te=0,ne=$.length,G=ne-1;te<ne;G=te++){const ee=$[te],re=$[G],ae=ee.x*re.y-re.x*ee.y;V+=(ee.x+re.x)*ae,q+=(ee.y+re.y)*ae,F+=3*ae}return new Vm(V/F,q/F,0,P)}(n),R=C.length;for(;C.length;){const P=C.pop();(P.d>M.d||!M.d)&&(M=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,R)),P.max-M.d<=e||(b=P.h/2,C.push(new Vm(P.p.x-b,P.p.y-b,b,n)),C.push(new Vm(P.p.x+b,P.p.y-b,b,n)),C.push(new Vm(P.p.x-b,P.p.y+b,b,n)),C.push(new Vm(P.p.x+b,P.p.y+b,b,n)),R+=4)}return i&&(console.log(`num probes: ${R}`),console.log(`best distance: ${M.d}`)),M.p}function VE(n,e){return e.max-n.max}class Vm{constructor(e,i,s,l){this.p=new Tt(e,i),this.h=s,this.d=function(d,f){let g=!1,x=1/0;for(let b=0;b<f.length;b++){const C=f[b];for(let M=0,R=C.length,P=R-1;M<R;P=M++){const F=C[M],V=C[P];F.y>d.y!=V.y>d.y&&d.x<(V.x-F.x)*(d.y-F.y)/(V.y-F.y)+F.x&&(g=!g),x=Math.min(x,hh(d,F,V))}}return(g?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}const jE=Object.keys,Qv=Number.POSITIVE_INFINITY,GE=Math.sqrt(2);function j1(n,[e,i]){let s=0,l=0;if(i===Qv){e<0&&(e=0);const d=e/GE;switch(n){case"top-right":case"top-left":l=d-7;break;case"bottom-right":case"bottom-left":l=7-d;break;case"bottom":l=7-e;break;case"top":l=e-7}switch(n){case"top-right":case"bottom-right":s=-d;break;case"top-left":case"bottom-left":s=d;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),n){case"top-right":case"top-left":case"top":l=i-7;break;case"bottom-right":case"bottom-left":case"bottom":l=7-i}switch(n){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,l]}function by(n,e,i,s,l,d,f,g,x){if(!e||!e.usvg)return;const b=I1(s),C=I1(l),M=d!=="both"&&d!=="width"||!A1(s)?1:C.width/b.width,R=d!=="both"&&d!=="height"||!C1(s)?1:C.height/b.height;i.scaleSelf(M,R);const P=i.toString();f.set(P,i),g.set(P,e);const{imagePosition:F}=Yv(P,e,Hp);x.set(P,F)}function G1(n,e,i,s,l,d,f,g,x){if(!n)return;const b=function(C,M,R,P,F,V){if(C.kind==="camera")return C.maxSize;if(C.kind==="composite"){const q=M.possiblyEvaluate(new hn(C.maxZoom,{worldview:V}),R).evaluate(F,{},R),$=M.possiblyEvaluate(new hn(C.minZoom,{worldview:V}),R).evaluate(F,{},R);return Math.max(q,$)}return M.possiblyEvaluate(new hn(P,{worldview:V})).evaluate(F,{},R)}(e,i,s,l,d,x);return n.scaleSelf(b*g*f)}function H1(n,e,i,s,l,d,f,g,x){return{iconPrimary:G1(n.getPrimary(),e,i,s,l,d,f,g,x),iconSecondary:G1(n.getSecondary(),e,i,s,l,d,f,g,x)}}function HE(n,e,i){if(!e)return;const s=i.get(n.toString()),l=i.get(e.toString());l&&(s.paddedRect.w===l.paddedRect.w&&s.paddedRect.h===l.paddedRect.h||vi(`Mismatch in icon variant sizes: ${n.toString()} and ${e.toString()}`),s.usvg!==l.usvg&&vi(`Mismatch in icon variant image types: ${n.id} and ${e.id}`))}function q1(n,e,i,s){if(!n)return;const l=e.get(i.toString());if(n.imagePrimary=l,s){const d=e.get(s.toString());n.imageSecondary=d}}function qE(n,e){for(const i in n.horizontal)Z1(n.horizontal[i],e);Z1(n.vertical,e)}function Z1(n,e){if(n){for(const i of n.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const l=s.image.toString();s.rect=e.get(l).paddedRect}}}function Jv(n){switch(n){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ZE(n,e,i,s,l,d,f,g,x){const b=e0(d.horizontal)||d.vertical,C=i.get("icon-text-fit-padding").evaluate(s,{},l);let M,R=e;return e&&x!=="none"&&(n.allowVerticalPlacement&&d.vertical&&(M=E1(e,d.vertical,x,C,g,f)),b&&(R=E1(e,b,x,C,g,f))),{defaultShapedIcon:R,verticallyShapedIcon:M}}function XE(n,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$,te,ne){let G=f.textMaxSize.evaluate(e,{},R);G===void 0?G=g*f.textScaleFactor:G*=f.textScaleFactor;const ee=n.layers[0].layout,re=e0(i.horizontal)||i.vertical,ae=P.name==="globe",Te=_s,ve=n.tilePixelRatio*G/Te,Se=(ft=n.overscaling,n.zoom>18&&ft>2&&(ft>>=1),Math.max(vt/(512*ft),1)*ee.get("symbol-spacing")),Me=ee.get("text-padding")*n.tilePixelRatio,je=ee.get("icon-padding")*n.tilePixelRatio,ct=en(ee.get("text-max-angle")),et=ee.get("icon-rotation-alignment")==="map"&&ne!=="point",at=Se/2;var ft;n.hasAnyIconTextFit===!1&&q!=="none"&&(n.hasAnyIconTextFit=!0);const He=e.properties?+e.properties[ii]:null,st=He&&n.elevationFeatureIdToIndex?n.elevationFeatureIdToIndex.get(He):65535,Ve=(Ge,_t,yt)=>{if(_t.x<0||_t.x>=vt||_t.y<0||_t.y>=vt)return;let Qt=null;if(ae){const{x:jt,y:At,z:mt}=P.projectTilePoint(_t.x,_t.y,yt);Qt={anchor:new Id(jt,At,mt,0,void 0),up:P.upVector(yt,_t.x,_t.y)}}(function(jt,At,mt,_i,Vt,Gt,ri,Si,bi,Di,Ei,zi,fn,Vn,se,ue,Xe,bt,Ct,Et,Ut,ni,Ni,Ui,Ai,mn,kn,Vi,fr){const jn=jt.addToLineVertexArray(At,_i);let pn,wr,Wn,Bn,Gn,vn,Mi,En=0,pr=0,ti=0,Yi=0,$n=-1,yr=-1;const er={};let jr=Mc("");const In=mt?mt.anchor:At,Br=Vi!=="none";let Xo=0,js=0;if(bi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Gr=bi.layout.get("text-offset").evaluate(Ut,{},Ai);Xo=Gr[0]*_s,js=Gr[1]*_s}else Xo=bi.layout.get("text-radial-offset").evaluate(Ut,{},Ai)*_s,js=Qv;if(jt.allowVerticalPlacement&&Vt.vertical){const Gr=Vt.vertical;if(se)vn=t0(Gr),Si&&(Mi=t0(Si));else{const is=bi.layout.get("text-rotate").evaluate(Ut,{},Ai)+90;Wn=wy(Di,In,At,Ei,zi,fn,Gr,Vn,is,ue),Si&&(Bn=wy(Di,In,At,Ei,zi,fn,Si,bt,is))}}if(Gt){const Gr=jt.iconSizeData,is=bi.layout.get("icon-rotate").evaluate(Ut,{},Ai),Gs=U1(Gt,is,Ni,Br,ni.iconScaleFactor),ho=Si?U1(Si,is,Ni,Br,ni.iconScaleFactor):void 0;wr=wy(Di,In,At,Ei,zi,fn,Gt,bt,is,null),En=4*Gs.length;let Js=null;Gr.kind==="source"?(Js=[vh*bi.layout.get("icon-size").evaluate(Ut,{},Ai)*ni.iconScaleFactor],Js[0]>zf&&vi(`${jt.layerIds[0]}: Value for "icon-size" is >= ${X_}. Reduce your "icon-size".`)):Gr.kind==="composite"&&(Js=[vh*ni.compositeIconSizes[0].evaluate(Ut,{},Ai)*ni.iconScaleFactor,vh*ni.compositeIconSizes[1].evaluate(Ut,{},Ai)*ni.iconScaleFactor],(Js[0]>zf||Js[1]>zf)&&vi(`${jt.layerIds[0]}: Value for "icon-size" is >= ${X_}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Gs,Js,Et,Ct,Ut,void 0,mt,At,jn.lineStartIndex,jn.lineLength,-1,Ui,Ai,mn,kn),$n=jt.icon.placedSymbolArray.length-1,ho&&(pr=4*ho.length,jt.addSymbols(jt.icon,ho,Js,Et,Ct,Ut,xa.vertical,mt,At,jn.lineStartIndex,jn.lineLength,-1,Ui,Ai,mn,kn),yr=jt.icon.placedSymbolArray.length-1)}for(const Gr in Vt.horizontal){const is=Gr,Gs=Vt.horizontal[is];pn||(jr=Mc(Gs.text),se?Gn=t0(Gs):pn=wy(Di,In,At,Ei,zi,fn,Gs,Vn,bi.layout.get("text-rotate").evaluate(Ut,{},Ai),ue));const ho=Gs.positionedLines.length===1;if(ti+=X1(jt,mt,At,Gs,ri,bi,se,Ut,ue,jn,Vt.vertical?xa.horizontal:xa.horizontalOnly,ho?jE(Vt.horizontal):[is],er,$n,ni,Ui,Ai,mn),ho)break}Vt.vertical&&(Yi+=X1(jt,mt,At,Vt.vertical,ri,bi,se,Ut,ue,jn,xa.vertical,["vertical"],er,yr,ni,Ui,Ai,mn));let zs=-1;const Wo=(Gr,is)=>Gr?Math.max(Gr,is):is;zs=Wo(Gn,zs),zs=Wo(vn,zs),zs=Wo(Mi,zs);const xh=zs>-1?1:0;jt.glyphOffsetArray.length>=65535&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ut.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,Ut.sortKey),jt.symbolInstances.emplaceBack(At.x,At.y,In.x,In.y,In.z,er.right>=0?er.right:-1,er.center>=0?er.center:-1,er.left>=0?er.left:-1,er.vertical>=0?er.vertical:-1,$n,yr,jr,pn!==void 0?pn:jt.collisionBoxArray.length,pn!==void 0?pn+1:jt.collisionBoxArray.length,Wn!==void 0?Wn:jt.collisionBoxArray.length,Wn!==void 0?Wn+1:jt.collisionBoxArray.length,wr!==void 0?wr:jt.collisionBoxArray.length,wr!==void 0?wr+1:jt.collisionBoxArray.length,Bn||jt.collisionBoxArray.length,Bn?Bn+1:jt.collisionBoxArray.length,Ei,ti,Yi,En,pr,xh,0,Xo,js,zs,0,Br?1:0,fr)})(n,_t,Qt,Ge,i,s,d,l,n.layers[0],n.collisionBoxArray,e.index,e.sourceLayerIndex,n.index,Me,te,b,0,je,et,$,e,f,C,M,R,F,V,q,st)};if(ne==="line")for(const Ge of h(e.geometry,0,0,vt,vt)){const _t=FE(Ge,Se,ct,i.vertical||re,s,Te,ve,n.overscaling,vt);for(const yt of _t)re&&WE(n,re.text,at,yt)||Ve(Ge,yt,R)}else if(ne==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const _t=BE(Ge,ct,i.vertical||re,s,Te,ve);_t&&Ve(Ge,_t,R)}}else if(e.type==="Polygon")for(const Ge of zp(e.geometry,0)){const _t=UE(Ge,16);Ve(Ge[0],new Id(_t.x,_t.y,0,0,void 0),R)}else if(e.type==="LineString")for(const Ge of e.geometry)Ve(Ge,new Id(Ge[0].x,Ge[0].y,0,0,void 0),R);else if(e.type==="Point")for(const Ge of e.geometry)for(const _t of Ge)Ve([_t],new Id(_t.x,_t.y,0,0,void 0),R)}const X_=255,zf=X_*vh;function X1(n,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q,$){const te=function(ee,re,ae,Te,ve,Se,Me,je){const ct=[];if(re.positionedLines.length===0)return ct;const et=Te.layout.get("text-rotate").evaluate(Se,{})*Math.PI/180,at=function(Ge){const _t=Ge[0],yt=Ge[1],Qt=_t*yt;return Qt>0?[_t,-yt]:Qt<0?[-_t,yt]:_t===0?[yt,_t]:[yt,-_t]}(ae);let ft=Math.abs(re.top-re.bottom);for(const Ge of re.positionedLines)ft-=Ge.lineOffset;const He=re.positionedLines.length,st=ft/He;let Ve=re.top-ae[1];for(let Ge=0;Ge<He;++Ge){const _t=re.positionedLines[Ge];Ve=NE(re,st,Ve,Ge);for(const yt of _t.positionedGlyphs){if(!yt.rect)continue;const Qt=yt.rect||{};let jt=LE+1,At=!0,mt=1,_i=0;if(yt.image){const Ut=Me.get(yt.image.toString());if(!Ut)continue;if(Ut.sdf){vi("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,mt=Ut.pixelRatio,jt=Hp/mt}const Vt=(ve||je)&&yt.vertical,Gt=yt.metrics.advance*yt.scale/2,ri=yt.metrics,Si=yt.rect;if(Si===null)continue;je&&re.verticalizable&&(_i=yt.image?Gt-yt.metrics.width*yt.scale/2:0);const bi=ve?[yt.x+Gt,yt.y]:[0,0];let Di=[0,0],Ei=[0,0],zi=!1;ve||(Vt?(Ei=[yt.x+Gt+at[0],yt.y+at[1]-_i],zi=!0):Di=[yt.x+Gt+ae[0],yt.y+ae[1]-_i]);const fn=Si.w*yt.scale/(mt*(yt.localGlyph?hu:1)),Vn=Si.h*yt.scale/(mt*(yt.localGlyph?hu:1));let se,ue,Xe,bt;if(Vt){const Ut=yt.y-Ve,ni=new Tt(-Gt,Gt-Ut),Ni=-Math.PI/2,Ui=new Tt(...Ei);se=new Tt(-Gt+Di[0],Di[1]),se._rotateAround(Ni,ni)._add(Ui),se.x+=-Ut+Gt,se.y-=(ri.left-jt)*yt.scale;const Ai=yt.image?ri.advance*yt.scale:_s*yt.scale,mn=String.fromCodePoint(yt.glyph);CE(mn)?se.x+=(1-jt)*yt.scale:IE(mn)?se.x+=Ai-ri.height*yt.scale+(-jt-1)*yt.scale:se.x+=yt.image||ri.width+2*jt===Si.w&&ri.height+2*jt===Si.h?(Ai-Vn)/2:(Ai-(ri.height+2*jt)*yt.scale)/2,ue=new Tt(se.x,se.y-fn),Xe=new Tt(se.x+Vn,se.y),bt=new Tt(se.x+Vn,se.y-fn)}else{const Ut=(ri.left-jt)*yt.scale-Gt+Di[0],ni=(-ri.top-jt)*yt.scale+Di[1],Ni=Ut+fn,Ui=ni+Vn;se=new Tt(Ut,ni),ue=new Tt(Ni,ni),Xe=new Tt(Ut,Ui),bt=new Tt(Ni,Ui)}if(et){let Ut;Ut=ve?new Tt(0,0):zi?new Tt(at[0],at[1]):new Tt(ae[0],ae[1]),se._rotateAround(et,Ut),ue._rotateAround(et,Ut),Xe._rotateAround(et,Ut),bt._rotateAround(et,Ut)}const Ct=new Tt(0,0),Et=new Tt(0,0);ct.push({tl:se,tr:ue,bl:Xe,br:bt,texPrimary:Qt,texSecondary:void 0,writingMode:re.writingMode,glyphOffset:bi,sectionIndex:yt.sectionIndex,isSDF:At,pixelOffsetTL:Ct,pixelOffsetBR:Et,minFontScaleX:0,minFontScaleY:0})}}return ct}(0,s,x,d,f,g,l,n.allowVerticalPlacement),ne=n.textSizeData;let G=null;ne.kind==="source"?(G=[vh*d.layout.get("text-size").evaluate(g,{},q)*F.textScaleFactor],G[0]>zf&&vi(`${n.layerIds[0]}: Value for "text-size" is >= ${X_}. Reduce your "text-size".`)):ne.kind==="composite"&&(G=[vh*F.compositeTextSizes[0].evaluate(g,{},q)*F.textScaleFactor,vh*F.compositeTextSizes[1].evaluate(g,{},q)*F.textScaleFactor],(G[0]>zf||G[1]>zf)&&vi(`${n.layerIds[0]}: Value for "text-size" is >= ${X_}. Reduce your "text-size".`)),n.addSymbols(n.text,te,G,x,f,g,C,e,i,b.lineStartIndex,b.lineLength,P,V,q,$,!1);for(const ee of M)R[ee]=n.text.placedSymbolArray.length-1;return 4*te.length}function e0(n){for(const e in n)return n[e];return null}function wy(n,e,i,s,l,d,f,g,x,b){let C=f.top,M=f.bottom,R=f.left,P=f.right;if(S1(f)&&f.collisionPadding){const F=f.collisionPadding;R-=F[0],C-=F[1],P+=F[2],M+=F[3]}if(x){const F=new Tt(R,C),V=new Tt(P,C),q=new Tt(R,M),$=new Tt(P,M),te=en(x);let ne=new Tt(0,0);b&&(ne=new Tt(b[0],b[1])),F._rotateAround(te,ne),V._rotateAround(te,ne),q._rotateAround(te,ne),$._rotateAround(te,ne),R=Math.min(F.x,V.x,q.x,$.x),P=Math.max(F.x,V.x,q.x,$.x),C=Math.min(F.y,V.y,q.y,$.y),M=Math.max(F.y,V.y,q.y,$.y)}return n.emplaceBack(e.x,e.y,e.z,i.x,i.y,R,C,P,M,g,s,l,d),n.length-1}function t0(n){S1(n)&&n.collisionPadding&&(n.top-=n.collisionPadding[1],n.bottom+=n.collisionPadding[3]);const e=n.bottom-n.top;return e>0?Math.max(10,e):null}function WE(n,e,i,s){const l=n.compareText;if(e in l){const d=l[e];for(let f=d.length-1;f>=0;f--)if(s.dist(d[f])<i)return!0}else l[e]=[];return l[e].push(s),!1}function W1(n,e){const i=n.fovAboveCenter,s=n.elevation?n.elevation.getMinElevationBelowMSL()*e:0,l=(n._camera.position[2]*n.worldSize-s)/Math.cos(n._pitch),d=Math.sin(i)*l/Math.sin(Math.max(Math.PI/2-n._pitch-i,.01));let f=Math.sin(n._pitch)*d+l;const g=l*(1/n._horizonShift);if(!n.elevation||n.elevation.exaggeration()===0){let x=Math.max(n.zoom-17,0);n.isOrthographic&&(x/=10),f*=1+x}return Math.min(1.01*f,g)}function W_(n,e){if(!e.isReprojectedInTileSpace)return{scale:1<<n.z,x:n.x,y:n.y,x2:n.x+1,y2:n.y+1,projection:e};const i=Math.pow(2,-n.z),s=n.x*i,l=(n.x+1)*i,d=n.y*i,f=(n.y+1)*i,g=be(s),x=be(l),b=De(d),C=De(f),M=e.project(g,b),R=e.project(x,b),P=e.project(x,C),F=e.project(g,C);let V=Math.min(M.x,R.x,P.x,F.x),q=Math.min(M.y,R.y,P.y,F.y),$=Math.max(M.x,R.x,P.x,F.x),te=Math.max(M.y,R.y,P.y,F.y);const ne=i/16;function G(re,ae,Te,ve,Se,Me){const je=(Te+Se)/2,ct=(ve+Me)/2,et=e.project(be(je),De(ct)),at=Math.max(0,V-et.x,q-et.y,et.x-$,et.y-te);V=Math.min(V,et.x),$=Math.max($,et.x),q=Math.min(q,et.y),te=Math.max(te,et.y),at>ne&&(G(re,et,Te,ve,je,ct),G(et,ae,je,ct,Se,Me))}G(M,R,s,d,l,d),G(R,P,l,d,l,f),G(P,F,l,f,s,f),G(F,M,s,f,s,d),V-=ne,q-=ne,$+=ne,te+=ne;const ee=1/Math.max($-V,te-q);return{scale:ee,x:V*ee,y:q*ee,x2:$*ee,y2:te*ee,projection:e}}function $1(n,{x:e,y:i},s=0){return new Tt(((e-s)*n.scale-n.x)*vt,(i*n.scale-n.y)*vt)}const $E=Yt(new Float32Array(16));class Lf{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new J(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,l=!0){return e._coordinatePoint(e.locationCoordinate(i,s),l)}pixelsPerMeter(e,i){return _e(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return W1(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,l){const d=e.horizonLineFromTop(!1),f=new Tt(i,Math.max(d,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(f,l))}pointCoordinate3D(e,i,s){const l=new Tt(i,s);if(e.elevation)return e.elevation.pointCoordinate(l);{const d=this.pointCoordinate(e,l.x,l.y,0);return[d.x,d.y,d.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return $E}createTileMatrix(e,i,s){let l,d,f;const g=s.canonical,x=Yt(new Float64Array(16));if(this.isReprojectedInTileSpace){const b=W_(g,this);l=1,d=b.x+s.wrap*b.scale,f=b.y,xn(x,x,[l/b.scale,l/b.scale,e.pixelsPerMeter/i])}else l=i/e.zoomScale(g.z),d=(g.x+Math.pow(2,g.z)*s.wrap)*l,f=g.y*l;return Yn(x,x,[d,f,0]),xn(x,x,[l/vt,l/vt,1]),x}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class YE extends Lf{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(en(i));this.n=(l+Math.sin(en(s)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:l,r0:d}=this,f=en(e-this.center[0]),g=en(i),x=Math.sqrt(l-2*s*Math.sin(g))/s;return{x:x*Math.sin(f*s),y:x*Math.cos(f*s)-d,z:0}}unproject(e,i){const{n:s,c:l,r0:d}=this,f=d+i;let g=Math.atan2(e,Math.abs(f))*Math.sign(f);f*s<0&&(g-=Math.PI*Math.sign(e)*Math.sign(f));const x=en(this.center[0])*s;g=Oe(g,-Math.PI-x,Math.PI-x);const b=me(Be(g/s)+this.center[0],-180,180),C=Math.asin(me((l-(e*e+f*f)*s*s)/(2*s),-1,1)),M=me(Be(C),-85.051129,qe);return new J(b,M)}}const $_=1.340264,Y_=-.081106,K_=893e-6,Q_=.003796,Ty=Math.sqrt(3)/2;class KE extends Lf{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Ty*Math.sin(i)),l=s*s,d=l*l*l;return{x:.5*(e*Math.cos(s)/(Ty*($_+3*Y_*l+d*(7*K_+9*Q_*l)))/Math.PI+.5),y:1-.5*(s*($_+Y_*l+d*(K_+Q_*l))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,l=s*s,d=l*l*l;for(let C,M,R,P=0;P<12&&(M=s*($_+Y_*l+d*(K_+Q_*l))-i,R=$_+3*Y_*l+d*(7*K_+9*Q_*l),C=M/R,s=me(s-C,-Math.PI/3,Math.PI/3),l=s*s,d=l*l*l,!(Math.abs(C)<1e-12));++P);const f=Ty*e*($_+3*Y_*l+d*(7*K_+9*Q_*l))/Math.cos(s),g=Math.asin(Math.sin(s)/Ty),x=me(180*f/Math.PI,-180,180),b=me(180*g/Math.PI,-85.051129,qe);return new J(x,b)}}class QE extends Lf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),l=me(360*(.5-i),-85.051129,qe);return new J(s,l)}}const jm=Math.PI/2;function Sy(n){return Math.tan((jm+n)/2)}class JE extends Lf{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let l=en(i),d=en(s);this.southernCenter=l+d<0,this.southernCenter&&(l=-l,d=-d);const f=Math.cos(l),g=Sy(l);this.n=l===d?Math.sin(l):Math.log(f/Math.cos(d))/Math.log(Sy(d)/g),this.f=f*Math.pow(Sy(l),this.n)/this.n}project(e,i){i=en(i),this.southernCenter&&(i=-i),e=en(e-this.center[0]);const s=1e-6,{n:l,f:d}=this;d>0?i<-jm+s&&(i=-jm+s):i>jm-s&&(i=jm-s);const f=d/Math.pow(Sy(i),l);let g=f*Math.sin(l*e),x=d-f*Math.cos(l*e);return g=.5*(g/Math.PI+.5),x=.5*(x/Math.PI+.5),{x:g,y:this.southernCenter?x:1-x,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:l}=this,d=l-i,f=Math.sign(d),g=Math.sign(s)*Math.sqrt(e*e+d*d);let x=Math.atan2(e,Math.abs(d))*f;d*s<0&&(x-=Math.PI*Math.sign(e)*f);const b=me(Be(x/s)+this.center[0],-180,180),C=me(Be(2*Math.atan(Math.pow(l/g,1/s))-jm),-85.051129,qe);return new J(b,this.southernCenter?-C:C)}}class Y1 extends Lf{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:de(e),y:he(i),z:0}}unproject(e,i){const s=be(e),l=De(i);return new J(s,l)}}const K1=en(qe);class e2 extends Lf{project(e,i){const s=(i=en(i))*i,l=s*s;return{x:.5*((e=en(e))*(.8707-.131979*s+l*(l*(.003971*s-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+l*(.028874*s-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,l=25,d=0,f=s*s;do{f=s*s;const b=f*f;d=(s*(1.007226+f*(.015085+b*(.028874*f-.044475-.005916*b)))-i)/(1.007226+f*(.045255+b*(.259866*f-.311325-.005916*11*b))),s=me(s-d,-K1,K1)}while(Math.abs(d)>1e-6&&--l>0);f=s*s;const g=me(Be(e/(.8707+f*(f*(f*f*f*(.003971-.001529*f)-.013791)-.131979))),-180,180),x=Be(s);return new J(g,x)}}const Q1=en(qe);class t2 extends Lf{project(e,i){i=en(i),e=en(e);const s=Math.cos(i),l=2/Math.PI,d=Math.acos(s*Math.cos(e/2)),f=Math.sin(d)/d,g=.5*(e*l+2*s*Math.sin(e/2)/f)||0,x=.5*(i+Math.sin(i)/f)||0;return{x:.5*(g/Math.PI+.5),y:1-.5*(x/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,l=i=(2*(1-i)-1)*Math.PI,d=25;const f=1e-6;let g=0,x=0;do{const b=Math.cos(l),C=Math.sin(l),M=2*C*b,R=C*C,P=b*b,F=Math.cos(s/2),V=Math.sin(s/2),q=2*F*V,$=V*V,te=1-P*F*F,ne=te?1/te:0,G=te?Math.acos(b*F)*Math.sqrt(1/te):0,ee=.5*(2*G*b*V+2*s/Math.PI)-e,re=.5*(G*C+l)-i,ae=.5*ne*(P*$+G*b*F*R)+1/Math.PI,Te=ne*(q*M/4-G*C*V),ve=.125*ne*(M*V-G*C*P*q),Se=.5*ne*(R*F+G*$*b)+.5,Me=Te*ve-Se*ae;g=(re*Te-ee*Se)/Me,x=(ee*ve-re*ae)/Me,s=me(s-g,-Math.PI,Math.PI),l=me(l-x,-Q1,Q1)}while((Math.abs(g)>f||Math.abs(x)>f)&&--d>0);return new J(Be(s),Be(l))}}class J1 extends Lf{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(en(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:l}=this;return{x:en(e)*l*s+.5,y:-Math.sin(en(i))/l*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:l}=this,d=-(i-.5)/s,f=me(Be((e-.5)/s)/l,-180,180),g=Math.asin(me(d*l,-1,1)),x=me(Be(g),-85.051129,qe);return new J(f,x)}}class i2 extends Y1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const l=_d(e,i,s);return cn(l,l,fh(yc(s))),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,i,s){const l=j(i.lat,i.lng),d=Ci([],l),f=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;Bt(l,l,d,_e(1,0)*vt*f);const g=Yt(new Float64Array(16));return Ji(g,e.pixelMatrix,e.globeMatrix),cn(l,l,g),new Tt(l[0],l[1])}pixelsPerMeter(e,i){return _e(1,0)*i}pixelSpaceConversion(e,i,s){const l=_e(1,e)*i,d=ei(_e(1,45)*i,l,s);return this.pixelsPerMeter(e,i)/d}createTileMatrix(e,i,s){const l=x_(yc(s.canonical));return Ji(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,i){const{center:s}=e,l=fh(yc(i));return _n(l,l,en(s.lng)),Nr(l,l,en(s.lat)),xn(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,i,s,l){return Ug(e,i,s,!0)||new Ee(0,0)}pointCoordinate3D(e,i,s){const l=this.pointCoordinate(e,i,s,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,i){return!Ug(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(l,d){const f=l.cameraToCenterDistance,g=l._centerAltitude*d,x=l._camera,b=l._camera.forward(),C=bn([],Le([],b,-f),[0,0,g]),M=l.worldSize/(2*Math.PI),R=[0,0,-M],P=l.width/l.height,F=Math.tan(l.fovAboveCenter),V=Le([],x.up(),F),q=Le([],x.right(),F*P),$=Ci([],bn([],bn([],b,V),q)),te=[];let ne;if(new Cn(C,$).closestPointOnSphere(R,M,te)){const G=bn([],te,R),ee=vr([],G,C);ne=Math.cos(l.fovAboveCenter)*Vr(ee)}else{const G=vr([],C,R),ee=vr([],R,C);Ci(ee,ee);const re=Vr(G)-M;ne=Math.sqrt(re*(re+2*M));const ae=Math.acos(ne/(M+re))-Math.acos(yi(b,ee));ne*=Math.cos(ae)}return 1.01*ne}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=ou(e.zoom);if(s>0){const l=W1(e,_e(1,e.center.lat)*e.worldSize),d=e.worldSize/(2*Math.PI),f=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ei(i,l+d*(1-Math.cos(f)),Math.pow(s,10))}return i}upVector(e,i,s){return _d(i,s,e,1)}upVectorScale(e){return{metersToTile:xr(vc(yc(e)))}}}function eb(n){const e=n.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(n.name){case"mercator":return new Y1(n);case"equirectangular":return new QE(n);case"naturalEarth":return new e2(n);case"equalEarth":return new KE(n);case"winkelTripel":return new t2(n);case"albers":return i?new J1(n):new YE(n);case"lambertConformalConic":return i?new J1(n):new JE(n);case"globe":return new i2(n)}throw new Error(`Invalid projection name: ${n.name}`)}const n2=mi.VectorTileFeature.types,r2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ey(n,e,i,s,l,d,f,g,x,b,C,M,R){const P=g?Math.min(zf,Math.round(g[0])):0,F=g?Math.min(zf,Math.round(g[1])):0;n.emplaceBack(e,i,Math.round(32*s),Math.round(32*l),d,f,(P<<1)+(x?1:0),F,16*b,16*C,256*M,256*R)}function Ay(n,e,i){n.emplaceBack(e,i)}function Cy(n,e,i,s,l,d,f){n.emplaceBack(e,i,s,l,d,f)}const Iy=(n,e,i,s)=>{for(let l=0;l<e;l++)n.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function My(n,e,i,s,l){n.emplaceBack(e,i,s,l),n.emplaceBack(e,i,s,l),n.emplaceBack(e,i,s,l),n.emplaceBack(e,i,s,l)}function s2(n){for(const e of n.sections)if(up(e.text))return!0;return!1}class i0{constructor(e){this.layoutVertexArray=new Jc,this.indexArray=new Sr,this.programConfigurations=e,this.segments=new or,this.dynamicLayoutVertexArray=new zr,this.opacityVertexArray=new tu,this.placedSymbolArray=new vp,this.iconTransitioningVertexArray=new os,this.globeExtVertexArray=new eu,this.zOffsetVertexArray=new pa,this.orientationVertexArray=new sd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,s,l,d){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,vE.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,r2,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,wE.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,yE.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||d)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,xE.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,bE.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Pt(i0,"SymbolBuffers");class n0{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new or,this.collisionVertexArray=new Vo,this.collisionVertexArrayExt=new zr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,TE.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,SE.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Pt(n0,"CollisionBuffers");class Ry{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(f=>f.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Yt([]),this.placementViewportMatrix=Yt([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=M1(this.zoom,i["text-size"],this.worldview),this.iconSizeData=M1(this.zoom,i["icon-size"],this.worldview);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=d!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(d==="viewport-y"||d==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(f=>xa[f]),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new i0(new c(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new i0(new c(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new uf,this.lineVertexArray=new xp,this.symbolInstances=new ms}calculateGlyphDependencies(e,i,s,l,d){for(const f of e){const g=f.codePointAt(0);if(g===void 0)break;if(i[g]=!0,l&&d&&g<=65535){const x=G_[f];x&&(i[x.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Cf(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}populate(e,i,s,l){const d=this.layers[0],f=d.layout,g=this.projection.name==="globe",x=f.get("text-font"),b=f.get("text-field"),C=f.get("icon-image"),[M,R]=f.get("icon-size-scale-range"),P=me(i.scaleFactor||1,M,R),F=(b.value.kind!=="constant"||b.value.value instanceof Ts&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),V=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,q=f.get("symbol-sort-key");if(this.features=[],!F&&!V)return;const $=i.iconDependencies,te=i.glyphDependencies,ne=i.availableImages,G=new hn(this.zoom,{worldview:this.worldview});for(const{feature:ee,id:re,index:ae,sourceLayerIndex:Te}of e){const ve=d._featureFilter.needGeometry,Se=Dt(ee,ve);if(!d._featureFilter.filter(G,Se,s))continue;if(ve||(Se.geometry=zt(ee,s,l)),g&&ee.type!==1&&s.z<=5){const at=Se.geometry,ft=.98078528056,He=(st,Ve)=>yi(_d(st.x,st.y,s,1),_d(Ve.x,Ve.y,s,1))<ft;for(let st=0;st<at.length;st++)at[st]=gt(at[st],He)}let Me,je;if(F){const at=d.getValueAndResolveTokens("text-field",Se,s,ne),ft=Ts.factory(at);s2(ft)&&(this.hasRTLText=!0),(!this.hasRTLText||Xc()==="unavailable"||this.hasRTLText&&Va.isParsed())&&(Me=AE(ft,d,Se))}if(V){const at=d.getValueAndResolveTokens("icon-image",Se,s,ne);je=typeof at=="string"?Jr.build(at):at}if(!Me&&!je)continue;const ct=this.sortFeaturesByKey?q.evaluate(Se,{},s):void 0,et={id:re,text:Me,icon:je,index:ae,sourceLayerIndex:Te,geometry:Se.geometry,properties:ee.properties,type:n2[ee.type],sortKey:ct};if(this.features.push(et),je){const at=this.layers[0]._unevaluatedLayout._values,{iconPrimary:ft,iconSecondary:He}=H1(je,this.iconSizeData,at["icon-size"],s,this.zoom,et,this.pixelRatio,P,this.worldview),st=ft.id.toString();if($.has(st)?$.get(st).push(ft):$.set(st,[ft]),He){const Ve=He.id.toString();$.has(Ve)?$.get(Ve).push(He):$.set(Ve,[He])}}if(Me){const at=x.evaluate(Se,{},s).join(","),ft=f.get("text-rotation-alignment")==="map"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(xa.vertical)>=0;for(const He of Me.sections)if(He.image){const st=He.image.getPrimary().scaleSelf(this.pixelRatio),Ve=st.id.toString(),Ge=$.get(Ve)||[];Ge.push(st),$.set(Ve,Ge)}else{const st=Dr(Me.toString()),Ve=He.fontStack||at,Ge=te[Ve]=te[Ve]||{};this.calculateGlyphDependencies(He.text,Ge,ft,this.allowVerticalPlacement,st)}}}if(f.get("symbol-placement")==="line"&&(this.features=function(ee){const re={},ae={},Te=[];let ve=0;function Se(et){Te.push(ee[et]),ve++}function Me(et,at,ft){const He=ae[et];return delete ae[et],ae[at]=He,Te[He].geometry[0].pop(),Te[He].geometry[0]=Te[He].geometry[0].concat(ft[0]),He}function je(et,at,ft){const He=re[at];return delete re[at],re[et]=He,Te[He].geometry[0].shift(),Te[He].geometry[0]=ft[0].concat(Te[He].geometry[0]),He}function ct(et,at,ft){const He=ft?at[0][at[0].length-1]:at[0][0];return`${et}:${He.x}:${He.y}`}for(let et=0;et<ee.length;et++){const at=ee[et],ft=at.geometry,He=at.text?at.text.toString():null;if(!He){Se(et);continue}const st=ct(He,ft),Ve=ct(He,ft,!0);if(st in ae&&Ve in re&&ae[st]!==re[Ve]){const Ge=je(st,Ve,ft),_t=Me(st,Ve,Te[Ge].geometry);delete re[st],delete ae[Ve],ae[ct(He,Te[_t].geometry,!0)]=_t,Te[Ge].geometry=null}else st in ae?Me(st,Ve,ft):Ve in re?je(st,Ve,ft):(Se(et),re[st]=ve-1,ae[Ve]=ve-1)}return Te.filter(et=>et.geometry)}(this.features)),f.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ee of i.elevationFeatures)this.elevationFeatureIdToIndex.set(ee.id,this.elevationFeatures.length),this.elevationFeatures.push(ee)}}else f.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ee,re)=>ee.sortKey-re.sortKey)}update(e,i,s,l,d,f,g){this.text.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,d,s,l,f,g,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=Ue(e),l=1/s;let d=!1,f=!1;for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g),b=rn(1,0,0),C=rn(0,1,0),{numHorizontalGlyphVertices:M,numVerticalGlyphVertices:R,numIconVertices:P,numVerticalIconVertices:F}=x,V=M>0||R>0,q=P>0,$=this.elevationFeatures[x.elevationFeatureIndex];if($){const te=new Tt(x.tileAnchorX,x.tileAnchorY),ne=.075+$.pointElevation(te);x.zOffset!==ne&&(i=!0,x.zOffset=ne);const G=$.computeSlopeNormal(te,l),ee=vu(Hs(),rn(0,0,1),G);Ao(b,b,ee),Ao(C,C,ee),b[2]*=s,C[2]*=s,b[0]===1&&b[1]===0&&b[2]===0&&C[0]===0&&C[1]===1&&C[2]===0||(d=d||V,f=f||q)}if(V&&(Iy(this.text.orientationVertexArray,M,b,C),Iy(this.text.orientationVertexArray,R,b,C)),q){const{placedIconSymbolIndex:te,verticalPlacedIconSymbolIndex:ne}=x;te>=0&&Iy(this.icon.orientationVertexArray,P,b,C),ne>=0&&Iy(this.icon.orientationVertexArray,F,b,C)}}d||(this.text.orientationVertexArray=void 0),f||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(d,f,g)=>{s+=f,s>d.length&&d.resize(s);for(let x=-f;x<0;x++)d.emplace(x+s,g)},i=(d,f,g)=>{l+=f,l>d.length&&d.resize(l);for(let x=-f;x<0;x++)d.emplace(x+l,g)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,l=0;for(let d=0;d<this.symbolInstances.length;d++){const f=this.symbolInstances.get(d),{numHorizontalGlyphVertices:g,numVerticalGlyphVertices:x,numIconVertices:b}=f,C=f.zOffset,M=b>0;if((g>0||x>0)&&(e(this.text.zOffsetVertexArray,g,C),e(this.text.zOffsetVertexArray,x,C)),M){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:P}=f;R>=0&&i(this.icon.zOffsetVertexArray,b,C),P>=0&&i(this.icon.zOffsetVertexArray,f.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=eb(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:l,y:d}of i)this.lineVertexArray.emplaceBack(l,d);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,l,d,f,g,x,b,C,M,R,P,F,V,q){const $=e.indexArray,te=e.layoutVertexArray,ne=e.globeExtVertexArray,G=e.segments.prepareSegment(4*i.length,te,$,this.canOverlap?f.sortKey:void 0),ee=this.glyphOffsetArray.length,re=G.vertexLength,ae=this.allowVerticalPlacement&&g===xa.vertical?Math.PI/2:0,Te=f.text&&f.text.sections;for(let Se=0;Se<i.length;Se++){const{tl:Me,tr:je,bl:ct,br:et,texPrimary:at,texSecondary:ft,pixelOffsetTL:He,pixelOffsetBR:st,minFontScaleX:Ve,minFontScaleY:Ge,glyphOffset:_t,isSDF:yt,sectionIndex:Qt}=i[Se],jt=G.vertexLength,At=_t[1];if(Ey(te,b.x,b.y,Me.x,At+Me.y,at.x,at.y,s,yt,He.x,He.y,Ve,Ge),Ey(te,b.x,b.y,je.x,At+je.y,at.x+at.w,at.y,s,yt,st.x,He.y,Ve,Ge),Ey(te,b.x,b.y,ct.x,At+ct.y,at.x,at.y+at.h,s,yt,He.x,st.y,Ve,Ge),Ey(te,b.x,b.y,et.x,At+et.y,at.x+at.w,at.y+at.h,s,yt,st.x,st.y,Ve,Ge),x){const{x:mt,y:_i,z:Vt}=x.anchor,[Gt,ri,Si]=x.up;Cy(ne,mt,_i,Vt,Gt,ri,Si),Cy(ne,mt,_i,Vt,Gt,ri,Si),Cy(ne,mt,_i,Vt,Gt,ri,Si),Cy(ne,mt,_i,Vt,Gt,ri,Si),My(e.dynamicLayoutVertexArray,mt,_i,Vt,ae)}else My(e.dynamicLayoutVertexArray,b.x,b.y,b.z,ae);if(q){const mt=ft||at;Ay(e.iconTransitioningVertexArray,mt.x,mt.y),Ay(e.iconTransitioningVertexArray,mt.x+mt.w,mt.y),Ay(e.iconTransitioningVertexArray,mt.x,mt.y+mt.h),Ay(e.iconTransitioningVertexArray,mt.x+mt.w,mt.y+mt.h)}$.emplaceBack(jt,jt+1,jt+2),$.emplaceBack(jt+1,jt+2,jt+3),G.vertexLength+=4,G.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(_t[0]),Se!==i.length-1&&Qt===i[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(te.length,f,f.index,{},P,F,V,Te&&Te[Qt],this.worldview)}const ve=x?x.anchor:b;e.placedSymbolArray.emplaceBack(ve.x,ve.y,ve.z,b.x,b.y,ee,this.glyphOffsetArray.length-ee,re,C,M,b.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],g,0,0,0,R,0)}_commitLayoutVertex(e,i,s,l,d,f,g){e.emplaceBack(i,s,l,d,f,Math.round(g.x),Math.round(g.y))}_addCollisionDebugVertices(e,i,s,l,d,f,g){const x=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),b=x.vertexLength,C=g.tileAnchorX,M=g.tileAnchorY;for(let P=0;P<4;P++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,g.zOffset),this._commitLayoutVertex(s.layoutVertexArray,l,d,f,C,M,new Tt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,d,f,C,M,new Tt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,l,d,f,C,M,new Tt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,l,d,f,C,M,new Tt(e.x1,e.y2)),x.vertexLength+=4;const R=s.indexArray;R.emplaceBack(b,b+1),R.emplaceBack(b+1,b+2),R.emplaceBack(b+2,b+3),R.emplaceBack(b+3,b),x.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,l,d,f){for(let g=l;g<d;g++){const x=s.get(g),b=this.getSymbolInstanceTextSize(e,f,i,g);this._addCollisionDebugVertices(x,b,this.textCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}_addIconDebugCollisionBoxes(e,i,s,l,d,f){for(let g=l;g<d;g++){const x=s.get(g),b=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._addCollisionDebugVertices(x,b,this.iconCollisionBox,x.projectedAnchorX,x.projectedAnchorY,x.projectedAnchorZ,f)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new n0(_a,m1.members,os),this.iconCollisionBox=new n0(_a,m1.members,os);const l=q_(this.iconSizeData,e),d=q_(this.textSizeData,e,s);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(d,e,i,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(d,e,i,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(l,e,i,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,i,s,l){const d=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:l),f=$v(this.textSizeData,e,d)/_s;return this.tilePixelRatio*f}getSymbolInstanceIconSize(e,i,s){const l=this.icon.placedSymbolArray.get(s),d=$v(this.iconSizeData,e,l);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,i,s,l){e.emplaceBack(i,-s,-s,l),e.emplaceBack(i,s,-s,l),e.emplaceBack(i,s,s,l),e.emplaceBack(i,-s,s,l)}_updateTextDebugCollisionBoxes(e,i,s,l,d,f,g){for(let x=l;x<d;x++){const b=s.get(x),C=this.getSymbolInstanceTextSize(e,f,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,b.padding,f.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,l,d,f,g){for(let x=l;x<d;x++){const b=s.get(x),C=this.getSymbolInstanceIconSize(e,i,f.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,b.padding,f.zOffset)}}updateCollisionDebugBuffers(e,i,s,l){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const d=q_(this.iconSizeData,e,l),f=q_(this.textSizeData,e,s);for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x,s),this._updateTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x,s),this._updateIconDebugCollisionBoxes(d,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x,l),this._updateIconDebugCollisionBoxes(d,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,l,d,f,g,x,b){const C={};if(i<s){const{x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G,featureIndex:ee}=e.get(i);C.textBox={x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G},C.textFeatureIndex=ee}if(l<d){const{x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G,featureIndex:ee}=e.get(l);C.verticalTextBox={x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G},C.verticalTextFeatureIndex=ee}if(f<g){const{x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G,featureIndex:ee}=e.get(f);C.iconBox={x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G},C.iconFeatureIndex=ee}if(x<b){const{x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G,featureIndex:ee}=e.get(x);C.verticalIconBox={x1:M,y1:R,x2:P,y2:F,padding:V,projectedAnchorX:q,projectedAnchorY:$,projectedAnchorZ:te,tileAnchorX:ne,tileAnchorY:G},C.verticalIconFeatureIndex=ee}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),l=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<l;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),l=[],d=[],f=[];for(let g=0;g<this.symbolInstances.length;++g){f.push(g);const x=this.symbolInstances.get(g);l.push(0|Math.round(i*x.tileAnchorX+s*x.tileAnchorY)),d.push(x.featureIndex)}return f.sort((g,x)=>l[g]-l[x]||d[x]-d[g]),f}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:d,leftJustifiedTextSymbolIndex:f,verticalPlacedTextSymbolIndex:g,placedIconSymbolIndex:x,verticalPlacedIconSymbolIndex:b}=s;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),d>=0&&d!==l&&this.addIndicesForPlacedSymbol(this.text,d),f>=0&&f!==d&&f!==l&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let tb,ib,r0;Pt(Ry,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Ry.addDynamicAttributes=My;class nb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mu,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt(nb,"FormatSectionOverride",{omit:["defaultValue"]});const s0=()=>r0||(r0={layout:tb||(tb=new sr({"symbol-placement":new dt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new dt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new dt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new dt(Re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new dt(Re.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new dt(Re.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new dt(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new dt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new dt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new dt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Re.layout_symbol["icon-size"]),"icon-size-scale-range":new dt(Re.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new St(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Re.layout_symbol["icon-image"]),"icon-rotate":new St(Re.layout_symbol["icon-rotate"]),"icon-padding":new dt(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new dt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Re.layout_symbol["icon-offset"]),"icon-anchor":new St(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new dt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new dt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new dt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new St(Re.layout_symbol["text-field"]),"text-font":new St(Re.layout_symbol["text-font"]),"text-size":new St(Re.layout_symbol["text-size"]),"text-size-scale-range":new dt(Re.layout_symbol["text-size-scale-range"]),"text-max-width":new St(Re.layout_symbol["text-max-width"]),"text-line-height":new St(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Re.layout_symbol["text-letter-spacing"]),"text-justify":new St(Re.layout_symbol["text-justify"]),"text-radial-offset":new St(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new dt(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Re.layout_symbol["text-anchor"]),"text-max-angle":new dt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new dt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new St(Re.layout_symbol["text-rotate"]),"text-padding":new dt(Re.layout_symbol["text-padding"]),"text-keep-upright":new dt(Re.layout_symbol["text-keep-upright"]),"text-transform":new St(Re.layout_symbol["text-transform"]),"text-offset":new St(Re.layout_symbol["text-offset"]),"text-allow-overlap":new dt(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new dt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new dt(Re.layout_symbol["text-optional"]),visibility:new dt(Re.layout_symbol.visibility)})),paint:ib||(ib=new sr({"icon-opacity":new St(Re.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new St(Re.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new St(Re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new St(Re.paint_symbol["text-emissive-strength"]),"icon-color":new St(Re.paint_symbol["icon-color"]),"icon-halo-color":new St(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new dt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new dt(Re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new dt(Re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new St(Re.paint_symbol["text-opacity"]),"text-occlusion-opacity":new St(Re.paint_symbol["text-occlusion-opacity"]),"text-color":new St(Re.paint_symbol["text-color"],{runtimeType:no,getOverride:n=>n.textColor,hasOverride:n=>!!n.textColor}),"text-halo-color":new St(Re.paint_symbol["text-halo-color"]),"text-halo-width":new St(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Re.paint_symbol["text-halo-blur"]),"text-translate":new dt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new dt(Re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new dt(Re.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new dt(Re.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new dt(Re.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new dt(Re.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new St(Re.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},r0);class Dy extends ps{constructor(e,i,s,l){super(e,s0(),i,s,l),this._colorAdjustmentMatrix=Yt([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const d of s)l.indexOf(d)<0&&l.push(d);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,l){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===l||(this._colorAdjustmentMatrix=function(d,f,g,x){d=rs(d),f=xs(f);const b=pi(),C=d/3,M=1-2*C,R=[M,C,C,0,C,M,C,0,C,C,M,0,0,0,0,1],P=.5-.5*f,F=x-g;return Ji(b,[F,0,0,0,0,F,0,0,0,0,F,0,g,g,g,1],[f,0,0,0,0,f,0,0,0,0,f,0,P,P,P,1]),Ji(b,b,R),b}(e,i,s,l),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=l),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,l){const d=this.layout.get(e).evaluate(i,{},s,l),f=this._unevaluatedLayout._values[e];return f.isDataDriven()||Pr(f.value)||!d?d:function(g,x){return x.replace(/{([^{}]+)}/g,(b,C)=>C in g?String(g[C]):"")}(i.properties,d)}createBucket(e){return new Ry(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of s0().paint.overridableProperties){if(!Dy.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new nb(i),l=new rr(s,i.property.specification,this.scope,this.options);let d=null;d=i.value.kind==="constant"||i.value.kind==="source"?new Oa("source",l):new ha("composite",l,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Wc(i.property,d,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Dy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),l=s0().paint.properties[i];let d=!1;const f=g=>{for(const x of g)if(l.overrides&&l.overrides.hasOverride(x))return void(d=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Ts)f(s.value.value.sections);else if(s.value.kind==="source"){const g=b=>{d||(b instanceof li&&kt(b.value)===Dh?f(b.value.sections):b instanceof pl?f(b.sections):b.eachChild(g))},x=s.value;x._styleExpression&&g(x._styleExpression.expression)}return d}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new Ks(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let rb,sb,ob,ab;var o0=Gi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function a0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function l0(n){switch(n){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class c0{constructor(e,i,s,l){this.context=e,this.format=s,this.useMipmap=l&&l.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:l&&l.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,l=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:d}=this,{gl:f}=d,{x:g,y:x}=i&&i.position?i.position:{x:0,y:0},b=g+s,C=x+l;!this.size||this.size[0]===b&&this.size[1]===C||(f.bindTexture(f.TEXTURE_2D,null),f.deleteTexture(this.texture),this.texture=f.createTexture(),this.size=null),f.bindTexture(f.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===f.RGBA8&&(!i||i.premultiply!==!1));const M=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&b>0&&C>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(b,C)))+1:1;f.texStorage2D(f.TEXTURE_2D,R,this.format,b,C),this.size=[b,C]}if(this.size)if(M)f.texSubImage2D(f.TEXTURE_2D,0,g,x,a0(this.format),l0(this.format),e);else{const R=e.data;R&&f.texSubImage2D(f.TEXTURE_2D,0,g,x,s,l,a0(this.format),l0(this.format),R)}this.useMipmap&&f.generateMipmap(f.TEXTURE_2D)}bind(e,i,s=!1){const{context:l}=this,{gl:d}=l;d.bindTexture(d.TEXTURE_2D,this.texture),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,i),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,l,d){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),i!==this.magFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap?e===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),this.wrapS=s),l!==this.wrapT&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,l),this.wrapT=l),d!==this.compareMode&&(d?(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.COMPARE_REF_TO_TEXTURE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_FUNC,d)):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_COMPARE_MODE,g.NONE),this.compareMode=d)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class zy{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:l}=s;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Ly(n,e,i,s,l,d,f,g){const x=[n,e,1,i,s,1,l,d,1],b=[f,g,1],C=Je([],x),[M,R,P]=Bl(b,b,C);return Kt(x,x,[M,0,0,0,R,0,0,0,P])}function lb(n,e,i,s,l,d,f,g){const x=function(b,C,M,R,P,F,V,q){const $=Ly(0,0,1,0,1,1,0,1),te=Ly(b,C,M,R,P,F,V,q);return Kt(te,te,Je([],$))}(n,e,i,s,l,d,f,g);return[x[2]/x[8]/vt,x[5]/x[8]/vt]}function Py(n){return[n[0],Math.min(Math.max(n[1],-85.051129),qe)]}class cb extends Rc{constructor(e,i,s,l){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new hl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Au(this.map._requestManager.transformRequest(this.url,Eu.Image),(s,l)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Xl(s)):l&&(this.image=l instanceof HTMLImageElement?Mo.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new zy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new hl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof zy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const d of e)d[1]>s&&(s=d[1]),d[1]<i&&(i=d[1]);const l=(s+i)/2;if(l>qe?this.onNorthPole=!0:l<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const d=e.map(Ee.fromLngLat);this.tileID=function(f){let g=1/0,x=1/0,b=-1/0,C=-1/0;for(const V of f)g=Math.min(g,V.x),x=Math.min(x,V.y),b=Math.max(b,V.x),C=Math.max(C,V.y);const M=Math.max(b-g,C-x),R=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),P=Math.pow(2,R);let F=Math.floor((g+b)/2*P);return F>1&&(F-=1),new dh(R,F,Math.floor((x+C)/2*P))}(d),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new hl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const $ in this.tiles){const te=this.tiles[$];te.state!=="loaded"&&(te.state="loaded",te.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=W_(new dh(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function($){const te=$[1].x-$[0].x,ne=$[1].y-$[0].y,G=$[2].x-$[1].x,ee=$[2].y-$[1].y,re=$[3].x-$[2].x,ae=$[3].y-$[2].y,Te=$[0].x-$[3].x,ve=$[0].y-$[3].y,Se=te*ee-G*ne,Me=G*ae-re*ee,je=re*ve-Te*ae,ct=Te*ne-te*ve;return Se>0&&Me>0&&je>0&&ct>0||Se<0&&Me<0&&je<0&&ct<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const l=W_(this.tileID,this.map.transform.projection),[d,f,g,x]=this.coordinates.map($=>{const te=l.projection.project($[0],$[1]);return $1(l,te)._round()});this.perspectiveTransform=lb(d.x,d.y,f.x,f.y,g.x,g.y,x.x,x.y);const b=this._boundsArray=new Kc;b.emplaceBack(d.x,d.y,0,0),b.emplaceBack(f.x,f.y,vt,0),b.emplaceBack(x.x,x.y,0,vt),b.emplaceBack(g.x,g.y,vt,vt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(b,o0.members),this.boundsSegments=or.simpleSegment(0,0,4,2);const C=[],M=[Py((R=this.coordinates)[0]),Py(R[1]),Py(R[2]),Py(R[3])];var R;const[P,F,V,q]=function($){let te=$[0][0],ne=te,G=$[0][1],ee=G;for(let re=1;re<$.length;re++)$[re][0]<te?te=$[re][0]:$[re][0]>ne&&(ne=$[re][0]),$[re][1]<G?G=$[re][1]:$[re][1]>ee&&(ee=$[re][1]);return[te,G,ne-te,ee-G]}(M);{const $=new Kc,[te,ne,G,ee]=function(He){let st=He[0].x,Ve=st,Ge=He[0].y,_t=Ge;for(let yt=1;yt<He.length;yt++)He[yt].x<st?st=He[yt].x:He[yt].x>Ve&&(Ve=He[yt].x),He[yt].y<Ge?Ge=He[yt].y:He[yt].y>_t&&(_t=He[yt].y);return[st,Ge,Ve-st,_t-Ge]}(s),re=He=>[(He.x-te)/G,(He.y-ne)/ee],[ae,Te,ve,Se]=s.map(re),Me=function(He,st,Ve,Ge,_t,yt,Qt,jt){const At=Ly(0,0,1,0,1,1,0,1);return Kt(At,At,Je([],Ly(He,st,Ve,Ge,_t,yt,Qt,jt)))}(ae[0],ae[1],Te[0],Te[1],ve[0],ve[1],Se[0],Se[1]);this.elevatedGlobePerspectiveTransform=lb(ae[0],ae[1],Te[0],Te[1],ve[0],ve[1],Se[0],Se[1]);const je=(He,st)=>{C.push(He.lng);const Ve=Math.round((He.lng-P)/V*vt),Ge=Math.round((He.lat-F)/q*vt),_t=re(st),yt=Bl([],[_t[0],_t[1],1],Me),Qt=Math.round(yt[0]/yt[2]*vt),jt=Math.round(yt[1]/yt[2]*vt);$.emplaceBack(Ve,Ge,Qt,jt)},ct=s[3].x-s[0].x,et=s[3].y-s[0].y,at=s[2].x-s[1].x,ft=s[2].y-s[1].y;for(let He=0;He<65;He++){const st=He/64,Ve=[s[0].x+st*ct,s[0].y+st*et],Ge=[s[1].x+st*at,s[1].y+st*ft],_t=Ge[0]-Ve[0],yt=Ge[1]-Ve[1];for(let Qt=0;Qt<65;Qt++){const jt=Qt/64,At={x:Ve[0]+_t*jt,y:Ve[1]+yt*jt};je(i.projection.unproject(At.x,At.y),At)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer($,o0.members)}{this.maxLongitudeTriangleSize=0;let $=[],te=new Sr;const ne=(G,ee,re)=>{te.emplaceBack(G,ee,re);const ae=C[G],Te=C[ee],ve=C[re],Se=Math.min(Math.min(ae,Te),ve),Me=Math.max(Math.max(ae,Te),ve)-Se;Me>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Me),$.push(Se+Me/2)};for(let G=0;G<64;G++)for(let ee=0;ee<64;ee++){const re=65*G+ee,ae=re+1,Te=re+65,ve=Te+1;ne(re,Te,ae),ne(ae,Te,ve)}[$,te]=function(G,ee){const re=Array.from({length:G.length},(ve,Se)=>Se);re.sort((ve,Se)=>G[ve]-G[Se]);const ae=[],Te=new Sr;for(let ve=0;ve<re.length;ve++){const Se=re[ve];ae.push(G[Se]);const Me=3*Se,je=Me+1;Te.emplaceBack(ee.uint16[Me],ee.uint16[je],ee.uint16[je+1])}return[ae,Te]}($,te),this.elevatedGlobeTrianglesCenterLongitudes=$,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(te)}this.elevatedGlobeSegments=or.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,V/vt,0,q/vt,0,0,F,P,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof zy||(this.texture?this.texture.update(this.image):(this.texture=new c0(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let l=(d=e+180)+360*Math.round((s[0]-d)/360);var d;const f=new or,g=(M,R)=>{f.segments.push({vertexOffset:0,primitiveOffset:M,vertexLength:i.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},x=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-l)<=x){const M=Ir(s,0,s.length,l+x);return M===s.length||g(M,Qn(s,M+1,s.length,l+360-x)-M),f}l<s[0]&&(l+=360);const b=Qn(s,0,s.length,l-x);if(b===s.length)return g(0,s.length),f;g(0,b-0);const C=Ir(s,b+1,s.length,l+x);return C!==s.length&&g(C,s.length-C),f}}const o2=(Math.pow(256,2)-1)/16907520;class ub extends ps{constructor(e,i,s,l){super(e,{layout:ob||(ob=new sr({visibility:new dt(Re.layout_raster.visibility)})),paint:ab||(ab=new sr({"raster-opacity":new dt(Re.paint_raster["raster-opacity"]),"raster-color":new Ga(Re.paint_raster["raster-color"]),"raster-color-mix":new dt(Re.paint_raster["raster-color-mix"]),"raster-color-range":new dt(Re.paint_raster["raster-color-range"]),"raster-hue-rotate":new dt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new dt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new dt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new dt(Re.paint_raster["raster-saturation"]),"raster-contrast":new dt(Re.paint_raster["raster-contrast"]),"raster-resampling":new dt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new dt(Re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new dt(Re.paint_raster["raster-emissive-strength"]),"raster-array-band":new dt(Re.paint_raster["raster-array-band"]),"raster-elevation":new dt(Re.paint_raster["raster-elevation"]),"raster-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},i,s,l),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof cb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,l]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(l)||s===this._curRampRange[0]&&l===this._curRampRange[1]||(this.colorRamp=Rp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:l}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,l])}}let hb,db,fb,pb,mb;class _b extends ps{constructor(e,i,s,l){super(e,{layout:hb||(hb=new sr({visibility:new dt(Re["layout_raster-particle"].visibility)})),paint:db||(db=new sr({"raster-particle-array-band":new dt(Re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new dt(Re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ga(Re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new dt(Re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new dt(Re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new dt(Re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new dt(Re["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new dt(Re["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},i,s,l),this._updateColorRamp(),this.lastInvalidatedAt=Mo.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Rp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Mo.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class a2 extends ps{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function u0(n,e,i){const s=[0,0,1],l=Jo([]);return sl(l,l,i?-en(n)+Math.PI:en(n)),Ul(l,l,-en(e)),Ao(s,s,l),Ci(s,s)}function gb(n,e){const i=Oy(n.projection,n.zoom,n.width,n.height),s=function(d,f,g,x,b){const C=new J(g.lng-180*Pf,g.lat),M=new J(g.lng+180*Pf,g.lat),R=d.project(C.lng,C.lat),P=d.project(M.lng,M.lat),F=-Math.atan2(P.y-R.y,P.x-R.x),V=Ee.fromLngLat(g);V.y=me(V.y,-1+Pf,1-Pf);const q=V.toLngLat(),$=d.project(q.lng,q.lat),te=Ee.fromLngLat(q);te.x+=Pf;const ne=te.toLngLat(),G=d.project(ne.lng,ne.lat),ee=vb(G.x-$.x,G.y-$.y,F),re=Ee.fromLngLat(q);re.y+=Pf;const ae=re.toLngLat(),Te=d.project(ae.lng,ae.lat),ve=vb(Te.x-$.x,Te.y-$.y,F),Se=Math.abs(ee.x)/Math.abs(ve.y),Me=Yt([]);Zr(Me,Me,-F*(1-(b?0:x)));const je=Yt([]);return xn(je,je,[1,1-(1-Se)*x,1]),je[4]=-ve.x/ve.y*x,Zr(je,je,F),Ji(je,Me,je),je}(n.projection,0,n.center,i,e),l=yb(n);return xn(s,s,[l,l,1]),s}function yb(n){const e=n.projection,i=Oy(n.projection,n.zoom,n.width,n.height),s=h0(e,n.center),l=h0(e,J.convert(e.center));return Math.pow(2,s*i+(1-i)*l)}function Oy(n,e,i,s,l=1/0){const d=n.range;if(!d)return 0;const f=Math.min(l,Math.max(i,s)),g=Math.log(f/1024)/Math.LN2;return Ce(d[0]+g,d[1]+g,e)}const Pf=1/4e4;function h0(n,e){const i=me(e.lat,-85.051129,qe),s=new J(e.lng-180*Pf,i),l=new J(e.lng+180*Pf,i),d=n.project(s.lng,i),f=n.project(l.lng,i),g=Ee.fromLngLat(s),x=Ee.fromLngLat(l),b=f.x-d.x,C=f.y-d.y,M=x.x-g.x,R=x.y-g.y,P=Math.sqrt((M*M+R*R)/(b*b+C*C));return Math.log(P)/Math.LN2}function vb(n,e,i){const s=Math.cos(i),l=Math.sin(i);return{x:n*s-e*l,y:n*l+e*s}}function xb(n,e,i){Yt(n),Zr(n,n,en(e[2])),Nr(n,n,en(e[0])),_n(n,n,en(e[1])),xn(n,n,i),Ji(n,n,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function ky(n,e,i,s,l,d,f,g){const x=[i[0]-e[0],i[1]-e[1],0],b=[s[0]-e[0],s[1]-e[1],0];if(Vr(x)<1e-12||Vr(b)<1e-12)return Jo(n);const C=nr([],x,b);Ci(C,C),wt(b,s,e),x[2]=(d-l)*g,b[2]=(f-l)*g;const M=x;return nr(M,x,b),Ci(M,M),vu(n,C,M)}function d0(n,e,i=!1){const s=ou(e.zoom),l=function(d,f,g){const x=f.worldSize,b=[d[12],d[13],d[14]],C=De(b[1]/x),M=be(b[0]/x),R=Yt([]),P=_e(1,C)*x,F=_e(1,0)*x*rt(C,f.zoom),V=1/gm(x);let q=F*V;if(g){const G=Oy(f.projection,f.zoom,f.width,f.height,1024);q=V*f.projection.pixelSpaceConversion(f.center.lat,x,G)}const $=j(C,M);bn($,$,Le([],Ci([],$),P*q*b[2]));const te=function(G){const ee=[G[0],G[1],G[2]];let re=[0,1,0];const ae=nr([],re,ee);return nr(re,ee,ae),di(re)===0&&(re=[0,1,0],nr(ae,ee,re)),Ci(ae,ae),Ci(re,re),Ci(ee,ee),[ae[0],ae[1],ae[2],0,re[0],re[1],re[2],0,ee[0],ee[1],ee[2],0,G[0],G[1],G[2],1]}($);xn(R,R,[q,q,q*P]),Yn(R,R,[-b[0],-b[1],-b[2]]);const ne=Ji([],f.globeMatrix,te);return Ji(ne,ne,R),Ji(ne,ne,d),ne}(n,e,i);if(s>0){const d=function(f,g){const x=g.worldSize,b=_e(1,0)*x*rt(g.center.lat,g.zoom)/gm(x),C=_e(1,g.center.lat)*x,M=Yt([]);return _n(M,M,en(g.center.lng)),Nr(M,M,en(g.center.lat)),Yn(M,M,[0,0,v]),xn(M,M,[b,b,b*C]),Yn(M,M,[g.point.x-.5*x,g.point.y-.5*x,0]),Ji(M,M,f),Ji(M,g.globeMatrix,M)}(n,e);return function(f,g,x){const b=(F,V,q)=>{const $=Vr(F),te=Vr(V),ne=su(F,V,q);return Le(ne,ne,1/Vr(ne)*ei($,te,q))},C=b([f[0],f[1],f[2]],[g[0],g[1],g[2]],x),M=b([f[4],f[5],f[6]],[g[4],g[5],g[6]],x),R=b([f[8],f[9],f[10]],[g[8],g[9],g[10]],x),P=su([f[12],f[13],f[14]],[g[12],g[13],g[14]],x);return[C[0],C[1],C[2],0,M[0],M[1],M[2],0,R[0],R[1],R[2],0,P[0],P[1],P[2],1]}(l,d,s)}return l}function bb(n,e,i,s){const l=Hi.projectAabbCorners(s,i);let d=Number.MAX_VALUE,f=-1;for(let b=0;b<l.length;++b){const C=l[b];C[0]=(.5*C[0]+.5)*e.width,C[1]=(.5-.5*C[1])*e.height,C[2]<d&&(f=b,d=C[2])}const g=b=>new Tt(l[b][0],l[b][1]);let x;switch(f){case 0:case 6:x=[g(1),g(5),g(4),g(7),g(3),g(2),g(1)];break;case 1:case 7:x=[g(0),g(4),g(5),g(6),g(2),g(3),g(0)];break;case 3:case 5:x=[g(1),g(0),g(4),g(7),g(6),g(2),g(1)];break;default:x=[g(1),g(5),g(6),g(7),g(3),g(0),g(1)]}if(Is(n,x))return d}const l2=Gi([{name:"a_pos_3f",components:3,type:"Float32"}]),c2=Gi([{name:"a_color_3f",components:3,type:"Float32"}]),u2=Gi([{name:"a_color_4f",components:4,type:"Float32"}]),h2=Gi([{name:"a_uv_2f",components:2,type:"Float32"}]),d2=Gi([{name:"a_normal_3f",components:3,type:"Float32"}]),f2=Gi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),p2=Gi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),wb={None:0,Model:1,Symbol:2,FillExtrusion:4};class By{constructor(e,i,s,l){this.message=(e?`${e}: `:"")+s,l&&(this.identifier=l),i!=null&&i.__line__&&(this.line=i.__line__)}}function f0(n,e){const i=n.indexOf("://")===-1;try{return new URL(n,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Tb{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Sb{constructor(){this.instancedDataArray=new iu,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class p0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,s,l){this.tileToMeter=Ue(s);const d=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:f,id:g,index:x,sourceLayerIndex:b}of e){const C=g??(f.properties&&f.properties.hasOwnProperty("id")?f.properties.id:void 0),M=Dt(f,d);if(!this.layers[0]._featureFilter.filter(new hn(this.zoom,{worldview:this.worldview}),M,s))continue;const R={id:C,sourceLayerIndex:b,index:x,geometry:d?M.geometry:zt(f,s,l),properties:f.properties,type:f.type,patterns:{}},P=this.addFeature(R,R.geometry,M);P&&i.featureIndex.insert(f,R.geometry,x,b,this.index,this.instancesPerModel[P].instancedDataArray.length,vt/32)}this.lookup=null}update(e,i,s,l){for(const d in this.instancesPerModel){const f=this.instancesPerModel[d];for(const g in e)f.idToFeaturesIndex.hasOwnProperty(g)&&(this.evaluate(f.features[f.idToFeaturesIndex[g]],e[g],f,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const l of s.features){const d=this.layers[0],f=l.feature,g=this.canonical,x=d.paint.get("model-rotation").evaluate(f,{},g),b=d.paint.get("model-scale").evaluate(f,{},g),C=d.paint.get("model-translation").evaluate(f,{},g);_o(l.rotation,x)&&_o(l.scale,b)&&_o(l.translation,C)||(this.evaluate(l,l.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,l){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const d=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Cf(this.activeReplacements,d))return!1;this.activeReplacements=d;let f=!1;for(const g in this.instancesPerModel){const x=this.instancesPerModel[g],b=x.instancedDataArray;for(const C of x.features){const M=C.instancedDataOffset,R=C.instancedDataCount;for(let P=0;P<R;P++){const F=16*(P+M);let V=b.float32[F+0];const q=V>vt;V=q?V-vt:V;const $=Math.floor(V),te=b.float32[F+1];let ne=!1;for(const G of this.activeReplacements)if(!sy(G,s,wb.Model,l)&&!(G.min.x>$||$>G.max.x||G.min.y>te||te>G.max.y)&&(ne=k_(O_($,te,e.canonical,G.footprintTileId.canonical),G.footprint),ne))break;b.float32[F]=ne?V+vt:V,f=f||ne!==q}}}return f}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,f2.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length!==0&&s.instancedDataBuffer&&s.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,s){const l=this.layers[0],d=l.layout.get("model-id").evaluate(s,{},this.canonical);if(!d)return vi(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),d;(f0(d,!1)||this.styleDefinedModelURLs[d]!==void 0)&&(this.modelUris.includes(d)||this.modelUris.push(d)),this.instancesPerModel[d]||(this.instancesPerModel[d]=new Sb);const f=this.instancesPerModel[d],g=f.instancedDataArray,x=new Tb(s,g.length);for(const b of i)for(const C of b){if(C.x<0||C.x>=vt||C.y<0||C.y>=vt)continue;const M=(this.lookupDim-1)/vt,R=this.lookupDim*(C.y*M|0)+C.x*M|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}this.instanceCount++;const P=g.length;g.resize(P+1),f.instancesEvaluatedElevation.push(0),g.float32[16*P]=C.x,g.float32[16*P+1]=C.y}return x.instancedDataCount=f.instancedDataArray.length-x.instancedDataOffset,x.instancedDataCount>0&&(e.id&&(f.idToFeaturesIndex[e.id]=f.features.length),f.features.push(x),this.evaluate(x,{},f,!1)),d}getModelUris(){return this.modelUris}evaluate(e,i,s,l){const d=this.layers[0],f=e.feature,g=this.canonical,x=e.rotation=d.paint.get("model-rotation").evaluate(f,i,g),b=e.scale=d.paint.get("model-scale").evaluate(f,i,g),C=e.translation=d.paint.get("model-translation").evaluate(f,i,g),M=d.paint.get("model-color").evaluate(f,i,g);M.a=d.paint.get("model-color-mix-intensity").evaluate(f,i,g);const R=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,b[0]),Math.max(b[1],b[2])),xb(R,x,b);const P=Math.round(100*M.a)+M.b/1.05;for(let F=0;F<e.instancedDataCount;++F){const V=e.instancedDataOffset+F,q=16*V,$=s.instancedDataArray.float32;let te=0;l&&(te=$[q+6]-s.instancesEvaluatedElevation[V]);const ne=0|$[q+1];$[q]=(0|$[q])+M.r/1.05,$[q+1]=ne+M.g/1.05,$[q+2]=P,$[q+3]=1/(g.z>10?this.tileToMeter:Ue(g,ne)),$[q+4]=C[0],$[q+5]=C[1],$[q+6]=C[2]+te,$[q+7]=R[0],$[q+8]=R[1],$[q+9]=R[2],$[q+10]=R[4],$[q+11]=R[5],$[q+12]=R[6],$[q+13]=R[8],$[q+14]=R[9],$[q+15]=R[10],s.instancesEvaluatedElevation[V]=C[2]}}}let Eb,Ab;Pt(p0,"ModelBucket",{omit:["layers"]}),Pt(Sb,"PerModelAttributes"),Pt(Tb,"ModelFeature");const Zp=64,Gm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Cb(n,e,i,s,l,d,f,g,x,b=!1){const C=i.zoom,M=i.project(s),R=rt(s.lat,C),P=1/R;Yt(n),Yn(n,n,[M.x+f[0]*P,M.y+f[1]*P,f[2]]);let F=1,V=1;const q=i.worldSize;if(b){if(i.projection.name==="mercator"){let G=0;i.elevation&&(G=i.elevation.getAtPointOrZero(new Ee(M.x/q,M.y/q),0));const ee=ys([],[M.x,M.y,G,1],i.projMatrix)[3]/i.cameraToCenterDistance;F=ee,V=ee*rt(i.center.lat,C)}else if(i.projection.name==="globe"){const G=d0(n,i),ee=[0,0,0,1];ys(ee,ee,Ji([],i.projMatrix,G));const re=ee[3]/i.cameraToCenterDistance,ae=ou(C),Te=i.projection.pixelsPerMeter(s.lat,q)*rt(s.lat,C),ve=i.projection.pixelsPerMeter(i.center.lat,q)*rt(i.center.lat,C);F=re/ei(Te,We(i.center.lat),ae),V=re*R/Te,F*=ve,V*=ve}}else F=P;xn(n,n,[F,F,V]);const $=[...n],te=e.orientation,ne=[];if(xb(ne,[te[0]+l[0],te[1]+l[1],te[2]+l[2]],d),Ji(n,$,ne),g&&i.elevation){let G=0;const ee=[];if(x&&i.elevation){G=function(ae,Te,ve,Se,Me){const je=Te.elevation;if(!je)return 0;const ct=Hi.projectAabbCorners(ve,Se),et=_e(1,Me.lat)*Te.worldSize,at=function(mt,_i){const Vt=[0,0,1],Gt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ri of Gt){const Si=mt[ri.corners[0]],bi=mt[ri.corners[1]],Di=mt[ri.corners[2]],Ei=[bi[0]-Si[0],bi[1]-Si[1],_i*(bi[2]-Si[2])],zi=nr(Ei,Ei,[Di[0]-Si[0],Di[1]-Si[1],_i*(Di[2]-Si[2])]);Ci(zi,zi),ri.dotProductWithUp=yi(zi,Vt)}return Gt.sort((ri,Si)=>ri.dotProductWithUp-Si.dotProductWithUp),Gt[0].corners}(ct,et),ft=ct[at[0]],He=ct[at[1]],st=ct[at[2]],Ve=ct[at[3]],Ge=je.getAtPointOrZero(new Ee(ft[0]/Te.worldSize,ft[1]/Te.worldSize),0),_t=je.getAtPointOrZero(new Ee(He[0]/Te.worldSize,He[1]/Te.worldSize),0),yt=je.getAtPointOrZero(new Ee(st[0]/Te.worldSize,st[1]/Te.worldSize),0),Qt=je.getAtPointOrZero(new Ee(Ve[0]/Te.worldSize,Ve[1]/Te.worldSize),0),jt=(Ge+Qt)/2,At=(_t+yt)/2;return jt>At?_t<yt?ky(ae,He,Ve,ft,_t,Qt,Ge,et):ky(ae,st,ft,Ve,yt,Ge,Qt,et):Ge<Qt?ky(ae,ft,He,st,Ge,_t,yt,et):ky(ae,Ve,st,He,Qt,yt,_t,et),Math.max(jt,At)}(ee,i,e.aabb,n,s);const re=Ji([],ns([],ee),ne);Ji(n,$,re)}else G=i.elevation.getAtPointOrZero(new Ee(M.x/q,M.y/q),0);G!==0&&(n[14]+=G)}}function J_(n,e,i=!1){n.uploaded||(n.gfxTexture=new c0(e,n.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:n.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),n.uploaded=!0,n.image=null)}function m2(n,e,i){n.indexBuffer=e.createIndexBuffer(n.indexArray,!1,!0),n.vertexBuffer=e.createVertexBuffer(n.vertexArray,l2.members,!1,!0),n.normalArray&&(n.normalBuffer=e.createVertexBuffer(n.normalArray,d2.members,!1,!0)),n.texcoordArray&&(n.texcoordBuffer=e.createVertexBuffer(n.texcoordArray,h2.members,!1,!0)),n.colorArray&&(n.colorBuffer=e.createVertexBuffer(n.colorArray,(n.colorArray.bytesPerElement===12?c2:u2).members,!1,!0)),n.featureArray&&(n.pbrBuffer=e.createVertexBuffer(n.featureArray,p2.members,!0)),n.segments=or.simpleSegment(0,0,n.vertexArray.length,n.indexArray.length);const s=n.material;s.pbrMetallicRoughness.baseColorTexture&&J_(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&J_(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&J_(s.normalTexture,e),s.occlusionTexture&&J_(s.occlusionTexture,e,i),s.emissionTexture&&J_(s.emissionTexture,e)}function m0(n,e,i){if(n.meshes)for(const s of n.meshes)m2(s,e,i);if(n.children)for(const s of n.children)m0(s,e,i)}function Fy(n){if(n.meshes)for(const e of n.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(n.children)for(const e of n.children)Fy(e)}function _0(n){if(n.meshes)for(const i of n.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(n.children)for(const i of n.children)_0(i)}class Hm{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const l=s||e.findDEMTileFor(i);if(!l||!l.dem)return;const d=l.dem,f=l.tileID,g=1<<i.canonical.z-f.canonical.z;return new Hm(l,d.dim/vt/g,[(i.canonical.x/g-f.canonical.x)*d.dim,(i.canonical.y/g-f.canonical.y)*d.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new Tt(l,d)}getElevationAt(e,i,s,l){const d=e*this._scale+this._offset[0],f=i*this._scale+this._offset[1],g=Math.floor(d),x=Math.floor(f),b=this._dem;return l=!!l,s?ei(ei(b.get(g,x,l),b.get(g,x+1,l),f-x),ei(b.get(g+1,x,l),b.get(g+1,x+1,l),f-x),d-g):b.get(g,x,l)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*_e(1,e)*this._dem.stride}}const g0=new Float32Array(262144),Xp=new Uint8Array(262144);function Ib(n){let e=0;if(n.meshes)for(const i of n.meshes)e=Math.max(e,i.aabb.max[2]);if(n.children)for(const i of n.children)e=Math.max(e,Ib(i));return e}function Mb(n,e,i){if(n.meshes)for(const s of n.meshes){if(s.aabb.min[0]===1/0)continue;const l=Hi.applyTransform(s.aabb,n.matrix);i.insert(e,l.min[0],l.min[1],l.max[0],l.max[1])}if(n.children)for(const s of n.children)Mb(s,e,i)}const Rb=["","wall","door","roof","window","lamp","logo"];class Db{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Ib(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Hi.applyTransformFast(s.aabb,this.node.matrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Ny{constructor(e,i,s,l,d,f,g,x){this.id=s,this.layers=e,this.layerIds=this.layers.map(b=>b.fqid),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.modelTraits|=Gm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,l&&(this.modelTraits|=Gm.HasMapboxMeshFeatures),d&&(this.modelTraits|=Gm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=f,this.worldview=x,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const b of i)this.nodesInfo.push(new Db(b)),Mb(b,g.featureIndexArray.length,g.grid),g.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,g.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const s of this.getNodesInfo()){const l=s.node;l.footprint&&i.push({footprint:l.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!ia(e,this.states))for(const l of s)this.evaluate(l,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const l=s.node;this.uploaded?this.updatePbrBuffer(l):m0(l,e,!0)}for(const s of i)Fy(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const l=e.transform.projectionOptions,d=e.style.getBrightness(),f=this.brightness!==d;if(!this.uploaded||this.dirty||l.name!==this.projection.name||eg(s.paint.get("model-color").value,f)||eg(s.paint.get("model-color-mix-intensity").value,f)||eg(s.paint.get("model-roughness").value,f)||eg(s.paint.get("model-emissive-strength").value,f)||eg(s.paint.get("model-height-based-emissive-strength-multiplier").value,f)){this.projection=l,this.brightness=d;const g=this.getNodesInfo();for(const x of g)x.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),l=this.id.canonical;for(const d of s){const f=d.feature;d.evaluatedTranslation=i.paint.get("model-translation").evaluate(f,{},l),d.evaluatedScale=i.paint.get("model-scale").evaluate(f,{},l)}}evaluate(e,i){const s=this.getNodesInfo();for(const l of s){if(!l.node.meshes)continue;const d=l.feature,f=i&&i[d.id];if(ia(f,l.state))continue;l.state=structuredClone(f);const g=l.node.meshes&&l.node.meshes[0].featureData,x=l.evaluatedColor[2],b=l.evaluatedRMEA[2],C=this.id.canonical;if(l.hasTranslucentParts=!1,g){for(let M=0;M<Rb.length;M++){const R=Rb[M];R.length&&(d.properties.part=R);const P=e.paint.get("model-color").evaluate(d,f,C).toPremultipliedRenderColor(null),F=e.paint.get("model-color-mix-intensity").evaluate(d,f,C);l.evaluatedColor[M]=[P.r,P.g,P.b,F],l.evaluatedRMEA[M][0]=e.paint.get("model-roughness").evaluate(d,f,C),l.evaluatedRMEA[M][2]=e.paint.get("model-emissive-strength").evaluate(d,f,C),l.evaluatedRMEA[M][3]=P.a,l.emissionHeightBasedParams[M]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(d,f,C),!l.hasTranslucentParts&&P.a<1&&(l.hasTranslucentParts=!0)}delete d.properties.part,g2(l,x!==l.evaluatedColor[2]||b!==l.evaluatedRMEA[2],this.modelTraits)}else l.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(d,f,C);l.evaluatedTranslation=e.paint.get("model-translation").evaluate(d,f,C),l.evaluatedScale=e.paint.get("model-scale").evaluate(d,f,C),this.updatePbrBuffer(l.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,l){const d=e.findDEMTileFor(s);if(d&&(d.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(d.dem&&d.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=d.tileID.overscaledZ;const f=Hm.create(e,s,d);if(!f)return;this.modelTraits&Gm.HasMapboxMeshFeatures&&this.updateDEM(e,f,s,l);for(const g of this.getNodesInfo()){const x=g.node;if(!x.footprint||!x.footprint.vertices||!x.footprint.vertices.length)continue;const b=x.footprint.vertices;let C=f.getElevationAt(b[0].x,b[0].y,!0,!0);for(let M=1;M<b.length;M++)C=Math.min(C,f.getElevationAt(b[M].x,b[M].y,!0,!0));x.elevation=C}}this.terrainTile=d.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,l){let d=i._dem._modifiedForSources[l];if(d===void 0&&(i._dem._modifiedForSources[l]=[],d=i._dem._modifiedForSources[l]),d.includes(s.canonical))return;const f=i._dem.dim;d.push(s.canonical);let g=!1;for(const x of this.getNodesInfo()){const b=x.node;if(!b.footprint||!b.footprint.grid)continue;const C=b.footprint.grid,M=i.tileCoordToPixel(C.min.x,C.min.y),R=i.tileCoordToPixel(C.max.x,C.max.y),P=Math.min(Math.min(f-R.y,M.x),Math.min(M.y,f-R.x));if(P<0)continue;const F=me(P,2,5);let V=Math.max(0,M.x-F),q=Math.max(0,M.y-F),$=Math.min(R.x+F,f-1),te=Math.min(R.y+F,f-1);for(let re=q;re<=te;++re)for(let ae=V;ae<=$;++ae)Xp[re*f+ae]=255;let ne=0,G=0;for(let re=0;re<C.cellsY;++re)for(let ae=0;ae<C.cellsX;++ae){if(!C.cells[re*C.cellsX+ae])continue;const Te=i.tileCoordToPixel(C.min.x+ae/C.xScale,C.min.y+re/C.yScale),ve=i.tileCoordToPixel(C.min.x+(ae+1)/C.xScale,C.min.y+(re+1)/C.yScale);for(let Se=Te.y;Se<=Math.min(ve.y+1,f-1);++Se)for(let Me=Te.x;Me<=Math.min(ve.x+1,f-1);++Me)Xp[Se*f+Me]===255&&(Xp[Se*f+Me]=0,ne+=i.getElevationAtPixel(Me,Se),G++)}const ee=ne/G;V=Math.max(1,M.x-F),q=Math.max(1,M.y-F),$=Math.min(R.x+F,f-2),te=Math.min(R.y+F,f-2),g=!0;for(let re=q;re<=te;++re)for(let ae=V;ae<=$;++ae)Xp[re*f+ae]===0&&(g0[re*f+ae]=i._dem.set(ae,re,ee));for(let re=1;re<F;++re){V=Math.max(1,M.x-re),q=Math.max(1,M.y-re),$=Math.min(R.x+re,f-2),te=Math.min(R.y+re,f-2);for(let ae=q;ae<=te;++ae)for(let Te=V;Te<=$;++Te){const ve=ae*f+Te;if(Xp[ve]===255){let Se=0,Me=0,je=-1,ct=-1;for(let et=-1;et<=1;++et)for(let at=-1;at<=1;++at){const ft=(ae+et)*f+Te+at;if(Xp[ft]>=re)continue;const He=g0[ft],st=Math.abs(He);st>Me&&(Se=He,Me=st,je=at,ct=et)}if(Me>.1){const et=1-(re+.5*Math.abs(je*ct))/F;let at=i._dem.get(Te,ae)+Se*et;const ft=i._dem.get(Te+je,ae+ct),He=i._dem.get(Te-je,ae-ct,!0);(at-ft)*(at-He)>0&&(at=(ft+He)/2),g0[ve]=i._dem.set(Te,ae,at),Xp[ve]=re}}}}}g&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Mo.now())}setFilter(e){this.filter=e?tf(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new hn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Fy(i.node),_0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const l of this.getNodesInfo()){const d=l.node.footprint;l.hiddenByReplacement=!!d&&!s.find(f=>f.footprint===d)}}getHeightAtTileCoord(e,i){const s=[],l=[0,0,0],d=Yt([]);for(const f of this.getNodesInfo()){const g=f.node.meshes[0],x=g.transformedAabb;if(e<x.min[0]||i<x.min[1]||e>x.max[0]||i>x.max[1])continue;if(f.node.hidden===!0)return{height:1/0,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};Qi(d,f.node.matrix),l[0]=e,l[1]=i,cn(l,l,d);const b=(l[0]-g.aabb.min[0])/(g.aabb.max[0]-g.aabb.min[0])*Zp|0,C=Math.min(63,(l[1]-g.aabb.min[1])/(g.aabb.max[1]-g.aabb.min[1])*Zp|0)*Zp+Math.min(63,b),M=g.heightmap[C];if(!(M<0&&f.node.footprint))return f.hiddenByReplacement?void 0:{height:M,maxHeight:f.feature.properties.height,hidden:!1,verticalScale:f.evaluatedScale[2]};if(f.node.footprint.grid.query(new Tt(e,i),new Tt(e,i),s),s.length>0)return{height:void 0,maxHeight:f.feature.properties.height,hidden:f.hiddenByReplacement,verticalScale:f.evaluatedScale[2]}}}}function eg(n,e){return n instanceof Oa&&!n.isLightConstant&&e}function _2(n,e,i,s,l,d,f,g){let x=(61440&e|(61440&e)>>4)>>8,b=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;i[3]>0&&(x=ei(x,255*i[0],i[3]),b=ei(b,255*i[1],i[3]),C=ei(C,255*i[2],i[3]));const M=x<<8|b,R=C<<8|Math.floor(255*s[3]),P=function(re){const ae=me(re,0,2);return Math.min(Math.round(.5*ae*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],F=me(l[0],0,1),V=me(l[1],0,1),q=me(l[2],0,1),$=me(l[3],0,1);let te,ne,G,ee;if(F!==V&&f!==d&&V!==F){const re=f-d;ne=1/(re*(V-F)),G=-(d+re*F)/(re*(V-F));const ae=me(l[4],-1,1);ee=Math.pow(10,ae),te=255*q<<8|255*$}else te=65535,ne=0,G=1,ee=1;if(n.emplaceBack(M,R,P,te,ne,G,ee),g){const re=g.length;g.clear();for(let ae=0;ae<re;ae++)g.emplaceBack(M,R,P,te,ne,G,ee)}}function g2(n,e,i){const s=n.node;let l=0;const d=i&Gm.HasMeshoptCompression;for(const f of s.meshes){if(s.lights&&s.lightMeshIndex===l||!f.featureData)continue;f.featureArray=new pc,f.featureArray.reserve(f.featureData.length);let g=e;for(const x of f.featureData){const b=d?65535&x:x>>16&65535,C=d?x>>16&65535:65535&x,M=(15&C)<8?15&C:0,R=n.evaluatedRMEA[M],P=n.evaluatedColor[M],F=n.emissionHeightBasedParams[M];let V;if(g&&M===2&&s.lights&&(V=new pc,V.resize(10*s.lights.length)),_2(f.featureArray,b,P,R,F,f.aabb.min[2],f.aabb.max[2],V),V&&g){g=!1;const q=s.meshes[s.lightMeshIndex];q.featureArray=V,q.featureArray._trim()}}f.featureArray._trim(),l++}}function zb(n,e,i,s){const l=1<<n.z;e.lat=De((s/vt+n.y)/l),e.lng=be((i/vt+n.x)/l)}function y2(n,e,i,s){const l=n.getNodesInfo()[e];if(!l||l.hiddenByReplacement||!l.node.meshes)return;let d=Number.MAX_VALUE;const f=l.node,g=i.tile,x=s.calculatePosMatrix(g.tileID.toUnwrapped(),s.worldSize),b=l.evaluatedScale;let C=0;s.elevation&&f.elevation&&(C=f.elevation*s.elevation.exaggeration()),Yn(x,x,[(f.anchor?f.anchor[0]:0)*(b[0]-1),(f.anchor?f.anchor[1]:0)*(b[1]-1),C]),xn(x,x,b);const M=i.queryGeometry,R=M.isPointQuery()?M.screenBounds:M.screenGeometry,P=function(V){const q=Ji([],x,V.matrix);Ji(q,s.expandedFarZProjMatrix,q);for(let $=0;$<V.meshes.length;++$){const te=V.meshes[$];if($===V.lightMeshIndex)continue;const ne=bb(R,s,q,te.aabb);ne!=null&&(d=Math.min(ne,d))}if(V.children)for(const $ of V.children)P($)};if(P(f),d===Number.MAX_VALUE)return;const F=new J(0,0);return zb(g.tileID.canonical,F,l.node.anchor[0],l.node.anchor[1]),{intersectionZ:d,position:F,feature:l.feature}}Pt(Ny,"Tiled3dModelBucket",{omit:["layers"]}),Pt(Db,"Tiled3dModelFeature");const v2={circle:class extends ps{constructor(n,e,i,s){super(n,{layout:m_||(m_=new sr({"circle-sort-key":new St(Re.layout_circle["circle-sort-key"]),"circle-elevation-reference":new dt(Re.layout_circle["circle-elevation-reference"]),visibility:new dt(Re.layout_circle.visibility)})),paint:dd||(dd=new sr({"circle-radius":new St(Re.paint_circle["circle-radius"]),"circle-color":new St(Re.paint_circle["circle-color"]),"circle-blur":new St(Re.paint_circle["circle-blur"]),"circle-opacity":new St(Re.paint_circle["circle-opacity"]),"circle-translate":new dt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new dt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new dt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new dt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new dt(Re.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(n){return new Us(n)}queryRadius(n){const e=n;return yf("circle-radius",this,e)+yf("circle-stroke-width",this,e)+_m(this.paint.get("circle-translate"))}queryIntersectsFeature(n,e,i,s,l,d,f,g){const x=p_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),b=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Hg(n,s,d,f,g,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",x,b)}getProgramIds(){return["circle"]}getDefaultProgramParams(n,e,i){const s=ym(this);return{config:new Ks(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(n){return!n&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends ps{createBucket(n){return new Un(n)}constructor(n,e,i,s){super(n,{layout:vm||(vm=new sr({visibility:new dt(Re.layout_heatmap.visibility)})),paint:Mp||(Mp=new sr({"heatmap-radius":new St(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new dt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ga(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new dt(Re.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(n){return yf("heatmap-radius",this,n)}queryIntersectsFeature(n,e,i,s,l,d,f,g){const x=this.paint.get("heatmap-radius").evaluate(e,i);return Hg(n,s,d,f,g,!0,!0,new Tt(0,0),x)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(n,e,i){return n==="heatmap"?{config:new Ks(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends ps{constructor(n,e,i,s){super(n,{layout:xm||(xm=new sr({visibility:new dt(Re.layout_hillshade.visibility)})),paint:E_||(E_=new sr({"hillshade-illumination-direction":new dt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new dt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new dt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new dt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new dt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new dt(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new dt(Re.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}},fill:class extends ps{constructor(n,e,i,s){super(n,{layout:Ef||(Ef=new sr({"fill-sort-key":new St(Re.layout_fill["fill-sort-key"]),visibility:new dt(Re.layout_fill.visibility),"fill-elevation-reference":new dt(Re.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new St(Re.layout_fill["fill-construct-bridge-guard-rail"])})),paint:z_||(z_=new sr({"fill-antialias":new dt(Re.paint_fill["fill-antialias"]),"fill-opacity":new St(Re.paint_fill["fill-opacity"]),"fill-color":new St(Re.paint_fill["fill-color"]),"fill-outline-color":new St(Re.paint_fill["fill-outline-color"]),"fill-translate":new dt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new dt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new St(Re.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new dt(Re.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new dt(Re.paint_fill["fill-emissive-strength"]),"fill-z-offset":new St(Re.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new St(Re.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new St(Re.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const n=this.paint.get("fill-pattern"),e=n&&n.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(n,e,i){return{config:new Ks(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(n,e){super.recalculate(n,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new ph(n)}queryRadius(){return _m(this.paint.get("fill-translate"))}queryIntersectsFeature(n,e,i,s,l,d){return!n.queryGeometry.isAboveHorizon&&Zo(kg(n.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(n){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return n!=null?e&&!n:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends ps{constructor(n,e,i,s){super(n,{layout:Fm||(Fm=new sr({visibility:new dt(Re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new dt(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:jp||(jp=new sr({"fill-extrusion-opacity":new dt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new dt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new dt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new St(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new dt(Re["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new St(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new dt(Re["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new dt(Re["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new dt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new dt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new dt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new dt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new dt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new dt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new dt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new dt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new St(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new St(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new dt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new dt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new dt(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new dt(Re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new St(Re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new St(Re["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new dt(Re["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new Fp(n)}queryRadius(){return _m(this.paint.get("fill-extrusion-translate"))}is3D(n){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(n,e,i,s,l,d,f,g,x){const b=p_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,i),M=this.paint.get("fill-extrusion-base").evaluate(e,i),R=[0,0],P=g&&d.elevation,F=d.elevation?d.elevation.exaggeration():1,V=n.tile.getBucket(this);if(P&&V instanceof Fp){const G=V.centroidVertexArray,ee=x+1;ee<G.length&&(R[0]=G.geta_centroid_pos0(ee),R[1]=G.geta_centroid_pos1(ee))}if(R[0]===0&&R[1]===1)return!1;d.projection.name==="globe"&&(s=U_([s],[new Tt(0,0),new Tt(vt,vt)],n.tileID.canonical).map(G=>G.polygon).flat());const q=P?g:null,[$,te]=function(G,ee,re,ae,Te,ve,Se,Me,je,ct,et){return G.projection.name==="globe"?function(at,ft,He,st,Ve,Ge,_t,yt,Qt,jt,At){const mt=[],_i=[],Vt=at.projection.upVectorScale(At,at.center.lat,at.worldSize).metersToTile,Gt=[0,0,0,1],ri=[0,0,0,1],Si=(Di,Ei,zi,fn)=>{Di[0]=Ei,Di[1]=zi,Di[2]=fn,Di[3]=1},bi=Up();He>0&&(He+=bi),st+=bi;for(const Di of ft){const Ei=[],zi=[];for(const fn of Di){const Vn=fn.x+Ve.x,se=fn.y+Ve.y,ue=at.projection.projectTilePoint(Vn,se,At),Xe=at.projection.upVector(At,fn.x,fn.y);let bt=He,Ct=st;if(_t){const Et=ie(Vn,se,He,st,_t,yt,Qt,jt);bt+=Et.base,Ct+=Et.top}He!==0?Si(Gt,ue.x+Xe[0]*Vt*bt,ue.y+Xe[1]*Vt*bt,ue.z+Xe[2]*Vt*bt):Si(Gt,ue.x,ue.y,ue.z),Si(ri,ue.x+Xe[0]*Vt*Ct,ue.y+Xe[1]*Vt*Ct,ue.z+Xe[2]*Vt*Ct),cn(Gt,Gt,Ge),cn(ri,ri,Ge),Ei.push(new yh(Gt[0],Gt[1],Gt[2])),zi.push(new yh(ri[0],ri[1],ri[2]))}mt.push(Ei),_i.push(zi)}return[mt,_i]}(G,ee,re,ae,Te,ve,Se,Me,je,ct,et):Se?function(at,ft,He,st,Ve,Ge,_t,yt,Qt){const jt=[],At=[],mt=[0,0,0,1];for(const _i of at){const Vt=[],Gt=[];for(const ri of _i){const Si=ri.x+st.x,bi=ri.y+st.y,Di=ie(Si,bi,ft,He,Ge,_t,yt,Qt);mt[0]=Si,mt[1]=bi,mt[2]=Di.base,mt[3]=1,ys(mt,mt,Ve),mt[3]=Math.max(mt[3],1e-5);const Ei=new yh(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);mt[0]=Si,mt[1]=bi,mt[2]=Di.top,mt[3]=1,ys(mt,mt,Ve),mt[3]=Math.max(mt[3],1e-5);const zi=new yh(mt[0]/mt[3],mt[1]/mt[3],mt[2]/mt[3]);Vt.push(Ei),Gt.push(zi)}jt.push(Vt),At.push(Gt)}return[jt,At]}(ee,re,ae,Te,ve,Se,Me,je,ct):function(at,ft,He,st,Ve){const Ge=[],_t=[],yt=Ve[8]*ft,Qt=Ve[9]*ft,jt=Ve[10]*ft,At=Ve[11]*ft,mt=Ve[8]*He,_i=Ve[9]*He,Vt=Ve[10]*He,Gt=Ve[11]*He;for(const ri of at){const Si=[],bi=[];for(const Di of ri){const Ei=Di.x+st.x,zi=Di.y+st.y,fn=Ve[0]*Ei+Ve[4]*zi+Ve[12],Vn=Ve[1]*Ei+Ve[5]*zi+Ve[13],se=Ve[2]*Ei+Ve[6]*zi+Ve[14],ue=Ve[3]*Ei+Ve[7]*zi+Ve[15],Xe=fn+yt,bt=Vn+Qt,Ct=se+jt,Et=Math.max(ue+At,1e-5),Ut=fn+mt,ni=Vn+_i,Ni=se+Vt,Ui=Math.max(ue+Gt,1e-5);Si.push(new yh(Xe/Et,bt/Et,Ct/Et)),bi.push(new yh(Ut/Ui,ni/Ui,Ni/Ui))}Ge.push(Si),_t.push(bi)}return[Ge,_t]}(ee,re,ae,Te,ve)}(d,s,M,C,b,f,q,R,F,d.center.lat,n.tileID.canonical),ne=n.queryGeometry;return function(G,ee,re){let ae=1/0;Zo(re,ee)&&(ae=U(re,ee[0]));for(let Te=0;Te<ee.length;Te++){const ve=ee[Te],Se=G[Te];for(let Me=0;Me<ve.length-1;Me++){const je=ve[Me],ct=[je,ve[Me+1],Se[Me+1],Se[Me],je];Is(re,ct)&&(ae=Math.min(ae,U(re,ct)))}}return ae!==1/0&&ae}($,te,ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},building:class extends ps{constructor(n,e,i,s){super(n,{layout:i1||(i1=new sr({visibility:new dt(Re.layout_building.visibility),"building-roof-shape":new St(Re.layout_building["building-roof-shape"]),"building-height":new St(Re.layout_building["building-height"]),"building-base":new St(Re.layout_building["building-base"])})),paint:n1||(n1=new sr({"building-opacity":new dt(Re.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new dt(Re.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new dt(Re.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new dt(Re.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new dt(Re.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new dt(Re.paint_building["building-vertical-scale"]),"building-cast-shadows":new dt(Re.paint_building["building-cast-shadows"]),"building-color":new St(Re.paint_building["building-color"]),"building-emissive-strength":new St(Re.paint_building["building-emissive-strength"]),"building-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new t1(n)}},line:class extends ps{constructor(n,e,i,s){const l=f1();super(n,l,e,i,s),l.layout&&(this.layout=new $c(l.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof wl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(n,e){super.recalculate(n,e),this.paint._values["line-floorwidth"]=(()=>{if(j_)return j_;const i=f1();return j_=new _E(i.paint.properties["line-width"].specification),j_.useIntegerZoom=!0,j_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new Vv(n)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(n,e,i){const s=h1(this);return{config:new Ks(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(n){const e=n,i=p1(yf("line-width",this,e),yf("line-gap-width",this,e)),s=yf("line-offset",this,e);return i/2+Math.abs(s)+_m(this.paint.get("line-translate"))}queryIntersectsFeature(n,e,i,s,l,d){if(n.queryGeometry.isAboveHorizon)return!1;const f=kg(n.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,n.pixelToTileUnitsFactor),g=n.pixelToTileUnitsFactor/2*p1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),x=this.paint.get("line-offset").evaluate(e,i);return x&&(s=function(b,C){const M=[],R=new Tt(0,0);for(let P=0;P<b.length;P++){const F=b[P],V=[];for(let q=0;q<F.length;q++){const $=F[q],te=F[q+1],ne=q===0?R:$.sub(F[q-1])._unit()._perp(),G=q===F.length-1?R:te.sub($)._unit()._perp(),ee=ne._add(G)._unit();ee._mult(1/(ee.x*G.x+ee.y*G.y)),V.push(ee._mult(C)._add($))}M.push(V)}return M}(s,x*n.pixelToTileUnitsFactor)),function(b,C,M){for(let R=0;R<C.length;R++){const P=C[R];if(b.length>=3){for(let F=0;F<P.length;F++)if(ga(b,P[F]))return!0}if(ts(b,P,M))return!0}return!1}(f,s,g)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(n){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Dy,background:class extends ps{constructor(n,e,i,s){super(n,{layout:rb||(rb=new sr({visibility:new dt(Re.layout_background.visibility)})),paint:sb||(sb=new sr({"background-pitch-alignment":new dt(Re.paint_background["background-pitch-alignment"]),"background-color":new dt(Re.paint_background["background-color"]),"background-pattern":new dt(Re.paint_background["background-pattern"]),"background-opacity":new dt(Re.paint_background["background-opacity"]),"background-emissive-strength":new dt(Re.paint_background["background-emissive-strength"]),"background-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(n,e,i){return{overrideFog:!1}}is3D(n){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:ub,"raster-particle":_b,sky:class extends ps{constructor(n,e,i,s){super(n,{layout:fb||(fb=new sr({visibility:new dt(Re.layout_sky.visibility)})),paint:pb||(pb=new sr({"sky-type":new dt(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new dt(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new dt(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new dt(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new dt(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ga(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new dt(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new dt(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new dt(Re.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="sky-gradient"?this._updateColorRamp():n!=="sky-atmosphere-sun"&&n!=="sky-atmosphere-halo-color"&&n!=="sky-atmosphere-color"&&n!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Rp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(n){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=n.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(n,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),l=!s,d=n.style.light,f=d.properties.get("position");return l&&d.properties.get("anchor")==="viewport"&&vi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?u0(f.azimuthal,90-f.polar,e):u0(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return u0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(n){this._skyboxInvalidated=!1,this._lightPosition=n.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const n=this.paint.get("sky-type");return n==="atmosphere"?["skyboxCapture","skybox"]:n==="gradient"?["skyboxGradient"]:null}},slot:class extends ps{constructor(n,e,i,s){super(n,{paint:mb||(mb=new sr({}))},e,null)}},model:class extends ps{constructor(n,e,i,s){super(n,{layout:Eb||(Eb=new sr({visibility:new dt(Re.layout_model.visibility),"model-id":new St(Re.layout_model["model-id"])})),paint:Ab||(Ab=new sr({"model-opacity":new St(Re.paint_model["model-opacity"]),"model-rotation":new St(Re.paint_model["model-rotation"]),"model-scale":new St(Re.paint_model["model-scale"]),"model-translation":new St(Re.paint_model["model-translation"]),"model-color":new St(Re.paint_model["model-color"]),"model-color-mix-intensity":new St(Re.paint_model["model-color-mix-intensity"]),"model-type":new dt(Re.paint_model["model-type"]),"model-cast-shadows":new dt(Re.paint_model["model-cast-shadows"]),"model-receive-shadows":new dt(Re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new dt(Re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new St(Re.paint_model["model-emissive-strength"]),"model-roughness":new St(Re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new St(Re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new dt(Re.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new dt(Re.paint_model["model-front-cutoff"]),"model-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(n){return new p0(n)}getProgramIds(){return["model"]}is3D(n){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(n){return n instanceof Ny?vt-1:0}queryIntersectsFeature(n,e,i,s,l,d){if(!this.modelManager)return!1;const f=this.modelManager,g=n.tile.getBucket(this);if(!(g&&g instanceof p0))return!1;for(const x in g.instancesPerModel){const b=g.instancesPerModel[x],C=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(b.idToFeaturesIndex.hasOwnProperty(C)){const M=b.features[b.idToFeaturesIndex[C]],R=f.getModel(x,this.scope);if(!R)return!1;let P=pi();const F=new J(0,0),V=g.canonical;let q=Number.MAX_VALUE;for(let $=0;$<M.instancedDataCount;++$){const te=16*(M.instancedDataOffset+$),ne=b.instancedDataArray.float32,G=[ne[te+4],ne[te+5],ne[te+6]];zb(V,F,ne[te],0|ne[te+1]),Cb(P,R,d,F,M.rotation,M.scale,G,!1,!1,!1),d.projection.name==="globe"&&(P=d0(P,d));const ee=Ji([],d.projMatrix,P),re=n.queryGeometry,ae=bb(re.isPointQuery()?re.screenBounds:re.screenGeometry,d,ee,R.aabb);ae!=null&&(q=Math.min(ae,q))}return q!==Number.MAX_VALUE&&q}}return!1}_handleOverridablePaintPropertyUpdate(n,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||n!=="model-color"&&n!=="model-color-mix-intensity"&&n!=="model-rotation"&&n!=="model-scale"&&n!=="model-translation"&&n!=="model-emissive-strength")}_isPropertyZoomDependent(n){const e=this._transitionablePaint._values[n];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ha}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends ps{constructor(n,e,i,s){super(n,{layout:ty||(ty=new sr({"clip-layer-types":new dt(Re.layout_clip["clip-layer-types"]),"clip-layer-scope":new dt(Re.layout_clip["clip-layer-scope"])})),paint:Sd||(Sd=new sr({}))},e,i,s)}recalculate(n,e){super.recalculate(n,e)}createBucket(n){return new Pp(n)}is3D(n){return!0}}},y0=new sn(0,0,0),v0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},x0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Uy={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},x2={PAINT_ORDER_FILL_AND_STROKE:1},tg={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},Lb={MASK_TYPE_LUMINANCE:1};function b2(n,e,i){n===1&&e.icons.push(function(s,l){return function(d){if(d.usvg_tree.height||(d.usvg_tree.height=d.usvg_tree.width),!d.metadata)return d;const{metadata:f}=d;if(f.content_area){const{content_area:g}=f;g.top==null&&(g.top=g.left),g.width==null&&(g.width=d.usvg_tree.width),g.height==null&&(g.height=g.width)}return f.stretch_x&&f.stretch_x.length&&Pb(f,"x"),f.stretch_y&&f.stretch_y.length&&Pb(f,"y"),d}(s.readFields(w2,{name:void 0},l))}(i,i.readVarint()+i.pos))}function Pb(n,e){const i=[],s=n[`stretch_${e}`];let l=null;for(let d=0;d<s.length;d++)l===null?l=i.length===0?s[0]:i[i.length-1][1]+s[d]:(i.push([l,l+s[d]]),l=null);n[`stretch_${e}_areas`]=i}function w2(n,e,i){n===1?e.name=i.readString():n===2?e.metadata=function(s,l){return s.readFields(T2,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},l)}(i,i.readVarint()+i.pos):n===3&&(e.usvg_tree=function(s,l){return s.readFields(A2,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},l)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function T2(n,e,i){n===1?e.stretch_x=i.readPackedVarint():n===2?e.stretch_y=i.readPackedVarint():n===3?e.content_area=function(s,l){return s.readFields(S2,{left:0},l)}(i,i.readVarint()+i.pos):n===4&&e.variables.push(function(s,l){return s.readFields(E2,{name:void 0},l)}(i,i.readVarint()+i.pos))}function S2(n,e,i){n===1?e.left=i.readVarint():n===2?e.width=i.readVarint():n===3?e.top=i.readVarint():n===4&&(e.height=i.readVarint())}function E2(n,e,i){n===1?e.name=i.readString():n===2&&(e.rgb_color=Gy(i.readVarint()),e.value="rgb_color")}function A2(n,e,i){n===1?e.width=e.height=i.readVarint():n===2?e.height=i.readVarint():n===3?e.children.push(Vy(i,i.readVarint()+i.pos)):n===4?e.linear_gradients.push(function(s,l){return s.readFields(L2,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},l)}(i,i.readVarint()+i.pos)):n===5?e.radial_gradients.push(function(s,l){return s.readFields(O2,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},l)}(i,i.readVarint()+i.pos)):n===7?e.clip_paths.push(function(s,l){return s.readFields(k2,{children:[]},l)}(i,i.readVarint()+i.pos)):n===8&&e.masks.push(function(s,l){const d=s.readFields(B2,{left:0,width:20,mask_type:Lb.MASK_TYPE_LUMINANCE,children:[]},l);return d.height==null&&(d.height=d.width),d.top==null&&(d.top=d.left),d}(i,i.readVarint()+i.pos))}function Vy(n,e){return n.readFields(C2,{},e)}function C2(n,e,i){n===1?(e.group=function(s,l){return s.readFields(I2,{opacity:255,children:[]},l)}(i,i.readVarint()+i.pos),e.node="group"):n===2&&(e.path=function(s,l){return s.readFields(R2,{paint_order:1,commands:[],step:1,diffs:[],rule:v0.PATH_RULE_NON_ZERO},l)}(i,i.readVarint()+i.pos),e.node="path")}function I2(n,e,i){n===1?e.transform=jy(i,i.readVarint()+i.pos):n===2?e.opacity=i.readVarint():n===5?e.clip_path_idx=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Vy(i,i.readVarint()+i.pos))}function jy(n,e){return n.readFields(M2,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function M2(n,e,i){n===1?e.sx=i.readFloat():n===2?e.ky=i.readFloat():n===3?e.kx=i.readFloat():n===4?e.sy=i.readFloat():n===5?e.tx=i.readFloat():n===6&&(e.ty=i.readFloat())}function R2(n,e,i){n===1?e.fill=function(s,l){return s.readFields(D2,{rgb_color:y0,paint:"rgb_color",opacity:255},l)}(i,i.readVarint()+i.pos):n===2?e.stroke=function(s,l){return s.readFields(z2,{rgb_color:y0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},l)}(i,i.readVarint()+i.pos):n===3?e.paint_order=i.readVarint():n===5?i.readPackedVarint(e.commands):n===6?e.step=i.readFloat():n===7?i.readPackedSVarint(e.diffs):n===8&&(e.rule=i.readVarint())}function D2(n,e,i){n===1?(e.rgb_color=Gy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5&&(e.opacity=i.readVarint())}function Gy(n){return new sn((n>>16&255)/255,(n>>8&255)/255,(255&n)/255,1)}function z2(n,e,i){n===1?(e.rgb_color=Gy(i.readVarint()),e.paint="rgb_color"):n===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):n===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):n===5?i.readPackedFloat(e.dasharray):n===6?e.dashoffset=i.readFloat():n===7?e.miterlimit=i.readFloat():n===8?e.opacity=i.readVarint():n===9?e.width=i.readFloat():n===10?e.linecap=i.readVarint():n===11&&(e.linejoin=i.readVarint())}function L2(n,e,i){n===1?e.transform=jy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(Ob(i,i.readVarint()+i.pos)):n===4?e.x1=i.readFloat():n===5?e.y1=i.readFloat():n===6?e.x2=i.readFloat():n===7&&(e.y2=i.readFloat())}function Ob(n,e){return n.readFields(P2,{offset:0,opacity:255,rgb_color:y0},e)}function P2(n,e,i){n===1?e.offset=i.readFloat():n===2?e.opacity=i.readVarint():n===3&&(e.rgb_color=Gy(i.readVarint()))}function O2(n,e,i){n===1?e.transform=jy(i,i.readVarint()+i.pos):n===2?e.spread_method=i.readVarint():n===3?e.stops.push(Ob(i,i.readVarint()+i.pos)):n===4?e.cx=i.readFloat():n===5?e.cy=i.readFloat():n===6?e.r=i.readFloat():n===7?e.fx=i.readFloat():n===8?e.fy=i.readFloat():n===9&&(e.fr=i.readFloat())}function k2(n,e,i){n===1?e.transform=jy(i,i.readVarint()+i.pos):n===2?e.clip_path_idx=i.readVarint():n===3&&e.children.push(Vy(i,i.readVarint()+i.pos))}function B2(n,e,i){n===1?e.left=e.top=i.readFloat():n===2?e.width=e.height=i.readFloat():n===3?e.top=i.readFloat():n===4?e.height=i.readFloat():n===5?e.mask_type=i.readVarint():n===6?e.mask_idx=i.readVarint():n===7&&e.children.push(Vy(i,i.readVarint()+i.pos))}class F2{static calculate(e={},i=[]){const s=new Map,l=new Map;if(Object.keys(e).length===0)return s;i.forEach(d=>{l.set(d.name,d.rgb_color||new sn(0,0,0))});for(const[d,f]of Object.entries(e))l.has(d)?s.set(l.get(d).toString(),f):console.warn(`Ignoring unknown image variable "${d}"`);return s}}function qm(n,e=255,i){const s=e/255,l=n.toString(),d=i.has(l)?i.get(l).clone():n.clone();return d.a*=s,d.toString()}function ig(n,e){if(!bu()){const i=document.createElement("canvas");return i.width=n,i.height=e,i}return new OffscreenCanvas(n,e)}function N2(n,e){const i=F2.calculate(e.params,n.metadata?n.metadata.variables:[]),s=n.usvg_tree,l=s.width,d=s.height,f=e.transform?e.transform:new DOMMatrix,g=Math.max(1,Math.round(l*f.a)),x=Math.max(1,Math.round(d*f.d)),b=new DOMMatrix([g/l,0,0,x/d,0,0]),C=ig(g,x).getContext("2d");return b0(C,b,s,s,i),C.getImageData(0,0,g,x)}function b0(n,e,i,s,l){for(const d of s.children)kb(n,e,i,d,l)}function kb(n,e,i,s,l){s.group?(n.save(),function(d,f,g,x,b){const C=x.mask_idx!=null?g.masks[x.mask_idx]:null,M=x.clip_path_idx!=null?g.clip_paths[x.clip_path_idx]:null;if(x.transform&&(f=Zm(x.transform).preMultiplySelf(f)),!function(F,V,q){return F.opacity!==255||V||q}(x,M!=null,C!=null))return void b0(d,f,g,x,b);const R=ig(d.canvas.width,d.canvas.height),P=R.getContext("2d");b0(P,f,g,x,b),M&&Gb(P,f,g,M),C&&Hb(P,f,g,C,b),d.globalAlpha=x.opacity/255,d.drawImage(R,0,0)}(n,e,i,s.group,l),n.restore()):s.path&&(n.save(),function(d,f,g,x,b){d.setTransform(f),x.paint_order===x2.PAINT_ORDER_FILL_AND_STROKE?(Bb(d,g,x,b),Nb(d,g,x,b)):(Nb(d,g,x,b),Bb(d,g,x,b))}(n,e,i,s.path,l),n.restore())}function Bb(n,e,i,s){const l=i.fill;if(!l)return;const d=l.opacity/255;switch(n.save(),n.beginPath(),qb(i,n),l.paint){case"rgb_color":n.fillStyle=qm(l.rgb_color,l.opacity,s);break;case"linear_gradient_idx":{const f=e.linear_gradients[l.linear_gradient_idx];f.transform&&n.setTransform(Zm(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Ub(n,f,d,s);break}case"radial_gradient_idx":{const f=e.radial_gradients[l.radial_gradient_idx];f.transform&&n.setTransform(Zm(f.transform).preMultiplySelf(n.getTransform())),n.fillStyle=Vb(n,f,d,s)}}n.fill(Fb(i)),n.restore()}function Fb(n){return n.rule===v0.PATH_RULE_NON_ZERO?"nonzero":n.rule===v0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Nb(n,e,i,s){const l=i.stroke;if(!l)return;const d=Zb(i);n.lineWidth=l.width,n.miterLimit=l.miterlimit,n.setLineDash(l.dasharray),n.lineDashOffset=l.dashoffset;const f=l.opacity/255;switch(l.paint){case"rgb_color":n.strokeStyle=qm(l.rgb_color,l.opacity,s);break;case"linear_gradient_idx":n.strokeStyle=Ub(n,e.linear_gradients[l.linear_gradient_idx],f,s,!0);break;case"radial_gradient_idx":n.strokeStyle=Vb(n,e.radial_gradients[l.radial_gradient_idx],f,s,!0)}switch(l.linejoin){case Uy.LINE_JOIN_MITER_CLIP:case Uy.LINE_JOIN_MITER:n.lineJoin="miter";break;case Uy.LINE_JOIN_ROUND:n.lineJoin="round";break;case Uy.LINE_JOIN_BEVEL:n.lineJoin="bevel"}switch(l.linecap){case x0.LINE_CAP_BUTT:n.lineCap="butt";break;case x0.LINE_CAP_ROUND:n.lineCap="round";break;case x0.LINE_CAP_SQUARE:n.lineCap="square"}n.stroke(d)}function Ub(n,e,i,s,l=!1){if(e.stops.length===1){const R=e.stops[0];return qm(R.rgb_color,R.opacity*i,s)}const{x1:d,y1:f,x2:g,y2:x}=e;let b=new DOMPoint(d,f),C=new DOMPoint(g,x);if(l){const R=Zm(e.transform);b=R.transformPoint(b),C=R.transformPoint(C)}const M=n.createLinearGradient(b.x,b.y,C.x,C.y);for(const R of e.stops)M.addColorStop(R.offset,qm(R.rgb_color,R.opacity*i,s));return M}function Vb(n,e,i,s,l=!1){if(e.stops.length===1){const $=e.stops[0];return qm($.rgb_color,$.opacity*i,s)}const d=Zm(e.transform),{fx:f,fy:g,fr:x,cx:b,cy:C,r:M}=e;let R=new DOMPoint(f,g),P=new DOMPoint(b,C),F=x,V=M;if(l){R=d.transformPoint(R),P=d.transformPoint(P);const $=(d.a+d.d)/2;F=x*$,V=e.r*$}const q=n.createRadialGradient(R.x,R.y,F,P.x,P.y,V);for(const $ of e.stops)q.addColorStop($.offset,qm($.rgb_color,$.opacity*i,s));return q}function jb(n,e,i,s){const l=s.transform?Zm(s.transform).preMultiplySelf(e):e,d=ig(n.canvas.width,n.canvas.height),f=d.getContext("2d");for(const x of s.children)if(x.group)jb(f,l,i,x.group);else if(x.path){const b=x.path,C=new Path2D;C.addPath(Zb(b),l),f.fill(C,Fb(b))}const g=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;g&&Gb(f,l,i,g),n.globalCompositeOperation="source-over",n.drawImage(d,0,0)}function Gb(n,e,i,s){const l=ig(n.canvas.width,n.canvas.height);jb(l.getContext("2d"),e,i,s),n.globalCompositeOperation="destination-in",n.drawImage(l,0,0)}function Hb(n,e,i,s,l){if(s.children.length===0)return;const d=s.mask_idx!=null?i.masks[s.mask_idx]:null;d&&Hb(n,e,i,d,l);const f=n.canvas.width,g=n.canvas.height,x=ig(f,g),b=x.getContext("2d"),C=s.width,M=s.height,R=s.left,P=s.top,F=new Path2D,V=new Path2D;V.rect(R,P,C,M),F.addPath(V,e),b.clip(F);for(const te of s.children)kb(b,e,i,te,l);const q=b.getImageData(0,0,f,g),$=q.data;if(s.mask_type===Lb.MASK_TYPE_LUMINANCE)for(let te=0;te<$.length;te+=4)$[te+3]=$[te+3]/255*(.2126*$[te]+.7152*$[te+1]+.0722*$[te+2]);b.putImageData(q,0,0),n.globalCompositeOperation="destination-in",n.drawImage(x,0,0)}function Zm(n){return n?new DOMMatrix([n.sx,n.ky,n.kx,n.sy,n.tx,n.ty]):new DOMMatrix}function qb(n,e){const i=n.step;let s=n.diffs[0]*i,l=n.diffs[1]*i;e.moveTo(s,l);for(let d=0,f=2;d<n.commands.length;d++)switch(n.commands[d]){case tg.PATH_COMMAND_MOVE:s+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.moveTo(s,l);break;case tg.PATH_COMMAND_LINE:s+=n.diffs[f++]*i,l+=n.diffs[f++]*i,e.lineTo(s,l);break;case tg.PATH_COMMAND_QUAD:{const g=s+n.diffs[f++]*i,x=l+n.diffs[f++]*i;s=g+n.diffs[f++]*i,l=x+n.diffs[f++]*i,e.quadraticCurveTo(g,x,s,l);break}case tg.PATH_COMMAND_CUBIC:{const g=s+n.diffs[f++]*i,x=l+n.diffs[f++]*i,b=g+n.diffs[f++]*i,C=x+n.diffs[f++]*i;s=b+n.diffs[f++]*i,l=C+n.diffs[f++]*i,e.bezierCurveTo(g,x,b,C,s,l);break}case tg.PATH_COMMAND_CLOSE:e.closePath()}return e}function Zb(n){return qb(n,new Path2D)}class Hy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Pt(Hy,"LRUCache");class w0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new cs(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new Hy(150)),this.cacheMap.get(s).get(dc(e.toString(),i))}setInCache(e,i,s,l){this.cacheDependenciesMap.has(l)||this.cacheDependenciesMap.set(l,new Map),this.cacheMap.has(l)||this.cacheMap.set(l,new Hy(150));const d=this.cacheDependenciesMap.get(l),f=dc(e.id.toString(),s);d.get(f)||d.set(f,new Set);const g=this.cacheMap.get(l),x=e.toString();d.get(f).add(x),g.put(dc(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const l=this.cacheMap.get(s),d=this.cacheDependenciesMap.get(s);for(const f of e){const g=dc(f.toString(),i);if(d.has(g)){for(const x of d.get(g))l.delete(x);d.delete(g)}}}rasterize(e,i,s,l,d=N2){const f=this.getFromCache(e,s,l);if(f)return f.clone();const g=d(i.icon,e.options),x=w0._getImage(g);return this.setInCache(e,x,s,l),x.clone()}}class Xb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Wb(n,e,i,s){let l=0,d=Number.MAX_VALUE;for(let f=0;f<3;f++)if(Math.abs(s[f])<1e-15){if(i[f]<n[f]||i[f]>e[f])return null}else{const g=1/s[f];let x=(n[f]-i[f])*g,b=(e[f]-i[f])*g;if(x>b){const C=x;x=b,b=C}if(x>l&&(l=x),b<d&&(d=b),l>d)return null}return l}function $b(n,e,i,s,l,d,f,g,x,b,C){const M=s-n,R=l-e,P=d-i,F=f-n,V=g-e,q=x-i,$=C[1]*q-C[2]*V,te=C[2]*F-C[0]*q,ne=C[0]*V-C[1]*F,G=M*$+R*te+P*ne;if(Math.abs(G)<1e-15)return null;const ee=1/G,re=b[0]-n,ae=b[1]-e,Te=b[2]-i,ve=(re*$+ae*te+Te*ne)*ee;if(ve<0||ve>1)return null;const Se=ae*P-Te*R,Me=Te*M-re*P,je=re*R-ae*M,ct=(C[0]*Se+C[1]*Me+C[2]*je)*ee;return ct<0||ve+ct>1?null:(F*Se+V*Me+q*je)*ee}function Yb(n,e,i){return(n-e)/(i-e)}function Kb(n,e,i,s,l,d,f,g,x){const b=1<<i,C=d-s,M=f-l,R=(n+1)/b*C+s,P=(e+0)/b*M+l,F=(e+1)/b*M+l;g[0]=(n+0)/b*C+s,g[1]=P,x[0]=R,x[1]=F}class Qb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(d){const f=Math.ceil(Math.log2(d.dim/8)),g=[];let x=Math.ceil(Math.pow(2,f));const b=1/x,C=(P,F,V,q,$)=>{const te=q?1:0,ne=(P+1)*V-te,G=F*V,ee=(F+1)*V-te;$[0]=P*V,$[1]=G,$[2]=ne,$[3]=ee};let M=new Xb(x);const R=[];for(let P=0;P<x*x;P++){C(P%x,Math.floor(P/x),b,!1,R);const F=Of(R[0],R[1],d),V=Of(R[2],R[1],d),q=Of(R[2],R[3],d),$=Of(R[0],R[3],d);M.minimums.push(Math.min(F,V,q,$)),M.maximums.push(Math.max(F,V,q,$)),M.leaves.push(1)}for(g.push(M),x/=2;x>=1;x/=2){const P=g[g.length-1];M=new Xb(x);for(let F=0;F<x*x;F++){C(F%x,Math.floor(F/x),2,!0,R);const V=P.getElevation(R[0],R[1]),q=P.getElevation(R[2],R[1]),$=P.getElevation(R[2],R[3]),te=P.getElevation(R[0],R[3]),ne=P.isLeaf(R[0],R[1]),G=P.isLeaf(R[2],R[1]),ee=P.isLeaf(R[2],R[3]),re=P.isLeaf(R[0],R[3]),ae=Math.min(V.min,q.min,$.min,te.min),Te=Math.max(V.max,q.max,$.max,te.max),ve=ne&&G&&ee&&re;M.maximums.push(Te),M.minimums.push(ae),M.leaves.push(Te-ae<=5&&ve?1:0)}g.push(M)}return g}(this.dem),s=i.length-1,l=i[s];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,l,d,f,g=1){return Wb([e,i,-100],[s,l,this.maximums[0]*g],d,f)}raycast(e,i,s,l,d,f,g=1){if(!this.nodeCount)return null;const x=this.raycastRoot(e,i,s,l,d,f,g);if(x==null)return null;const b=[],C=[],M=[],R=[],P=[{idx:0,t:x,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:F,t:V,nodex:q,nodey:$,depth:te}=P.pop();if(this.leaves[F]){Kb(q,$,te,e,i,s,l,M,R);const G=1<<te,ee=(q+0)/G,re=(q+1)/G,ae=($+0)/G,Te=($+1)/G,ve=Of(ee,ae,this.dem)*g,Se=Of(re,ae,this.dem)*g,Me=Of(re,Te,this.dem)*g,je=Of(ee,Te,this.dem)*g,ct=$b(M[0],M[1],ve,R[0],M[1],Se,R[0],R[1],Me,d,f),et=$b(R[0],R[1],Me,M[0],R[1],je,M[0],M[1],ve,d,f),at=Math.min(ct!==null?ct:Number.MAX_VALUE,et!==null?et:Number.MAX_VALUE);if(at!==Number.MAX_VALUE)return at;{const ft=Bt([],d,f,V);if(Jb(ve,Se,je,Me,Yb(ft[0],M[0],R[0]),Yb(ft[1],M[1],R[1]))>=ft[2])return V}continue}let ne=0;for(let G=0;G<this._siblingOffset.length;G++){Kb((q<<1)+this._siblingOffset[G][0],($<<1)+this._siblingOffset[G][1],te+1,e,i,s,l,M,R),M[2]=-100,R[2]=this.maximums[this.childOffsets[F]+G]*g;const ee=Wb(M,R,d,f);if(ee!=null){const re=ee;b[G]=re;let ae=!1;for(let Te=0;Te<ne&&!ae;Te++)re>=b[C[Te]]&&(C.splice(Te,0,G),ae=!0);ae||(C[ne]=G),ne++}}for(let G=0;G<ne;G++){const ee=C[G];P.push({idx:this.childOffsets[F]+ee,t:b[ee],nodex:(q<<1)+this._siblingOffset[ee][0],nodey:($<<1)+this._siblingOffset[ee][1],depth:te+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,l,d){if(e[l].isLeaf(i,s)===1)return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const f=l-1,g=e[f];let x=0,b=0;for(let C=0;C<this._siblingOffset.length;C++){const M=2*i+this._siblingOffset[C][0],R=2*s+this._siblingOffset[C][1],P=g.getElevation(M,R),F=g.isLeaf(M,R),V=this._addNode(P.min,P.max,F);F&&(x|=1<<C),b||(b=V)}for(let C=0;C<this._siblingOffset.length;C++)x&1<<C||this._construct(e,2*i+this._siblingOffset[C][0],2*s+this._siblingOffset[C][1],f,b+C)}}function Jb(n,e,i,s,l,d){return ei(ei(n,i,d),ei(e,s,d),l)}function Of(n,e,i){const s=i.dim,l=me(n*s-.5,0,s-1),d=me(e*s-.5,0,s-1),f=Math.floor(l),g=Math.floor(d),x=Math.min(f+1,s-1),b=Math.min(g+1,s-1);return Jb(i.get(f,g),i.get(x,g),i.get(f,b),i.get(x,b),l-f,d-g)}const U2={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function V2(n,e,i){return(256*n*256+256*e+i)/10-1e4}function j2(n,e,i){return 256*n+e+i/256-32768}class qy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,l=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void vi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2,f=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let x=0;x<d;x++)f[this._idx(-1,x)]=f[this._idx(0,x)],f[this._idx(d,x)]=f[this._idx(d-1,x)],f[this._idx(x,-1)]=f[this._idx(x,0)],f[this._idx(x,d)]=f[this._idx(x,d-1)];f[this._idx(-1,-1)]=f[this._idx(0,0)],f[this._idx(d,-1)]=f[this._idx(d-1,0)],f[this._idx(-1,d)]=f[this._idx(0,d-1)],f[this._idx(d,d)]=f[this._idx(d-1,d-1)]}const g=s==="terrarium"?j2:V2;for(let x=0;x<f.length;++x){const b=4*x;this.floatView[x]=g(this.pixels[b],this.pixels[b+1],this.pixels[b+2])}this._timestamp=Mo.now()}_buildQuadTree(){this._tree=new Qb(this)}get(e,i,s=!1){s&&(e=me(e,-1,this.dim),i=me(i,-1,this.dim));const l=this._idx(e,i);return this.floatView[l]}set(e,i,s){const l=this._idx(e,i),d=this.floatView[l];return this.floatView[l]=s,s-d}static getUnpackVector(e){return U2[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],l=qy.getUnpackVector(i);let d=Math.floor((e+l[3])/l[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new Zg({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=i*this.dim,d=i*this.dim+this.dim,f=s*this.dim,g=s*this.dim+this.dim;switch(i){case-1:l=d-1;break;case 1:d=l+1}switch(s){case-1:f=g-1;break;case 1:g=f+1}const x=-i*this.dim,b=-s*this.dim;for(let C=f;C<g;C++)for(let M=l;M<d;M++){const R=4*this._idx(M,C),P=4*this._idx(M+x,C+b);this.pixels[R+0]=e.pixels[P+0],this.pixels[R+1]=e.pixels[P+1],this.pixels[R+2]=e.pixels[P+2],this.pixels[R+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function G2(n,e,i){n===1?e.headerLength=i.readFixed32():n===2?e.x=i.readVarint():n===3?e.y=i.readVarint():n===4?e.z=i.readVarint():n===5&&e.layers.push(function(s,l){return s.readFields(W2,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},l)}(i,i.readVarint()+i.pos))}function H2(n,e,i){n===1?(e.delta_filter=function(s,l){return s.readFields(q2,{blockSize:0},l)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):n===2?(i.readVarint(),e.filter="zigzag_filter"):n===3?(i.readVarint(),e.filter="bitshuffle_filter"):n===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function q2(n,e,i){n===1&&(e.blockSize=i.readVarint())}function Z2(n,e,i){n===1?(i.readVarint(),e.codec="gzip_data"):n===2?(i.readVarint(),e.codec="jpeg_image"):n===3?(i.readVarint(),e.codec="webp_image"):n===4&&(i.readVarint(),e.codec="png_image")}function X2(n,e,i){let s=0,l=0;n===1?e.firstByte=i.readFixed64():n===2?e.lastByte=i.readFixed64():n===3?e.filters.push(function(d,f){return d.readFields(H2,{},f)}(i,i.readVarint()+i.pos)):n===4?e.codec=function(d,f){return d.readFields(Z2,{},f)}(i,i.readVarint()+i.pos):n===5?l=i.readFloat():n===6?s=i.readFloat():n===7?e.bands.push(i.readString()):n===8?e.offset=i.readDouble():n===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=l),e.scale===0&&(e.scale=s)}function W2(n,e,i){n===1?e.version=i.readVarint():n===2?e.name=i.readString():n===3?e.units=i.readString():n===4?e.tileSize=i.readVarint():n===5?e.buffer=i.readVarint():n===6?e.pixelFormat=i.readVarint():n===7&&e.dataIndex.push(function(s,l){return s.readFields(X2,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},l)}(i,i.readVarint()+i.pos))}function $2(n,e,i){if(n===2)(function(s,l,d){s.readFields(Y2,d,l)})(i,i.readVarint()+i.pos,e);else if(n===3)throw new Error("Not implemented")}function Y2(n,e,i){if(n===1){let s=0;const l=i.readVarint()+i.pos;for(;i.pos<l;)e[s++]=i.readVarint()}}function K2(n,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const l=s===1?1:0,d=s===2?1:0;for(let f=0;f<e[0];f++){const g=e[1]*f;for(let x=l;x<e[1];x++){const b=e[2]*(x+g);for(let C=d;C<e[2];C++){const M=e[3]*(C+b);for(let R=0;R<e[3];R++){const P=M+R;n[P]+=n[P-i]}}}}i*=e[s]}return n}function Q2(n){for(let e=0,i=n.length;e<i;e++)n[e]=n[e]>>>1^-(1&n[e]);return n}function J2(n,e){switch(e){case"uint32":return n;case"uint16":for(let i=0;i<n.length;i+=2){const s=n[i],l=n[i+1];n[i]=(240&s)>>4|(61440&s)>>8|(240&l)<<4|61440&l,n[i+1]=15&s|(3840&s)>>4|(15&l)<<8|(3840&l)<<4}return n;case"uint8":for(let i=0;i<n.length;i+=4){const s=n[i],l=n[i+1],d=n[i+2],f=n[i+3];n[i+0]=(192&s)>>6|(192&l)>>4|(192&d)>>2|192&f,n[i+1]=(48&s)>>4|(48&l)>>2|48&d|(48&f)<<2,n[i+2]=(12&s)>>2|12&l|(12&d)<<2|(12&f)<<4,n[i+3]=3&s|(3&l)<<2|(3&d)<<4|(3&f)<<6}return n;default:throw new Error(`Invalid pixel format, "${e}"`)}}Pt(qy,"DEMData"),Pt(Qb,"DemMinMaxQuadTree",{omit:["dem"]});var Ol=Uint8Array,ng=Uint16Array,eA=Int32Array,ew=new Ol([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tw=new Ol([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),tA=new Ol([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),iw=function(n,e){for(var i=new ng(31),s=0;s<31;++s)i[s]=e+=1<<n[s-1];var l=new eA(i[30]);for(s=1;s<30;++s)for(var d=i[s];d<i[s+1];++d)l[d]=d-i[s]<<5|s;return{b:i,r:l}},nw=iw(ew,2),rw=nw.b,iA=nw.r;rw[28]=258,iA[258]=28;for(var nA=iw(tw,0).b,sw=new ng(32768),$r=0;$r<32768;++$r){var Xm=(43690&$r)>>1|(21845&$r)<<1;sw[$r]=((65280&(Xm=(61680&(Xm=(52428&Xm)>>2|(13107&Xm)<<2))>>4|(3855&Xm)<<4))>>8|(255&Xm)<<8)>>1}var rg=function(n,e,i){for(var s=n.length,l=0,d=new ng(e);l<s;++l)n[l]&&++d[n[l]-1];var f,g=new ng(e);for(l=1;l<e;++l)g[l]=g[l-1]+d[l-1]<<1;f=new ng(1<<e);var x=15-e;for(l=0;l<s;++l)if(n[l])for(var b=l<<4|n[l],C=e-n[l],M=g[n[l]-1]++<<C,R=M|(1<<C)-1;M<=R;++M)f[sw[M]>>x]=b;return f},sg=new Ol(288);for($r=0;$r<144;++$r)sg[$r]=8;for($r=144;$r<256;++$r)sg[$r]=9;for($r=256;$r<280;++$r)sg[$r]=7;for($r=280;$r<288;++$r)sg[$r]=8;var ow=new Ol(32);for($r=0;$r<32;++$r)ow[$r]=5;var rA=rg(sg,9),sA=rg(ow,5),T0=function(n){for(var e=n[0],i=1;i<n.length;++i)n[i]>e&&(e=n[i]);return e},du=function(n,e,i){var s=e/8|0;return(n[s]|n[s+1]<<8)>>(7&e)&i},S0=function(n,e){var i=e/8|0;return(n[i]|n[i+1]<<8|n[i+2]<<16)>>(7&e)},oA=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],fu=function(n,e,i){var s=new Error(e||oA[n]);if(s.code=n,Error.captureStackTrace&&Error.captureStackTrace(s,fu),!i)throw s;return s},aA=new Ol(0),lA=typeof TextDecoder<"u"&&new TextDecoder;try{lA.decode(aA,{stream:!0})}catch{}const cA={gzip_data:"gzip"};class wc extends Error{constructor(e){super(e),this.name="MRTError"}}const uA={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},aw={uint32:1,uint16:2,uint8:4},hA={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let E0;class Zy{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new wc(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new wc("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new wc(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const l=function(d,f){return d.readFields(G2,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new E0(i.subarray(0,s)));if(!isNaN(this.x)&&(this.x!==l.x||this.y!==l.y||this.z!==l.z))throw new wc(`Invalid attempt to parse header ${l.z}/${l.x}/${l.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=l.x,this.y=l.y,this.z=l.z;for(const d of l.layers)this.layers[d.name]=new lw(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let l of e.blockIndices){const d=s.dataIndex[l],f=d.firstByte-e.firstByte,g=d.lastByte-e.firstByte;if(s._blocksInProgress.has(l))continue;const x={layerName:s.name,firstByte:f,lastByte:g,pixelFormat:s.pixelFormat,blockIndex:l,blockShape:[d.bands.length].concat(s.bandShape),buffer:s.buffer,codec:d.codec.codec,filters:d.filters.map(b=>b.filter)};s._blocksInProgress.add(l),i.push(x)}return new cw(i,()=>{i.forEach(l=>s._blocksInProgress.delete(l.blockIndex))},(l,d)=>{if(i.forEach(f=>s._blocksInProgress.delete(f.blockIndex)),l)throw l;d.forEach(f=>{this.getLayer(f.layerName).processDecodedData(f)})})}}class lw{constructor({version:e,name:i,units:s,tileSize:l,pixelFormat:d,buffer:f,dataIndex:g},x){if(this.version=e,this.version!==1)throw new wc(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=l,this.buffer=f,this.pixelFormat=uA[d],this.dataIndex=g,this.bandShape=[l+2*f,l+2*f,aw[this.pixelFormat]],this._decodedBlocks=new Hy(x?x.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return aw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,l]of this.dataIndex.entries()){for(const[d,f]of l.bands.entries())if(f===e)return{bandIndex:i+d,blockIndex:s,blockBandIndex:d};i+=l.bands.length}break;case"number":for(const[s,l]of this.dataIndex.entries()){if(e>=i&&e<i+l.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=l.bands.length}break;default:throw new wc(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const l=[],d=new Set;for(const f of e){const{blockIndex:g}=this.getBlockForBand(f);if(g<0)throw new wc(`Invalid band: ${JSON.stringify(f)}`);const x=this.dataIndex[g];l.includes(g)||l.push(g),d.add(g),i=Math.min(i,x.firstByte),s=Math.max(s,x.lastByte)}if(d.size>this.cacheSize)throw new wc(`Number of blocks to decode (${d.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:l}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new wc(`Band not found: ${JSON.stringify(e)}`);const l=this._decodedBlocks.get(i.toString());if(!l)throw new wc(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const d=this.dataIndex[i],f=this.bandShape.reduce((b,C)=>b*C,1),g=s*f,x=l.subarray(g,g+f);return{data:x,bytes:new Uint8Array(x.buffer).subarray(x.byteOffset,x.byteOffset+x.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:d.offset,scale:d.scale}}}Zy.setPbf=function(n){E0=n};class cw{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function Wp(n,e){const i=n.json.bufferViews[e.bufferView],s=fy[e.componentType];return new s(n.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==V_[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:V_[e.type]))}function A0(n,e,i,s){const l=fy[e.componentType],d=function(C){switch(C){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(l),f=n.json.bufferViews[e.bufferView],g=f.byteStride?f.byteStride/l.BYTES_PER_ELEMENT:V_[e.type],x=i.float32,b=x.length/i.capacity;for(let C=0,M=0;C<e.count*g;C+=g,M+=b)for(let R=0;R<b;R++)x[M+R]=s[C+R]*d;i._trim()}function dA(n,e,i){const s=n.indices,l=n.attributes,d={};d.indexArray=new Sr;const f=e.json.accessors[s],g=f.count/3;d.indexArray.reserve(g);const x=Wp(e,f);for(let R=0;R<g;R++)d.indexArray.emplaceBack(x[3*R],x[3*R+1],x[3*R+2]);d.indexArray._trim(),d.vertexArray=new uo;const b=e.json.accessors[l.POSITION];d.vertexArray.reserve(b.count);const C=Wp(e,b);for(let R=0;R<b.count;R++)d.vertexArray.emplaceBack(C[3*R],C[3*R+1],C[3*R+2]);if(d.vertexArray._trim(),d.aabb=new Hi(b.min,b.max),d.centroid=function(R,P){const F=[0,0,0],V=R.length;if(V>0){for(let q=0;q<V;q++){const $=3*R[q];F[0]+=P[$],F[1]+=P[$+1],F[2]+=P[$+2]}F[0]/=V,F[1]/=V,F[2]/=V}return F}(x,C),l.COLOR_0!==void 0){const R=e.json.accessors[l.COLOR_0],P=V_[R.type],F=Wp(e,R);d.colorArray=P===3?new uo:new zr,d.colorArray.resize(R.count),A0(e,R,d.colorArray,F)}if(l.NORMAL!==void 0){d.normalArray=new uo;const R=e.json.accessors[l.NORMAL];d.normalArray.resize(R.count);const P=Wp(e,R);A0(e,R,d.normalArray,P)}if(l.TEXCOORD_0!==void 0&&i.length>0){d.texcoordArray=new Za;const R=e.json.accessors[l.TEXCOORD_0];d.texcoordArray.resize(R.count);const P=Wp(e,R);A0(e,R,d.texcoordArray,P)}if(l._FEATURE_ID_RGBA4444!==void 0){const R=e.json.accessors[l._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(d.featureData=Wp(e,R))}l._FEATURE_RGBA4444!==void 0&&(d.featureData=new Uint32Array(Wp(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer));const M=n.material;return d.material=function(R,P){const{emissiveFactor:F=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:q=.5,normalTexture:$,occlusionTexture:te,emissiveTexture:ne,doubleSided:G}=R,{baseColorFactor:ee=[1,1,1,1],metallicFactor:re=1,roughnessFactor:ae=1,baseColorTexture:Te,metallicRoughnessTexture:ve}=R.pbrMetallicRoughness||{},Se=te?P[te.index]:void 0;if(te&&te.extensions&&te.extensions.KHR_texture_transform&&Se){const Me=te.extensions.KHR_texture_transform;Se.offsetScale=[Me.offset[0],Me.offset[1],Me.scale[0],Me.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new sn(...ee),metallicFactor:re,roughnessFactor:ae,baseColorTexture:Te?P[Te.index]:void 0,metallicRoughnessTexture:ve?P[ve.index]:void 0},doubleSided:G,emissiveFactor:new sn(...F),alphaMode:V,alphaCutoff:q,normalTexture:$?P[$.index]:void 0,occlusionTexture:Se,emissionTexture:ne?P[ne.index]:void 0,defined:R.defined===void 0}}(M!==void 0?e.json.materials[M]:{defined:!1},i),d}function uw(n,e,i){const{matrix:s,rotation:l,translation:d,scale:f,mesh:g,extras:x,children:b}=n,C={};if(C.matrix=s||function(M,R,P,F){var V=R[0],q=R[1],$=R[2],te=R[3],ne=V+V,G=q+q,ee=$+$,re=V*ne,ae=V*G,Te=V*ee,ve=q*G,Se=q*ee,Me=$*ee,je=te*ne,ct=te*G,et=te*ee,at=F[0],ft=F[1],He=F[2];return M[0]=(1-(ve+Me))*at,M[1]=(ae+et)*at,M[2]=(Te-ct)*at,M[3]=0,M[4]=(ae-et)*ft,M[5]=(1-(re+Me))*ft,M[6]=(Se+je)*ft,M[7]=0,M[8]=(Te+ct)*He,M[9]=(Se-je)*He,M[10]=(1-(re+ve))*He,M[11]=0,M[12]=P[0],M[13]=P[1],M[14]=P[2],M[15]=1,M}([],l||[0,0,0,1],d||[0,0,0],f||[1,1,1]),g!==void 0){C.meshes=i[g];const M=C.anchor=[0,0];for(const R of C.meshes){const{min:P,max:F}=R.aabb;M[0]+=P[0]+F[0],M[1]+=P[1]+F[1]}M[0]=Math.floor(M[0]/C.meshes.length/2),M[1]=Math.floor(M[1]/C.meshes.length/2)}if(x&&(x.id&&(C.id=x.id),x.lights&&(C.lights=function(M){if(!M.length)return[];const R=function($){const te=atob($),ne=new Uint8Array(te.length);for(let G=0;G<te.length;G++)ne[G]=te.codePointAt(G);return ne}(M),P=[],F=R.length/24,V=new Uint16Array(R.buffer),q=new Float32Array(R.buffer);for(let $=0;$<F;$++){const te=V[2*$*6]/30,ne=V[2*$*6+1]/30,G=V[2*$*6+10]/100,ee=q[6*$+1],re=q[6*$+2],ae=q[6*$+3],Te=q[6*$+4],ve=ae-ee,Se=Te-re,Me=Math.hypot(ve,Se);P.push({pos:[ee+.5*ve,re+.5*Se,ne],normal:[Se/Me,-ve/Me,0],width:Me,height:te,depth:G,points:[ee,re,ae,Te]})}return P}(x.lights))),b){const M=[];for(const R of b)M.push(uw(e.json.nodes[R],e,i));C.children=M}return C}function fA(n){if(n.vertices.length===0||n.indices.length===0)return null;const e=new Ed(n.vertices,n.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:n.vertices,indices:n.indices,grid:e,min:i,max:s}}function pA(n){if(!n.extras||!n.extras.ground)return null;const e=n.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const f of i){if(!Array.isArray(f)||f.length!==2)continue;const g=f[0],x=f[1];typeof g=="number"&&typeof x=="number"&&s.push(new Tt(g,x))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let l=0;for(let f=0;f<s.length;f++){const g=s[f],x=s[(f+1)%s.length],b=s[(f+2)%s.length];l+=(g.x-x.x)*(b.y-x.y)-(b.x-x.x)*(g.y-x.y)}l>0&&s.reverse();const d=gd(s.flatMap(f=>[f.x,f.y]),[]);return d.length===0?null:{vertices:s,indices:d}}function mA(n,e){const i=[],s=[];let l=0;const d=[];for(const f of n){l=i.length;const g=f.vertexArray.float32,x=f.indexArray.uint16;for(let b=0;b<f.vertexArray.length;b++)d[0]=g[3*b+0],d[1]=g[3*b+1],d[2]=g[3*b+2],cn(d,d,e),i.push(new Tt(d[0],d[1]));for(let b=0;b<3*f.indexArray.length;b++)s.push(x[b]+l)}if(s.length%3!=0)return null;for(let f=0;f<s.length;f+=3){const g=i[s[f+0]],x=i[s[f+1]],b=i[s[f+2]];(g.x-x.x)*(b.y-x.y)-(b.x-x.x)*(g.y-x.y)>0&&([s[f+1],s[f+2]]=[s[f+2],s[f+1]])}return{vertices:i,indices:s}}function hw(n){const e=function(x,b){const C=[],M=WebGL2RenderingContext;if(x.json.textures)for(const R of x.json.textures){const P={magFilter:M.LINEAR,minFilter:M.NEAREST,wrapS:M.REPEAT,wrapT:M.REPEAT};R.sampler!==void 0&&Object.assign(P,x.json.samplers[R.sampler]),C.push({image:b[R.source],sampler:P,uploaded:!1})}return C}(n,n.images),i=function(x,b){const C=[];for(const M of x.json.meshes){const R=[];for(const P of M.primitives)R.push(dA(P,x,b));C.push(R)}return C}(n,e),{scenes:s,scene:l,nodes:d}=n.json,f=s?s[l||0].nodes:d,g=[];for(const x of f)g.push(uw(d[x],n,i));return function(x,b,C){const M={},R=new Set;for(let P=0;P<x.length;P++){const F=C[b[P]];if(!F.extras)continue;const V=F.extras["mapbox:footprint:version"],q=F.extras["mapbox:footprint:id"];(V||q)&&R.add(P),V==="1.0.0"&&q&&(M[q]=P)}for(let P=0;P<x.length;P++){if(R.has(P))continue;const F=x[P],V=C[b[P]];if(!V.extras)continue;let q=null;F.id in M&&(q=mA(x[M[F.id]].meshes,F.matrix)),q||(q=pA(V)),q&&(F.footprint=fA(q))}if(R.size>0){const P=Array.from(R.values()).sort((F,V)=>F-V);for(let F=P.length-1;F>=0;F--)x.splice(P[F],1)}}(g,f,n.json.nodes),g}function _A(n){n.heightmap=new Float32Array(4096),n.heightmap.fill(-1);const e=n.vertexArray.float32,i=n.aabb.min[0]-1,s=n.aabb.min[1]-1,l=Zp/(n.aabb.max[0]-i+2),d=Zp/(n.aabb.max[1]-s+2);for(let f=0;f<e.length;f+=3){const g=e[f+2],x=(e[f+0]-i)*l|0,b=(e[f+1]-s)*d|0;g>n.heightmap[b*Zp+x]&&(n.heightmap[b*Zp+x]=g)}}function gA(n,e){const i={};i.indexArray=new Sr,i.indexArray.reserve(4*n.length),i.vertexArray=new uo,i.vertexArray.reserve(10*n.length),i.colorArray=new zr,i.vertexArray.reserve(10*n.length);let s=0;for(const f of n){const g=Math.min(10,Math.max(4,1.3*f.height))*e,x=[-f.normal[1],f.normal[0],0],b=Math.min(.29,.1*f.width/f.depth),C=f.width-2*f.depth*e*(b+.01),M=Bt([],f.pos,x,C/2),R=Bt([],f.pos,x,-C/2),P=[M[0],M[1],M[2]+f.height],F=[R[0],R[1],R[2]+f.height],V=Bt([],f.normal,x,b);Le(V,V,g);const q=Bt([],f.normal,x,-b);Le(q,q,g),bn(V,M,V),bn(q,R,q),M[2]+=.1,R[2]+=.1,i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(q[0],q[1],q[2]);const $=C/g/2;i.colorArray.emplaceBack(-$-b,-1,$,.8),i.colorArray.emplaceBack($+b,-1,$,.8),i.colorArray.emplaceBack(-$,0,$,1.3),i.colorArray.emplaceBack($,0,$,1.3),i.colorArray.emplaceBack($+b,-.8,$,.7),i.colorArray.emplaceBack($+b,-.8,$,.7),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack(0,0,$,1.3),i.colorArray.emplaceBack($+b,-1.2,$,.8),i.colorArray.emplaceBack($+b,-1.2,$,.8),i.indexArray.emplaceBack(6+s,4+s,8+s),i.indexArray.emplaceBack(7+s,9+s,5+s),i.indexArray.emplaceBack(0+s,1+s,2+s),i.indexArray.emplaceBack(1+s,3+s,2+s),s+=10}const l={defined:!0};l.emissiveFactor=sn.black;const d={};return d.baseColorFactor=sn.white,l.pbrMetallicRoughness=d,i.material=l,i.aabb=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Zy.performDecoding=function(n,e){const i=new Uint8Array(n);return Promise.all(e.tasks.map(s=>{const{layerName:l,firstByte:d,lastByte:f,pixelFormat:g,blockShape:x,blockIndex:b,filters:C,codec:M}=s,R=i.subarray(d,f+1),P=new Uint32Array(x[0]*x[1]*x[2]);let F;if(M!=="gzip_data")throw new wc(`Unhandled codec: ${M}`);return F=function(V,q){if(!globalThis.DecompressionStream&&q==="gzip_data")return Promise.resolve(((G=function(ae){ae[0]==31&&ae[1]==139&&ae[2]==8||fu(6,"invalid gzip data");var Te=ae[3],ve=10;4&Te&&(ve+=2+(ae[10]|ae[11]<<8));for(var Se=(Te>>3&1)+(Te>>4&1);Se>0;Se-=!ae[ve++]);return ve+(2&Te)}(ne=V))+8>ne.length&&fu(6,"invalid gzip data"),function(ae,Te,ve,Se){var Me=ae.length;if(!Me||Te.f&&!Te.l)return ve||new Ol(0);var je=!ve,ct=je||Te.i!=2,et=Te.i;je&&(ve=new Ol(3*Me));var at,ft,He=function(wr){var Wn=ve.length;if(wr>Wn){var Bn=new Ol(Math.max(2*Wn,wr));Bn.set(ve),ve=Bn}},st=Te.f||0,Ve=Te.p||0,Ge=Te.b||0,_t=Te.l,yt=Te.d,Qt=Te.m,jt=Te.n,At=8*Me;do{if(!_t){st=du(ae,Ve,1);var mt=du(ae,Ve+1,3);if(Ve+=3,!mt){var _i=ae[(se=4+((Ve+7)/8|0))-4]|ae[se-3]<<8,Vt=se+_i;if(Vt>Me){et&&fu(0);break}ct&&He(Ge+_i),ve.set(ae.subarray(se,Vt),Ge),Te.b=Ge+=_i,Te.p=Ve=8*Vt,Te.f=st;continue}if(mt==1)_t=rA,yt=sA,Qt=9,jt=5;else if(mt==2){var Gt=du(ae,Ve,31)+257,ri=du(ae,Ve+10,15)+4,Si=Gt+du(ae,Ve+5,31)+1;Ve+=14;for(var bi=new Ol(Si),Di=new Ol(19),Ei=0;Ei<ri;++Ei)Di[tA[Ei]]=du(ae,Ve+3*Ei,7);Ve+=3*ri;var zi=T0(Di),fn=(1<<zi)-1,Vn=rg(Di,zi);for(Ei=0;Ei<Si;){var se,ue=Vn[du(ae,Ve,fn)];if(Ve+=15&ue,(se=ue>>4)<16)bi[Ei++]=se;else{var Xe=0,bt=0;for(se==16?(bt=3+du(ae,Ve,3),Ve+=2,Xe=bi[Ei-1]):se==17?(bt=3+du(ae,Ve,7),Ve+=3):se==18&&(bt=11+du(ae,Ve,127),Ve+=7);bt--;)bi[Ei++]=Xe}}var Ct=bi.subarray(0,Gt),Et=bi.subarray(Gt);Qt=T0(Ct),jt=T0(Et),_t=rg(Ct,Qt),yt=rg(Et,jt)}else fu(1);if(Ve>At){et&&fu(0);break}}ct&&He(Ge+131072);for(var Ut=(1<<Qt)-1,ni=(1<<jt)-1,Ni=Ve;;Ni=Ve){var Ui=(Xe=_t[S0(ae,Ve)&Ut])>>4;if((Ve+=15&Xe)>At){et&&fu(0);break}if(Xe||fu(2),Ui<256)ve[Ge++]=Ui;else{if(Ui==256){Ni=Ve,_t=null;break}var Ai=Ui-254;Ui>264&&(Ai=du(ae,Ve,(1<<(Vi=ew[Ei=Ui-257]))-1)+rw[Ei],Ve+=Vi);var mn=yt[S0(ae,Ve)&ni],kn=mn>>4;if(mn||fu(3),Ve+=15&mn,Et=nA[kn],kn>3){var Vi=tw[kn];Et+=S0(ae,Ve)&(1<<Vi)-1,Ve+=Vi}if(Ve>At){et&&fu(0);break}ct&&He(Ge+131072);var fr=Ge+Ai;if(Ge<Et){var jn=0-Et,pn=Math.min(Et,fr);for(jn+Ge<0&&fu(3);Ge<pn;++Ge)ve[Ge]=(void 0)[jn+Ge]}for(;Ge<fr;++Ge)ve[Ge]=ve[Ge-Et]}}Te.l=_t,Te.p=Ni,Te.b=Ge,Te.f=st,_t&&(st=1,Te.m=Qt,Te.d=yt,Te.n=jt)}while(!st);return Ge!=ve.length&&je?(at=ve,((ft=Ge)==null||ft>at.length)&&(ft=at.length),new Ol(at.subarray(0,ft))):ve.subarray(0,Ge)}(ne.subarray(G,-8),{i:2},new Ol((($=ne)[(te=$.length)-4]|$[te-3]<<8|$[te-2]<<16|$[te-1]<<24)>>>0))));var $,te,ne,G;const ee=cA[q];if(!ee)throw new Error(`Unhandled codec: ${q}`);const re=new globalThis.DecompressionStream(ee);return new Response(new Blob([V]).stream().pipeThrough(re)).arrayBuffer().then(ae=>new Uint8Array(ae))}(R,M).then(V=>(function(q,$){q.readFields($2,$)}(new E0(V),P),new hA[g](P.buffer))),F.then(V=>{for(let q=C.length-1;q>=0;q--)switch(C[q]){case"delta_filter":K2(V,x);break;case"zigzag_filter":Q2(V);break;case"bitshuffle_filter":J2(V,g);break;default:throw new wc(`Unhandled filter "${C[q]}"`)}return{layerName:l,blockIndex:b,data:V}}).catch(V=>{throw V})}))},Pt(cw,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Pt(Zy,"MapboxRasterTile"),Pt(lw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class dw{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const yA=["id","tile","layer","source","sourceLayer","state"];class Wm{constructor(e,i,s,l,d){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=l,this.properties=e.properties,this.id=d}clone(){const e=new Wm(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of yA)this[i]!==void 0&&(e[i]=this[i]);return e}}class fw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new fa(vt,16,0),this.featureIndexArray=new wp,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,l,d,f=0,g=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,d,f);const b=this.grid;for(let C=0;C<i.length;C++){const M=i[C],R=[1/0,1/0,-1/0,-1/0];for(let P=0;P<M.length;P++){const F=M[P];R[0]=Math.min(R[0],F.x),R[1]=Math.min(R[1],F.y),R[2]=Math.max(R[2],F.x),R[3]=Math.max(R[3],F.y)}g!==0&&(R[0]-=g,R[1]-=g,R[2]+=g,R[3]+=g),R[0]<vt&&R[1]<vt&&R[2]>=0&&R[3]>=0&&b.insert(x,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new mi.VectorTile(new my(this.rawTileData)).layers,this.sourceLayerCoder=new dw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:l,tileTransform:d,pixelPosMatrix:f,availableImages:g,worldview:x}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const b=s.bufferedTilespaceBounds,C=this.grid.query(b.min.x,b.min.y,b.max.x,b.max.y,(F,V,q,$)=>ru(s.bufferedTilespaceGeometry,F,V,q,$));C.sort(vA);let M=null;l.elevation&&C.length>0&&(M=Hm.create(l.elevation,this.tileID));const R={};let P;for(let F=0;F<C.length;F++){const V=C[F];if(V===P)continue;P=V;const q=this.featureIndexArray.get(V);let $=null;this.is3DTile?this.loadMatchingModelFeature(R,q,e,s,l,x):this.loadMatchingFeature(R,q,e,g,x,(te,ne,G,ee=0)=>($||($=zt(te,this.tileID.canonical,d)),ne.queryIntersectsFeature(s,te,G,$,this.z,l,f,M,ee)))}return R}loadMatchingFeature(e,i,s,l,d,f){const{featureIndex:g,bucketIndex:x,sourceLayerIndex:b,layoutVertexArrayOffset:C}=i,M=this.bucketLayerIDs[x],R=s.layers,P=Object.keys(R);if(P.length&&!ci(P,M))return;const F=s.sourceCache,V=this.sourceLayerCoder.decode(b),q=this.vtLayers[V].feature(g),$=this.getId(q,V);for(let te=0;te<M.length;te++){const ne=M[te];if(!R[ne])continue;const{styleLayer:G,targets:ee}=R[ne];let re={};$!==void 0&&(re=F.getFeatureState(G.sourceLayer,$));const ae=!f||f(q,G,re,C);if(!ae)continue;const Te=new Wm(q,this.z,this.x,this.y,$);Te.tile=this.tileID.canonical,Te.state=re;let ve=this.serializedLayersCache.get(ne);ve||(ve=G.serialize(),ve.id=ne,this.serializedLayersCache.set(ne,ve)),Te.source=ve.source,Te.sourceLayer=ve["source-layer"],Te.layer=ke({},ve),Te.layer.paint=pw(ve.paint,G.paint,q,re,l),Te.layer.layout=pw(ve.layout,G.layout,q,re,l);let Se=!1;for(const Me of ee){this.updateFeatureProperties(Te,Me);const{filter:je}=Me;if(je){if(q.properties=Te.properties,je.needGeometry){const ct=Dt(q,!0);if(!je.filter(new hn(this.tileID.overscaledZ,{worldview:d}),ct,this.tileID.canonical))continue}else if(!je.filter(new hn(this.tileID.overscaledZ,{worldview:d}),q))continue}Se=!0,Me.targetId&&this.addFeatureVariant(Te,Me)}Se&&this.appendToResult(e,ne,g,Te,ae)}}loadMatchingModelFeature(e,i,s,l,d,f){const{featureIndex:g,bucketIndex:x}=i,b=this.bucketLayerIDs[x],C=s.layers,M=Object.keys(C);if(!M.length||ci(M,b))for(let R=0;R<b.length;R++){const P=b[R],{styleLayer:F,targets:V}=C[P];if(F.type!=="model")continue;const q=l.tile,$=q.getBucket(F);if(!($&&$ instanceof Ny))continue;const te=y2($,g,l,d);if(!te)continue;const{z:ne,x:G,y:ee}=q.tileID.canonical,{feature:re,intersectionZ:ae,position:Te}=te;let ve={};re.id!==void 0&&(ve=s.sourceCache.getFeatureState(F.sourceLayer,re.id));const Se=new Wm({},ne,G,ee,re.id);Se.tile=this.tileID.canonical,Se.state=ve,Se.properties=re.properties,Se.geometry={type:"Point",coordinates:[Te.lng,Te.lat]};let Me=this.serializedLayersCache.get(P);Me||(Me=F.serialize(),Me.id=P,this.serializedLayersCache.set(P,Me)),Se.source=Me.source,Se.sourceLayer=Me["source-layer"],Se.layer=ke({},Me);let je=!1;for(const ct of V){this.updateFeatureProperties(Se,ct);const{filter:et}=ct;if(et){if(re.properties=Se.properties,et.needGeometry){if(!et.filter(new hn(this.tileID.overscaledZ,{worldview:f}),re,this.tileID.canonical))continue}else if(!et.filter(new hn(this.tileID.overscaledZ,{worldview:f}),re))continue}je=!0,ct.targetId&&this.addFeatureVariant(Se,ct)}je&&this.appendToResult(e,P,g,Se,ae)}}updateFeatureProperties(e,i,s){if(i.properties){const l={};for(const d in i.properties){const f=i.properties[d].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);f!=null&&(l[d]=f)}e.properties=l}}addFeatureVariant(e,i,s){const l={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(l.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(l)}appendToResult(e,i,s,l,d){let f=e[i];f===void 0&&(f=e[i]=[]),f.push({featureIndex:s,feature:l,intersectionZ:d})}lookupSymbolFeatures(e,i,s,l,d,f){const g={};this.loadVTLayers();for(const x of e)this.loadMatchingFeature(g,{bucketIndex:i,sourceLayerIndex:s,featureIndex:x,layoutVertexArrayOffset:0},l,d,f);return g}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const l=this.sourceLayerCoder.decode(s),d=this.vtFeatures[l];if(d[i])return d[i];const f=this.vtLayers[l].feature(i);return d[i]=f,f}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const l=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(l!=null)if(Array.isArray(l)){if(!this.promoteIdExpression){const d=Fo(l);if(d.result!=="success"){const f=d.value.map(g=>`${g.key}: ${g.message}`).join(", ");return void vi(`Failed to create expression for promoteId: ${f}`)}this.promoteIdExpression=d.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new Du),s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[l];typeof s=="boolean"&&(s=Number(s))}return s}}function pw(n,e,i,s,l){return Rt(n,(d,f)=>{const g=e instanceof $c?e.get(f):null;return g&&g.evaluate?g.evaluate(i,s,void 0,l):g})}function vA(n,e){return e-n}Pt(fw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const mw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class C0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const d=mw[15&s];if(!d)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(e,2,1),[g]=new Uint32Array(e,4,1);return new C0(g,f,d,e)}constructor(e,i=64,s=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const d=mw.indexOf(this.ArrayType),f=2*e*this.ArrayType.BYTES_PER_ELEMENT,g=e*this.IndexArrayType.BYTES_PER_ELEMENT,x=(8-g%8)%8;if(d<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+f+g+x),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+g+x,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+d]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return I0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:f,nodeSize:g}=this,x=[0,d.length-1,0],b=[];for(;x.length;){const C=x.pop()||0,M=x.pop()||0,R=x.pop()||0;if(M-R<=g){for(let q=R;q<=M;q++){const $=f[2*q],te=f[2*q+1];$>=e&&$<=s&&te>=i&&te<=l&&b.push(d[q])}continue}const P=R+M>>1,F=f[2*P],V=f[2*P+1];F>=e&&F<=s&&V>=i&&V<=l&&b.push(d[P]),(C===0?e<=F:i<=V)&&(x.push(R),x.push(P-1),x.push(1-C)),(C===0?s>=F:l>=V)&&(x.push(P+1),x.push(M),x.push(1-C))}return b}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:d,nodeSize:f}=this,g=[0,l.length-1,0],x=[],b=s*s;for(;g.length;){const C=g.pop()||0,M=g.pop()||0,R=g.pop()||0;if(M-R<=f){for(let q=R;q<=M;q++)gw(d[2*q],d[2*q+1],e,i)<=b&&x.push(l[q]);continue}const P=R+M>>1,F=d[2*P],V=d[2*P+1];gw(F,V,e,i)<=b&&x.push(l[P]),(C===0?e-s<=F:i-s<=V)&&(g.push(R),g.push(P-1),g.push(1-C)),(C===0?e+s>=F:i+s>=V)&&(g.push(P+1),g.push(M),g.push(1-C))}return x}}function I0(n,e,i,s,l,d){if(l-s<=i)return;const f=s+l>>1;_w(n,e,f,s,l,d),I0(n,e,i,s,f-1,1-d),I0(n,e,i,f+1,l,1-d)}function _w(n,e,i,s,l,d){for(;l>s;){if(l-s>600){const b=l-s+1,C=i-s+1,M=Math.log(b),R=.5*Math.exp(2*M/3),P=.5*Math.sqrt(M*R*(b-R)/b)*(C-b/2<0?-1:1);_w(n,e,i,Math.max(s,Math.floor(i-C*R/b+P)),Math.min(l,Math.floor(i+(b-C)*R/b+P)),d)}const f=e[2*i+d];let g=s,x=l;for(og(n,e,s,i),e[2*l+d]>f&&og(n,e,s,l);g<x;){for(og(n,e,g,x),g++,x--;e[2*g+d]<f;)g++;for(;e[2*x+d]>f;)x--}e[2*s+d]===f?og(n,e,s,x):(x++,og(n,e,x,l)),x<=i&&(s=x+1),i<=x&&(l=x-1)}}function og(n,e,i,s){M0(n,i,s),M0(e,2*i,2*s),M0(e,2*i+1,2*s+1)}function M0(n,e,i){const s=n[e];n[e]=n[i],n[i]=s}function gw(n,e,i,s){const l=n-i,d=e-s;return l*l+d*d}o.$=Wr,o.A=hl,o.B=Ca,o.C=dc,o.D=pt,o.E=Rc,o.F=2,o.G=Z_,o.H=O1,o.I=io,o.J=ml,o.K=class extends By{},o.L=zc,o.M=Ys,o.N=Xu,o.O=Gc,o.P=Tt,o.Q=qc,o.R=Eu,o.S=Pr,o.T=c0,o.U=Jh,o.V=By,o.W=Wh,o.X=Fo,o.Y=Nu,o.Z=Tr,o._=nc,o.a=function(n){return Qr.API_CDN_URL_REGEX.test(n)},o.a$=Ne,o.a0=Dc,o.a1=ed,o.a2=Wu,o.a3=Hc,o.a4=function(n){const e=n.value;let i=[];if(!e)return i;const s=ml(e);return s!=="string"?(i=i.concat([new By(n.key,e,`string expected, "${s}" found`)]),i):(f0(e,!0)||(i=i.concat([new By(n.key,e,`invalid url "${e}"`)])),i)},o.a5=Re,o.a6=hp,o.a7=sr,o.a8=dt,o.a9=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return Nn(n.expression.evaluate(e))}interpolate(n,e,i){return{x:ei(n.x,e.x,i),y:ei(n.y,e.y,i),z:ei(n.z,e.z,i),azimuthal:ei(n.azimuthal,e.azimuthal,i),polar:ei(n.polar,e.polar,i)}}},o.aA=ys,o.aB=v,o.aC=ga,o.aD=de,o.aE=Fe,o.aF=function(n,e){const i={};for(let s=0;s<e.length;s++){const l=e[s];l in n&&(i[l]=n[l])}return i},o.aG=oe,o.aH=he,o.aI=class{constructor(n){this.entries={},this.scheduler=n}request(n,e,i,s){const l=this.entries[n]=this.entries[n]||{callbacks:[]};if(l.result){const[d,f]=l.result;return this.scheduler?this.scheduler.add(()=>{s(d,f)},e):s(d,f),()=>{}}return l.callbacks.push(s),l.cancel||(l.cancel=i((d,f)=>{l.result=[d,f];for(const g of l.callbacks)this.scheduler?this.scheduler.add(()=>{g(d,f)},e):g(d,f);setTimeout(()=>delete this.entries[n],3e3)})),()=>{l.result||(l.callbacks=l.callbacks.filter(d=>d!==s),l.callbacks.length||(l.cancel(),delete this.entries[n]))}}},o.aJ=function(n,e,i){const s=JSON.stringify(n.request);return n.data&&(this.deduped.entries[s]={result:[null,n.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:n.isSymbolTile,zoom:n.tileZoom},l=>{const d=cl(n.request,(f,g,x,b)=>{f?l(f):g&&l(null,{vectorTile:i?void 0:new mi.VectorTile(new my(g)),rawData:g,cacheControl:x,expires:b})});return()=>{d.cancel(),l()}},e)},o.aK=function(n){Gf++,Gf>to&&(n.getActor().send("enforceCacheSizeLimit",Ro),Gf=0)},o.aL=function(n){return n<=1?1:Math.pow(2,Math.floor(Math.log(n)/Math.LN2))},o.aM=Ms,o.aN=ub,o.aO=_b,o.aP=cb,o.aQ=function(n,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<n.length;s++){const l=document.createElement("source");Hl(n[s])||(i.crossOrigin="Anonymous"),l.src=n[s],i.appendChild(l)}return{cancel:()=>{}}},o.aR=zy,o.aS=function(n){return fetch(n).then(e=>e.arrayBuffer()).then(e=>e1(e,0,n))},o.aT=hw,o.aU=class{constructor(n,e,i,s){this.id=n,this.position=e!=null?new J(e[0],e[1]):new J(0,0),this.orientation=i??[0,0,0],this.nodes=s,this.uploaded=!1,this.aabb=new Hi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(n,e){if(Ji(n.matrix,e,n.matrix),n.meshes)for(const i of n.meshes){const s=Hi.applyTransformFast(i.aabb,n.matrix);this.aabb.encapsulate(s)}if(n.children)for(const i of n.children)this._applyTransformations(i,n.matrix)}computeBoundsAndApplyParent(){const n=Yt([]);for(const e of this.nodes)this._applyTransformations(e,n)}computeModelMatrix(n,e,i,s,l,d,f=!1){Cb(this.matrix,this,n.transform,this.position,e,i,s,l,d,f)}upload(n){if(!this.uploaded){for(const e of this.nodes)m0(e,n);for(const e of this.nodes)Fy(e);this.uploaded=!0}}destroy(){for(const n of this.nodes)_0(n)}},o.aV=Ft,o.aW=W_,o.aX=be,o.aY=De,o.aZ=Kc,o.a_=Sr,o.aa=hn,o.ab=ha,o.ac=Ee,o.ad=cn,o.ae=Vr,o.af=Ce,o.ag=$c,o.ah=ou,o.ai=ei,o.aj=vt,o.ak=kd,o.al=en,o.am=sn,o.an=class{constructor(n){this.specification=n}possiblyEvaluate(n,e){return function([i,s]){const l=Nn([1,i,s]);return{x:l.x,y:l.y,z:l.z}}(n.expression.evaluate(e))}interpolate(n,e,i){return{x:ei(n.x,e.x,i),y:ei(n.y,e.y,i),z:ei(n.z,e.z,i)}}},o.ao=function(n,e,i=0,s=!0){const l=new Tt(i,i),d=n.sub(l),f=e.add(l),g=[d,new Tt(f.x,d.y),f,new Tt(d.x,f.y)];return s&&g.push(d.clone()),g},o.ap=function(n,e){const i=[];for(let s=0;s<n.length;s++){const l=Oe(s-1,-1,n.length-1),d=Oe(s+1,-1,n.length-1),f=n[s],g=n[d],x=n[l].sub(f).unit(),b=g.sub(f).unit(),C=b.angleWithSep(x.x,x.y),M=x.add(b).unit().mult(-1*e/Math.sin(C/2));i.push(f.add(M))}return i},o.aq=$1,o.ar=ru,o.as=function(n,e,i=0){return rn(((e.x-i)*n.scale-n.x)*vt,(e.y*n.scale-n.y)*vt,ze(e.z,e.y))},o.at=vr,o.au=Ci,o.av=Cn,o.aw=a1,o.ax=function(n){let e=1/0,i=1/0,s=-1/0,l=-1/0;for(const d of n)e=Math.min(e,d.x),i=Math.min(i,d.y),s=Math.max(s,d.x),l=Math.max(l,d.y);return{min:new Tt(e,i),max:new Tt(s,l)}},o.ay=me,o.az=Ji,o.b=function(n){return Qr.API_FONTS_REGEX.test(n)},o.b$=function(n,e,i){i*=.5;var s=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=s*x+l*g,n[1]=l*x-s*g,n[2]=d*x+f*g,n[3]=f*x-d*g,n},o.b0=od,o.b1=Ry,o.b2=function(){Va.isLoading()||Va.isLoaded()||Xc()!=="deferred"||cm()},o.b3=tf,o.b4=Dt,o.b5=Wm,o.b6=Xi,o.b7=Vv,o.b8=ph,o.b9=zt,o.bA=function(n,e){const{x:i,y:s}=n.point,l=w_(i,s,n.worldSize/n._pixelsPerMercatorPixel,0,0);return Ji(l,l,x_(yc(e)))},o.bB=Ke,o.bC=function(n){return n[0]=0,n[1]=0,n[2]=0,n},o.bD=function(n,e){return Math.hypot(e[0]-n[0],e[1]-n[1],e[2]-n[2])},o.bE=Bt,o.bF=nr,o.bG=yi,o.bH=q_,o.bI=xa,o.bJ=$v,o.bK=function(n,e,i,s,l){const d=5*e+2;n.float32[d+0]=i,n.float32[d+1]=s,n.float32[d+2]=l},o.bL=My,o.bM=h,o.bN=Is,o.bO=_s,o.bP=sy,o.bQ=wb,o.bR=O_,o.bS=k_,o.bT=Wv,o.bU=j1,o.bV=Jv,o.bW=C0,o.bX=Oe,o.bY=Le,o.bZ=Nl,o.b_=Jo,o.ba=No,o.bb=sh,o.bc=g_,o.bd=or,o.be=gd,o.bf=o0,o.bg=function(n,e){const i=ou(e.zoom);if(i===0)return yc(n);const s=vf(n),l=xf(s),d=de(s.getWest())*e.worldSize,f=de(s.getEast())*e.worldSize,g=he(s.getNorth())*e.worldSize,x=he(s.getSouth())*e.worldSize,b=[d,g,0],C=[f,g,0],M=[d,x,0],R=[f,x,0],P=Qi([],e.globeMatrix);return cn(b,b,P),cn(C,C,P),cn(M,M,P),cn(R,R,P),l[0]=su(l[0],M,i),l[1]=su(l[1],R,i),l[2]=su(l[2],C,i),l[3]=su(l[3],b,i),Hi.fromPoints(l)},o.bh=fh,o.bi=Qi,o.bj=_d,o.bk=su,o.bl=th,o.bm=Ng,o.bn=us,o.bo=Yn,o.bp=Zy,o.bq=my,o.br=cl,o.bs=function(n,e){const i=[];for(const s in n)s in e||i.push(s);return i},o.bt=Ae,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=ia,o.bw=function(n){var e=new pe(16);return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e},o.bx=Yt,o.by=Zr,o.bz=pi,o.c=Sh,o.c$=gr,o.c0=Ul,o.c1=Kn,o.c2=function(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n[3]=e[3],n},o.c3=ns,o.c4=function(n,e,i,s,l){var d,f=1/Math.tan(e/2);return n[0]=f/i,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,l!=null&&l!==1/0?(n[10]=(l+s)*(d=1/(s-l)),n[14]=2*l*s*d):(n[10]=-1,n[14]=-2*s),n},o.c5=function(n,e,i,s,l,d,f){var g=1/(e-i),x=1/(s-l),b=1/(d-f);return n[0]=-2*g,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*x,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*b,n[11]=0,n[12]=(e+i)*g,n[13]=(l+s)*x,n[14]=(f+d)*b,n[15]=1,n},o.c6=_e,o.c7=function(n,e,i){n[4*e+0]=i[0],n[4*e+1]=i[1],n[4*e+2]=i[2],n[4*e+3]=i[3]},o.c8=jo,o.c9=lh,o.cA=Oy,o.cB=rl,o.cC=gb,o.cD=function(n){const e=gb(n,!0);return Ke([],[e[0],e[1],e[4],e[5]])},o.cE=xn,o.cF=yn,o.cG=Nr,o.cH=function(n){const{x:e,y:i}=n.point,{lng:s,lat:l}=n._center;return w_(e,i,n.worldSize,s,l)},o.cI=oi,o.cJ=Be,o.cK=fd,o.cL=w,o.cM=function(n,e,i){let s=0;for(let l=0;l<2;++l)n[l]>0&&(s+=(n[l]-0)*(n[l]-0)),e[l]<0&&(s+=(0-e[l])*(0-e[l]));return s},o.cN=function(n){return n*n*n*n*n},o.cO=fe,o.cP=45,o.cQ=Go,o.cR=function(n,e,i){const s=Math.sqrt(n*n+e*e+i*i),l=s>0?Math.acos(i/s)*xu:0;let d=n!==0||e!==0?Math.atan2(-e,-n)*xu+90:0;return d<0&&(d+=360),[s,d,l]},o.cS=rn,o.cT=Nn,o.cU=Ue,o.cV=bn,o.cW=Hi,o.cX=wt,o.cY=function(n){return[Math.pow(n[0],1/2.2),Math.pow(n[1],1/2.2),Math.pow(n[2],1/2.2)]},o.cZ=f0,o.c_=function(n,e){return n.readFields(b2,{icons:[]},e)},o.ca=_r,o.cb=Wa,o.cc=$a,o.cd=J,o.ce=eb,o.cf=function(){var n=new pe(4);return pe!=Float32Array&&(n[1]=0,n[2]=0),n[0]=1,n[3]=1,n},o.cg=function(n,e,i){var s=e[0],l=e[1],d=e[2],f=e[3],g=Math.sin(i),x=Math.cos(i);return n[0]=s*x+d*g,n[1]=l*x+f*g,n[2]=s*-g+d*x,n[3]=l*-g+f*x,n},o.ch=function(n,e){return n[0]===e[0]&&n[1]===e[1]&&n[2]===e[2]&&n[3]===e[3]},o.ci=_o,o.cj=function(n){return Math.hypot(n[0],n[1],n[2],n[3])},o.ck=Xr,o.cl=Ao,o.cm=__,o.cn=dn,o.co=yb,o.cp=dh,o.cq=md,o.cr=function(n,e,i,s,l,d,f,g,x){if(x.name==="globe")return md(n,e,new dh(i,s,l),!1);const b=W_({z:i,x:s,y:l},x);return new Hi([(d+b.x/b.scale)*e,e*(b.y/b.scale),f],[(d+b.x2/b.scale)*e,e*(b.y2/b.scale),g])},o.cs=function(n,e,i){return n[0]=Math.min(e[0],i[0]),n[1]=Math.min(e[1],i[1]),n[2]=Math.min(e[2],i[2]),n[3]=Math.min(e[3],i[3]),n},o.ct=function(n,e,i){return n[0]=Math.max(e[0],i[0]),n[1]=Math.max(e[1],i[1]),n[2]=Math.max(e[2],i[2]),n[3]=Math.max(e[3],i[3]),n},o.cu=function(n){const e=Math.round((n+45+360)%360/90)%4;return W[e]},o.cv=qe,o.cw=Ps,o.cx=A,o.cy=function(n){const e=Yt(new Float64Array(16));Ji(e,n.pixelMatrix,n.globeMatrix);const i=[0,O,0],s=[0,N,0];return cn(i,i,e),cn(s,s,e),[i[0]>0&&i[0]<=n.width&&i[1]>0&&i[1]<=n.height&&!Ip(n,new J(n.center.lat,90)),s[0]>0&&s[0]<=n.width&&s[1]>0&&s[1]<=n.height&&!Ip(n,new J(n.center.lat,-90))]},o.cz=function(n,e){const{scale:i}=n.tileTransform,s=i*vt/(n.tileSize*Math.pow(2,e.zoom-n.tileID.overscaledZ+n.tileID.canonical.z));return function(l,d,f){var g=d[1],x=d[2],b=d[3],C=f[0],M=f[1];return l[0]=d[0]*C,l[1]=g*C,l[2]=x*M,l[3]=b*M,l}(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.d=function(n){return Qr.API_TILEJSON_REGEX.test(n)},o.d$=cf,o.d0=Um,o.d1=Kv,o.d2=Do,o.d3=hc,o.d4=bs,o.d5=Mc,o.d6=fi,o.d7=function(n){const e=n.indexOf(eh);return e>=0?n.slice(0,e):n},o.d8=function(n){return n.indexOf(eh)>=0},o.d9=function(n){const e=n.lastIndexOf(eh);return e>=0?n.slice(e+1):""},o.dA=b_,o.dB=xs,o.dC=rs,o.dD=256,o.dE=function(n,e){const i=[0,0,0];return cn(i,i,fh(yc(e.canonical))),cn(i,i,n),i},o.dF=n=>({u_matrix:new $a(n),u_texsize:new Wa(n),u_pixels_to_tile_units:new hd(n),u_device_pixel_ratio:new _r(n),u_width_scale:new _r(n),u_floor_width_scale:new _r(n),u_image:new jo(n),u_units_to_pixels:new Wa(n),u_tile_units_to_pixels:new _r(n),u_alpha_discard_threshold:new _r(n),u_trim_offset:new Wa(n),u_trim_fade_range:new Wa(n),u_trim_color:new Go(n),u_emissive_strength:new _r(n),u_zbias_factor:new _r(n),u_tile_to_meter:new _r(n),u_ground_shadow_factor:new lh(n),u_pattern_transition:new _r(n)}),o.dG=n=>({u_matrix:new $a(n),u_pixels_to_tile_units:new hd(n),u_device_pixel_ratio:new _r(n),u_width_scale:new _r(n),u_floor_width_scale:new _r(n),u_units_to_pixels:new Wa(n),u_dash_image:new jo(n),u_gradient_image:new jo(n),u_image_height:new _r(n),u_texsize:new Wa(n),u_tile_units_to_pixels:new _r(n),u_alpha_discard_threshold:new _r(n),u_trim_offset:new Wa(n),u_trim_fade_range:new Wa(n),u_trim_color:new Go(n),u_emissive_strength:new _r(n),u_zbias_factor:new _r(n),u_tile_to_meter:new _r(n),u_ground_shadow_factor:new lh(n)}),o.dH=n=>({u_camera_to_center_distance:new _r(n),u_extrude_scale:new hd(n),u_device_pixel_ratio:new _r(n),u_matrix:new $a(n),u_inv_rot_matrix:new $a(n),u_merc_center:new Wa(n),u_tile_id:new lh(n),u_zoom_transition:new _r(n),u_up_dir:new lh(n),u_emissive_strength:new _r(n)}),o.dI=of,o.dJ=EE,o.dK=ym,o.dL=(n,e,i,s,l,d)=>{const f=n.transform,g=f.projection.name==="globe";let x;if(d.paint.get("circle-pitch-alignment")==="map")if(g){const C=b_(f.zoom,e.canonical)*f._pixelsPerMercatorPixel;x=Float32Array.from([C,0,0,C])}else x=f.calculatePixelsToTileUnitsMatrix(i);else x=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const b={u_camera_to_center_distance:n.transform.getCameraToCenterDistance(f.projection),u_matrix:n.translatePosMatrix(e.projMatrix,i,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Mo.devicePixelRatio,u_extrude_scale:x,u_inv_rot_matrix:S_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:d.paint.get("circle-emissive-strength")};if(g){b.u_inv_rot_matrix=s,b.u_merc_center=l,b.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],b.u_zoom_transition=ou(f.zoom);const C=l[0]*vt,M=l[1]*vt;b.u_up_dir=f.projection.upVector(new dh(0,0,0),C,M)}return b},o.dM=h1,o.dN=Jr,o.dO=(n,e,i,s,l,d,f,g,x,b)=>{const C=n.transform,M=C.pitch<15?l1(.07,.7,me((14-C.zoom)/5,0,1)):.07,R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:u1(n,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_width_scale:d,u_floor_width_scale:f,u_image:0,u_tile_units_to_pixels:c1(e,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:g,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:M,u_tile_to_meter:Ue(e.tileID.canonical,0),u_ground_shadow_factor:x,u_pattern_transition:b}},o.dP=(n,e,i,s,l,d,f,g,x,b)=>{const C=n.transform,M=C.calculatePixelsToTileUnitsMatrix(e),R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=C.pitch<15?l1(.07,.7,me((14-C.zoom)/5,0,1)):.07;return{u_matrix:u1(n,e,i,s),u_pixels_to_tile_units:M,u_device_pixel_ratio:d,u_width_scale:f,u_floor_width_scale:g,u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:d1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:c1(e,n.transform),u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:P,u_tile_to_meter:Ue(e.tileID.canonical,0),u_ground_shadow_factor:b}},o.dQ=xt,o.dR=Rp,o.dS=ze,o.dT=Bg,o.dU=Fp,o.dV=Up,o.dW=bc,o.dX=450,o.dY=7,o.dZ=o2,o.d_=Gi,o.da=function(n){const e=[],i=n.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),n.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),n.renderingMode&&n.renderingMode!=="2d"&&n.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.db=function(n,e,i,s){return n.type==="custom"?new a2(n,e):new v2[n.type](n,e,i,s)},o.dc=ai,o.dd=function(n){const e=n.indexOf(eh);return e>=0?n.slice(e+1):""},o.de=class extends Wm{constructor(n,e){super(n._vectorTileFeature,n._z,n._x,n._y,n.id),n.state&&(this.state=Object.assign({},n.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=n.source,this.sourceLayer=n.sourceLayer,this.layer=n.layer)}toJSON(){const n=super.toJSON();return n.target=this.target,n.namespace=this.namespace,n}},o.df=Yu,o.dg=Gl,o.dh=function(n){return n({pluginStatus:As,pluginURL:Ua}),Yu.on("pluginStateChange",n),n},o.di=Sp,o.dj=class extends Xa{constructor(n){super(n),this.current=Mr}set(n,e,i){if(this.fetchUniformLocation(n,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dk=K,o.dl=function(n,e,i){const s=ou(i.zoom),l=n.style.map._antialias,d=n.terrain&&n.terrain.exaggeration()>0;return s===0&&!l&&!d},o.dm=function(n){const e=n.pixelsPerMeter,i=e/_e(1,n.center.lat),s=Yt(new Float64Array(16));return Yn(s,s,[n.point.x,n.point.y,0]),xn(s,s,[i,i,e]),Float32Array.from(s)},o.dn=vf,o.dp=function(n){const e=qe-5;n=me(n,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(en(n))),3);return Math.round(i*(k.length-1))},o.dq=function(n,e,i,s){const l=e.getNorth(),d=e.getSouth(),f=e.getWest(),g=e.getEast(),x=1<<n.z,b=g-f,C=l-d,M=b/L,R=-C/k[i],P=[0,M,0,R,0,0,l,f,0];if(n.z>0){const F=180/s;Kt(P,P,[F/b+1,0,0,0,F/C+1,0,-.5*F/M,.5*F/R,1])}return P[2]=x,P[5]=n.x,P[8]=n.y,P},o.dr=yc,o.ds=function(n,e,i){const s=Yt(new Float64Array(16)),l=(e/(1<<n)-.5)*Math.PI*2;return _n(s,i.globeMatrix,l),Float32Array.from(s)},o.dt=class{isDataAvailableAtPoint(n){const e=this._source();if(this.isUsingMockSource()||!e||n.y<0||n.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,l=Math.floor(n.x),d=Math.floor((n.x-l)*s),f=Math.floor(n.y*s),g=this.findDEMTileFor(new Ms(i,l,i,d,f));return!(!g||!g.dem)}getAtPointOrZero(n,e=0){return this.getAtPoint(n,e)||0}getAtPoint(n,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||n.y<0||n.y>1)return e;const l=s.getSource().maxzoom,d=1<<l,f=Math.floor(n.x),g=n.x-f,x=new Ms(l,f,l,Math.floor(g*d),Math.floor(n.y*d)),b=this.findDEMTileFor(x);if(!b||!b.dem)return e;const C=b.dem,M=1<<b.tileID.canonical.z,R=(g*M-b.tileID.canonical.x)*C.dim,P=(n.y*M-b.tileID.canonical.y)*C.dim,F=Math.floor(R),V=Math.floor(P);return(i?this.exaggeration():1)*ei(ei(C.get(F,V),C.get(F,V+1),P-V),ei(C.get(F+1,V),C.get(F+1,V+1),P-V),R-F)}getAtTileOffset(n,e,i){const s=1<<n.canonical.z;return this.getAtPointOrZero(new Ee(n.wrap+(n.canonical.x+e/vt)/s,(n.canonical.y+i/vt)/s))}getAtTileOffsetFunc(n,e,i,s){return l=>{const d=this.getAtTileOffset(n,l.x,l.y),f=s.upVector(n.canonical,l.x,l.y);return Le(f,f,d*s.upVectorScale(n.canonical,e,i).metersToTile),f}}getForTilePoints(n,e,i,s){if(this.isUsingMockSource())return!1;const l=Hm.create(this,n,s);return!!l&&(e.forEach(d=>{d[2]=this.exaggeration()*l.getElevationAt(d[0],d[1],i)}),!0)}getMinMaxForTile(n){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(n);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,l=1<<n.canonical.z-s.canonical.z;let d=n.canonical.x/l-s.canonical.x,f=n.canonical.y/l-s.canonical.y,g=0;for(let x=0;x<n.canonical.z-s.canonical.z&&!i.leaves[g];x++){d*=2,f*=2;const b=2*Math.floor(f)+Math.floor(d);g=i.childOffsets[g]+b,d%=1,f%=1}return{min:this.exaggeration()*i.minimums[g],max:this.exaggeration()*i.maximums[g]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(n,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(n){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(n){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const n=this.visibleDemTiles;if(n.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const l of n){const d=this.getMinMaxForTile(l.tileID);d&&(i=Math.min(i,d.min),s=Math.max(s,d.max),e=!0)}return e?{min:i,max:s}:null}},o.du=Zg,o.dv=xr,o.dw=function(n,e){return[Math.pow(n[0],2.2)*e,Math.pow(n[1],2.2)*e,Math.pow(n[2],2.2)*e]},o.dx=nt,o.dy=function(n,e){var i=Math.sin(e),s=Math.cos(e);return n[0]=s,n[1]=i,n[2]=0,n[3]=-i,n[4]=s,n[5]=0,n[6]=0,n[7]=0,n[8]=1,n},o.dz=Bl,o.e=Qr,o.e$=dw,o.e0=256,o.e1=x_,o.e2=uo,o.e3=_n,o.e4=function(n,e){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[4],n[4]=e[5],n[5]=e[6],n[6]=e[8],n[7]=e[9],n[8]=e[10],n},o.e5=Ha,o.e6=rh,o.e7=qu,o.e8=function(n,e,i,s,l){return me((n-e)/(i-e)*(l-s)+s,s,l)},o.e9=sl,o.eA=function(n,e,i){return n[0]=e[0]/i[0],n[1]=e[1]/i[1],n[2]=e[2]/i[2],n},o.eB=Fl,o.eC=j,o.eD=di,o.eE=function(n,e,i,s){return n[0]=e,n[1]=i,n[2]=s,n},o.eF=function([n,e,i]){const s=Math.hypot(n,e,i),l=Math.atan2(n,i),d=.5*Math.PI-Math.acos(-e/s);return new J(Be(l),Be(d))},o.eG=bh,o.eH=h0,o.eI=function(n){const e=n.navigator?n.navigator.userAgent:null;return!!function(i){if(Mn==null){const s=i.navigator?i.navigator.userAgent:null;Mn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Mn}(n)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eJ=function(n,e){Ro=n,to=e},o.eK=Ip,o.eL=jg,o.eM=function(n){const e=[0,0,0],i=Yt(new Float64Array(16));return Ji(i,n.pixelMatrix,n.globeMatrix),cn(e,e,i),new Tt(e[0],e[1])},o.eN=function(){const n=$i;n&&(n.isPreloaded()&&n.numActive()===1?(n.release(Nt),$i=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.eO=function(){gr().acquire(Nt)},o.eP=Xc,o.eQ=function(n,e,i=!1){if(As===$s.deferred||As===$s.loading||As===$s.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ua=Mo.resolveURL(n),As=$s.deferred,ef=e,Qh(),i||cm()},o.eR=function(n){xi=Mo.resolveURL(n),Ri||(Ri=new pt(gr(),new Rc)),Ri.broadcast("setMeshoptUrl",xi)},o.eS=dy,o.eT=function(n){ot=Mo.resolveURL(n),Ri||(Ri=new pt(gr(),new Rc)),Ri.broadcast("setDracoUrl",ot)},o.eU=uu,o.eV=Mt,o.eW=function(n){const e=al();if(!e)return;const i=e.delete(Sa);n&&i.then(()=>n()).catch(n)},o.eX=ut,o.eY=Pt,o.eZ=ya,o.e_=hu,o.ea=function(n,e){var i=e[0],s=e[1],l=e[2],d=e[3],f=e[4],g=e[5],x=e[6],b=e[7],C=e[8],M=C*f-g*b,R=-C*d+g*x,P=b*d-f*x,F=i*M+s*R+l*P;return F?(n[0]=M*(F=1/F),n[1]=(-C*s+l*b)*F,n[2]=(g*s-l*f)*F,n[3]=R*F,n[4]=(C*i-l*x)*F,n[5]=(-g*i+l*d)*F,n[6]=P*F,n[7]=(-b*i+s*x)*F,n[8]=(f*i-s*d)*F,n):null},o.eb=ki,o.ec=rt,o.ed=d0,o.ee=function(n,e){if(n===e){var i=e[1],s=e[2],l=e[3],d=e[6],f=e[7],g=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=i,n[6]=e[9],n[7]=e[13],n[8]=s,n[9]=d,n[11]=e[14],n[12]=l,n[13]=f,n[14]=g}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n},o.ef=ir,o.eg=[1,1,1],o.eh=class{constructor(n,e,i,s){this.context=n,this.format=s,this.size=i,this.texture=n.gl.createTexture();const[l,d,f]=this.size,{gl:g}=n;g.bindTexture(g.TEXTURE_3D,this.texture),n.pixelStoreUnpackFlipY.set(!1),n.pixelStoreUnpack.set(1),n.pixelStoreUnpackPremultiplyAlpha.set(!1),g.texImage3D(g.TEXTURE_3D,0,this.format,l,d,f,0,a0(this.format),l0(this.format),e.data)}bind(n,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),n!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,n),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,n),this.minFilter=n),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}},o.ei=Hm,o.ej=function(n,e,i,s){var l=new pe(4);return l[0]=n,l[1]=e,l[2]=i,l[3]=s,l},o.ek=Ls,o.el=function(n,e,i,s){var l=e[0],d=e[1],f=e[2],g=e[3];return n[0]=l+s*(i[0]-l),n[1]=d+s*(i[1]-d),n[2]=f+s*(i[2]-f),n[3]=g+s*(i[3]-g),n},o.em=Gm,o.en=os,o.eo=Za,o.ep=function(n,e,i,s,l,d,f,g,x,b,C,M,R,P,F,V){var q=new pe(16);return q[0]=n,q[1]=e,q[2]=i,q[3]=s,q[4]=l,q[5]=d,q[6]=f,q[7]=g,q[8]=x,q[9]=b,q[10]=C,q[11]=M,q[12]=R,q[13]=P,q[14]=F,q[15]=V,q},o.eq=X,o.er=qa,o.es=af,o.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Tt(1/0,1/0),max:new Tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(n,e=!1){const i=Pm(new Tt(0,0),new Tt(vt,vt),n),s=[];if(e&&!Af(i,this._globalClipBounds))return s;for(const l of this._activeRegions){if(l.hiddenByOverlap||!Af(i,l))continue;const d=kv(l.min,l.max,n);s.push({min:d.min,max:d.max,sourceId:this._sourceIds[l.priority],footprint:l.footprint,footprintTileId:l.tileId,order:l.order,clipMask:l.clipMask,clipScope:l.clipScope})}return s}setSources(n){this._setSources(n.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const l=e.cache.getTile(s).buckets[e.layer];l&&l.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(n){const e=n.getFootprints();if(e.length===0)return;const i=n.getOrder(),s=n.getClipMask(),l=n.getClipScope();for(const d of e){if(!d.footprint)continue;const f=Pm(d.footprint.min,d.footprint.max,d.id);this._activeRegions.push({min:f.min,max:f.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:d.id,footprint:d.footprint,order:i,clipMask:s,clipScope:l})}this._sourceIds.push(n.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Lm(e.min,i.min)||Lm(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,l){const d=(f,g)=>f+g;return s.length-l.length||s.reduce(d,"").localeCompare(l.reduce(d,""))}(e.clipScope,i.clipScope));let n=this._activeRegions.length!==this._prevRegions.length;if(!n){let e=0;for(;!n&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];n=i.priority!==s.priority||!oy(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!ia(i.clipScope,s.clipScope),++e}}if(n){++this._updateTime;for(const i of this._activeRegions)i.order!==mh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const l=s[i].priority;for(;i<s.length&&s[i].priority===l;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let l=i;const d=i;for(;l!==s;){const f=this._activeRegions[l];f.hiddenByOverlap=!1;for(let g=0;g<d;g++){const x=this._activeRegions[g];if(!x.hiddenByOverlap&&f.order===mh&&Af(f,x)&&(f.hiddenByOverlap=ay(f.footprint,f.tileId,x.footprint,x.tileId),f.hiddenByOverlap))break}++l}i=s,s=e(i)}}}}_setSources(n){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=n.length-1;e>=0;e--)this._addSource(n[e]);this._computeReplacement()}},o.eu=mh,o.ev=class{constructor(n){this._createGrid(n),this._createPoles(n)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const n of this._poleSegments)n.destroy();for(const n of this._gridSegments)n.withSkirts.destroy(),n.withoutSkirts.destroy()}_fillGridMeshWithLods(n,e){const i=new No,s=new Sr,l=[],d=n+1+2,f=e[0]+1,g=e[0]+1+(1+e.length),x=(b,C,M)=>{let R=b===d-1?b-2:b===0?b:b-1;return R+=M?24575:0,[R,C]};for(let b=0;b<d;++b)i.emplaceBack(...x(b,0,!0));for(let b=0;b<f;++b)for(let C=0;C<d;++C)i.emplaceBack(...x(C,b,(C===0||C===d-1)&&!0));for(let b=0;b<e.length;++b){const C=e[b];for(let M=0;M<d;++M)i.emplaceBack(...x(M,C,!0))}for(let b=0;b<e.length;++b){const C=s.length,M=e[b]+1+2,R=new Sr;for(let V=0;V<M-1;V++){const q=V===M-2,$=q?d*(g-e.length+b-V):d;for(let te=0;te<d-1;te++){const ne=V*d+te;V===0||q||te===0||te===d-2?(R.emplaceBack(ne+1,ne,ne+$),R.emplaceBack(ne+$,ne+$+1,ne+1)):(s.emplaceBack(ne+1,ne,ne+$),s.emplaceBack(ne+$,ne+$+1,ne+1))}}const P=or.simpleSegment(0,C,i.length,s.length-C);for(let V=0;V<R.uint16.length;V+=3)s.emplaceBack(R.uint16[V],R.uint16[V+1],R.uint16[V+2]);const F=or.simpleSegment(0,C,i.length,s.length-C);l.push({withoutSkirts:P,withSkirts:F})}return{vertices:i,indices:s,segments:l}}_createGrid(n){const e=this._fillGridMeshWithLods(L,k);this._gridSegments=e.segments,this._gridBuffer=n.createVertexBuffer(e.vertices,g_.members),this._gridIndexBuffer=n.createIndexBuffer(e.indices,!0)}_createPoles(n){const e=new Sr;for(let f=0;f<=L;f++)e.emplaceBack(0,f+1,f+2);this._poleIndexBuffer=n.createIndexBuffer(e,!0);const i=new Ha,s=new Ha,l=new Ha,d=new Ha;this._poleSegments=[];for(let f=0,g=0;f<w;f++){const x=360/(1<<f);i.emplaceBack(0,-v,0,.5,0),s.emplaceBack(0,-v,0,.5,1),l.emplaceBack(0,-v,0,.5,.5),d.emplaceBack(0,-v,0,.5,.5);for(let b=0;b<=L;b++){let C=b/L,M=0;const R=ei(0,x,C),[P,F,V]=Z(Gg,Av,R,v);i.emplaceBack(P,F,V,C,M),s.emplaceBack(P,F,V,C,1-M);const q=en(R);C=.5+.5*Math.sin(q),M=.5+.5*Math.cos(q),l.emplaceBack(P,F,V,C,M),d.emplaceBack(P,F,V,C,1-M)}this._poleSegments.push(or.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=n.createVertexBuffer(i,pd,!1),this._poleSouthVertexBuffer=n.createVertexBuffer(s,pd,!1),this._texturedPoleNorthVertexBuffer=n.createVertexBuffer(l,pd,!1),this._texturedPoleSouthVertexBuffer=n.createVertexBuffer(d,pd,!1)}getGridBuffers(n,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[n].withSkirts:this._gridSegments[n].withoutSkirts]}getPoleBuffers(n,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[n]]}},o.ew=le,o.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.ey=we,o.ez=Ie,o.f=function(n){return btoa(encodeURIComponent(n).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.f0=fw,o.f1=r1,o.f2=ii,o.f3="hd_road_elevation",o.f4=Qs,o.f5=Rt,o.f6=Td,o.f7=Yv,o.f8=Hp,o.f9=function(n,e,i,s,l,d,f,g=1,x,b,C){n.createArrays(),n.tilePixelRatio=vt/(512*n.overscaling),n.compareText={},n.iconsNeedLinear=!1;const M=n.layers[0].layout,R=n.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=g,P.textSizeScaleRange=M.get("text-size-scale-range"),P.iconSizeScaleRange=M.get("icon-size-scale-range");const[F,V]=P.textSizeScaleRange,[q,$]=P.iconSizeScaleRange;P.textScaleFactor=me(P.scaleFactor,F,V),P.iconScaleFactor=me(P.scaleFactor,q,$);const te=R["text-size"],ne=R["icon-size"];if(n.textSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Se}=n.textSizeData;P.compositeTextSizes=[te.possiblyEvaluate(new hn(ve,{worldview:C}),d),te.possiblyEvaluate(new hn(Se,{worldview:C}),d)]}if(n.iconSizeData.kind==="composite"){const{minZoom:ve,maxZoom:Se}=n.iconSizeData;P.compositeIconSizes=[ne.possiblyEvaluate(new hn(ve,{worldview:C}),d),ne.possiblyEvaluate(new hn(Se,{worldview:C}),d)]}P.layoutTextSize=te.possiblyEvaluate(new hn(f+1,{worldview:C}),d),P.layoutIconSize=ne.possiblyEvaluate(new hn(f+1,{worldview:C}),d),P.textMaxSize=te.possiblyEvaluate(new hn(18,{worldview:C}),d);const G=M.get("symbol-placement"),ee=M.get("text-rotation-alignment")==="map"&&G!=="point",re=M.get("text-size");let ae=!1;const Te=[];for(const ve of n.features){const Se=M.get("text-font").evaluate(ve,{},d).join(","),Me=re.evaluate(ve,{},d)*P.textScaleFactor,je=P.layoutTextSize.evaluate(ve,{},d)*P.textScaleFactor,ct=P.layoutIconSize.evaluate(ve,{},d)*P.iconScaleFactor,et={horizontal:{},vertical:void 0},at=ve.text;let ft,He=[0,0];if(at){const ri=at.toString(),Si=M.get("text-letter-spacing").evaluate(ve,{},d)*_s,bi=M.get("text-line-height").evaluate(ve,{},d)*_s,Di=lp(ri)?Si:0,Ei=M.get("text-anchor").evaluate(ve,{},d),zi=M.get("text-variable-anchor");if(!zi){const Xe=M.get("text-radial-offset").evaluate(ve,{},d);if(Xe)He=j1(Ei,[Xe*_s,Qv]);else{const bt=M.get("text-offset").evaluate(ve,{},d);He=[bt[0]*_s,bt[1]*_s]}}let fn=ee?"center":M.get("text-justify").evaluate(ve,{},d);const Vn=G==="point",se=Vn?M.get("text-max-width").evaluate(ve,{},d)*_s:1/0,ue=Xe=>{n.allowVerticalPlacement&&Dr(ri)&&(et.vertical=Xv(at,e,i,l,Se,se,bi,Ei,Xe,Di,He,xa.vertical,!0,je,Me,x))};if(!ee&&zi){const Xe=fn==="auto"?zi.map(Ct=>Jv(Ct)):[fn];let bt=!1;for(let Ct=0;Ct<Xe.length;Ct++){const Et=Xe[Ct];if(!et.horizontal[Et])if(bt)et.horizontal[Et]=et.horizontal[0];else{const Ut=Xv(at,e,i,l,Se,se,bi,"center",Et,Di,He,xa.horizontal,!1,je,Me,x);Ut&&(et.horizontal[Et]=Ut,bt=Ut.positionedLines.length===1)}}ue("left")}else{if(fn==="auto"&&(fn=Jv(Ei)),Vn||M.get("text-writing-mode").indexOf("horizontal")>=0||!Dr(ri)){const Xe=Xv(at,e,i,l,Se,se,bi,Ei,fn,Di,He,xa.horizontal,!1,je,Me,x);Xe&&(et.horizontal[fn]=Xe)}ue(Vn?"left":fn)}}let st,Ve,Ge,_t,yt,Qt,jt=!1;const At=M.get("icon-text-fit").evaluate(ve,{},d);if(ve.icon&&ve.icon.hasPrimary()){const ri=H1(ve.icon,n.iconSizeData,R["icon-size"],d,n.zoom,ve,x,P.iconScaleFactor,C);st=ri.iconPrimary,Ge=ri.iconSecondary;const Si=st.toString();if(Ve=s.get(Si),Ve&&(yt=M.get("icon-offset").evaluate(ve,{},d),Qt=M.get("icon-anchor").evaluate(ve,{},d),ft=kE(l.get(Si),Ge?l.get(Ge.toString()):void 0,yt,Qt),jt=Ve.sdf,n.sdfIcons===void 0?n.sdfIcons=Ve.sdf:n.sdfIcons!==Ve.sdf&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==n.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(n.iconsNeedLinear=!0)),Ge){const bi=Ge.toString();_t=s.get(bi)}}ae=ae||!(!ve.icon||!ve.icon.hasSecondary());const mt=e0(et.horizontal)||et.vertical;n.iconsInText||(n.iconsInText=!!mt&&mt.iconsInText);const _i=je*P.textScaleFactor/_s,{defaultShapedIcon:Vt,verticallyShapedIcon:Gt}=ZE(n,ft,M,ve,d,et,_i,yt,At);At!=="none"&&ft&&(A1(ft)||C1(ft))&&(by(0,Ve,st,ft,Vt,At,b,s,l),by(0,_t,Ge,ft,Vt,At,b,s,l),Gt&&(by(0,Ve,st,ft,Gt,At,b,s,l),by(0,_t,Ge,ft,Gt,At,b,s,l))),ft=Vt,Te.push({feature:ve,shapedTextOrientations:et,shapedText:mt,shapedIcon:ft,iconPrimary:st,iconSecondary:Ge,iconOffset:yt,iconAnchor:Qt,verticallyShapedIcon:Gt,layoutTextSize:je,layoutIconSize:ct,textOffset:He,isSDFIcon:jt,iconTextFit:At})}return{featureData:Te,sizes:P,hasAnySecondaryIcon:ae,textAlongLine:ee,symbolPlacement:G}},o.fa=k1,o.fb=function(n,e,i,s,l,d,f,g,x,b){const{featureData:C,hasAnySecondaryIcon:M,sizes:R,textAlongLine:P,symbolPlacement:F}=e;for(const V of C){const{shapedIcon:q,verticallyShapedIcon:$,feature:te,shapedTextOrientations:ne,shapedText:G,layoutTextSize:ee,textOffset:re,isSDFIcon:ae,iconPrimary:Te,iconSecondary:ve,iconTextFit:Se,iconOffset:Me}=V;q1(q,b.iconPositions,Te,ve),q1($,b.iconPositions,Te,ve),qE(ne,b.iconPositions),HE(Te,ve,b.iconPositions),(G||q)&&XE(n,te,ne,q,$,x,R,ee,0,re,ae,s,l,f,g,M,Se,Me,P,F)}i&&n.generateCollisionDebugBuffers(d,n.collisionBoxArray,R.textScaleFactor)},o.fc=mi,o.fd=qy,o.fe=Vl,o.ff=gi,o.fg=y1,o.fh=ol,o.fi=function(n){let e=0;if(new Uint32Array(n,0,1)[0]!==Yx){const i=new Uint32Array(n,0,7),[,,s,l,d,f]=i;e=i.byteLength+l+d+f+d,(s!==n.byteLength||e>=n.byteLength)&&vi("Invalid b3dm header information.")}return e1(n,e)},o.fj=function(n,e){const i=hw(n);for(const s of i){for(const l of s.meshes)_A(l);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(gA(s.lights,e)))}return i},o.fk=Ny,o.fl=tn,o.fm=lt,o.fn=Va,o.fo=$s,o.fp=function(n){Tu(),na?.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-n;s++)e.delete(i[s]).catch(l=>vi(l.message))}).catch(i=>vi(i.message))}).catch(e=>vi(e.message))},o.g=function(n,e){return Gl(ke(n,{method:"GET"}),e)},o.h=ke,o.i=function(n){return Qr.API_STYLE_REGEX.test(n)&&!Sh(n)},o.j=function(n){return n.indexOf("mapbox:")===0},o.k=ss,o.l=Su,o.m=function(n){return decodeURIComponent(atob(n).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(n,e){return Gl(ke(n,{type:"json"}),e)},o.o=Au,o.p=function(n,e){return Gl(ke(n,{method:"POST"}),e)},o.q=Mo,o.r=cs,o.s=function(n){try{const e=self[n];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=bu,o.u=function(){return function n(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,n)}()},o.v=function(n){return!!n&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n)},o.w=vi,o.x=function(){return Zi||(Zi=new ut),Zi},o.y=w0,o.z=Xl}),H(["./shared"],function(o){function xe(Be){const W=Be?Be.url.toString():void 0;return W?performance.getEntriesByName(W):[]}function pe(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let K="[";for(const le of Be)K+=`${pe(le)},`;return`${K}]`}let W="{";for(const K of Object.keys(Be).sort())W+=`${K}:${pe(Be[K])},`;return`${W}}`}function Ke(Be){let W="";for(const K of o.bu)W+=`/${pe(Be[K])}`;return W}class nt{constructor(W){this.keyCache={},this._layers={},this._layerConfigs={},W&&this.replace(W)}replace(W,K){this._layerConfigs={},this._layers={},this.update(W,[],K)}update(W,K,le){this._options=le;for(const me of W)this._layerConfigs[me.id]=me,(this._layers[me.id]=o.db(me,this.scope,null,this._options)).compileFilter(le),this.keyCache[me.id]&&delete this.keyCache[me.id];for(const me of K)delete this.keyCache[me],delete this._layerConfigs[me],delete this._layers[me];this.familiesBySource={};const we=function(me,Ce){const Oe={};for(let ke=0;ke<me.length;ke++){const Qe=me[ke];let Ne=Ce&&Ce[Qe.id];Ne||(Qe.type==="symbol"?Ne=Qe.id:(Ne=Ke(Qe),Qe.type==="line"&&Qe.paint&&function Ft(Rt){return typeof Rt=="string"&&Rt==="line-progress"||(Array.isArray(Rt)?Rt.some(Ft):!(!Rt||typeof Rt!="object")&&Object.values(Rt).some(Ft))}(Qe.paint["line-width"])&&(Ne+=`/${pe(Qe.paint["line-width"])}`))),Ce&&(Ce[Qe.id]=Ne);let xt=Oe[Ne];xt||(xt=Oe[Ne]=[]),xt.push(Qe)}const Ae=[];for(const ke in Oe)Ae.push(Oe[ke]);return Ae}(Object.values(this._layerConfigs),this.keyCache);for(const me of we){const Ce=me.map(xt=>this._layers[xt.id]),Oe=Ce[0];if(Oe.visibility==="none")continue;const Ae=Oe.source||"";let ke=this.familiesBySource[Ae];ke||(ke=this.familiesBySource[Ae]={});const Qe=Oe.sourceLayer||"_geojsonTileLayer";let Ne=ke[Qe];Ne||(Ne=ke[Qe]=[]),Ne.push(Ce)}}}const Je=1*o.e_;class Kt{constructor(W){const K={},le=[];for(const Oe in W){const Ae=W[Oe],ke=K[Oe]={};for(const Qe in Ae.glyphs){const Ne=Ae.glyphs[+Qe];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const xt=Ne.metrics.localGlyph?Je:1,Ft={x:0,y:0,w:Ne.bitmap.width+2*xt,h:Ne.bitmap.height+2*xt};le.push(Ft),ke[Qe]=Ft}}const{w:we,h:me}=o.H(le),Ce=new o.eZ({width:we||1,height:me||1});for(const Oe in W){const Ae=W[Oe];for(const ke in Ae.glyphs){const Qe=Ae.glyphs[+ke];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const Ne=K[Oe][ke],xt=Qe.metrics.localGlyph?Je:1;o.eZ.copy(Qe.bitmap,Ce,{x:0,y:0},{x:Ne.x+xt,y:Ne.y+xt},Qe.bitmap)}}this.image=Ce,this.positions=K}}o.eY(Kt,"GlyphAtlas");class pi{constructor(W){this.tileID=new o.aM(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.lut=W.lut,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.scope=W.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.request&&W.request.collectResourceTiming,this.promoteId=W.promoteId,this.isSymbolTile=W.isSymbolTile,this.tileTransform=o.aW(W.tileID.canonical,W.projection),this.projection=W.projection,this.worldview=W.worldview,this.localizableLayerIds=W.localizableLayerIds,this.brightness=W.brightness,this.extraShadowCaster=!!W.extraShadowCaster,this.tessellationStep=W.tessellationStep,this.scaleFactor=W.scaleFactor,this.worldview=W.worldview}parse(W,K,le,we,me,Ce){this.status="parsing",this.data=W,this.collisionBoxArray=new o.b0;const Oe=new o.e$(Object.keys(W.layers).sort()),Ae=new o.f0(this.tileID,this.promoteId);Ae.bucketLayerIDs=[];const ke={},Qe=new o.f1(256,256),Ne={featureIndex:Ae,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Qe,availableImages:le,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},xt=[],Ft=K.familiesBySource[this.source];for(const ai in Ft){const fi=W.layers[ai];if(!fi)continue;let ci=!1,wi=!1,vi=!1;for(const tn of Ft[ai])tn[0].type==="symbol"?ci=!0:wi=!0,tn[0].is3D()&&tn[0].type!=="model"&&(vi=!0);if(this.extraShadowCaster&&!vi||this.isSymbolTile===!0&&!ci||this.isSymbolTile===!1&&!wi)continue;fi.version===1&&o.w(`Vector tile source "${this.source}" layer "${ai}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const gn=Oe.encode(ai),Ln=[];let Nn=!1;for(let tn=0,Xi=0;tn<fi.length;tn++){const Mn=fi.feature(tn),Kn=Ae.getId(Mn,ai);if(this.localizableLayerIds&&this.localizableLayerIds.has(ai)){const Qn=Mn.properties?Mn.properties.worldview:null;if(this.worldview&&typeof Qn=="string")if(Qn==="all")Mn.properties.$localized=!0;else{if(!Qn.split(",").includes(this.worldview))continue;Mn.properties.$localized=!0,Mn.properties.worldview=this.worldview}}!Nn&&Mn.properties&&Mn.properties.hasOwnProperty(o.f2)&&(Nn=!0),Ln.push({feature:Mn,id:Kn,index:Xi,sourceLayerIndex:gn}),Xi++}Nn&&!Ne.elevationFeatures&&W.layers.hasOwnProperty(o.f3)&&(Ne.elevationFeatures=o.f4.parseFrom(W.layers[o.f3],this.canonical));for(const tn of Ft[ai]){const Xi=tn[0];if(this.extraShadowCaster&&(!Xi.is3D()||Xi.type==="model")||this.isSymbolTile!==void 0&&Xi.type==="symbol"!==this.isSymbolTile||Xi.minzoom&&this.zoom<Math.floor(Xi.minzoom)||Xi.maxzoom&&this.zoom>=Xi.maxzoom||Xi.visibility==="none")continue;Yt(tn,this.zoom,Ne.brightness,le,this.worldview);const Mn=ke[Xi.id]=Xi.createBucket({index:Ae.bucketLayerIDs.length,layers:tn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:gn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:we,worldview:this.worldview});Ae.bucketLayerIDs.push(tn.map(Qn=>o.C(Qn.id,Qn.scope)));let Kn=Mn.prepare?Mn.prepare():null;Kn!=null?(Kn=Kn.then(()=>Mn.populate(Ln,Ne,this.tileID.canonical,this.tileTransform)),xt.push(Kn)):Mn.populate(Ln,Ne,this.tileID.canonical,this.tileTransform)}}const Rt=()=>{let ai,fi,ci,wi,vi,gn;Qe.trim();const Ln={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Nn=()=>{if(ai)return this.status="done",Ce(ai);if(this.extraShadowCaster)this.status="done",Ce(null,{buckets:Object.values(ke).filter(Xi=>!Xi.isEmpty()),featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ne.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(fi&&ci&&wi){const Xi=new Kt(fi),Mn=new Map;for(const[Ir,xs]of ci.entries()){const{imagePosition:rs}=o.f7(Ir,xs,o.f8);Mn.set(Ir,rs)}const Kn={};for(const Ir in ke){const xs=ke[Ir];xs instanceof o.b1&&(Yt(xs.layers,this.zoom,Ne.brightness,le,this.worldview),Kn[Ir]=o.f9(xs,fi,Xi.positions,ci,Mn,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,vi,this.worldview))}const Qn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(me,ci,vi,()=>{Qn.iconsPending=!1,tn(Kn,Xi,Qn)}),this.rasterizeIfNeeded(me,wi,gn,()=>{Qn.patternsPending=!1,tn(Kn,Xi,Qn)})}},tn=(Xi,Mn,Kn,Qn)=>{if(Kn.iconsPending||Kn.patternsPending)return;const Ir=new o.fa(ci,wi,this.lut);for(const xs in ke){const rs=ke[xs];if(xs in Xi)o.fb(rs,Xi[xs],this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,ci,Ir);else if(rs.hasPattern&&(rs instanceof o.b7||rs instanceof o.b8||rs instanceof o.dU)){Yt(rs.layers,this.zoom,Ne.brightness,le,this.worldview);const Th=Object.fromEntries(Ir.patternPositions);rs.addFeatures(Ne,this.tileID.canonical,Th,le,this.tileTransform,this.brightness)}}this.status="done",Ce(null,{buckets:Object.values(ke).filter(xs=>!xs.isEmpty()),featureIndex:Ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mn.image,lineAtlas:Qe,imageAtlas:Ir,brightness:Ne.brightness})};if(!this.extraShadowCaster){const Xi=o.f5(Ne.glyphDependencies,Qn=>Object.keys(Qn).map(Number));Object.keys(Xi).length?me.send("getGlyphs",{uid:this.uid,stacks:Xi,scope:this.scope},(Qn,Ir)=>{ai||(ai=Qn,fi=Ir,Nn())},void 0,!1,Ln):fi={};const Mn=Array.from(Ne.iconDependencies.keys()).map(Qn=>o.I.parse(Qn));Mn.length?me.send("getImages",{images:Mn,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Qn,Ir)=>{ai||(ai=Qn,ci=new Map,vi=this.updateImageMapAndGetImageTaskQueue(ci,Ir,Ne.iconDependencies),Nn())},void 0,!1,Ln):(ci=new Map,vi=new Map);const Kn=Array.from(Ne.patternDependencies.keys()).map(Qn=>o.I.parse(Qn));Kn.length?me.send("getImages",{images:Kn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Qn,Ir)=>{ai||(ai=Qn,wi=new Map,gn=this.updateImageMapAndGetImageTaskQueue(wi,Ir,Ne.patternDependencies),Nn())},void 0,!1,Ln):(wi=new Map,gn=new Map)}if(Ne.elevationFeatures&&Ne.elevationFeatures.length>0){const Xi=[];for(const Kn of Object.values(ke))if(Kn instanceof o.b8){const Qn=Kn.getUnevaluatedPortalGraph();Qn&&Xi.push(Qn)}const Mn=o.f6.evaluate(Xi);for(const Kn of Object.values(ke))if(Kn instanceof o.b8){const Qn=W.layers[Oe.decode(Kn.sourceLayerIndex)];Kn.setEvaluatedPortalGraph(Mn,Qn,this.tileID.canonical,Ne.availableImages,Ne.brightness)}}Nn()};xt.length>0?Promise.allSettled(xt).then(Rt).catch(Ce):Rt()}rasterizeIfNeeded(W,K,le,we){Array.from(K.values()).some(me=>me.usvg)?this.rasterize(W,K,le,we):we()}updateImageMapAndGetImageTaskQueue(W,K,le){const we=new Map;for(const me of K.keys()){const Ce=le.get(me)||[];for(const Oe of Ce){const Ae=Oe.toString(),ke=K.get(Oe.id.toString());ke.usvg?we.has(Ae)||(we.set(Ae,Oe),W.set(Ae,Object.assign({},ke))):W.set(Ae,ke)}}return we}rasterize(W,K,le,we){this.rasterizeTask=W.send("rasterizeImages",{scope:this.scope,tasks:le},(me,Ce)=>{if(!me)for(const[Oe,Ae]of Ce.entries()){const ke=Object.assign(K.get(Oe),{data:Ae});K.set(Oe,ke)}we()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Yt(Be,W,K,le,we){const me=new o.aa(W,{brightness:K,worldview:we});for(const Ce of Be)Ce.recalculate(me,le)}class Qi extends o.E{constructor(W,K,le,we,me,Ce,Oe){super(),this.actor=W,this.layerIndex=K,this.availableImages=le,this.availableModels=we,this.loadVectorData=Ce||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(W.scheduler),this.isSpriteLoaded=me,this.scheduler=W.scheduler,this.brightness=Oe}loadTile(W,K){const le=W.uid,we=W&&W.request,me=we&&we.collectResourceTiming,Ce=this.loading[le]=new pi(W);Ce.abort=this.loadVectorData(W,(Oe,Ae)=>{const ke=!this.loading[le];if(delete this.loading[le],Ce.cancelRasterize(),ke||Oe||!Ae)return Ce.status="done",ke||(this.loaded[le]=Ce),K(Oe);const Qe=Ae.rawData,Ne={};Ae.expires&&(Ne.expires=Ae.expires),Ae.cacheControl&&(Ne.cacheControl=Ae.cacheControl),Ce.vectorTile=Ae.vectorTile||new o.fc.VectorTile(new o.bq(Qe));const xt=()=>{Ce.parse(Ce.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ft,Rt)=>{if(Ft||!Rt)return K(Ft);const ai={};if(me){const fi=xe(we);fi.length>0&&(ai.resourceTiming=JSON.parse(JSON.stringify(fi)))}K(null,o.h({rawTileData:Qe.slice(0)},Rt,Ne,ai))})};this.isSpriteLoaded?xt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(xt,{type:"parseTile",isSymbolTile:W.isSymbolTile,zoom:W.tileZoom}):xt()}),this.loaded=this.loaded||{},this.loaded[le]=Ce})}reloadTile(W,K){const le=this.loaded,we=W.uid;if(le&&le[we]){const me=le[we];me.scaleFactor=W.scaleFactor,me.showCollisionBoxes=W.showCollisionBoxes,me.projection=W.projection,me.brightness=W.brightness,me.tileTransform=o.aW(W.tileID.canonical,W.projection),me.extraShadowCaster=W.extraShadowCaster,me.lut=W.lut,me.worldview=W.worldview;const Ce=(Oe,Ae)=>{const ke=me.reloadCallback;ke&&(delete me.reloadCallback,me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ke)),K(Oe,Ae)};me.status==="parsing"?me.reloadCallback=Ce:me.status==="done"&&(me.vectorTile?me.parse(me.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ce):Ce())}else K(null,void 0)}abortTile(W,K){const le=W.uid,we=this.loading[le];we&&(we.abort&&we.abort(),delete this.loading[le]),K()}removeTile(W,K){const le=this.loaded,we=W.uid;le&&le[we]&&delete le[we],K()}}class Ji{loadTile(W,K){const{uid:le,encoding:we,rawImageData:me,padding:Ce}=W,Oe=ImageBitmap&&me instanceof ImageBitmap?this.getImageData(me,Ce):me;K(null,new o.fd(le,Oe,we,Ce<1))}reloadTile(W,K){K(null,null)}abortTile(W,K){K()}removeTile(W,K){K()}getImageData(W,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const le=this.offscreenCanvasContext.getImageData(-K,-K,W.width+2*K,W.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}o.bp.setPbf(o.bq);class Yn{constructor(W){this._mrt=new o.bp(W.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=W.uid,this.tileID=W.tileID,this.source=W.source}parse(W,K){const le=this._mrt;this.status="parsing",this._entireBuffer=W;try{le.parseHeader(W),this._isHeaderLoaded=!0;const we=[];for(const me in le.layers){const Ce=le.getLayer(me),Oe=Ce.getDataRange(Ce.getBandList()),Ae=le.createDecodingTask(Oe),ke=W.slice(Oe.firstByte,Oe.lastByte+1),Qe=o.bp.performDecoding(ke,Ae).then(Ne=>Ae.complete(null,Ne)).catch(Ne=>Ae.complete(Ne,null));we.push(Qe)}Promise.allSettled(we).then(()=>K(null,le)).catch(me=>K(me))}catch(we){K(we)}}}class xn{constructor(W){this.actor=W,this.loading={},this.loaded={}}loadTile(W,K){const le=W.uid,we=W.request,me=this.loading[le]=new Yn(W),{cancel:Ce}=o.br(we,(Oe,Ae,ke,Qe)=>{const Ne=!this.loading[le];if(delete this.loading[le],Ne||Oe||!Ae)return me.status="done",Ne||(this.loaded[le]=me),K(Oe);me.parse(Ae,(xt,Ft)=>{if(xt||!Ft)return K(xt);K(null,Ft,ke,Qe)}),this.loaded[le]=me});me.abort=Ce}reloadTile(W,K){K(null,void 0)}abortTile(W,K){const le=W.uid,we=this.loading[le];we&&(we.abort&&we.abort(),delete this.loading[le]),K()}removeTile(W,K){const le=W.uid;this.loaded[le]&&delete this.loaded[le],K()}decodeRasterArray(W,K){o.bp.performDecoding(W.buffer,W.task).then(le=>K(null,le)).catch(le=>K(le))}}const Nr=o.fc.VectorTileFeature.prototype.toGeoJSON;class _n{constructor(W){this._feature=W,this.extent=o.aj,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const K of this._feature.geometry)W.push([new o.P(K[0],K[1])]);return W}{const W=[];for(const K of this._feature.geometry){const le=[];for(const we of K)le.push(new o.P(we[0],we[1]));W.push(le)}return W}}toGeoJSON(W,K,le){return Nr.call(this,W,K,le)}}class Zr{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.aj,this.length=W.length,this._features=W}feature(W){return new _n(this._features[W])}}class us{constructor(W,K){this.name=W,this.extent=o.aj,this.length=K.length,this._features=K}feature(W){return new _n(this._features[W])}}class Kr extends Zr{constructor(W){super([]),this.layers={};for(const K in W)this.layers[K]=new us(K,W[K])}}const ns=64/4096,rl=128;class ir{constructor(){this.features=new Map}clear(){this.features.clear()}load(W=[],K){for(const le of W){const we=le.id;if(we==null)continue;let me=this.features.get(we);me&&this.updateCache(me,K),le.geometry?(me=Vr(le),this.updateCache(me,K),this.features.set(we,me)):this.features.delete(we),this.updateCache(me,K)}}updateCache(W,K){for(const{canonical:le,uid:we}of Object.values(K)){const{z:me,x:Ce,y:Oe}=le;Ur(W,Math.pow(2,me),Ce,Oe)&&delete K[we]}}getTile(W,K,le){const we=Math.pow(2,W),me=[];for(const Ce of this.features.values())Ur(Ce,we,K,le)&&me.push(oi(Ce,we,K,le));return{features:me}}getFeatures(){return[...this.features.values()]}}function Ur({minX:Be,minY:W,maxX:K,maxY:le},we,me,Ce){return Be<(me+1+ns)/we&&W<(Ce+1+ns)/we&&K>(me-ns)/we&&le>(Ce-ns)/we}function Vr(Be){const{id:W,geometry:K,properties:le}=Be;if(!K)return;if(K.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:we,coordinates:me}=K,Ce={id:W,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Oe=Ce.geometry;if(we==="Point")rn(me,Oe,Ce);else if(we==="MultiPoint")for(const Ae of me)rn(Ae,Oe,Ce);else if(we==="LineString")Ce.type=2,bn(me,Oe,Ce);else if(we==="MultiLineString")Ce.type=2,wt(me,Oe,Ce);else if(we==="Polygon")Ce.type=3,wt(me,Oe,Ce,!0);else{if(we!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ce.type=3;for(const Ae of me)wt(Ae,Oe,Ce,!0)}return Ce}function rn([Be,W],K,le){const we=o.aD(Be);let me=o.aH(W);me=me<0?0:me>1?1:me,K.push(we,me),le.minX=Math.min(le.minX,we),le.minY=Math.min(le.minY,me),le.maxX=Math.max(le.maxX,we),le.maxY=Math.max(le.maxY,me)}function bn(Be,W,K,le=!1,we=!1){const me=[];for(const Ce of Be)rn(Ce,me,K);W.push(me),le&&function(Ce,Oe){let Ae=0;for(let ke=0,Qe=Ce.length,Ne=Qe-2;ke<Qe;Ne=ke,ke+=2)Ae+=(Ce[ke]-Ce[Ne])*(Ce[ke+1]+Ce[Ne+1]);if(Ae>0===Oe)for(let ke=0,Qe=Ce.length;ke<Qe/2;ke+=2){const Ne=Ce[ke],xt=Ce[ke+1];Ce[ke]=Ce[Qe-2-ke],Ce[ke+1]=Ce[Qe-1-ke],Ce[Qe-2-ke]=Ne,Ce[Qe-1-ke]=xt}}(me,we)}function wt(Be,W,K,le=!1){for(let we=0;we<Be.length;we++)bn(Be[we],W,K,le,we===0)}function oi(Be,W,K,le){const{id:we,type:me,geometry:Ce,tags:Oe}=Be,Ae=[];if(me===1)(function(ke,Qe,Ne,xt,Ft){for(let Rt=0;Rt<ke.length;Rt+=2){const ai=Math.round(o.aj*(ke[Rt+0]*Qe-Ne)),fi=Math.round(o.aj*(ke[Rt+1]*Qe-xt));Ft.push([ai,fi])}})(Ce,W,K,le,Ae);else for(const ke of Ce)Oi(ke,W,K,le,Ae);return{id:we,type:me,geometry:Ae,tags:Oe}}function Oi(Be,W,K,le,we){const Ce=o.aj+rl;let Oe;for(let Ae=0;Ae<Be.length-2;Ae+=2){let ke=Math.round(o.aj*(Be[Ae+0]*W-K)),Qe=Math.round(o.aj*(Be[Ae+1]*W-le)),Ne=Math.round(o.aj*(Be[Ae+2]*W-K)),xt=Math.round(o.aj*(Be[Ae+3]*W-le));const Ft=Ne-ke,Rt=xt-Qe;ke<-128&&Ne<-128||(ke<-128?(Qe+=Math.round(Rt*((-128-ke)/Ft)),ke=-128):Ne<-128&&(xt=Qe+Math.round(Rt*((-128-ke)/Ft)),Ne=-128),Qe<-128&&xt<-128||(Qe<-128?(ke+=Math.round(Ft*((-128-Qe)/Rt)),Qe=-128):xt<-128&&(Ne=ke+Math.round(Ft*((-128-Qe)/Rt)),xt=-128),ke>=Ce&&Ne>=Ce||(ke>=Ce?(Qe+=Math.round(Rt*((Ce-ke)/Ft)),ke=Ce):Ne>=Ce&&(xt=Qe+Math.round(Rt*((Ce-ke)/Ft)),Ne=Ce),Qe>=Ce&&xt>=Ce||(Qe>=Ce?(ke+=Math.round(Ft*((Ce-Qe)/Rt)),Qe=Ce):xt>=Ce&&(Ne=ke+Math.round(Ft*((Ce-Qe)/Rt)),xt=Ce),Oe&&ke===Oe[Oe.length-1][0]&&Qe===Oe[Oe.length-1][1]||(Oe=[[ke,Qe]],we.push(Oe)),Oe.push([Ne,xt])))))}}var zn,Le,Bt,hi={exports:{}},di=function(){if(Bt)return hi.exports;Bt=1;var Be=o.fg(),W=function(){if(Le)return zn;Le=1;var Qe=o.fe(),Ne=o.ff().VectorTileFeature;function xt(Rt,ai){this.options=ai||{},this.features=Rt,this.length=Rt.length}function Ft(Rt,ai){this.id=typeof Rt.id=="number"?Rt.id:void 0,this.type=Rt.type,this.rawGeometry=Rt.type===1?[Rt.geometry]:Rt.geometry,this.properties=Rt.tags,this.extent=ai||4096}return zn=xt,xt.prototype.feature=function(Rt){return new Ft(this.features[Rt],this.options.extent)},Ft.prototype.loadGeometry=function(){var Rt=this.rawGeometry;this.geometry=[];for(var ai=0;ai<Rt.length;ai++){for(var fi=Rt[ai],ci=[],wi=0;wi<fi.length;wi++)ci.push(new Qe(fi[wi][0],fi[wi][1]));this.geometry.push(ci)}return this.geometry},Ft.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Rt=this.geometry,ai=1/0,fi=-1/0,ci=1/0,wi=-1/0,vi=0;vi<Rt.length;vi++)for(var gn=Rt[vi],Ln=0;Ln<gn.length;Ln++){var Nn=gn[Ln];ai=Math.min(ai,Nn.x),fi=Math.max(fi,Nn.x),ci=Math.min(ci,Nn.y),wi=Math.max(wi,Nn.y)}return[ai,ci,fi,wi]},Ft.prototype.toGeoJSON=Ne.prototype.toGeoJSON,zn}();function K(Qe){var Ne=new Be;return function(xt,Ft){for(var Rt in xt.layers)Ft.writeMessage(3,le,xt.layers[Rt])}(Qe,Ne),Ne.finish()}function le(Qe,Ne){var xt;Ne.writeVarintField(15,Qe.version||1),Ne.writeStringField(1,Qe.name||""),Ne.writeVarintField(5,Qe.extent||4096);var Ft={keys:[],values:[],keycache:{},valuecache:{}};for(xt=0;xt<Qe.length;xt++)Ft.feature=Qe.feature(xt),Ne.writeMessage(2,we,Ft);var Rt=Ft.keys;for(xt=0;xt<Rt.length;xt++)Ne.writeStringField(3,Rt[xt]);var ai=Ft.values;for(xt=0;xt<ai.length;xt++)Ne.writeMessage(4,ke,ai[xt])}function we(Qe,Ne){var xt=Qe.feature;xt.id!==void 0&&Ne.writeVarintField(1,xt.id),Ne.writeMessage(2,me,Qe),Ne.writeVarintField(3,xt.type),Ne.writeMessage(4,Ae,xt)}function me(Qe,Ne){var xt=Qe.feature,Ft=Qe.keys,Rt=Qe.values,ai=Qe.keycache,fi=Qe.valuecache;for(var ci in xt.properties){var wi=xt.properties[ci],vi=ai[ci];if(wi!==null){vi===void 0&&(Ft.push(ci),ai[ci]=vi=Ft.length-1),Ne.writeVarint(vi);var gn=typeof wi;gn!=="string"&&gn!=="boolean"&&gn!=="number"&&(wi=JSON.stringify(wi));var Ln=gn+":"+wi,Nn=fi[Ln];Nn===void 0&&(Rt.push(wi),fi[Ln]=Nn=Rt.length-1),Ne.writeVarint(Nn)}}}function Ce(Qe,Ne){return(Ne<<3)+(7&Qe)}function Oe(Qe){return Qe<<1^Qe>>31}function Ae(Qe,Ne){for(var xt=Qe.loadGeometry(),Ft=Qe.type,Rt=0,ai=0,fi=xt.length,ci=0;ci<fi;ci++){var wi=xt[ci],vi=1;Ft===1&&(vi=wi.length),Ne.writeVarint(Ce(1,vi));for(var gn=Ft===3?wi.length-1:wi.length,Ln=0;Ln<gn;Ln++){Ln===1&&Ft!==1&&Ne.writeVarint(Ce(2,gn-1));var Nn=wi[Ln].x-Rt,tn=wi[Ln].y-ai;Ne.writeVarint(Oe(Nn)),Ne.writeVarint(Oe(tn)),Rt+=Nn,ai+=tn}Ft===3&&Ne.writeVarint(Ce(7,1))}}function ke(Qe,Ne){var xt=typeof Qe;xt==="string"?Ne.writeStringField(1,Qe):xt==="boolean"?Ne.writeBooleanField(7,Qe):xt==="number"&&(Qe%1!=0?Ne.writeDoubleField(3,Qe):Qe<0?Ne.writeSVarintField(6,Qe):Ne.writeVarintField(5,Qe))}return hi.exports=K,hi.exports.fromVectorTileJs=K,hi.exports.fromGeojsonVt=function(Qe,Ne){Ne=Ne||{};var xt={};for(var Ft in Qe)xt[Ft]=new W(Qe[Ft].features,Ne),xt[Ft].name=Ft,xt[Ft].version=Ne.version,xt[Ft].extent=Ne.extent;return K({layers:xt})},hi.exports.GeoJSONWrapper=W,hi.exports}(),ki=o.fh(di);const Ci={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},yi=Math.fround||(nr=new Float32Array(1),Be=>(nr[0]=+Be,nr[0]));var nr;const Hn=3,cn=5,Bl=6;class Ao{constructor(W){this.options=Object.assign(Object.create(Ci),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:K,minZoom:le,maxZoom:we}=this.options;K&&console.time("total time");const me=`prepare ${W.length} points`;K&&console.time(me),this.points=W;const Ce=[];for(let Ae=0;Ae<W.length;Ae++){const ke=W[Ae];if(!ke.geometry)continue;const[Qe,Ne]=ke.geometry.coordinates,xt=yi(Fl(Qe)),Ft=yi(Nl(Ne));Ce.push(xt,Ft,1/0,Ae,-1,1),this.options.reduce&&Ce.push(0)}let Oe=this.trees[we+1]=this._createTree(Ce);K&&console.timeEnd(me);for(let Ae=we;Ae>=le;Ae--){const ke=+Date.now();Oe=this.trees[Ae]=this._createTree(this._cluster(Oe,Ae)),K&&console.log("z%d: %d clusters in %dms",Ae,Oe.numItems,+Date.now()-ke)}return K&&console.timeEnd("total time"),this}getClusters(W,K){let le=((W[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,W[1]));let me=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)le=-180,me=180;else if(le>me){const Ne=this.getClusters([le,we,180,Ce],K),xt=this.getClusters([-180,we,me,Ce],K);return Ne.concat(xt)}const Oe=this.trees[this._limitZoom(K)],Ae=Oe.range(Fl(le),Nl(Ce),Fl(me),Nl(we)),ke=Oe.data,Qe=[];for(const Ne of Ae){const xt=this.stride*Ne;Qe.push(ke[xt+cn]>1?_o(ke,xt,this.clusterProps):this.points[ke[xt+Hn]])}return Qe}getChildren(W){const K=this._getOriginId(W),le=this._getOriginZoom(W),we="No cluster with the specified id.",me=this.trees[le];if(!me)throw new Error(we);const Ce=me.data;if(K*this.stride>=Ce.length)throw new Error(we);const Oe=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Ae=me.within(Ce[K*this.stride],Ce[K*this.stride+1],Oe),ke=[];for(const Qe of Ae){const Ne=Qe*this.stride;Ce[Ne+4]===W&&ke.push(Ce[Ne+cn]>1?_o(Ce,Ne,this.clusterProps):this.points[Ce[Ne+Hn]])}if(ke.length===0)throw new Error(we);return ke}getLeaves(W,K,le){const we=[];return this._appendLeaves(we,W,K=K||10,le=le||0,0),we}getTile(W,K,le){const we=this.trees[this._limitZoom(W)],me=Math.pow(2,W),{extent:Ce,radius:Oe}=this.options,Ae=Oe/Ce,ke=(le-Ae)/me,Qe=(le+1+Ae)/me,Ne={features:[]};return this._addTileFeatures(we.range((K-Ae)/me,ke,(K+1+Ae)/me,Qe),we.data,K,le,me,Ne),K===0&&this._addTileFeatures(we.range(1-Ae/me,ke,1,Qe),we.data,me,le,me,Ne),K===me-1&&this._addTileFeatures(we.range(0,ke,Ae/me,Qe),we.data,-1,le,me,Ne),Ne.features.length?Ne:null}getClusterExpansionZoom(W){let K=this._getOriginZoom(W)-1;for(;K<=this.options.maxZoom;){const le=this.getChildren(W);if(K++,le.length!==1)break;W=le[0].properties.cluster_id}return K}_appendLeaves(W,K,le,we,me){const Ce=this.getChildren(K);for(const Oe of Ce){const Ae=Oe.properties;if(Ae&&Ae.cluster?me+Ae.point_count<=we?me+=Ae.point_count:me=this._appendLeaves(W,Ae.cluster_id,le,we,me):me<we?me++:W.push(Oe),W.length===le)break}return me}_createTree(W){const K=new o.bW(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<W.length;le+=this.stride)K.add(W[le],W[le+1]);return K.finish(),K.data=W,K}_addTileFeatures(W,K,le,we,me,Ce){for(const Oe of W){const Ae=Oe*this.stride,ke=K[Ae+cn]>1;let Qe,Ne,xt;if(ke)Qe=vr(K,Ae,this.clusterProps),Ne=K[Ae],xt=K[Ae+1];else{const ai=this.points[K[Ae+Hn]];Qe=ai.properties;const[fi,ci]=ai.geometry.coordinates;Ne=Fl(fi),xt=Nl(ci)}const Ft={type:1,geometry:[[Math.round(this.options.extent*(Ne*me-le)),Math.round(this.options.extent*(xt*me-we))]],tags:Qe};let Rt;Rt=ke||this.options.generateId?K[Ae+Hn]:this.points[K[Ae+Hn]].id,Rt!==void 0&&(Ft.id=Rt),Ce.features.push(Ft)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,K){const{radius:le,extent:we,reduce:me,minPoints:Ce}=this.options,Oe=le/(we*Math.pow(2,K)),Ae=W.data,ke=[],Qe=this.stride;for(let Ne=0;Ne<Ae.length;Ne+=Qe){if(Ae[Ne+2]<=K)continue;Ae[Ne+2]=K;const xt=Ae[Ne],Ft=Ae[Ne+1],Rt=W.within(Ae[Ne],Ae[Ne+1],Oe),ai=Ae[Ne+cn];let fi=ai;for(const ci of Rt){const wi=ci*Qe;Ae[wi+2]>K&&(fi+=Ae[wi+cn])}if(fi>ai&&fi>=Ce){let ci,wi=xt*ai,vi=Ft*ai,gn=-1;const Ln=(Ne/Qe<<5)+(K+1)+this.points.length;for(const Nn of Rt){const tn=Nn*Qe;if(Ae[tn+2]<=K)continue;Ae[tn+2]=K;const Xi=Ae[tn+cn];wi+=Ae[tn]*Xi,vi+=Ae[tn+1]*Xi,Ae[tn+4]=Ln,me&&(ci||(ci=this._map(Ae,Ne,!0),gn=this.clusterProps.length,this.clusterProps.push(ci)),me(ci,this._map(Ae,tn)))}Ae[Ne+4]=Ln,ke.push(wi/fi,vi/fi,1/0,Ln,-1,fi),me&&ke.push(gn)}else{for(let ci=0;ci<Qe;ci++)ke.push(Ae[Ne+ci]);if(fi>1)for(const ci of Rt){const wi=ci*Qe;if(!(Ae[wi+2]<=K)){Ae[wi+2]=K;for(let vi=0;vi<Qe;vi++)ke.push(Ae[wi+vi])}}}}return ke}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,K,le){if(W[K+cn]>1){const Ce=this.clusterProps[W[K+Bl]];return le?Object.assign({},Ce):Ce}const we=this.points[W[K+Hn]].properties,me=this.options.map(we);return le&&me===we?Object.assign({},me):me}}function _o(Be,W,K){return{type:"Feature",id:Be[W+Hn],properties:vr(Be,W,K),geometry:{type:"Point",coordinates:[(le=Be[W],360*(le-.5)),Ls(Be[W+1])]}};var le}function vr(Be,W,K){const le=Be[W+cn],we=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,me=Be[W+Bl],Ce=me===-1?{}:Object.assign({},K[me]);return Object.assign(Ce,{cluster:!0,cluster_id:Be[W+Hn],point_count:le,point_count_abbreviated:we})}function Fl(Be){return Be/360+.5}function Nl(Be){const W=Math.sin(Be*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function Ls(Be){const W=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Ps(Be,W,K,le){let we=le;const me=W+(K-W>>1);let Ce,Oe=K-W;const Ae=Be[W],ke=Be[W+1],Qe=Be[K],Ne=Be[K+1];for(let xt=W+3;xt<K;xt+=3){const Ft=bh(Be[xt],Be[xt+1],Ae,ke,Qe,Ne);if(Ft>we)Ce=xt,we=Ft;else if(Ft===we){const Rt=Math.abs(xt-me);Rt<Oe&&(Ce=xt,Oe=Rt)}}we>le&&(Ce-W>3&&Ps(Be,W,Ce,le),Be[Ce+2]=we,K-Ce>3&&Ps(Be,Ce,K,le))}function bh(Be,W,K,le,we,me){let Ce=we-K,Oe=me-le;if(Ce!==0||Oe!==0){const Ae=((Be-K)*Ce+(W-le)*Oe)/(Ce*Ce+Oe*Oe);Ae>1?(K=we,le=me):Ae>0&&(K+=Ce*Ae,le+=Oe*Ae)}return Ce=Be-K,Oe=W-le,Ce*Ce+Oe*Oe}function ys(Be,W,K,le){const we={id:Be??null,type:W,geometry:K,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(W==="Point"||W==="MultiPoint"||W==="LineString")Hs(we,K);else if(W==="Polygon")Hs(we,K[0]);else if(W==="MultiLineString")for(const me of K)Hs(we,me);else if(W==="MultiPolygon")for(const me of K)Hs(we,me[0]);return we}function Hs(Be,W){for(let K=0;K<W.length;K+=3)Be.minX=Math.min(Be.minX,W[K]),Be.minY=Math.min(Be.minY,W[K+1]),Be.maxX=Math.max(Be.maxX,W[K]),Be.maxY=Math.max(Be.maxY,W[K+1])}function Jo(Be,W,K,le){if(!W.geometry)return;const we=W.geometry.coordinates;if(we&&we.length===0)return;const me=W.geometry.type,Ce=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2);let Oe=[],Ae=W.id;if(K.promoteId?Ae=W.properties[K.promoteId]:K.generateId&&(Ae=le||0),me==="Point")Ul(we,Oe);else if(me==="MultiPoint")for(const ke of we)Ul(ke,Oe);else if(me==="LineString")sl(we,Oe,Ce,!1);else if(me==="MultiLineString"){if(K.lineMetrics){for(const ke of we)Oe=[],sl(ke,Oe,Ce,!1),Be.push(ys(Ae,"LineString",Oe,W.properties));return}Os(we,Oe,Ce,!1)}else if(me==="Polygon")Os(we,Oe,Ce,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(const ke of W.geometry.geometries)Jo(Be,{id:Ae,geometry:ke,properties:W.properties},K,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ke of we){const Qe=[];Os(ke,Qe,Ce,!0),Oe.push(Qe)}}Be.push(ys(Ae,me,Oe,W.properties))}function Ul(Be,W){W.push(yu(Be[0]),ba(Be[1]),0)}function sl(Be,W,K,le){let we,me,Ce=0;for(let Ae=0;Ae<Be.length;Ae++){const ke=yu(Be[Ae][0]),Qe=ba(Be[Ae][1]);W.push(ke,Qe,0),Ae>0&&(Ce+=le?(we*Qe-ke*me)/2:Math.sqrt(Math.pow(ke-we,2)+Math.pow(Qe-me,2))),we=ke,me=Qe}const Oe=W.length-3;W[2]=1,Ps(W,0,Oe,K),W[Oe+2]=1,W.size=Math.abs(Ce),W.start=0,W.end=W.size}function Os(Be,W,K,le){for(let we=0;we<Be.length;we++){const me=[];sl(Be[we],me,K,le),W.push(me)}}function yu(Be){return Be/360+.5}function ba(Be){const W=Math.sin(Be*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function Ar(Be,W,K,le,we,me,Ce,Oe){if(le/=W,me>=(K/=W)&&Ce<le)return Be;if(Ce<K||me>=le)return null;const Ae=[];for(const ke of Be){const Qe=ke.geometry;let Ne=ke.type;const xt=we===0?ke.minX:ke.minY,Ft=we===0?ke.maxX:ke.maxY;if(xt>=K&&Ft<le){Ae.push(ke);continue}if(Ft<K||xt>=le)continue;let Rt=[];if(Ne==="Point"||Ne==="MultiPoint")Co(Qe,Rt,K,le,we);else if(Ne==="LineString")Xr(Qe,Rt,K,le,we,!1,Oe.lineMetrics);else if(Ne==="MultiLineString")vs(Qe,Rt,K,le,we,!1);else if(Ne==="Polygon")vs(Qe,Rt,K,le,we,!0);else if(Ne==="MultiPolygon")for(const ai of Qe){const fi=[];vs(ai,fi,K,le,we,!0),fi.length&&Rt.push(fi)}if(Rt.length){if(Oe.lineMetrics&&Ne==="LineString"){for(const ai of Rt)Ae.push(ys(ke.id,Ne,ai,ke.tags));continue}Ne!=="LineString"&&Ne!=="MultiLineString"||(Rt.length===1?(Ne="LineString",Rt=Rt[0]):Ne="MultiLineString"),Ne!=="Point"&&Ne!=="MultiPoint"||(Ne=Rt.length===3?"Point":"MultiPoint"),Ae.push(ys(ke.id,Ne,Rt,ke.tags))}}return Ae.length?Ae:null}function Co(Be,W,K,le,we){for(let me=0;me<Be.length;me+=3){const Ce=Be[me+we];Ce>=K&&Ce<=le&&Io(W,Be[me],Be[me+1],Be[me+2])}}function Xr(Be,W,K,le,we,me,Ce){let Oe=vu(Be);const Ae=we===0?wa:ea;let ke,Qe,Ne=Be.start;for(let fi=0;fi<Be.length-3;fi+=3){const ci=Be[fi],wi=Be[fi+1],vi=Be[fi+2],gn=Be[fi+3],Ln=Be[fi+4],Nn=we===0?ci:wi,tn=we===0?gn:Ln;let Xi=!1;Ce&&(ke=Math.sqrt(Math.pow(ci-gn,2)+Math.pow(wi-Ln,2))),Nn<K?tn>K&&(Qe=Ae(Oe,ci,wi,gn,Ln,K),Ce&&(Oe.start=Ne+ke*Qe)):Nn>le?tn<le&&(Qe=Ae(Oe,ci,wi,gn,Ln,le),Ce&&(Oe.start=Ne+ke*Qe)):Io(Oe,ci,wi,vi),tn<K&&Nn>=K&&(Qe=Ae(Oe,ci,wi,gn,Ln,K),Xi=!0),tn>le&&Nn<=le&&(Qe=Ae(Oe,ci,wi,gn,Ln,le),Xi=!0),!me&&Xi&&(Ce&&(Oe.end=Ne+ke*Qe),W.push(Oe),Oe=vu(Be)),Ce&&(Ne+=ke)}let xt=Be.length-3;const Ft=Be[xt],Rt=Be[xt+1],ai=we===0?Ft:Rt;ai>=K&&ai<=le&&Io(Oe,Ft,Rt,Be[xt+2]),xt=Oe.length-3,me&&xt>=3&&(Oe[xt]!==Oe[0]||Oe[xt+1]!==Oe[1])&&Io(Oe,Oe[0],Oe[1],Oe[2]),Oe.length&&W.push(Oe)}function vu(Be){const W=[];return W.size=Be.size,W.start=Be.start,W.end=Be.end,W}function vs(Be,W,K,le,we,me){for(const Ce of Be)Xr(Ce,W,K,le,we,me,!1)}function Io(Be,W,K,le){Be.push(W,K,le)}function wa(Be,W,K,le,we,me){const Ce=(me-W)/(le-W);return Io(Be,me,K+(we-K)*Ce,1),Ce}function ea(Be,W,K,le,we,me){const Ce=(me-K)/(we-K);return Io(Be,W+(le-W)*Ce,me,1),Ce}function go(Be,W){const K=[];for(let le=0;le<Be.length;le++){const we=Be[le],me=we.type;let Ce;if(me==="Point"||me==="MultiPoint"||me==="LineString")Ce=ta(we.geometry,W);else if(me==="MultiLineString"||me==="Polygon"){Ce=[];for(const Oe of we.geometry)Ce.push(ta(Oe,W))}else if(me==="MultiPolygon"){Ce=[];for(const Oe of we.geometry){const Ae=[];for(const ke of Oe)Ae.push(ta(ke,W));Ce.push(Ae)}}K.push(ys(we.id,me,Ce,we.tags))}return K}function ta(Be,W){const K=[];K.size=Be.size,Be.start!==void 0&&(K.start=Be.start,K.end=Be.end);for(let le=0;le<Be.length;le+=3)K.push(Be[le]+W,Be[le+1],Be[le+2]);return K}function Ta(Be,W){if(Be.transformed)return Be;const K=1<<Be.z,le=Be.x,we=Be.y;for(const me of Be.features){const Ce=me.geometry,Oe=me.type;if(me.geometry=[],Oe===1)for(let Ae=0;Ae<Ce.length;Ae+=2)me.geometry.push(qn(Ce[Ae],Ce[Ae+1],W,K,le,we));else for(let Ae=0;Ae<Ce.length;Ae++){const ke=[];for(let Qe=0;Qe<Ce[Ae].length;Qe+=2)ke.push(qn(Ce[Ae][Qe],Ce[Ae][Qe+1],W,K,le,we));me.geometry.push(ke)}}return Be.transformed=!0,Be}function qn(Be,W,K,le,we,me){return[Math.round(K*(Be*le-we)),Math.round(K*(W*le-me))]}function ol(Be,W,K,le,we){const me=W===we.maxZoom?0:we.tolerance/((1<<W)*we.extent),Ce={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:K,y:le,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Oe of Be)Tc(Ce,Oe,me,we);return Ce}function Tc(Be,W,K,le){const we=W.geometry,me=W.type,Ce=[];if(Be.minX=Math.min(Be.minX,W.minX),Be.minY=Math.min(Be.minY,W.minY),Be.maxX=Math.max(Be.maxX,W.maxX),Be.maxY=Math.max(Be.maxY,W.maxY),me==="Point"||me==="MultiPoint")for(let Oe=0;Oe<we.length;Oe+=3)Ce.push(we[Oe],we[Oe+1]),Be.numPoints++,Be.numSimplified++;else if(me==="LineString")ks(Ce,we,Be,K,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(let Oe=0;Oe<we.length;Oe++)ks(Ce,we[Oe],Be,K,me==="Polygon",Oe===0);else if(me==="MultiPolygon")for(let Oe=0;Oe<we.length;Oe++){const Ae=we[Oe];for(let ke=0;ke<Ae.length;ke++)ks(Ce,Ae[ke],Be,K,!0,ke===0)}if(Ce.length){let Oe=W.tags||null;if(me==="LineString"&&le.lineMetrics){Oe={};for(const ke in W.tags)Oe[ke]=W.tags[ke];Oe.mapbox_clip_start=we.start/we.size,Oe.mapbox_clip_end=we.end/we.size}const Ae={geometry:Ce,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:Oe};W.id!==null&&(Ae.id=W.id),Be.features.push(Ae)}}function ks(Be,W,K,le,we,me){const Ce=le*le;if(le>0&&W.size<(we?Ce:le))return void(K.numPoints+=W.length/3);const Oe=[];for(let Ae=0;Ae<W.length;Ae+=3)(le===0||W[Ae+2]>Ce)&&(K.numSimplified++,Oe.push(W[Ae],W[Ae+1])),K.numPoints++;we&&function(Ae,ke){let Qe=0;for(let Ne=0,xt=Ae.length,Ft=xt-2;Ne<xt;Ft=Ne,Ne+=2)Qe+=(Ae[Ne]-Ae[Ft])*(Ae[Ne+1]+Ae[Ft+1]);if(Qe>0===ke)for(let Ne=0,xt=Ae.length;Ne<xt/2;Ne+=2){const Ft=Ae[Ne],Rt=Ae[Ne+1];Ae[Ne]=Ae[xt-2-Ne],Ae[Ne+1]=Ae[xt-1-Ne],Ae[xt-2-Ne]=Ft,Ae[xt-1-Ne]=Rt}}(Oe,me),Be.push(Oe)}const Sc={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pd{constructor(W,K){const le=(K=this.options=function(me,Ce){for(const Oe in Ce)me[Oe]=Ce[Oe];return me}(Object.create(Sc),K)).debug;if(le&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");let we=function(me,Ce){const Oe=[];if(me.type==="FeatureCollection")for(let Ae=0;Ae<me.features.length;Ae++)Jo(Oe,me.features[Ae],Ce,Ae);else Jo(Oe,me.type==="Feature"?me:{geometry:me},Ce);return Oe}(W,K);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),we=function(me,Ce){const Oe=Ce.buffer/Ce.extent;let Ae=me;const ke=Ar(me,1,-1-Oe,Oe,0,-1,2,Ce),Qe=Ar(me,1,1-Oe,2+Oe,0,-1,2,Ce);return(ke||Qe)&&(Ae=Ar(me,1,-Oe,1+Oe,0,-1,2,Ce)||[],ke&&(Ae=go(ke,1).concat(Ae)),Qe&&(Ae=Ae.concat(go(Qe,-1)))),Ae}(we,K),we.length&&this.splitTile(we,0,0,0),le&&(we.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(W,K,le,we,me,Ce,Oe){const Ae=[W,K,le,we],ke=this.options,Qe=ke.debug;for(;Ae.length;){we=Ae.pop(),le=Ae.pop(),K=Ae.pop(),W=Ae.pop();const Ne=1<<K,xt=Vl(K,le,we);let Ft=this.tiles[xt];if(!Ft&&(Qe>1&&console.time("creation"),Ft=this.tiles[xt]=ol(W,K,le,we,ke),this.tileCoords.push({z:K,x:le,y:we}),Qe)){Qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,le,we,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));const Xi=`z${K}`;this.stats[Xi]=(this.stats[Xi]||0)+1,this.total++}if(Ft.source=W,me==null){if(K===ke.indexMaxZoom||Ft.numPoints<=ke.indexMaxPoints)continue}else{if(K===ke.maxZoom||K===me)continue;if(me!=null){const Xi=me-K;if(le!==Ce>>Xi||we!==Oe>>Xi)continue}}if(Ft.source=null,W.length===0)continue;Qe>1&&console.time("clipping");const Rt=.5*ke.buffer/ke.extent,ai=.5-Rt,fi=.5+Rt,ci=1+Rt;let wi=null,vi=null,gn=null,Ln=null,Nn=Ar(W,Ne,le-Rt,le+fi,0,Ft.minX,Ft.maxX,ke),tn=Ar(W,Ne,le+ai,le+ci,0,Ft.minX,Ft.maxX,ke);W=null,Nn&&(wi=Ar(Nn,Ne,we-Rt,we+fi,1,Ft.minY,Ft.maxY,ke),vi=Ar(Nn,Ne,we+ai,we+ci,1,Ft.minY,Ft.maxY,ke),Nn=null),tn&&(gn=Ar(tn,Ne,we-Rt,we+fi,1,Ft.minY,Ft.maxY,ke),Ln=Ar(tn,Ne,we+ai,we+ci,1,Ft.minY,Ft.maxY,ke),tn=null),Qe>1&&console.timeEnd("clipping"),Ae.push(wi||[],K+1,2*le,2*we),Ae.push(vi||[],K+1,2*le,2*we+1),Ae.push(gn||[],K+1,2*le+1,2*we),Ae.push(Ln||[],K+1,2*le+1,2*we+1)}}getTile(W,K,le){W=+W,K=+K,le=+le;const we=this.options,{extent:me,debug:Ce}=we;if(W<0||W>24)return null;const Oe=1<<W,Ae=Vl(W,K=K+Oe&Oe-1,le);if(this.tiles[Ae])return Ta(this.tiles[Ae],me);Ce>1&&console.log("drilling down to z%d-%d-%d",W,K,le);let ke,Qe=W,Ne=K,xt=le;for(;!ke&&Qe>0;)Qe--,Ne>>=1,xt>>=1,ke=this.tiles[Vl(Qe,Ne,xt)];return ke&&ke.source?(Ce>1&&(console.log("found parent tile z%d-%d-%d",Qe,Ne,xt),console.time("drilling down")),this.splitTile(ke.source,Qe,Ne,xt,W,K,le),Ce>1&&console.timeEnd("drilling down"),this.tiles[Ae]?Ta(this.tiles[Ae],me):null):null}}function Vl(Be,W,K){return 32*((1<<Be)*K+W)+Be}function Tt(Be,W){const K=Be.tileID.canonical;if(!this._geoJSONIndex)return void W(null,null);const le=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!le)return void W(null,null);const we=Ae=>Ae.tags&&"3d_elevation_id"in Ae.tags&&"source"in Ae.tags&&Ae.tags.source==="elevation",me=le.features.filter(Ae=>we(Ae));let Ce;if(me.length>0){const Ae=le.features.filter(ke=>!we(ke));Ce=new Kr({_geojsonTileLayer:Ae,hd_road_elevation:me})}else Ce=new Zr(le.features);let Oe=ki(Ce);Oe.byteOffset===0&&Oe.byteLength===Oe.buffer.byteLength||(Oe=new Uint8Array(Oe)),W(null,{vectorTile:Ce,rawData:Oe.buffer})}class ia extends Qi{constructor(W,K,le,we,me,Ce,Oe){super(W,K,le,we,me,Tt,Oe),Ce&&(this.loadGeoJSON=Ce),this._dynamicIndex=new ir}loadData(W,K){const le=W&&W.request,we=le&&le.collectResourceTiming;this.loadGeoJSON(W,(me,Ce)=>{if(me||!Ce)return K(me);if(typeof Ce!="object")return K(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{try{if(W.filter){const Ae=o.X(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ae.result==="error")throw new Error(Ae.value.map(ke=>`${ke.key}: ${ke.message}`).join(", "));Ce.features=Ce.features.filter(ke=>Ae.value.evaluate({zoom:0},ke))}W.dynamic?(Ce.type==="Feature"&&(Ce={type:"FeatureCollection",features:[Ce]}),W.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ce.features,this.loaded),W.cluster&&(Ce.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=W.cluster?new Ao(function({superclusterOptions:Ae,clusterProperties:ke}){if(!ke||!Ae)return Ae;const Qe={},Ne={},xt={accumulated:null,zoom:0},Ft={properties:null},Rt=Object.keys(ke);for(const ai of Rt){const[fi,ci]=ke[ai],wi=o.X(ci),vi=o.X(typeof fi=="string"?[fi,["accumulated"],["get",ai]]:fi);Qe[ai]=wi.value,Ne[ai]=vi.value}return Ae.map=ai=>{Ft.properties=ai;const fi={};for(const ci of Rt)fi[ci]=Qe[ci].evaluate(xt,Ft);return fi},Ae.reduce=(ai,fi)=>{Ft.properties=fi;for(const ci of Rt)xt.accumulated=ai[ci],ai[ci]=Ne[ci].evaluate(xt,Ft)},Ae}(W)).load(Ce.features):W.dynamic?this._dynamicIndex:function(Ae,ke){return new Pd(Ae,ke)}(Ce,W.geojsonVtOptions)}catch(Ae){return K(Ae)}const Oe={};if(we){const Ae=xe(le);Ae&&(Oe.resourceTiming={},Oe.resourceTiming[W.source]=JSON.parse(JSON.stringify(Ae)))}K(null,Oe)}})}reloadTile(W,K){const le=this.loaded;return le&&le[W.uid]?W.partial?K(null,void 0):super.reloadTile(W,K):this.loadTile(W,K)}loadGeoJSON(W,K){if(W.request)o.n(W.request,K);else{if(typeof W.data!="string")return K(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(W.data))}catch{return K(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(le){K(le)}}getClusterChildren(W,K){try{K(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(le){K(le)}}getClusterLeaves(W,K){try{K(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(le){K(le)}}}class wh{constructor(W,K,le){this.tileID=new o.aM(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.tileZoom=W.tileZoom,this.uid=W.uid,this.zoom=W.zoom,this.canonical=W.tileID.canonical,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=W.projection,this.brightness=K,this.worldview=le}parse(W,K,le,we){this.status="parsing";const me=new o.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Ce=[],Oe=K.familiesBySource[le.source],Ae=new o.f0(me,le.promoteId);Ae.bucketLayerIDs=[],Ae.is3DTile=!0,o.fi(W).then(ke=>{if(!ke)return we(new Error("Could not parse tile"));const Qe=ke.json.extensionsUsed&&ke.json.extensionsUsed.includes("MAPBOX_mesh_features")||ke.json.asset.extras&&ke.json.asset.extras.MAPBOX_mesh_features,Ne=ke.json.extensionsUsed&&ke.json.extensionsUsed.includes("EXT_meshopt_compression"),xt=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ft in Oe)for(const Rt of Oe[Ft]){const ai=Rt[0];Ae.bucketLayerIDs.push(Rt.map(wi=>o.C(wi.id,wi.scope))),ai.recalculate(xt,[]);const fi=o.fj(ke,1/o.cU(le.tileID.canonical)),ci=new o.fk(Rt,fi,me,Qe,Ne,this.brightness,Ae,this.worldview);Qe||(ci.needsUpload=!0),Ce.push(ci),ci.evaluate(ai)}this.status="done",we(null,{buckets:Ce,featureIndex:Ae,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(ke=>we(new Error(ke.message)))}}class xu{constructor(W,K,le,we,me,Ce,Oe,Ae){this.actor=W,this.layerIndex=K,this.availableImages=le,this.availableModels=we,this.brightness=Oe,this.loading={},this.loaded={},this.worldview=Ae}loadTile(W,K){const le=W.uid,we=this.loading[le]=new wh(W,this.brightness,this.worldview);o.br(W.request,(me,Ce)=>{const Oe=!this.loading[le];return delete this.loading[le],Oe||me?(we.status="done",Oe||(this.loaded[le]=we),K(me)):Ce&&Ce.byteLength!==0?void we.parse(Ce,this.layerIndex,W,(Ae,ke)=>{we.status="done",this.loaded=this.loaded||{},this.loaded[le]=we,Ae||!ke?K(Ae):K(null,ke)}):(we.status="done",this.loaded[le]=we,K())})}reloadTile(W,K){const le=this.loaded,we=W.uid;if(le&&le[we]){const me=le[we];me.projection=W.projection,me.brightness=W.brightness;const Ce=(Oe,Ae)=>{me.reloadCallback&&(delete me.reloadCallback,this.loadTile(W,K)),K(Oe,Ae)};me.status==="parsing"?me.reloadCallback=Ce:me.status==="done"&&this.loadTile(W,K)}}abortTile(W,K){const le=W.uid;this.loading[le]&&delete this.loading[le],K()}removeTile(W,K){const le=this.loaded,we=W.uid;le&&le[we]&&delete le[we],K()}}class en{constructor(W){this.self=W,this.actor=new o.fm(W,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.ce({name:"mercator"}),this.workerSourceTypes={vector:Qi,geojson:ia,"raster-dem":Ji,"raster-array":xn,"batched-model":xu},this.workerSources={},this.self.registerWorkerSource=(K,le)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=le},this.self.registerRTLTextPlugin=K=>{if(o.fn.isParsed())throw new Error("RTL text plugin already registered.");o.fn.setState({pluginStatus:o.fo.parsed,pluginURL:o.fn.getPluginURL()}),o.fn.applyArabicShaping=K.applyArabicShaping,o.fn.processBidirectionalText=K.processBidirectionalText,o.fn.processStyledBidirectionalText=K.processStyledBidirectionalText;for(const le of this.rtlPluginParsingListeners)le(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(W,K,le){delete this.layerIndexes[W],delete this.availableImages[W],delete this.availableModels[W],delete this.workerSources[W],le()}checkIfReady(W,K,le){le()}setReferrer(W,K){this.referrer=K}spriteLoaded(W,K){this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={});const{scope:le,isLoaded:we}=K;if(this.isSpriteLoaded[W][le]=we,this.workerSources[W]&&this.workerSources[W][le])for(const me in this.workerSources[W][le]){const Ce=this.workerSources[W][le][me];for(const Oe in Ce){const Ae=Ce[Oe];Ae instanceof Qi&&(Ae.isSpriteLoaded=we,Ae.fire(new o.A("isSpriteLoaded")))}}}setImages(W,K,le){this.availableImages[W]||(this.availableImages[W]={});const{scope:we,images:me}=K;if(this.availableImages[W][we]=me,this.workerSources[W]&&this.workerSources[W][we]){for(const Ce in this.workerSources[W][we]){const Oe=this.workerSources[W][we][Ce];for(const Ae in Oe)Oe[Ae].availableImages=me}le()}else le()}setModels(W,{scope:K,models:le},we){if(this.availableModels[W]||(this.availableModels[W]={}),this.availableModels[W][K]=le,this.workerSources[W]&&this.workerSources[W][K]){for(const me in this.workerSources[W][K]){const Ce=this.workerSources[W][K][me];for(const Oe in Ce)Ce[Oe].availableModels=le}we()}else we()}setProjection(W,K){this.projections[W]=o.ce(K)}setBrightness(W,K,le){this.brightness=K,le()}setWorldview(W,K,le){this.worldview=K,le()}setLayers(W,K,le){this.getLayerIndex(W,K.scope).replace(K.layers,K.options),le()}updateLayers(W,K,le){this.getLayerIndex(W,K.scope).update(K.layers,K.removedIds,K.options),le()}loadTile(W,K,le){K.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,K.type,K.source,K.scope).loadTile(K,le)}decodeRasterArray(W,K,le){this.getWorkerSource(W,K.type,K.source,K.scope).decodeRasterArray(K,le)}reloadTile(W,K,le){K.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,K.type,K.source,K.scope).reloadTile(K,le)}abortTile(W,K,le){this.getWorkerSource(W,K.type,K.source,K.scope).abortTile(K,le)}removeTile(W,K,le){this.getWorkerSource(W,K.type,K.source,K.scope).removeTile(K,le)}removeSource(W,K,le){if(!(this.workerSources[W]&&this.workerSources[W][K.scope]&&this.workerSources[W][K.scope][K.type]&&this.workerSources[W][K.scope][K.type][K.source]))return;const we=this.workerSources[W][K.scope][K.type][K.source];delete this.workerSources[W][K.scope][K.type][K.source],we.removeSource!==void 0?we.removeSource(K,le):le()}loadWorkerSource(W,K,le){try{this.self.importScripts(K.url),le()}catch(we){le(we.toString())}}syncRTLPluginState(W,K,le){if(o.fn.isParsed())le(null,!0);else if(o.fn.isParsing())this.rtlPluginParsingListeners.push(le);else try{o.fn.setState(K);const we=o.fn.getPluginURL();!o.fn.isLoaded()||o.fn.isParsed()||o.fn.isParsing()||we==null||(o.fn.setState({pluginStatus:o.fo.parsing,pluginURL:o.fn.getPluginURL()}),this.self.importScripts(we),o.fn.isParsed()?le(null,!0):this.rtlPluginParsingListeners.push(le))}catch(we){le(we.toString())}}setDracoUrl(W,K){this.dracoUrl=K}getAvailableImages(W,K){this.availableImages[W]||(this.availableImages[W]={});let le=this.availableImages[W][K];return le||(le=[]),le}getAvailableModels(W,K){this.availableModels[W]||(this.availableModels[W]={});let le=this.availableModels[W][K];return le||(le={}),le}getLayerIndex(W,K){this.layerIndexes[W]||(this.layerIndexes[W]={});let le=this.layerIndexes[W][K];return le||(le=this.layerIndexes[W][K]=new nt,le.scope=K),le}getWorkerSource(W,K,le,we){const me=this.workerSources;return me[W]||(me[W]={}),me[W][we]||(me[W][we]={}),me[W][we][K]||(me[W][we][K]={}),this.isSpriteLoaded[W]||(this.isSpriteLoaded[W]={}),me[W][we][K][le]||(me[W][we][K][le]=new this.workerSourceTypes[K]({send:(Ce,Oe,Ae,ke,Qe,Ne)=>this.actor.send(Ce,Oe,Ae,W,Qe,Ne),scheduler:this.actor.scheduler},this.getLayerIndex(W,we),this.getAvailableImages(W,we),this.getAvailableModels(W,we),this.isSpriteLoaded[W][we],void 0,this.brightness,this.worldview)),me[W][we][K][le]}rasterizeImagesWorker(W,K,le){const we=new Map;for(const[me,{image:Ce,imageVariant:Oe}]of K.tasks.entries()){const Ae=this.imageRasterizer.rasterize(Oe,Ce,K.scope,W);we.set(me,Ae)}le(void 0,we)}removeRasterizedImages(W,K,le){this.imageRasterizer.removeImagesFromCacheByIds(K.imageIds,K.scope,W),le()}enforceCacheSizeLimit(W,K){o.fp(K)}getWorkerPerformanceMetrics(W,K,le){le(void 0,void 0)}}return o.fl(self)&&(self.worker=new en(self)),en}),H(["./shared"],function(o){var xe="3.13.0";const pe={create:"create",load:"load",fullLoad:"fullLoad"},Ke={mark(c){performance.mark(c)},measure(c,t,r){performance.measure(c,t,r)}};function nt(c){const t=c.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Je,Kt={},pi=function(){if(Je)return Kt;function c(u){return!t(u)}function t(u){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,v,w=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(w);try{v=new Worker(A),_=!0}catch{_=!1}return v&&v.terminate(),URL.revokeObjectURL(A),_}()?function(){var _=document.createElement("canvas");_.width=_.height=1;var v=_.getContext("2d");if(!v)return!1;var w=v.getImageData(0,0,1,1);return w&&w.width===_.width}()?(r[p=u&&u.failIfMajorPerformanceCaveat]===void 0&&(r[p]=function(_){var v,w=function(A){var D=document.createElement("canvas"),L=Object.create(c.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=A,D.getContext("webgl2",L)}(_);if(!w)return!1;try{v=w.createShader(w.VERTEX_SHADER)}catch{return!1}return!(!v||w.isContextLost())&&(w.shaderSource(v,"void main() {}"),w.compileShader(v),w.getShaderParameter(v,w.COMPILE_STATUS)===!0)}(p)),r[p]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var p}Je=1,Kt.supported=c,Kt.notSupportedReason=t;var r={};return c.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Kt}();function Yt(c,t,r){const u=document.createElement(c);return t!=null&&(u.className=t),r&&r.appendChild(u),u}function Qi(c,t,r){const u=document.createElementNS("http://www.w3.org/2000/svg",c);for(const p of Object.keys(t))u.setAttributeNS(null,p,String(t[p]));return r&&r.appendChild(u),u}const Ji=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Yn=Ji&&Ji.userSelect!==void 0?"userSelect":"WebkitUserSelect";let xn;function Nr(){Ji&&Yn&&(xn=Ji[Yn],Ji[Yn]="none")}function _n(){Ji&&Yn&&(Ji[Yn]=xn)}function Zr(c){c.preventDefault(),c.stopPropagation(),window.removeEventListener("click",Zr,!0)}function us(){window.addEventListener("click",Zr,!0),window.setTimeout(()=>{window.removeEventListener("click",Zr,!0)},0)}function Kr(c,t){const r=c.getBoundingClientRect();return ir(c,r,t)}function ns(c,t){const r=c.getBoundingClientRect(),u=[];for(let p=0;p<t.length;p++)u.push(ir(c,r,t[p]));return u}function rl(c){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&c.button===2&&c.ctrlKey?0:c.button}function ir(c,t,r){const u=c.offsetWidth===t.width?1:c.offsetWidth/t.width;return new o.P((r.clientX-t.left)*u,(r.clientY-t.top)*u)}const Ur="01",Vr="NO_ACCESS_TOKEN";class rn{constructor(t,r,u){this._transformRequestFn=t,this._customAccessToken=r,this._silenceAuthErrors=!!u,this._createSkuToken()}_createSkuToken(){const t=function(){let r="";for(let u=0;u<10;u++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ur,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,r){return this._transformRequestFn&&this._transformRequestFn(t,r)||{url:t}}normalizeStyleURL(t,r){if(!o.j(t))return t;const u=wt(t);return u.params.push(`sdk=js-${xe}`),u.path=`/styles/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeGlyphsURL(t,r){if(!o.j(t))return t;const u=wt(t);return u.path=`/fonts/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeModelURL(t,r){if(!o.j(t))return t;const u=wt(t);return u.path=`/models/v1${u.path}`,this._makeAPIURL(u,this._customAccessToken||r)}normalizeSourceURL(t,r,u,p){if(!o.j(t))return t;const _=wt(t);return _.path=`/v4/${_.authority}.json`,_.params.push("secure"),u&&_.params.push(`language=${u}`),p&&_.params.push(`worldview=${p}`),this._makeAPIURL(_,this._customAccessToken||r)}normalizeIconsetURL(t,r){const u=wt(t);return o.j(t)?(u.path=`/styles/v1${u.path}/iconset.pbf`,this._makeAPIURL(u,this._customAccessToken||r)):oi(u)}normalizeSpriteURL(t,r,u,p){const _=wt(t);return o.j(t)?(_.path=`/styles/v1${_.path}/sprite${r}${u}`,this._makeAPIURL(_,this._customAccessToken||p)):(_.path+=`${r}${u}`,oi(_))}normalizeTileURL(t,r,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.j(t))return t;const p=wt(t);p.path=p.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||u&&p.authority!=="raster"&&u===512?"@2x":""}${o.l.supported?".webp":"$1"}`),p.authority==="raster"?p.path=`/${o.e.RASTER_URL_PREFIX}${p.path}`:p.authority==="rasterarrays"?p.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${p.path}`:p.authority==="3dtiles"?p.path=`/${o.e.TILES3D_URL_PREFIX}${p.path}`:(p.path=p.path.replace(/^.+\/v4\//,"/"),p.path=`/${o.e.TILE_URL_VERSION}${p.path}`);const _=this._customAccessToken||function(v){for(const w of v){const A=w.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(p.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&_&&this._skuToken&&p.params.push(`sku=${this._skuToken}`),this._makeAPIURL(p,_)}canonicalizeTileURL(t,r){const u=wt(t);if(!u.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!u.path.match(/\.[\w]+$/))return t;let p="mapbox://";u.path.match(/^\/raster\/v1\//)?p+=`raster/${u.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:u.path.match(/^\/rasterarrays\/v1\//)?p+=`rasterarrays/${u.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:p+=`tiles/${u.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let _=u.params;return r&&(_=_.filter(v=>!v.match(/^access_token=/))),_.length&&(p+=`?${_.join("&")}`),p}canonicalizeTileset(t,r){const u=!!r&&o.j(r),p=[];for(const _ of t.tiles||[])o.k(_)?p.push(this.canonicalizeTileURL(_,u)):p.push(_);return p}_makeAPIURL(t,r){const u="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",p=wt(o.e.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){const _=t.params.indexOf("secure");_>=0&&t.params.splice(_,1)}if(p.path!=="/"&&(t.path=`${p.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return oi(t);if(r=r||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${u}`);if(r[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${u}`)}return t.params=t.params.filter(_=>_.indexOf("access_token")===-1),t.params.push(`access_token=${r||""}`),oi(t)}}const bn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function wt(c){const t=c.match(bn);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function oi(c){const t=c.params.length?`?${c.params.join("&")}`:"";return`${c.protocol}://${c.authority}${c.path}${t}`}const Oi="mapbox.eventData";function zn(c){if(!c)return null;const t=c.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.m(t[1]))}catch{return null}}class Le{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=zn(o.e.ACCESS_TOKEN);let u="";return u=r&&r.u?o.f(r.u):o.e.ACCESS_TOKEN||"",t?`${Oi}.${t}:${u}`:`${Oi}:${u}`}fetchEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{const p=localStorage.getItem(r);p&&(this.eventData=JSON.parse(p));const _=localStorage.getItem(u);_&&(this.anonId=_)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const t=o.s("localStorage"),r=this.getStorageKey(),u=this.getStorageKey("uuid"),p=this.anonId;if(t&&p)try{localStorage.setItem(u,p),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,r,u,p){if(!o.e.EVENTS_URL)return;const _=wt(o.e.EVENTS_URL);_.params.push(`access_token=${p||o.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},w=r?o.h(v,r):v,A={url:oi(_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};this.pendingRequest=o.p(A,D=>{this.pendingRequest=null,u(D),this.saveEventData(),this.processRequests(p)})}queueRequest(t,r){this.queue.push(t),this.processRequests(r)}}const Bt=new class extends Le{constructor(c){super("appUserTurnstile"),this._customAccessToken=c}postTurnstileEvent(c,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(c)&&c.some(r=>o.j(r)||o.k(r))&&this.queueRequest(Date.now(),t)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=zn(o.e.ACCESS_TOKEN),r=t?t.u:o.e.ACCESS_TOKEN;let u=r!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const _=new Date(this.eventData.lastSuccess),v=new Date(p),w=(p-this.eventData.lastSuccess)/864e5;u=u||w>=1||w<-1||_.getDate()!==v.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xe,skuId:Ur,"enabled.telemetry":!1,userId:this.anonId},_=>{_||(this.eventData.lastSuccess=p,this.eventData.tokenU=r)},c):this.processRequests()}},hi=Bt.postTurnstileEvent.bind(Bt),di=new class extends Le{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(c,t,r,u){this.skuToken=t,this.errorCb=u,o.e.EVENTS_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Vr)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:xe,skuId:Ur,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c))}remove(){this.errorCb=null}},ki=di.postMapLoadEvent.bind(di),Ci=new class extends Le{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(c){let t=this.mapInstanceIdMap.get(c);return t||(t=o.u(),this.mapInstanceIdMap.set(c,t)),t}getEventId(c){const t=this.eventIdPerMapInstanceMap.get(c)||0;return this.eventIdPerMapInstanceMap.set(c,t+1),t}postStyleLoadEvent(c,t){const{map:r,style:u,importedStyles:p}=t;if(!o.e.EVENTS_URL||!c&&!o.e.ACCESS_TOKEN)return;const _=this.getMapInstanceId(r),v={mapInstanceId:_,eventId:this.getEventId(_),style:u};p.length&&(v.importedStyles=p),this.queueRequest({timestamp:Date.now(),payload:v},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},c)}},yi=Ci.postStyleLoadEvent.bind(Ci),nr=new class extends Le{constructor(){super("gljs.performance")}postPerformanceEvent(c,t){o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},c)}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:r}=this.queue.shift(),u=function(p){const _=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),w=function(N){const Z={};if(N){for(const j in N)if(j!=="other")for(const X of N[j]){const Y=`${j}ResolveRangeMin`,J=`${j}ResolveRangeMax`,oe=`${j}RequestCount`,ce=`${j}RequestCachedCount`;Z[Y]=Math.min(Z[Y]||1/0,X.startTime),Z[J]=Math.max(Z[J]||-1/0,X.responseEnd);const ye=fe=>{Z[fe]===void 0&&(Z[fe]=0),++Z[fe]};X.transferSize!==void 0&&X.transferSize===0&&ye(ce),ye(oe)}}return Z}(function(N,Z){const j={};if(N)for(const X of N){const Y=Z(X);j[Y]===void 0&&(j[Y]=[]),j[Y].push(X)}return j}(_,nt)),A=window.devicePixelRatio,D=navigator.connection||navigator.mozConnection||navigator.webkitConnection,L=D?D.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},O=(N,Z,j)=>{j!=null&&N.push({name:Z,value:j.toString()})};for(const N in w)O(k.counters,N,w[N]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",p.interactionRange[0]),O(k.counters,"interactionRangeMax",p.interactionRange[1])),v)for(const N of Object.keys(pe)){const Z=pe[N],j=v.find(X=>X.name===Z);j&&O(k.counters,Z,j.startTime)}return O(k.counters,"visibilityHidden",p.visibilityHidden),O(k.attributes,"style",function(N){if(N)for(const Z of N){const j=Z.name.split("?")[0];if(o.i(j)){const X=j.split("/").slice(-2);if(X.length===2)return`mapbox://styles/${X[0]}/${X[1]}`}}}(_)),O(k.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",p.fogEnabled?"true":"false"),O(k.attributes,"projection",p.projection),O(k.attributes,"zoom",p.zoom),O(k.metadata,"devicePixelRatio",A),O(k.metadata,"connectionEffectiveType",L),O(k.metadata,"navigatorUserAgent",navigator.userAgent),O(k.metadata,"screenWidth",window.screen.width),O(k.metadata,"screenHeight",window.screen.height),O(k.metadata,"windowWidth",window.innerWidth),O(k.metadata,"windowHeight",window.innerHeight),O(k.metadata,"mapWidth",p.width/A),O(k.metadata,"mapHeight",p.height/A),O(k.metadata,"webglRenderer",p.renderer),O(k.metadata,"webglVendor",p.vendor),O(k.metadata,"sdkVersion",xe),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(r);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(t,u,()=>{},c)}},Hn=nr.postPerformanceEvent.bind(nr),cn=new class extends Le{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(c,t,r,u){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const p=wt(o.e.API_URL+o.e.SESSION_PATH);p.params.push(`sku=${t||""}`),p.params.push(`access_token=${u||o.e.ACCESS_TOKEN||""}`);const _={url:oi(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(_,v=>{this.pendingRequest=null,r(v),this.saveEventData(),this.processRequests(u)})}getSessionAPI(c,t,r,u){this.skuToken=t,this.errorCb=u,o.e.SESSION_PATH&&o.e.API_URL&&(r||o.e.ACCESS_TOKEN?this.queueRequest({id:c,timestamp:Date.now()},r):this.errorCb(new Error(Vr)))}processRequests(c){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,u=>{u?this.errorCb(u):t&&(this.success[t]=!0)},c)}remove(){this.errorCb=null}},Bl=cn.getSessionAPI.bind(cn),Ao=new Set;function _o(c,t){t?Ao.add(c):Ao.delete(c)}class vr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,r){this._updatedSourceCaches[t]=r,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const r=t.scope;this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._updatedLayers[r].add(t.id),this.setDirty()}removeLayer(t){const r=t.scope;this._removedLayers[r]=this._removedLayers[r]||{},this._updatedLayers[r]=this._updatedLayers[r]||new Set,this._removedLayers[r][t.id]=t,this._updatedLayers[r].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const r in this._updatedLayers)t[r]=t[r]||{},t[r].updatedIds=Array.from(this._updatedLayers[r].values());for(const r in this._removedLayers)t[r]=t[r]||{},t[r].removedIds=Object.keys(this._removedLayers[r]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Fl(c){const{userImage:t}=c;return!!(t&&t.render&&t.render())&&(c.data.replace(new Uint8Array(t.data.buffer)),!0)}class Nl extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const r=this.atlasTexture.get(t);r&&(r.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,r){this.imageProviders.has(r)||this.imageProviders.set(r,new Map),this.imageProviders.get(r).set(t.id,t)}removeImageProvider(t,r){this.imageProviders.has(r)&&this.imageProviders.get(r).delete(t)}getPendingImageProviders(){const t=[];for(const r of this.imageProviders.values())for(const u of r.values())u.hasPendingRequests()&&t.push(u);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,r){if(this.loaded.get(r)!==t&&(this.loaded.set(r,t),t)){for(const{ids:u,callback:p}of this.requestors)this._notify(u,r,p);this.requestors=[]}}hasImage(t,r){return!!this.getImage(t,r)}getImage(t,r){return this.images.get(r).get(t.toString())}addImage(t,r,u){this._validate(t,u)&&this.images.get(r).set(t.toString(),u)}_validate(t,r){let u=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),u=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),u=!1),this._validateContent(r.content,r)||(this.fire(new o.z(new Error(`Image "${t.name}" has invalid "content" value`))),u=!1),u}_validateStretch(t,r){if(!t)return!0;let u=0;for(const p of t){if(p[0]<u||p[1]<p[0]||r<p[1])return!1;u=p[1]}return!0}_validateContent(t,r){return t?t.length!==4||!r.usvg&&(t[0]<0||r.data.width<t[0]||t[1]<0||r.data.height<t[1]||t[2]<0||r.data.width<t[2]||t[3]<0||r.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,r,u){const p=this.images.get(r).get(t.toString());u.version=p.version+1,this.images.get(r).set(t.toString(),u),this.updatedImages.get(r).add(t),this.removeFromImageRasterizerCache(t,r)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,r){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(t,r){const u=this.images.get(r),p=u.get(t.toString());u.delete(t.toString()),this.patterns.get(r).delete(t.toString()),this.removeFromImageRasterizerCache(t,r),p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(r=>o.I.from(r))}getImages(t,r,u){const p=[],_=[],v=this.imageProviders.get(r);for(const L of t){if(!L.iconsetId){p.push(L);continue}const k=v.get(L.iconsetId);k&&(this.getImage(L,r)?_.push(L):k.addPendingRequest(L))}if(p.length===0)return void this._notify(_,r,u);let w=!0;const A=!!this.loaded.get(r),D=this.images.get(r);if(!A)for(const L of p)D.has(L.toString())||(w=!1);A||w?this._notify(p,r,u):this.requestors.push({ids:p,scope:r,callback:u})}rasterizeImages(t,r){const u=new Map,{tasks:p,scope:_}=t;for(const[v,w]of p.entries()){const A=this.getImage(w.id,_);A&&u.set(v,{image:A,imageVariant:w})}this._rasterizeImages(_,u,r)}_rasterizeImages(t,r,u){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},u);else{const p=new Map;for(const[_,{image:v,imageVariant:w}]of r.entries())p.set(_,this.imageRasterizer.rasterize(w,v,t,0));u(void 0,p)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,r,u){const p=this.images.get(r),_=new Map;for(const v of t){if(!p.get(v.toString())){if(v.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:v.name}))}const w=p.get(v.toString());if(!w){o.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:w.usvg?null:w.data.clone(),pixelRatio:w.pixelRatio,sdf:w.sdf,usvg:w.usvg,version:w.version,stretchX:w.stretchX,stretchY:w.stretchY,content:w.content,hasRenderCallback:!!(w.userImage&&w.userImage.render)};w.usvg&&Object.assign(A,{width:w.icon.usvg_tree.width,height:w.icon.usvg_tree.height}),_.set(o.I.toString(v),A)}u(null,_)}getPixelSize(t){const{width:r,height:u}=this.atlasImage.get(t);return{width:r,height:u}}getPattern(t,r,u){const p=t.toString(),_=this.patterns.get(r),v=_.get(p),w=this.getImage(t,r);if(!w)return null;if(v){if(v.position.version===w.version)return v.position;v.position.version=w.version}else{if(w.usvg&&!w.data){const A=this.getPatternInFlightId(p,r);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const D=new o.B(t).scaleSelf(o.q.devicePixelRatio),L=new Map([[D.toString(),{image:w,imageVariant:D}]]);return this._rasterizeImages(r,L,(k,O)=>this.storePatternImage(D,r,w,u,O)),null}this.storePattern(t,r,w)}return this._updatePatternAtlas(r,u),_.get(p).position}getPatternInFlightId(t,r){return o.C(t,r)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,r,u,p,_){const v=t.toString(),w=_?_.get(v):void 0;w&&(u.data=w,this.storePattern(t.id,r,u),this._updatePatternAtlas(r,p),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),r)))}storePattern(t,r,u){const p={w:u.data.width+2*o.F,h:u.data.height+2*o.F,x:0,y:0},_=new o.G(p,u,o.F);this.patterns.get(r).set(t.toString(),{bin:p,position:_})}bind(t,r){const u=t.gl;let p=this.atlasTexture.get(r);p?this.dirty&&(p.update(this.atlasImage.get(r)),this.dirty=!1):(p=new o.T(t,this.atlasImage.get(r),u.RGBA8),this.atlasTexture.set(r,p)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const u=this.patterns.get(t),p=Array.from(u.values()).map(({bin:D})=>D),{w:_,h:v}=o.H(p),w=this.atlasImage.get(t);w.resize({width:_||1,height:v||1});const A=this.images.get(t);for(const[D,{bin:L,position:k}]of u.entries()){let O=k.padding;const N=L.x+O,Z=L.y+O,j=A.get(D).data,X=j.width,Y=j.height;O=O>1?O-1:O,o.r.copy(j,w,{x:0,y:0},{x:N,y:Z},{width:X,height:Y},r),o.r.copy(j,w,{x:0,y:Y-O},{x:N,y:Z-O},{width:X,height:O},r),o.r.copy(j,w,{x:0,y:0},{x:N,y:Z+Y},{width:X,height:O},r),o.r.copy(j,w,{x:X-O,y:0},{x:N-O,y:Z},{width:O,height:Y},r),o.r.copy(j,w,{x:0,y:0},{x:N+X,y:Z},{width:O,height:Y},r),o.r.copy(j,w,{x:X-O,y:Y-O},{x:N-O,y:Z-O},{width:O,height:O},r),o.r.copy(j,w,{x:0,y:Y-O},{x:N+X,y:Z-O},{width:O,height:O},r),o.r.copy(j,w,{x:0,y:0},{x:N+X,y:Z+Y},{width:O,height:O},r),o.r.copy(j,w,{x:X-O,y:0},{x:N-O,y:Z+Y},{width:O,height:O},r)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,r){const u=this.images.get(r);for(const p of t){if(this.callbackDispatchedThisFrame.get(r).has(p.toString()))continue;this.callbackDispatchedThisFrame.get(r).add(p.toString());const _=u.get(p.toString());Fl(_)&&this.updateImage(p,r,_)}}}function Ls(c){const t=c.key,r=c.value,u=c.valueSpec||{},p=c.objectElementValidators||{},_=c.style,v=c.styleSpec;let w=[];const A=o.J(r);if(A!=="object")return[new o.V(t,r,`object expected, ${A} found`)];for(const D in r){const L=D.split(".")[0];let k;p[L]?k=p[L]:u[L]?k=qn:p["*"]?k=p["*"]:u["*"]&&(k=qn),k?w=w.concat(k({key:(t&&`${t}.`)+D,value:r[D],valueSpec:u[L]||u["*"],style:_,styleSpec:v,object:r,objectKey:D},r)):w.push(new o.K(t,r[D],`unknown property "${D}"`))}for(const D in u)p[D]||u[D].required&&u[D].default===void 0&&r[D]===void 0&&w.push(new o.V(t,r,`missing required property "${D}"`));return w}function Ps(c){const t=c.value,r=c.valueSpec,u=c.style,p=c.styleSpec,_=c.key,v=c.arrayElementValidator||qn;if(o.J(t)!=="array")return[new o.V(_,t,`array expected, ${o.J(t)} found`)];if(r.length&&t.length!==r.length)return[new o.V(_,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new o.V(_,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let w={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};p.$version<7&&(w.function=r.function),o.J(r.value)==="object"&&(w=r.value);let A=[];for(let D=0;D<t.length;D++)A=A.concat(v({array:t,arrayIndex:D,value:t[D],valueSpec:w,style:u,styleSpec:p,key:`${_}[${D}]`},!0));return A}function bh(c){const t=c.key,r=c.value,u=c.valueSpec;let p=o.J(r);if(p==="number"&&r!=r&&(p="NaN"),p!=="number")return[new o.V(t,r,`number expected, ${p} found`)];if("minimum"in u){let _=u.minimum;if(o.J(u.minimum)==="array"&&(_=u.minimum[c.arrayIndex]),r<_)return[new o.V(t,r,`${r} is less than the minimum value ${_}`)]}if("maximum"in u){let _=u.maximum;if(o.J(u.maximum)==="array"&&(_=u.maximum[c.arrayIndex]),r>_)return[new o.V(t,r,`${r} is greater than the maximum value ${_}`)]}return[]}function ys(c){const t=c.valueSpec,r=o.M(c.value.type);let u,p,_,v={};const w=r!=="categorical"&&c.value.property===void 0,A=!w,D=o.J(c.value.stops)==="array"&&o.J(c.value.stops[0])==="array"&&o.J(c.value.stops[0][0])==="object",L=Ls({key:c.key,value:c.value,valueSpec:c.styleSpec.function,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(N){if(r==="identity")return[new o.V(N.key,N.value,'identity function may not have a "stops" property')];let Z=[];const j=N.value;return Z=Z.concat(Ps({key:N.key,value:j,valueSpec:N.valueSpec,style:N.style,styleSpec:N.styleSpec,arrayElementValidator:k})),o.J(j)==="array"&&j.length===0&&Z.push(new o.V(N.key,j,"array must have at least one stop")),Z},default:function(N){return qn({key:N.key,value:N.value,valueSpec:t,style:N.style,styleSpec:N.styleSpec})}}});return r==="identity"&&w&&L.push(new o.V(c.key,c.value,'missing required property "property"')),r==="identity"||c.value.stops||L.push(new o.V(c.key,c.value,'missing required property "stops"')),r==="exponential"&&c.valueSpec.expression&&!o.N(c.valueSpec)&&L.push(new o.V(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(A&&!o.O(c.valueSpec)?L.push(new o.V(c.key,c.value,"property functions not supported")):w&&!o.Q(c.valueSpec)&&L.push(new o.V(c.key,c.value,"zoom functions not supported"))),r!=="categorical"&&!D||c.value.property!==void 0||L.push(new o.V(c.key,c.value,'"property" property is required')),L;function k(N){let Z=[];const j=N.value,X=N.key;if(o.J(j)!=="array")return[new o.V(X,j,`array expected, ${o.J(j)} found`)];if(j.length!==2)return[new o.V(X,j,`array length 2 expected, length ${j.length} found`)];if(D){if(o.J(j[0])!=="object")return[new o.V(X,j,`object expected, ${o.J(j[0])} found`)];if(j[0].zoom===void 0)return[new o.V(X,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new o.V(X,j,"object stop key must have value")];const Y=o.M(j[0].zoom);if(typeof Y!="number")return[new o.V(X,j[0].zoom,"stop zoom values must be numbers")];if(_&&_>Y)return[new o.V(X,j[0].zoom,"stop zoom values must appear in ascending order")];Y!==_&&(_=Y,p=void 0,v={}),Z=Z.concat(Ls({key:`${X}[0]`,value:j[0],valueSpec:{zoom:{}},style:N.style,styleSpec:N.styleSpec,objectElementValidators:{zoom:bh,value:O}}))}else Z=Z.concat(O({key:`${X}[0]`,value:j[0],style:N.style,styleSpec:N.styleSpec},j));return o.S(o.U(j[1]))?Z.concat([new o.V(`${X}[1]`,j[1],"expressions are not allowed in function stops.")]):Z.concat(qn({key:`${X}[1]`,value:j[1],valueSpec:t,style:N.style,styleSpec:N.styleSpec}))}function O(N,Z){const j=o.J(N.value),X=o.M(N.value),Y=N.value!==null?N.value:Z;if(u){if(j!==u)return[new o.V(N.key,Y,`${j} stop domain type must match previous stop domain type ${u}`)]}else u=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof X!="number"&&typeof X!="string"&&typeof X!="boolean")return[new o.V(N.key,Y,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&r!=="categorical"){let J=`number expected, ${j} found`;return o.O(t)&&r===void 0&&(J+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(N.key,Y,J)]}return r!=="categorical"||j!=="number"||typeof X=="number"&&isFinite(X)&&Math.floor(X)===X?r!=="categorical"&&j==="number"&&typeof X=="number"&&typeof p=="number"&&p!==void 0&&X<p?[new o.V(N.key,Y,"stop domain values must appear in ascending order")]:(p=X,r==="categorical"&&X in v?[new o.V(N.key,Y,"stop domain values must be unique")]:(v[X]=!0,[])):[new o.V(N.key,Y,`integer expected, found ${String(X)}`)]}}function Hs(c){const t=(c.expressionContext==="property"?o.W:o.X)(o.U(c.value),c.valueSpec);if(t.result==="error")return t.value.map(u=>new o.V(`${c.key}${u.key}`,c.value,u.message));const r=t.value.expression||t.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!r.outputDefined())return[new o.V(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!o.Y(r))return[new o.V(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter")return Jo(r,c);if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!o.Z(r,["zoom","feature-state"]))return[new o.V(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!o._(r))return[new o.V(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Jo(c,t){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const p of t.valueSpec.expression.parameters)r.delete(p);if(r.size===0)return[];const u=[];return c instanceof o.$&&r.has(c.name)?[new o.V(t.key,t.value,`["${c.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(c.eachChild(p=>{u.push(...Jo(p,t))}),u)}function Ul(c){const t=c.key,r=c.value,u=c.valueSpec,p=[];return Array.isArray(u.values)?u.values.indexOf(o.M(r))===-1&&p.push(new o.V(t,r,`expected one of [${u.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(u.values).indexOf(o.M(r))===-1&&p.push(new o.V(t,r,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(r)} found`)),p}function sl(c){return o.a1(o.U(c.value))?Hs(o.L({},c,{expressionContext:"filter",valueSpec:c.styleSpec[`filter_${c.layerType||"fill"}`]})):Os(c)}function Os(c){const t=c.value,r=c.key;if(o.J(t)!=="array")return[new o.V(r,t,`array expected, ${o.J(t)} found`)];const u=c.styleSpec;let p,_=[];if(t.length<1)return[new o.V(r,t,"filter array must have at least 1 element")];switch(_=_.concat(Ul({key:`${r}[0]`,value:t[0],valueSpec:u.filter_operator,style:c.style,styleSpec:c.styleSpec})),o.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.M(t[1])==="$type"&&_.push(new o.V(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&_.push(new o.V(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(p=o.J(t[1]),p!=="string"&&_.push(new o.V(`${r}[1]`,t[1],`string expected, ${p} found`)));for(let v=2;v<t.length;v++)p=o.J(t[v]),o.M(t[1])==="$type"?_=_.concat(Ul({key:`${r}[${v}]`,value:t[v],valueSpec:u.geometry_type,style:c.style,styleSpec:c.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new o.V(`${r}[${v}]`,t[v],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)_=_.concat(Os({key:`${r}[${v}]`,value:t[v],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":p=o.J(t[1]),t.length!==2?_.push(new o.V(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new o.V(`${r}[1]`,t[1],`string expected, ${p} found`))}return _}function yu(c,t){const r=c.key,u=c.style,p=c.layer,_=c.styleSpec,v=c.value,w=c.objectKey,A=_[`${t}_${c.layerType}`];if(!A)return[];const D=w.match(/^(.*)-use-theme$/);if(t==="paint"&&D&&A[D[1]])return o.S(v)?[].concat(qn({key:c.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w})):qn({key:r,value:v,valueSpec:{type:"string"},style:u,styleSpec:_});const L=w.match(/^(.*)-transition$/);if(t==="paint"&&L&&A[L[1]]&&A[L[1]].transition)return qn({key:r,value:v,valueSpec:_.transition,style:u,styleSpec:_});const k=c.valueSpec||A[w];if(!k)return[new o.K(r,v,`unknown property "${w}"`)];let O;if(o.J(v)==="string"&&o.O(k)&&!k.tokens&&(O=/^{([^}]+)}$/.exec(v))){const Z=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(r,v,`"${w}" does not support interpolation syntax
Use an identity property function instead: ${Z}.`)]}const N=[];if(c.layerType==="symbol")w!=="text-field"||!u||u.glyphs||u.imports||N.push(new o.V(r,v,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&o.a2(o.U(v))&&o.M(v.type)==="identity"&&N.push(new o.V(r,v,'"text-font" does not support identity functions'));else if(c.layerType==="model"&&t==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&o.O(k)&&(o.a3(k)||o.Q(k))){const Z=o.W(o.U(v),k),j=Z.value.expression||Z.value._styleExpression.expression;j&&!o.Z(j,["measure-light"])&&(w==="model-emissive-strength"&&o._(j)&&o.Y(j)||N.push(new o.V(r,v,`${w} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return N.concat(qn({key:c.key,value:v,valueSpec:k,style:u,styleSpec:_,expressionContext:"property",propertyType:t,propertyKey:w}))}function ba(c){return yu(c,"paint")}function Ar(c){return yu(c,"layout")}function Co(c){let t=[];const r=c.value,u=c.key,p=c.style,_=c.styleSpec;r.type||r.ref||t.push(new o.V(u,r,'either "type" or "ref" is required'));let v=o.M(r.type);const w=o.M(r.ref);if(r.id){const A=o.M(r.id);for(let D=0;D<c.arrayIndex;D++){const L=p.layers[D];o.M(L.id)===A&&t.push(new o.V(u,r.id,`duplicate layer id "${r.id}", previously used at line ${L.id.__line__}`))}}if("ref"in r){let A;["type","source","source-layer","filter","layout"].forEach(D=>{D in r&&t.push(new o.V(u,r[D],`"${D}" is prohibited for ref layers`))}),p.layers.forEach(D=>{o.M(D.id)===w&&(A=D)}),A?A.ref?t.push(new o.V(u,r.ref,"ref cannot reference another ref layer")):v=o.M(A.type):typeof w=="string"&&t.push(new o.V(u,r.ref,`ref layer "${w}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(r.source){const A=p.sources&&p.sources[r.source],D=A&&o.M(A.type);A?D==="vector"&&v==="raster"?t.push(new o.V(u,r.source,`layer "${r.id}" requires a raster source`)):D==="raster"&&v!=="raster"?t.push(new o.V(u,r.source,`layer "${r.id}" requires a vector source`)):D!=="vector"||r["source-layer"]?D==="raster-dem"&&v!=="hillshade"?t.push(new o.V(u,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):D!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&r.paint&&(r.paint["line-gradient"]||r.paint["line-trim-offset"])&&D==="geojson"&&!A.lineMetrics?t.push(new o.V(u,r,`layer "${r.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&D!=="raster-array"&&t.push(new o.V(u,r.source,`layer "${r.id}" requires a 'raster-array' source.`)):t.push(new o.V(u,r.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(u,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new o.V(u,r.source,`source "${r.source}" not found`))}else t.push(new o.V(u,r,'missing required property "source"'));return t=t.concat(Ls({key:u,value:r,valueSpec:_.layer,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{"*":()=>[],type:()=>qn({key:`${u}.type`,value:r.type,valueSpec:_.layer.type,style:c.style,styleSpec:c.styleSpec,object:r,objectKey:"type"}),filter:A=>sl(o.L({layerType:v},A)),layout:A=>Ls({layer:r,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":D=>Ar(o.L({layerType:v},D))}}),paint:A=>Ls({layer:r,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":D=>ba(o.L({layerType:v,layer:r},D))}})}})),t}function Xr(c){const t=c.value,r=c.key,u=o.J(t);return u!=="string"?[new o.V(r,t,`string expected, ${u} found`)]:[]}const vu={promoteId:function c({key:t,value:r}){if(o.J(r)==="string")return Xr({key:t,value:r});if(Array.isArray(r)){const u=[],p=o.U(r),_=o.X(p);return _.result==="error"&&_.value.forEach(v=>{u.push(new o.V(`${t}${v.key}`,null,`${v.message}`))}),o.Z(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||u.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),u}{const u=[];for(const p in r)u.push(...c({key:`${t}.${p}`,value:r[p]}));return u}}};function vs(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new o.V(r,t,'"type" is required')];const _=o.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(t.url||t.tiles||v.push(new o.K(r,t,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(Ls({key:r,value:t,valueSpec:u[`source_${_.replace("-","_")}`],style:c.style,styleSpec:u,objectElementValidators:vu})),v;case"geojson":if(v=Ls({key:r,value:t,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:vu}),t.cluster)for(const w in t.clusterProperties){const[A,D]=t.clusterProperties[w],L=typeof A=="string"?[A,["accumulated"],["get",w]]:A;v.push(...Hs({key:`${r}.${w}.map`,value:D,expressionContext:"cluster-map"})),v.push(...Hs({key:`${r}.${w}.reduce`,value:L,expressionContext:"cluster-reduce"}))}return v;case"video":return Ls({key:r,value:t,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Ls({key:r,value:t,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new o.V(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ul({key:`${r}.type`,value:t.type,valueSpec:{values:Io(u)}})}}function Io(c){return c.source.reduce((t,r)=>{const u=c[r];return u.type.type==="enum"&&(t=t.concat(Object.keys(u.type.values))),t},[])}function wa(c){const t=c.value,r=c.styleSpec,u=r.light,p=c.style;let _=[];const v=o.J(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new o.V("light",t,`object expected, ${v} found`)]),_;for(const w in t){const A=w.match(/^(.*)-transition$/),D=w.match(/^(.*)-use-theme$/);_=_.concat(D&&u[D[1]]?qn({key:w,value:t[w],valueSpec:{type:"string"},style:p,styleSpec:r}):A&&u[A[1]]&&u[A[1]].transition?qn({key:w,value:t[w],valueSpec:r.transition,style:p,styleSpec:r}):u[w]?qn({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:r}):[new o.V(w,t[w],`unknown property "${w}"`)])}return _}function ea(c){const t=c.value;let r=[];if(!t)return r;const u=o.J(t);if(u!=="object")return r=r.concat([new o.V("light-3d",t,`object expected, ${u} found`)]),r;const p=c.styleSpec,_=p["light-3d"],v=c.key,w=c.style,A=c.style.lights;for(const k of["type","id"])if(!(k in t))return r=r.concat([new o.V("light-3d",t,`missing property ${k} on light`)]),r;if(t.type&&A)for(let k=0;k<c.arrayIndex;k++){const O=o.M(t.type),N=A[k];o.M(N.type)===O&&r.push(new o.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${N.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in p))return r=r.concat([new o.V("light-3d",t,`Invalid light type ${t.type}`)]),r;const L=p[D];for(const k in t)if(k==="properties"){const O=t[k],N=o.J(O);if(N!=="object")return r=r.concat([new o.V("properties",O,`object expected, ${N} found`)]),r;for(const Z in O){const j=Z.match(/^(.*)-transition$/),X=Z.match(/^(.*)-use-theme$/);r=r.concat(X&&L[X[1]]?qn({key:k,value:O[Z],valueSpec:{type:"string"},style:w,styleSpec:p}):j&&L[j[1]]&&L[j[1]].transition?qn({key:k,value:t[k],valueSpec:p.transition,style:w,styleSpec:p}):L[Z]?qn({key:Z,value:O[Z],valueSpec:L[Z],style:w,styleSpec:p}):[new o.K(c.key,O[Z],`unknown property "${Z}"`)])}}else r=r.concat(_[k]?qn({key:k,value:t[k],valueSpec:_[k],style:w,styleSpec:p}):[new o.K(k,t[k],`unknown property "${k}"`)]);return r}function go(c){const t=c.value,r=c.key,u=c.style,p=c.styleSpec,_=p.terrain;let v=[];const w=o.J(t);if(t===void 0||w==="null")return v;if(w!=="object")return v=v.concat([new o.V("terrain",t,`object expected, ${w} found`)]),v;for(const A in t){const D=A.match(/^(.*)-transition$/),L=A.match(/^(.*)-use-theme$/);v=v.concat(L&&_[L[1]]?qn({key:A,value:t[A],valueSpec:{type:"string"},style:u,styleSpec:p}):D&&_[D[1]]&&_[D[1]].transition?qn({key:A,value:t[A],valueSpec:p.transition,style:u,styleSpec:p}):_[A]?qn({key:A,value:t[A],valueSpec:_[A],style:u,styleSpec:p}):[new o.K(A,t[A],`unknown property "${A}"`)])}if(t.source){const A=u.sources&&u.sources[t.source],D=A&&o.M(A.type);A?D!=="raster-dem"&&v.push(new o.V(r,t.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):v.push(new o.V(r,t.source,`source "${t.source}" not found`))}else v.push(new o.V(r,t,'terrain is missing required property "source"'));return v}function ta(c){const t=c.value,r=c.style,u=c.styleSpec,p=u.fog;let _=[];const v=o.J(t);if(t===void 0)return _;if(v!=="object")return _=_.concat([new o.V("fog",t,`object expected, ${v} found`)]),_;for(const w in t){const A=w.match(/^(.*)-transition$/),D=w.match(/^(.*)-use-theme$/);_=_.concat(D&&p[D[1]]?qn({key:w,value:t[w],valueSpec:{type:"string"},style:r,styleSpec:u}):A&&p[A[1]]&&p[A[1]].transition?qn({key:w,value:t[w],valueSpec:u.transition,style:r,styleSpec:u}):p[w]?qn({key:w,value:t[w],valueSpec:p[w],style:r,styleSpec:u}):[new o.K(w,t[w],`unknown property "${w}"`)])}return _}const Ta={"*":()=>[],array:Ps,boolean:function(c){const t=c.value,r=c.key,u=o.J(t);return u!=="boolean"?[new o.V(r,t,`boolean expected, ${u} found`)]:[]},number:bh,color:function(c){const t=c.key,r=c.value,u=o.J(r);return u!=="string"?[new o.V(t,r,`color expected, ${u} found`)]:o.a0.parseCSSColor(r)===null?[new o.V(t,r,`color expected, "${r}" found`)]:[]},enum:Ul,filter:sl,function:ys,layer:Co,object:Ls,source:vs,model:o.a4,light:wa,"light-3d":ea,terrain:go,fog:ta,string:Xr,formatted:function(c){return Xr(c).length===0?[]:Hs(c)},resolvedImage:function(c){return Xr(c).length===0?[]:Hs(c)},projection:function(c){const t=c.value,r=c.styleSpec,u=r.projection,p=c.style;let _=[];const v=o.J(t);if(v==="object")for(const w in t)_=_.concat(qn({key:w,value:t[w],valueSpec:u[w],style:p,styleSpec:r}));else v!=="string"&&(_=_.concat([new o.V("projection",t,`object or string expected, ${v} found`)]));return _},import:function(c){const{value:t,styleSpec:r}=c,{data:u,...p}=t;Object.defineProperty(p,"__line__",{value:t.__line__,enumerable:!1});let _=Ls(o.L({},c,{value:p,valueSpec:r.import}));return o.M(p.id)===""&&_.push(new o.V(`${c.key}.id`,p,"import id can't be an empty string")),u&&(_=_.concat(Tc(u,r,{key:`${c.key}.data`}))),_},iconset:function(c){const t=c.value,r=c.key,u=c.styleSpec,p=c.style;if(!t.type)return[new o.V(r,t,'"type" is required')];const _=o.M(t.type);let v=[];if(v=v.concat(Ls({key:r,value:t,valueSpec:u[`iconset_${_}`],style:p,styleSpec:u})),_==="source"&&t.source){const w=p.sources&&p.sources[t.source],A=w&&o.M(w.type);w?A!=="raster-array"&&v.push(new o.V(r,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):v.push(new o.V(r,t.source,`source "${t.source}" not found`))}return v}};function qn(c,t=!1){const r=c.value,u=c.valueSpec,p=c.styleSpec;if(u.expression&&o.a2(o.M(r)))return ys(c);if(u.expression&&o.S(o.U(r)))return Hs(c);if(u.type&&Ta[u.type]){const _=Ta[u.type](c);return t===!0&&_.length>0&&o.J(c.value)==="array"?Hs(c):_}return Ls(o.L({},c,{valueSpec:u.type?p[u.type]:u}))}function ol(c){const t=c.value,r=c.key,u=Xr(c);return u.length||(t.indexOf("{fontstack}")===-1&&u.push(new o.V(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&u.push(new o.V(r,t,'"glyphs" url must include a "{range}" token'))),u}function Tc(c,t=o.a5,r={}){return qn({key:r.key||"",value:c,valueSpec:t.$root,styleSpec:t,style:c,objectElementValidators:{glyphs:ol,"*":()=>[]}})}function ks(c,t=o.a5){return we(Tc(c,t))}const Sc=c=>we(vs(c)),Pd=c=>we(wa(c)),Vl=c=>we(ea(c)),Tt=c=>we(go(c)),ia=c=>we(ta(c)),wh=c=>we(function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.snow;let v=[];const w=o.J(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new o.V("snow",r,`object expected, ${w} found`)]),v;for(const A in r){const D=A.match(/^(.*)-transition$/);v=v.concat(D&&_[D[1]]&&_[D[1]].transition?qn({key:A,value:r[A],valueSpec:p.transition,style:u,styleSpec:p}):_[A]?qn({key:A,value:r[A],valueSpec:_[A],style:u,styleSpec:p}):[new o.K(A,r[A],`unknown property "${A}"`)])}return v}(c)),xu=c=>we(function(t){const r=t.value,u=t.style,p=t.styleSpec,_=p.rain;let v=[];const w=o.J(r);if(r===void 0)return v;if(w!=="object")return v=v.concat([new o.V("rain",r,`object expected, ${w} found`)]),v;for(const A in r){const D=A.match(/^(.*)-transition$/);v=v.concat(D&&_[D[1]]&&_[D[1]].transition?qn({key:A,value:r[A],valueSpec:p.transition,style:u,styleSpec:p}):_[A]?qn({key:A,value:r[A],valueSpec:_[A],style:u,styleSpec:p}):[new o.K(A,r[A],`unknown property "${A}"`)])}return v}(c)),en=c=>we(Co(c)),Be=c=>we(sl(c)),W=c=>we(ba(c)),K=c=>we(Ar(c)),le=c=>we(o.a4(c));function we(c){return c.slice().sort((t,r)=>t.line&&r.line?t.line-r.line:0)}function me(c,t){let r=!1;if(t&&t.length)for(const u of t)u instanceof o.K?o.w(u.message):(c.fire(new o.z(new Error(u.message))),r=!0);return r}let Ce;class Oe extends o.E{constructor(t,r="flat"){super(),this._transitionable=new o.a6(Ce||(Ce=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,r,u={}){this._validate(Pd,t,u)||(this._transitionable.setTransitionOrValue(t),this.id=r)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&me(this,t.call(ks,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let Ae=class extends o.E{constructor(c,t,r,u,p){super(),this.scope=r,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),r,u),this._transitionable.setTransitionOrValue(c,u),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=p}get(){return this._transitionable.serialize()}set(c,t){this._transitionable.setTransitionOrValue(c,t)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}getExaggeration(c){return this._transitioning.possiblyEvaluate(new o.aa(c,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const c=this._transitionable._values.exaggeration;if(!c)return null;const t=c.value.expression;if(!t)return null;let r=-1,u=-1,p=1;for(const _ of t.zoomStops)p=t.evaluate(new o.aa(_,{worldview:this.worldview})),p>.01?(r=_,u=-1):u=_;return p<.01&&r>0&&u>r?[r,u]:null}isZoomDependent(){const c=this._transitionable._values.exaggeration;return c!=null&&c.value!=null&&c.value.expression!=null&&c.value.expression instanceof o.ab}};const ke=45,Qe=65,Ne=.05;function xt(c,t,r,u){const p=o.af(ke,Qe,r),[_,v]=Ft(c,u);let w=1-Math.min(1,Math.exp((t-_)/(v-_)*-6));return w*=w*w,w=Math.min(1,1.00747*w),w*p*c.alpha}function Ft(c,t){const r=.5/Math.tan(.5*t);return[c.range[0]+r,c.range[1]+r]}function Rt(c,t,r,u,p){const _=o.ad([],[t,r,u],p.mercatorFogMatrix);return xt(c,o.ae(_),p.pitch,p._fov)}function ai(c,t,r,u,p,_,v){const w=[[r,u,0],[p,u,0],[p,_,0],[r,_,0]];let A=Number.MAX_VALUE,D=-Number.MAX_VALUE;for(const L of w){const k=o.ad([],L,t),O=o.ae(k);A=Math.min(A,O),D=Math.max(D,O)}return[xt(c,A,v.pitch,v._fov),xt(c,D,v.pitch,v._fov)]}class fi extends o.E{constructor(t,r,u,p){super();const _=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(_,u,new Map(p)),this.set(t,p),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new o.ag(_),this.scope=u}get state(){const t=this._transform,r=t.projection.name==="globe",u=o.ah(t.zoom),p=this.properties.get("range"),_=[.5,3];return{range:r?[o.ai(_[0],p[0],u),o.ai(_[1],p[1],u)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,r,u={}){if(this._validate(ia,t,u))return;const p=o.h({},t);for(const _ of Object.keys(o.a5.fog))p[_]===void 0&&(p[_]=o.a5.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,r)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(ke,Qe,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(u,p,_){const v=o.ac.fromLngLat(p),w=_.elevation?_.elevation.getAtPointOrZero(v):0;return Rt(u,v.x,v.y,w,_)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return ai(this.state,r,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(t,r,u,p,_){return this._transform.projection.supportsFog?ai(this.state,t,r,u,p,_,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ft(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const u of r){const p=t.points[u];let _;if(p[2]>=0)_=p;else{const v=t.points[u-4];_=o.ak(v,p,v[2]/(v[2]-p[2]))}if(Rt(this.state,_[0],_[1],0,this._transform)>=Ne)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,r,u){return(!u||u.validate!==!1)&&me(this,t.call(ks,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let ci,wi,vi,gn,Ln=class extends o.E{constructor(c,t,r,u){super();const p=ci||(ci=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=o.al(r[0]),p=-Math.max(o.al(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette"),w=this.properties.get("vignette-color");return w.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:w}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(wh,c,r))return;const u=o.h({},c);for(const p of Object.keys(o.a5.snow))u[p]===void 0&&(u[p]=o.a5.snow[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&me(this,c.call(ks,o.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},Nn=class extends o.E{constructor(c,t,r,u){super();const p=wi||(wi=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(p,r,new Map(u)),this.set(c,u),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(p),this.scope=r}get state(){const c=this.properties.get("opacity"),t=this.properties.get("color"),r=this.properties.get("direction"),u=o.al(r[0]),p=-Math.max(o.al(r[1]),.01),_=[Math.cos(u)*Math.cos(p),Math.sin(u)*Math.cos(p),Math.sin(p)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(t.r,t.g,t.b,t.a*c),direction:_,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(c,t,r={}){if(this._validate(xu,c,r))return;const u=o.h({},c);for(const p of Object.keys(o.a5.rain))u[p]===void 0&&(u[p]=o.a5.rain[p].default);this._options=u,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(c){this._transitionable.setTransitionOrValue(this._options,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,t,r){return(!r||r.validate!==!1)&&me(this,c.call(ks,o.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class tn extends o.E{constructor(t,r,u,p){super(),this.scope=u,this._options=t,this.properties=new o.ag(r),this._transitionable=new o.a6(r,u,new Map(p)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,r){this._options=t,this._transitionable.setTransitionOrValue(t.properties,r)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Xi{constructor(t,r,u,p){this.screenBounds=t,this.cameraPoint=r,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=u,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(t,r){let u,p;if(t instanceof o.P||typeof t[0]=="number"){const _=o.P.convert(t);u=[_],p=r.isPointAboveHorizon(_)}else{const _=o.P.convert(t[0]),v=o.P.convert(t[1]),w=_.add(v)._div(2);u=[_,v],p=o.ao(_,v).every(A=>r.isPointAboveHorizon(A))&&r.isPointAboveHorizon(w)}return new Xi(u,r.getCameraPoint(),p,r)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.ao(r,u,0,!1);return this.cameraPoint.y>u.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<u.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=u.x?p[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(p[3]=this.cameraPoint)),o.ap(p,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],u=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.ao(r,u,t),_=this.cameraPoint.clone();switch(3*((_.y>r.y)+(_.y>u.y))+((_.x>r.x)+(_.x>u.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(t,r,u,p=0){const _=t.queryPadding/r._pixelsPerMercatorPixel+1,v=u?this._bufferedCameraMercator(_,r):this._bufferedScreenMercator(_,r);let w=t.tileID.wrap+(v.unwrapped?p:0);const A=v.polygon.map(X=>o.aq(t.tileTransform,X,w));if(!o.ar(A,0,0,o.aj,o.aj))return;w=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const D=this.screenGeometryMercator.polygon.map(X=>o.as(t.tileTransform,X,w)),L=D.map(X=>new o.P(X[0],X[1])),k=r.getFreeCameraOptions().position||new o.ac(0,0,0),O=o.as(t.tileTransform,k,w),N=D.map(X=>{const Y=o.at(X,X,O);return o.au(Y,Y),new o.av(O,Y)}),Z=o.aw(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:N,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(j=o.ax(A),j.min.x=o.ay(j.min.x,0,o.aj),j.min.y=o.ay(j.min.y,0,o.aj),j.max.x=o.ay(j.max.x,0,o.aj),j.max.y=o.ay(j.max.y,0,o.aj),j),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:Z};var j}_bufferedScreenMercator(t,r){const u=Qn(t);if(this._screenRaycastCache[u])return this._screenRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),r):{polygon:this.bufferedScreenGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[u]=p,p}}_bufferedCameraMercator(t,r){const u=Qn(t);if(this._cameraRaycastCache[u])return this._cameraRaycastCache[u];{let p;return p=r.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),r):{polygon:this.bufferedCameraGeometry(t).map(_=>r.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[u]=p,p}}_projectAndResample(t,r){const u=function(_,v){const w=o.az([],v.pixelMatrix,v.globeMatrix),A=[0,-o.aB,0,1],D=[0,o.aB,0,1],L=[0,0,0,1];o.aA(A,A,w),o.aA(D,D,w),o.aA(L,L,w);const k=new o.P(A[0]/A[3],A[1]/A[3]),O=new o.P(D[0]/D[3],D[1]/D[3]),N=o.aC(_,k)&&A[3]<L[3],Z=o.aC(_,O)&&D[3]<L[3];if(!N&&!Z)return null;const j=function(de,he,_e){for(let be=1;be<de.length;be++){const De=Kn(he.pointCoordinate3D(de[be-1]).x),ze=Kn(he.pointCoordinate3D(de[be]).x);if(_e<0){if(De<ze)return{idx:be,t:-De/(ze-1-De)}}else if(ze<De)return{idx:be,t:(1-De)/(ze+1-De)}}return null}(_,v,N?-1:1);if(!j)return null;const{idx:X,t:Y}=j;let J=X>1?Mn(_.slice(0,X),v):[],oe=X<_.length?Mn(_.slice(X),v):[];J=J.map(de=>new o.P(Kn(de.x),de.y)),oe=oe.map(de=>new o.P(Kn(de.x),de.y));const ce=[...J];ce.length===0&&ce.push(oe[oe.length-1]);const ye=o.ai(ce[ce.length-1].y,(oe.length===0?J[0]:oe[0]).y,Y);let fe;return fe=N?[new o.P(0,ye),new o.P(0,0),new o.P(1,0),new o.P(1,ye)]:[new o.P(1,ye),new o.P(1,1),new o.P(0,1),new o.P(0,ye)],ce.push(...fe),oe.length===0?ce.push(J[0]):ce.push(...oe),{polygon:ce.map(de=>new o.ac(de.x,de.y)),unwrapped:!1}}(t,r);if(u)return u;const p=function(_,v){let w=!1,A=-1/0,D=0;for(let k=0;k<_.length-1;k++)_[k].x>A&&(A=_[k].x,D=k);for(let k=0;k<_.length-1;k++){const O=(D+k)%(_.length-1),N=_[O],Z=_[O+1];Math.abs(N.x-Z.x)>.5&&(N.x<Z.x?(N.x+=1,O===0&&(_[_.length-1].x+=1)):(Z.x+=1,O+1===_.length-1&&(_[0].x+=1)),w=!0)}const L=o.aD(v.center.lng);return w&&L<Math.abs(L-1)&&_.forEach(k=>{k.x-=1}),{polygon:_,unwrapped:w}}(Mn(t,r).map(_=>new o.P(Kn(_.x),_.y)),r);return{polygon:p.polygon.map(_=>new o.ac(_.x,_.y)),unwrapped:p.unwrapped}}}function Mn(c,t){return o.aE(c,r=>{const u=t.pointCoordinate3D(r);r.x=u.x,r.y=u.y},1/256)}function Kn(c){return c<0?1+c%1:c%1}function Qn(c){return 100*c|0}function Ir(c,t,r,u,p){const _=function(w,A){if(w)return p(w);if(A){if(c.url&&A.tiles&&c.tiles&&delete c.tiles,A.variants){if(!Array.isArray(A.variants))return p(new Error("variants must be an array"));for(const L of A.variants){if(L==null||typeof L!="object"||L.constructor!==Object)return p(new Error("variant must be an object"));if(!Array.isArray(L.capabilities))return p(new Error("capabilities must be an array"));if(L.capabilities.length===1&&L.capabilities[0]==="meshopt"){A=o.h(A,L);break}}}const D=o.aF(o.h({},A,c),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);D.tiles=t.canonicalizeTileset(D,c.url),p(null,D)}},v=function(w,A,D){if(!w)return null;if(!A&&!D)return w;D=D||w.worldview_default;const L=Object.values(w.language||{});if(L.length===0)return null;const k=Object.values(w.worldview||{});if(k.length===0)return null;const O=L.every(Z=>Z===A),N=k.every(Z=>Z===D);return O&&N?w:A in(w.language_options||{})||D in(w.worldview_options||{})?null:w.language_options&&w.worldview_options?w:null}(c.data,r,u);return v?o.q.frame(()=>_(null,v)):c.url?o.n(t.transformRequest(t.normalizeSourceURL(c.url,null,r,u),o.R.Source),_):o.q.frame(()=>{const{data:w,...A}=c;_(null,A)})}function xs(c,t){const r=Math.pow(2,t.z),u=Math.floor(o.aD(c.getWest())*r),p=Math.floor(o.aH(c.getNorth())*r),_=Math.ceil(o.aD(c.getEast())*r),v=Math.ceil(o.aH(c.getSouth())*r);return t.x>=u&&t.x<_&&t.y>=p&&t.y<v}class rs{constructor(t,r,u){this.bounds=t?o.aG.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=u||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(o.aG.convert(this.validateBounds(r)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!xs(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const r of this.extraBounds)if(xs(r,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const r=new rs(t.bounds,t.minzoom,t.maxzoom);return r.addExtraBounds(t.extra_bounds),r}}class Th extends o.E{constructor(t,r,u,p){if(super(),this.id=t,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(r,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.aI}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,u=this.map.getWorldview();this._tileJSONRequest=Ir(this._options,this.map._requestManager,r,u,(p,_)=>{if(this._tileJSONRequest=null,this._loaded=!0,p)r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),u&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new o.z(p));else if(_){if(o.h(this,_),this.hasWorldviews=!!_.worldview_options,_.worldview_default&&(this.worldviewDefault=_.worldview_default),_.vector_layers){this.vectorLayers=_.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of _.vector_layers)this.vectorLayerIds.push(v.id),_.worldview&&_.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=rs.fromTileJSON(_),hi(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(p)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(t,r){const u=t.tileID.canonical.url(this.tiles,this.scheme),p=this.map._requestManager.normalizeTileURL(u),_=this.map._requestManager.transformRequest(p,o.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,w=v?{image:v.image.clone()}:null,A={request:_,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:w,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(u)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=r:t.request=t.actor.send("reloadTile",A,D.bind(this));else if(t.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,D.bind(this),void 0,!0);else{const L=o.aJ.call({deduped:this._deduped},A,(k,O)=>{k||!O?D.call(this,k):(A.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,D.bind(this),void 0,!0))},!0);t.request={cancel:L}}function D(L,k){return delete t.request,t.aborted?r(null):L&&L.status!==404?r(L):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),o.aK(this.dispatcher),r(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Qr extends o.E{constructor(t,r,u,p){super(),this.id=t,this.dispatcher=u,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},r),o.h(this,o.aF(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=Ir(this._options,this.map._requestManager,null,r,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?this.fire(new o.z(u)):p&&(o.h(this,p),p.raster_layers&&(this.rasterLayers=p.raster_layers,this.rasterLayerIds=this.rasterLayers.map(_=>_.id)),this.tileBounds=rs.fromTileJSON(p),hi(p.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(u)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,r){const u=o.q.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),u,this.tileSize);t.request=o.o(this.map._requestManager.transformRequest(p,o.R.Tile),(_,v,w,A)=>(delete t.request,t.aborted?(t.state="unloaded",r(null)):_?(t.state="errored",r(_)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:w,expires:A}),t.setTexture(v,this.map.painter),t.state="loaded",o.aK(this.dispatcher),void r(null)):r(null)))}abortTile(t,r){t.request&&(t.request.cancel(),delete t.request),r&&r()}unloadTile(t,r){t.texture&&t.texture instanceof o.T?(t.destroy(!0),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ss extends Qr{constructor(t,r,u,p){super(t,r,u,p),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},r)}triggerRepaint(t){const r=this.map.painter._terrain,u=this.map.style.getSourceCache(this.id);r&&r.enabled&&u&&r._clearRenderCacheForTile(u.id,t.tileID),this.map.triggerRepaint()}loadTile(t,r){const u=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(u,o.R.Tile),_={request:p,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=p,t.actor||(t.actor=this.dispatcher.getActor());const v=(w,A,D,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(w)return w.name==="AbortError"?void 0:(t.state="errored",r(w));if(this.map._refreshExpiredTiles&&A&&t.setExpiryData({cacheControl:D,expires:L}),this.partial)t.state="empty";else{if(!A)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}r(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",_,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,r){const u=t.texture;u&&u instanceof o.T?(t.destroy(!0),this.map.painter.saveTileTexture(u)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,r,u){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(r,u,(p,_)=>{if(p)return t.state="errored",this.fire(new o.z(p)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexture(_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const r=this.rasterLayers.find(({id:_})=>_===t),u=r&&r.fields,p=u&&u.bands&&u.bands;return p?p[0]:0}getTextureDescriptor(t,r,u){if(!t)return;const p=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;r instanceof o.aN?_=r.paint.get("raster-array-band"):r instanceof o.aO&&(_=r.paint.get("raster-particle-array-band"));const v=_||this.getInitialBand(p);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(p,v)||u)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,p,v)}getImages(t,r){const u=new Map;for(const p of t)for(const _ of r){const[v,w]=_.split("/"),A=p.getLayer(v);if(!A||!A.hasBand(w)||!A.hasDataForBand(w))continue;const{bytes:D,tileSize:L,buffer:k}=A.getBandView(w),O=L+2*k,N={data:new o.r({width:O,height:O},D),pixelRatio:2,sdf:!1,usvg:!1,version:0};u.set(_,N)}return u}}const Sh={vector:Th,raster:Qr,"raster-dem":class extends Qr{constructor(c,t,r,u){super(c,t,r,u),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function u(p,_){p&&(c.state="errored",t(p)),_&&(c.dem=_,c.dem.onDeserialize(),c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0,c.state="loaded",t(null))}c.request=o.o(this.map._requestManager.transformRequest(r,o.R.Tile),(function(p,_,v,w){if(delete c.request,c.aborted)c.state="unloaded",t(null);else if(p)c.state="errored",t(p);else if(_){this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:v,expires:w});const A=ImageBitmap&&_ instanceof ImageBitmap&&o.t(),D=1-(_.width-o.aL(_.width))/2;D<1||c.neighboringTiles||(c.neighboringTiles=this._getNeighboringTiles(c.tileID));const L=A?_:o.q.getImageData(_,D),k={uid:c.uid,tileID:c.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:L,encoding:this.encoding,padding:D};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadTile",k,u.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(c){const t=c.canonical,r=Math.pow(2,t.z),u=(t.x-1+r)%r,p=t.x===0?c.wrap-1:c.wrap,_=(t.x+1+r)%r,v=t.x+1===r?c.wrap+1:c.wrap,w={};return w[new o.aM(c.overscaledZ,p,t.z,u,t.y).key]={backfilled:!1},w[new o.aM(c.overscaledZ,v,t.z,_,t.y).key]={backfilled:!1},t.y>0&&(w[new o.aM(c.overscaledZ,p,t.z,u,t.y-1).key]={backfilled:!1},w[new o.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},w[new o.aM(c.overscaledZ,v,t.z,_,t.y-1).key]={backfilled:!1}),t.y+1<r&&(w[new o.aM(c.overscaledZ,p,t.z,u,t.y+1).key]={backfilled:!1},w[new o.aM(c.overscaledZ,c.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},w[new o.aM(c.overscaledZ,v,t.z,_,t.y+1).key]={backfilled:!1}),w}},"raster-array":ss,geojson:class extends o.E{constructor(c,t,r,u){super(),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(u),this._data=t.data,this._options=o.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const p=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*p,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*p,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*p,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(c){this.map=c,this.setData(this._data)}setData(c){return this._data=c,this._updateWorkerData(),this}updateData(c){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof c!="string"&&(c.type==="Feature"&&(c={type:"FeatureCollection",features:[c]}),c.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof c!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const r of this._data.features)t.set(r.id,r);for(const r of c.features)t.set(r.id,r);this._data.features=[...t.values()]}else this._data=c;return this._updateWorkerData(!0),this}getClusterExpansionZoom(c,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterChildren(c,t){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id,scope:this.scope},t),this}getClusterLeaves(c,t,r,u){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:c,limit:t,offset:r},u),this}_updateWorkerData(c=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=o.h({append:c},this.workerOptions);t.scope=this.scope;const r=this._data;typeof r=="string"?(t.request=this.map._requestManager.transformRequest(o.q.resolveURL(r),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(u,p)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new o.z(u));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),c&&(this._partialReload=!0),this.fire(new o.A("data",_)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(c),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const c=o.C(this.id,this.scope);this.map.style.clearSource(c),this._updateWorkerData()}loadTile(c,t){const r=c.actor?"reloadTile":"loadTile";c.actor=this.actor;const u=this.map.style?this.map.style.getLut(this.scope):null,p=u?{image:u.image.clone()}:null,_=this._partialReload,v={type:this.type,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:p,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:_,worldview:this.map.getWorldview()};c.request=this.actor.send(r,v,(w,A)=>_&&!A?(c.state="loaded",t(null)):(delete c.request,c.destroy(),c.aborted?t(null):w?t(w):(c.loadVectorData(A,this.map.painter,r==="reloadTile"),t(null))),void 0,r==="loadTile")}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0}unloadTile(c,t){this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}onRemove(c){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(c,t,r,u){super(c,t,r,u),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const c=this.options;this.urls=[];for(const t of c.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aQ(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new o.z(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(c){if(this.video){const t=this.video.seekable;c<t.start(0)||c>t.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=c}}getVideo(){return this.video}onAdd(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const c=this.map.painter.context,t=c.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(c,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(c)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(c,t,r,u){super(),this.id=c,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const c=[];for(const t in this._options.models){const r=this._options.models[t],u=o.aS(this.map._requestManager.transformRequest(r.uri,o.R.Model).url).then(p=>{if(!p)return;const _=o.aT(p),v=new o.aU(t,r.position,r.orientation,_);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(p=>{this.fire(new o.z(new Error(`Could not load model ${t} from ${r.uri}: ${p.message}`)))});c.push(u)}Promise.allSettled(c).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(c){this.map=c,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(c,t){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(c,t,r,u){super(),this.type="batched-model",this.id=c,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(u)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(c){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,r=this.map.getWorldview();this._tileJSONRequest=Ir(this._options,this.map._requestManager,t,r,(u,p)=>{this._tileJSONRequest=null,this._loaded=!0,u?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),r&&r.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${r}`),this.fire(new o.z(u))):p&&(o.h(this,p),p.bounds&&(this.tileBounds=new rs(p.bounds,this.minzoom,this.maxzoom)),hi(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),c&&c(u)})}hasTransition(){return!1}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loaded(){return this._loaded}loadTile(c,t){const r=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(r,o.R.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(c.actor&&c.state!=="expired")if(c.state==="loading")c.reloadCallback=t;else{if(c.buckets){const _=Object.values(c.buckets);for(const v of _)v.dirty=!0;return void(c.state="loaded")}c.request=c.actor.send("reloadTile",u,p.bind(this))}else c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",u,p.bind(this),void 0,!0);function p(_,v){return c.aborted?t(null):_&&_.status!==404?t(_):(this.map._refreshExpiredTiles&&v&&c.setExpiryData(v),c.loadModelData(v,this.map.painter),c.state="loaded",void t(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(c,t,r,u){super(c,t,r,u),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new o.z(new o.V(`sources.${c}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${c}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${c}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${c}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${c}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()}onRemove(c){this.pause()}prepare(){let c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!c&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const c of[this.canvas.width,this.canvas.height])if(isNaN(c)||c<=0)return!0;return!1}},custom:class extends o.E{constructor(c,t,r,u){super(),this.id=c,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=t,this.setEventedParent(u),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new rs(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(c){this.map=c,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(c),this.load()}onRemove(c){this._implementation.onRemove&&this._implementation.onRemove(c)}hasTile(c){if(this._implementation.hasTile){const{x:t,y:r,z:u}=c.canonical;return this._implementation.hasTile({x:t,y:r,z:u})}return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,t){const{x:r,y:u,z:p}=c.tileID.canonical,_=new AbortController;c.request=Promise.resolve(this._implementation.loadTile({x:r,y:u,z:p},{signal:_.signal})).then((function(v){return delete c.request,c.aborted?(c.state="unloaded",t(null)):v===void 0?(c.state="errored",t(null)):v===null?(this.loadTileData(c,{width:this.tileSize,height:this.tileSize,data:null}),c.state="loaded",t(null)):function(w){return w instanceof ImageData||w instanceof HTMLCanvasElement||w instanceof ImageBitmap||w instanceof HTMLImageElement}(v)?(this.loadTileData(c,v),c.state="loaded",void t(null)):(c.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(c.state="errored",t(v))}),c.request.cancel=()=>_.abort()}loadTileData(c,t){c.setTexture(t,this.map.painter)}unloadTile(c,t){if(c.texture&&c.texture instanceof o.T?(c.destroy(!0),c.texture&&c.texture instanceof o.T&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),this._implementation.unloadTile){const{x:r,y:u,z:p}=c.tileID.canonical;this._implementation.unloadTile({x:r,y:u,z:p})}t&&t()}abortTile(c,t){c.request&&c.request.cancel&&(c.request.cancel(),delete c.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(c=>({x:c.canonical.x,y:c.canonical.y,z:c.canonical.z}))}_clearTiles(){const c=o.C(this.id,this.scope);this.map.style.clearSource(c)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},Eh=function(c,t,r,u){const p=new Sh[t.type](c,t,r,u);if(p.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${p.id}`);return o.aV(["load","abort","unload","serialize","prepare"],p),p};function jl(c,t,r=""){return`${r}:${t.id||""}:${t.layer.id}:${function(u){if("layerId"in u)return`layer:${u.layerId}`;{const{featuresetId:p,importId:_}=u;return`featureset:${p}${_?`:import:${_}`:""}`}}(c.target)}`}function Ah(c,t,r,u=""){if(c.uniqueFeatureID){const p=jl(c,t,u);if(r.has(p))return!0;r.add(p)}return!1}function Ec(c,t,r,u,p=!1){const _=t.sourceCache.transform,v=t.sourceCache.tilesIn(c,t.has3DLayers,p);v.sort(bu);const w=[];for(const A of v){const D=A.tile.queryRenderedFeatures(t,A,r,u,_,p);Object.keys(D).length&&w.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:D})}return w.length===0?{}:function(A){const D={},L={};for(const k of A){const O=k.queryResults,N=k.wrappedTileID,Z=L[N]=L[N]||{};for(const j in O){const X=O[j],Y=Z[j]=Z[j]||{},J=D[j]=D[j]||[];for(const oe of X)Y[oe.featureIndex]||(Y[oe.featureIndex]=!0,J.push(oe))}}return D}(w)}function Ac(c,t,r,u,p,_){const v={},w=u.queryRenderedSymbols(c),A=[];for(const D of Object.keys(w).map(Number))A.push(p[D]);A.sort(bu);for(const D of A){const L=D.featureIndex.lookupSymbolFeatures(w[D.bucketInstanceId],D.bucketIndex,D.sourceLayerIndex,t,r,_);for(const k in L){const O=v[k]=v[k]||[],N=L[k];N.sort((Z,j)=>{const X=D.featureSortOrder;if(X){const Y=X.indexOf(Z.featureIndex);return X.indexOf(j.featureIndex)-Y}return j.featureIndex-Z.featureIndex});for(const Z of N)O.push(Z)}}return v}function Bs(c,t){const r=c.getRenderableIds().map(_=>c.getTileByID(_)),u=[],p={};for(let _=0;_<r.length;_++){const v=r[_],w=v.tileID.canonical.key;p[w]||(p[w]=!0,v.querySourceFeatures(u,t))}return u}function bu(c,t){const r=c.tileID,u=t.tileID;return r.overscaledZ-u.overscaledZ||r.canonical.y-u.canonical.y||r.wrap-u.wrap||r.canonical.x-u.canonical.x}function Mo(c,t){const r={};if(!t)return r;for(const u of c){const p=u.layerIds.map(_=>t.getLayer(_)).filter(Boolean);if(p.length!==0){u.layers=p,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(_=>p.filter(v=>v.id===_)[0]));for(const _ of p)r[_.fqid]=u}}return r}const qs=32,bs=33,Sa=new Uint16Array(8184);for(let c=0;c<2046;c++){let t=c+2,r=0,u=0,p=0,_=0,v=0,w=0;for(1&t?p=_=v=qs:r=u=w=qs;(t>>=1)>1;){const D=r+p>>1,L=u+_>>1;1&t?(p=r,_=u,r=v,u=w):(r=p,u=_,p=v,_=w),v=D,w=L}const A=4*c;Sa[A+0]=r,Sa[A+1]=u,Sa[A+2]=p,Sa[A+3]=_}const Ro=new Uint16Array(2178),to=new Uint8Array(1089),Ch=new Uint16Array(1089);function na(c){return c===0?-.03125:c===32?.03125:0}const wu={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class al{constructor(t,r,u,p,_,v){this.tileID=t,this.uid=o.a$(),this.uses=0,this.tileSize=r,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection),this.worldview=v}registerFadeDuration(t){const r=t+this.timeAdded;r<o.q.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,u){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Mo(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.b1){if(this.hasSymbolBuckets=!0,!u)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.b1&&_.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],v=r.style.getOwnLayer(p);if(!v)continue;const w=v.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,w)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,r,u){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Mo(t.buckets,r.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(t)}const r=t.gl,u=this.imageAtlas;u&&!u.uploaded&&(this.imageAtlasTexture=new o.T(t,u.image,r.RGBA8,{useMipmap:!!u.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,r.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,r.R8),this.lineAtlas.uploaded=!0)}prepare(t,r,u){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,u),!r||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=r.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this.updateBuckets(r,this._lastUpdatedBrightness!==p),this._lastUpdatedBrightness=p))}queryRenderedFeatures(t,r,u,p,_,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const w=function(A,D){const L=o.bn([],[.5*A.width,.5*-A.height,1]);return o.bo(L,L,[1,-1,0]),o.az(L,L,A.calculateProjMatrix(D.toUnwrapped())),Float32Array.from(L)}(_,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:w,transform:p,availableImages:u,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,r){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),_=r?r.sourceLayer:"",v=p._geojsonTileLayer||p[_];if(!v)return;const w=o.b3(r&&r.filter),{z:A,x:D,y:L}=this.tileID.canonical,k={z:A,x:D,y:L};for(let O=0;O<v.length;O++){const N=v.feature(O);if(w.needGeometry){const X=o.b4(N,!0);if(!w.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),X,this.tileID.canonical))continue}else if(!w.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),N))continue;const Z=u.getId(N,_),j=new o.b5(N,A,D,L,Z);j.tile=k,t.push(j)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const u=o.b6(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(r)if(this.expirationTime<r)p=!0;else{const _=this.expirationTime-r;_?this.expirationTime=u+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,r){if(!this.latestFeatureIndex||!t.style)return;const u=this.latestFeatureIndex.loadVTLayers(),p=t.style.listImages(),_=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const w=this.buckets[v],A=w.layers[0],D=A.sourceLayer||"_geojsonTileLayer",L=u[D],k=t.style.getLayerSourceCache(A);let O={};k&&(O=k._state.getState(D,void 0));const N=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Z=Object.keys(O).length>0&&!r;Z&&!w.stateDependentLayers.length&&!r||w.update(O,L,p,N,Z?w.stateDependentLayers:w.layers,r,_),(w instanceof o.b7||w instanceof o.b8)&&t._terrain&&t._terrain.enabled&&k&&w.uploadPending()&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);const j=t&&t.style&&t.style.getOwnLayer(v);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.q.now()+t}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(u,t,p.RGBA8,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(t,r){const u={};for(const p of r)u[p]=!0;this.dependencies[t]=u}hasDependency(t,r){for(const u of t){const p=this.dependencies[u];if(p){for(const _ of r)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||r.name==="mercator"||this._tileDebugBuffer)return;const u=o.b9(wu,this.tileID.canonical,this.tileTransform)[0],p=new o.ba,_=new o.bb;for(let v=0;v<u.length;v++){const{x:w,y:A}=u[v];p.emplaceBack(w,A),_.emplaceBack(v)}_.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(_),this._tileDebugBuffer=t.createVertexBuffer(p,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||r.name==="mercator")return;const u=o.b9(wu,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const v=function(w,A){const D=o.aW(w,A),L=Math.pow(2,w.z);for(let X=0;X<bs;X++)for(let Y=0;Y<bs;Y++){const J=o.aX((w.x+(Y+na(Y))/qs)/L),oe=o.aY((w.y+(X+na(X))/qs)/L),ce=A.project(J,oe),ye=X*bs+Y;Ro[2*ye+0]=Math.round((ce.x*D.scale-D.x)*o.aj),Ro[2*ye+1]=Math.round((ce.y*D.scale-D.y)*o.aj)}to.fill(0),Ch.fill(0);for(let X=2045;X>=0;X--){const Y=4*X,J=Sa[Y+0],oe=Sa[Y+1],ce=Sa[Y+2],ye=Sa[Y+3],fe=J+ce>>1,de=oe+ye>>1,he=fe+de-oe,_e=de+J-fe,be=oe*bs+J,De=ye*bs+ce,ze=de*bs+fe,qe=Math.hypot((Ro[2*be+0]+Ro[2*De+0])/2-Ro[2*ze+0],(Ro[2*be+1]+Ro[2*De+1])/2-Ro[2*ze+1])>=16;to[ze]=to[ze]||(qe?1:0),X<1022&&(to[ze]=to[ze]||to[(oe+_e>>1)*bs+(J+he>>1)]||to[(ye+_e>>1)*bs+(ce+he>>1)])}const k=new o.aZ,O=new o.a_;let N=0;function Z(X,Y){const J=Y*bs+X;return Ch[J]===0&&(k.emplaceBack(Ro[2*J+0],Ro[2*J+1],X*o.aj/qs,Y*o.aj/qs),Ch[J]=++N),Ch[J]-1}function j(X,Y,J,oe,ce,ye){const fe=X+J>>1,de=Y+oe>>1;if(Math.abs(X-ce)+Math.abs(Y-ye)>1&&to[de*bs+fe])j(ce,ye,X,Y,fe,de),j(J,oe,ce,ye,fe,de);else{const he=Z(X,Y),_e=Z(J,oe),be=Z(ce,ye);O.emplaceBack(he,_e,be)}}return j(0,0,qs,qs,qs,0),j(qs,qs,0,0,0,qs),{vertices:k,indices:O}}(this.tileID.canonical,r);p=v.vertices,_=v.indices}else{p=new o.aZ,_=new o.a_;for(const{x:w,y:A}of u)p.emplaceBack(w,A,0,0);const v=o.be(p.int16.subarray(0,4*p.length),void 0,4);for(let w=0;w<v.length;w+=3)_.emplaceBack(v[w],v[w+1],v[w+2])}this._tileBoundsBuffer=t.createVertexBuffer(p,o.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(_),this._tileBoundsSegments=o.bd.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(t,r){const u=r.projection;if(!u||u.name!=="globe"||r.freezeTileCoverage)return;const p=this.tileID.canonical,_=o.bg(p,r),v=o.bh(_),w=o.ah(r.zoom);let A;w>0&&(A=o.bi(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,p,r,v,A,w),this._makeGlobeTileDebugTextBuffer(t,p,r,v,A,w)}_globePoint(t,r,u,p,_,v,w){let A=o.bj(t,r,u);if(v){const D=1<<u.z,L=o.aD(p.center.lng),k=o.aH(p.center.lat),O=(u.x+.5)/D-L;let N=0;O>.5?N=-1:O<-.5&&(N=1);let Z=(t/o.aj+u.x)/D+N,j=(r/o.aj+u.y)/D;Z=(Z-L)*p._pixelsPerMercatorPixel+L,j=(j-k)*p._pixelsPerMercatorPixel+k;const X=[Z*p.worldSize,j*p.worldSize,0];o.ad(X,X,v),A=o.bk(A,X,w)}return o.ad(A,A,_)}_makeGlobeTileDebugBorderBuffer(t,r,u,p,_,v){const w=new o.ba,A=new o.bb,D=new o.bl,L=(O,N,Z,j,X)=>{const Y=(Z-O)/(X-1),J=(j-N)/(X-1),oe=w.length;for(let ce=0;ce<X;ce++){const ye=O+ce*Y,fe=N+ce*J;w.emplaceBack(ye,fe);const de=this._globePoint(ye,fe,r,u,p,_,v);D.emplaceBack(de[0],de[1],de[2]),A.emplaceBack(oe+ce)}},k=o.aj;L(0,0,k,0,16),L(k,0,k,k,16),L(k,k,0,k,16),L(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(w,o.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(D,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,w.length,A.length)}_makeGlobeTileDebugTextBuffer(t,r,u,p,_,v){const w=o.aj/4,A=new o.ba,D=new o.a_,L=new o.bl,k=25;D.reserve(32),A.reserve(k),L.reserve(k);const O=(N,Z)=>k*N+Z;for(let N=0;N<k;N++){const Z=N*w;for(let j=0;j<k;j++){const X=j*w;A.emplaceBack(X,Z);const Y=this._globePoint(X,Z,r,u,p,_,v);L.emplaceBack(Y[0],Y[1],Y[2])}}for(let N=0;N<4;N++)for(let Z=0;Z<4;Z++){const j=O(N,Z),X=O(N,Z+1),Y=O(N+1,Z),J=O(N+1,Z+1);D.emplaceBack(j,X,Y),D.emplaceBack(Y,X,J)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(D),this._tileDebugTextBuffer=t.createVertexBuffer(A,o.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(L,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,k,32)}destroy(t=!1){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class Tu extends al{constructor(t,r,u,p,_){super(t,r,u,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,r){const u=r.context,p=u.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t,{premultiply:!1}):this.texture=new o.T(u,t,p.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,r){const u=this._mrt=new o.bp(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.br(p,(_,v,w,A)=>{if(_)r(_);else try{const D=u.getHeaderLength(v);if(D>t)return void(this.request=this.fetchHeader(D,r));u.parseHeader(v),this._isHeaderLoaded=!0;let L=0;for(const k of Object.values(u.layers))L=Math.max(L,k.dataIndex[k.dataIndex.length-1].lastByte);v.byteLength>=L&&(this.entireBuffer=v),r(null,this.entireBuffer||v,w,A)}catch(D){r(D)}}),this.request}fetchBand(t,r,u){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void u(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void u(new Error("Can't fetch tile band without an actor"));let v;const w=(k,O)=>{v.complete(k,O),k?u(k):(this.updateTextureDescriptor(t,r),u(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,O)=>{if(k)return u(k);const N=_.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:O,task:v},w,void 0,!0);this._workQueue.push(()=>{N&&N.cancel(),v.cancel()})},D=p.getLayer(t);if(!D)return void u(new Error(`Unknown sourceLayer "${t}"`));if(D.hasDataForBand(r))return this.updateTextureDescriptor(t,r),void u(null,this.textureDescriptor?this.textureDescriptor.img:null);const L=D.getDataRange([r]);if(v=p.createDecodingTask(L),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(L.firstByte,L.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${L.firstByte}-${L.lastByte}`}}),O=o.br(k,A);this._fetchQueue.push(()=>{O.cancel(),v.cancel()})}else u(null)}updateNeeded(t,r){return(!this.textureDescriptor||this.textureDescriptor.band!==r||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,r){if(!this._mrt)return;const u=this._mrt.getLayer(t);if(!u||!u.hasBand(r)||!u.hasDataForBand(r))return;const{bytes:p,tileSize:_,buffer:v,offset:w,scale:A}=u.getBandView(r),D=_+2*v,L=new o.r({width:D,height:D},p),k=this.texture;k&&k instanceof o.T&&k.update(L,{premultiply:!1}),this.textureDescriptor={layer:t,band:r,img:L,buffer:v,offset:w,tileSize:_,format:u.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class Gf{constructor(t,r){this.max=t,this.onRemove=r,this.reset()}reset(){for(const t in this.data)for(const r of this.data[t])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(t,r,u){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:r,timeout:void 0};if(u!==void 0&&(_.timeout=setTimeout(()=>{this.remove(t,_)},u)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const r=this.data[t].shift();return r.timeout&&clearTimeout(r.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),r.value}getByKey(t){const r=this.data[t];return r?r[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,r){if(!this.has(t))return this;const u=t.wrapped().key,p=r===void 0?0:this.data[u].indexOf(r),_=this.data[u][p];return this.data[u].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[u].length===0&&delete this.data[u],this.onRemove(_.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(t){const r=[];for(const u in this.data)for(const p of this.data[u])t(p.value)||r.push(p);for(const u of r)this.remove(u.value.tileID,u)}}class Su{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,r,u){const p=String(r);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},o.h(this.stateChanges[t][p],u),this.deletedStates[t]===null){this.deletedStates[t]={};for(const _ in this.state[t])_!==p&&(this.deletedStates[t][_]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const _ in this.state[t][p])u[_]||(this.deletedStates[t][p][_]=null)}else for(const _ in u)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][_]===null&&delete this.deletedStates[t][p][_]}removeFeatureState(t,r,u){if(this.deletedStates[t]===null)return;const p=String(r);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&r!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][u]=null);else if(r!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(u in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][u]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,r){const u=this.state[t]||{},p=this.stateChanges[t]||{},_=this.deletedStates[t];if(_===null)return{};if(r!==void 0){const w=String(r),A=o.h({},u[w],p[w]);if(_){const D=_[r];if(D===null)return{};for(const L in D)delete A[L]}return A}const v=o.h({},u,p);if(_)for(const w in _)delete v[w];return v}initializeTileState(t,r){t.refreshFeatureState(r)}coalesceChanges(t,r){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const v in this.stateChanges[p])this.state[p][v]||(this.state[p][v]={}),o.h(this.state[p][v],this.stateChanges[p][v]),_[v]=this.state[p][v];u[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const v in this.state[p])_[v]={},this.state[p][v]={};else for(const v in this.deletedStates[p]){if(this.deletedStates[p][v]===null)this.state[p][v]={};else if(this.state[p][v])for(const w of Object.keys(this.deletedStates[p][v]))delete this.state[p][v][w];_[v]=this.state[p][v]}u[p]=u[p]||{},o.h(u[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(const p in t)t[p].refreshFeatureState(r)}}class ws extends o.E{constructor(t,r,u){super(),this.id=t,this._onlySymbols=u,r.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Gf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=r.minTileCacheSize,this._maxTileCacheSize=r.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Su,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,r){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,r)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const u=this._tiles[r];u.upload(t),u.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(ll).map(t=>t.key)}getRenderableIds(t,r){const u=[];for(const p in this._tiles)this._isIdRenderable(+p,t,r)&&u.push(this._tiles[p]);return t?u.sort((p,_)=>{const v=p.tileID,w=_.tileID,A=new o.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),D=new o.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-w.overscaledZ||D.y-A.y||D.x-A.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(ll).map(p=>p.key)}hasRenderableParent(t){const r=this.findLoadedParent(t,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(t,r,u){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(r||!this._tiles[t].holdingForFade())&&(u||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,r){const u=this._tiles[t];u&&(u.state!=="loading"&&(u.state=r),this._loadTile(u,this._tileLoaded.bind(this,u,t,r)))}_tileLoaded(t,r,u,p){if(p)if(t.state="errored",p.status!==404)this._source.fire(new o.z(p,{tile:t}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=o.q.now(),u==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const r=this.getRenderableIds();for(let p=0;p<r.length;p++){const _=r[p];if(t.neighboringTiles&&t.neighboringTiles[_]){const v=this.getTileByID(_);u(t,v),u(v,t)}}function u(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let v=_.tileID.canonical.x-p.tileID.canonical.x;const w=_.tileID.canonical.y-p.tileID.canonical.y,A=Math.pow(2,p.tileID.canonical.z),D=_.tileID.key;v===0&&w===0||Math.abs(w)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,v,w),p.neighboringTiles&&p.neighboringTiles[D]&&(p.neighboringTiles[D].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,r,u,p){for(const _ in this._tiles){let v=this._tiles[_];if(p[_]||!v.hasData()||v.tileID.overscaledZ<=r||v.tileID.overscaledZ>u)continue;let w=v.tileID;for(;v&&v.tileID.overscaledZ>r+1;){const D=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[D.key],v&&v.hasData()&&(w=D)}let A=w;for(;A.overscaledZ>r;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){p[w.key]=w;break}}}findLoadedParent(t,r){if(t.key in this._loadedParentTiles){const u=this._loadedParentTiles[t.key];return u&&u.tileID.overscaledZ>=r?u:null}for(let u=t.overscaledZ-1;u>=r;u--){const p=t.scaledTo(u),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(t){const r=this._tiles[t.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,r){r=r||this._source.tileSize;const u=Math.ceil(t.width/r)+1,p=Math.ceil(t.height/r)+1,_=Math.floor(u*p*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(w)}handleWrapJump(t){const r=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,r){const u={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+r),u[_.tileID.key]=_}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(t,r,u,p,_){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;this.updateCacheSize(t,r),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let w,A=this._source.maxzoom;const D=this.map&&this.map.painter?this.map.painter._terrain:null;if(D&&D.sourceCache===this&&D.attenuationRange()){const O=D.attenuationRange()[0],N=Math.floor(O)-Math.log2(D.getDemUpscale());A>N&&(A=N)}if(this.used||this.usedForTerrain){if(this._source.tileID)w=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aM(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=t.clone();O.tileCoverLift=this.tileCoverLift,w=O.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(w.push(new o.aM(1,0,1,0,0)),w.push(new o.aM(1,0,1,1,0)),w.push(new o.aM(1,0,1,0,1)),w.push(new o.aM(1,0,1,1,1)))}else if(w=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);w=w.filter(N=>O(N))}}else w=[];if(w.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Ea(this._source.type)){const O=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!u}),N=Math.min(O,this._source.maxzoom);if(v){const Z=t.extendTileCover(w,N);for(const j of Z)w.push(j)}else if(_){const Z=t.extendTileCover(w,N,this.transform._camera.forward());for(const j of Z)w.push(j)}else if(this.castsShadows&&p){const Z=t.extendTileCover(w,N,p);for(const j of Z)this._shadowCasterTiles[j.key]=!0,w.push(j)}}const L=this._updateRetainedTiles(w);if(Ea(this._source.type)&&w.length!==0){const O={},N={},Z=Object.keys(L);for(const X of Z){const Y=L[X],J=this._tiles[X];if(!J||J.fadeEndTime&&J.fadeEndTime<=o.q.now())continue;const oe=this.findLoadedParent(Y,Math.max(Y.overscaledZ-ws.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),O[oe.tileID.key]=oe.tileID),N[X]=Y}const j=w[w.length-1].overscaledZ;for(const X in this._tiles){const Y=this._tiles[X];if(L[X]||!Y.hasData())continue;let J=Y.tileID;for(;J.overscaledZ>j;){J=J.scaledTo(J.overscaledZ-1);const oe=this._tiles[J.key];if(oe&&oe.hasData()&&N[J.key]){L[X]=Y.tileID;break}}}for(const X in O)L[X]||(this._coveredTiles[X]=!0,L[X]=O[X])}for(const O in L)this._tiles[O].clearFadeHold();const k=o.bs(this._tiles,L);for(const O of k){const N=this._tiles[O];N.hasSymbolBuckets&&!N.holdingForFade()?N.setHoldDuration(this.map._fadeDuration):N.hasSymbolBuckets&&!N.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const r={};if(t.length===0)return r;const u={},p=t.reduce((D,L)=>Math.min(D,L.overscaledZ),1/0),_=t[0].overscaledZ,v=Math.max(_-ws.maxOverzooming,this._source.minzoom),w=Math.max(_+ws.maxUnderzooming,this._source.minzoom),A={};for(const D of t){const L=this._addTile(D);r[D.key]=D,L.hasData()||p<this._source.maxzoom&&(A[D.key]=D)}this._retainLoadedChildren(A,p,w,r);for(const D of t){let L=this._tiles[D.key];if(L.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const O=D.children(this._source.maxzoom)[0],N=this.getTile(O);if(N&&N.hasData()){r[O.key]=O;continue}}else{const O=D.children(this._source.maxzoom);if(r[O[0].key]&&r[O[1].key]&&r[O[2].key]&&r[O[3].key])continue}let k=L.wasRequested();for(let O=D.overscaledZ-1;O>=v;--O){const N=D.scaledTo(O);if(u[N.key]||(u[N.key]=!0,L=this.getTile(N),!L&&k&&(L=this._addTile(N)),L&&(r[N.key]=N,k=L.wasRequested(),L.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const r=[];let u,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}r.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(_),u)break;p=_}for(const _ of r)this._loadedParentTiles[_]=u}}_addTile(t){let r=this._tiles[t.key];if(r)return r.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const u=!!r;if(!u){const p=this.map?this.map.painter:null,_=this._source.tileSize*t.overscaleFactor();r=this._source.type==="raster-array"?new Tu(t,_,this.transform.tileZoom,p,this._isRaster):new al(t,_,this.transform.tileZoom,p,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,u||this._source.fire(new o.A("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(t,r){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const u=r.getExpiryTimeout();u&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},u))}_removeTile(t){const r=this._tiles[t];r&&(r.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),r.uses>0||(r.hasData()&&r.state!=="reloading"||r.state==="empty"?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,u){const p=[],_=this.transform;if(!_)return p;const v=_.projection.name==="globe",w=o.aD(_.center.lng);for(const A in this._tiles){const D=this._tiles[A];if(u&&D.clearQueryDebugViz(),D.holdingForFade())continue;let L;if(v){const k=D.tileID.canonical;if(k.z===0){const O=[Math.abs(o.ay(w,...ra(k,-1))-w),Math.abs(o.ay(w,...ra(k,1))-w)];L=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.ay(w,...ra(k,-1))-w),Math.abs(o.ay(w,...ra(k,0))-w),Math.abs(o.ay(w,...ra(k,1))-w)];L=[O.indexOf(Math.min(...O))-1]}}else L=[0];for(const k of L){const O=t.containsTile(D,_,r,k);O&&p.push(O)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,r){const u=this.getRenderableIds(t,r).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of u)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return u}sortCoordinatesByDistance(t){const r=t.slice(),u=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const v of r){const w=1/(1<<v.canonical.z);_[v.key]=((v.canonical.x+.5)*w+v.wrap-u[0])*p[0]+((v.canonical.y+.5)*w-u[1])*p[1]-u[2]*p[2]}return r.sort((v,w)=>_[v.key]-_[w.key]),r}hasTransition(){if(this._source.hasTransition())return!0;if(Ea(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(r.fadeEndTime!==void 0&&r.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(t,r,u){this._state.updateState(t=t||"_geojsonTileLayer",r,u)}removeFeatureState(t,r,u){this._state.removeFeatureState(t=t||"_geojsonTileLayer",r,u)}getFeatureState(t,r){return this._state.getState(t=t||"_geojsonTileLayer",r)}setDependencies(t,r,u){const p=this._tiles[t];p&&p.setDependencies(r,u)}reloadTilesForDependencies(t,r){for(const u in this._tiles)this._tiles[u].hasDependency(t,r)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(t,r))}_preloadTiles(t,r){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,r))};return void this._source.on("data",A)}const u=new Map,p=Array.isArray(t)?t:[t],_=this.map.painter.terrain,v=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const A of p){const D=A.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of D)u.set(L.key,L);this.usedForTerrain&&A.updateElevation(!1)}const w=Array.from(u.values());o.bt(w,(A,D)=>{const L=new al(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(L,k=>{this._source.type==="raster-dem"&&L.dem&&this._backfillDEM(L),D(k,L)})},r)}}function ll(c,t){const r=Math.abs(2*c.wrap)-+(c.wrap<0),u=Math.abs(2*t.wrap)-+(t.wrap<0);return c.overscaledZ-t.overscaledZ||u-r||t.canonical.y-c.canonical.y||t.canonical.x-c.canonical.x}function Ea(c){return c==="raster"||c==="image"||c==="video"||c==="custom"}function ra(c,t){const r=1<<c.z;return[c.x/r+t,(c.x+1)/r+t]}ws.maxOverzooming=10,ws.maxUnderzooming=3;class Hf{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,r=!1;for(const u in this.style._mergedLayers){const p=this.style._mergedLayers[u];if(p.type==="fill-extrusion"||p.type==="building")this.layers.push({layer:p,visible:t,visibilityChanged:r});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:t,visibilityChanged:r})}}}onNewFrame(t){this.layersGotHidden=!1;for(const r of this.layers){const u=r.layer;let p=!1;u.type==="fill-extrusion"?p=!u.isHidden(t)&&u.paint.get("fill-extrusion-opacity")>0:u.type==="building"?p=!u.isHidden(t)&&u.paint.get("building-opacity")>0:u.type==="model"&&(p=!u.isHidden(t)&&u.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!p&&r.visible,r.visible=p}}updateZOffset(t,r){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,v=this.style.getLayerSourceCache(_);let w=1;_.type==="fill-extrusion"?w=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0:_.type==="building"&&(w=p.visible?_.paint.get("building-vertical-scale"):0);let A=v?v.getTile(r):null;if(!A&&v&&r.canonical.z>v.getSource().minzoom){let D=r.scaledTo(Math.min(v.getSource().maxzoom,r.overscaledZ-1));for(;D.overscaledZ>=v.getSource().minzoom&&(A=v.getTile(D),!A&&D.overscaledZ!==0);)D=D.scaledTo(D.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(_):null,tileID:A?A.tileID:r,verticalScale:w})}t.hasAnyZOffset=!1;let u=!1;for(let p=0;p<t.symbolInstances.length;p++){const _=t.symbolInstances.get(p),v=_.zOffset,w=this._getHeightAtTileOffset(r,_.tileAnchorX,_.tileAnchorY);_.zOffset=w!==Number.NEGATIVE_INFINITY?w:v,u||v===_.zOffset||(u=!0),t.hasAnyZOffset||_.zOffset===0||(t.hasAnyZOffset=!0)}u&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,u,p){let _=r,v=u;if(t.canonical.z!==p.canonical.z){const w=p.canonical,A=1/(1<<t.canonical.z-w.z);_=(r+t.canonical.x*o.aj)*A-w.x*o.aj|0,v=(u+t.canonical.y*o.aj)*A-w.y*o.aj|0}return{tileX:_,tileY:v}}_getHeightAtTileOffset(t,r,u){let p,_;for(let v=0;v<this.layers.length;++v){const w=this.layers[v].layer;if(w.type!=="fill-extrusion"&&w.type!=="building")continue;const{bucket:A,tileID:D,verticalScale:L}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:k,tileY:O}=this._mapCoordToOverlappingTile(t,r,u,D),N=A.getHeightAtTileCoord(k,O);N&&N.height!==void 0&&(N.hidden?p=N.height:_=Math.max(N.height*L,_||0))}if(_!==void 0)return _;for(let v=0;v<this.layers.length;++v){const w=this.layers[v];if(w.layer.type!=="model"||!w.visible)continue;const{bucket:A,tileID:D}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:L,tileY:k}=this._mapCoordToOverlappingTile(t,r,u,D),O=A.getHeightAtTileCoord(L,k);if(O&&!O.hidden)return O.height===void 0&&p!==void 0?Math.min(O.maxHeight,p)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Od(c,t){const r={};for(const u in c)u!=="ref"&&(r[u]=c[u]);return o.bu.forEach(u=>{u in t&&(r[u]=t[u])}),r}function Eu(c){c=c.slice();const t=Object.create(null);for(let r=0;r<c.length;r++)t[c[r].id]=c[r];for(let r=0;r<c.length;r++)"ref"in c[r]&&(c[r]=Od(c[r],t[c[r].ref]));return c}const ji={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Do(c,t,r){r.push({command:ji.addSource,args:[c,t[c]]})}function Gl(c,t,r){t.push({command:ji.removeSource,args:[c]}),r[c]=!0}function cl(c,t,r,u){Gl(c,r,u),Do(c,t,r)}function Hl(c,t,r){let u;for(u in c[r])if(c[r].hasOwnProperty(u)&&u!=="data"&&!o.bv(c[r][u],t[r][u]))return!1;for(u in t[r])if(t[r].hasOwnProperty(u)&&u!=="data"&&!o.bv(c[r][u],t[r][u]))return!1;return!0}function Cc(c,t,r,u,p,_){let v;for(v in t=t||{},c=c||{})c.hasOwnProperty(v)&&(o.bv(c[v],t[v])||r.push({command:_,args:[u,v,t[v],p]}));for(v in t)t.hasOwnProperty(v)&&!c.hasOwnProperty(v)&&(o.bv(c[v],t[v])||r.push({command:_,args:[u,v,t[v],p]}))}function Aa(c){return c.id}function ul(c,t){return c[t.id]=t,c}class Au{constructor(t,r){this.reset(t,r)}reset(t,r){this.points=t||[],this._distances=[0];for(let u=1;u<this.points.length;u++)this._distances[u]=this._distances[u-1]+this.points[u].dist(this.points[u-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(r||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.ay(t,0,1);let r=1,u=this._distances[r];const p=t*this.paddedLength+this.padding;for(;u<p&&r<this._distances.length;)u=this._distances[++r];const _=r-1,v=this._distances[_],w=u-v,A=w>0?(p-v)/w:0;return this.points[_].mult(1-A).add(this.points[r].mult(A))}}class Cu{constructor(t,r,u){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(t/u),this.yCellCount=Math.ceil(r/u);for(let v=0;v<this.xCellCount*this.yCellCount;v++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=r,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/r,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,r,u,p,_){this._forEachCell(r,u,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(r),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(t,r,u,p){this._forEachCell(r-p,u-p,r+p,u+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(r),this.circles.push(u),this.circles.push(p)}_insertBoxCell(t,r,u,p,_,v){this.boxCells[_].push(v)}_insertCircleCell(t,r,u,p,_,v){this.circleCells[_].push(v)}_query(t,r,u,p,_,v){if(u<0||t>this.width||p<0||r>this.height)return!_&&[];const w=[];if(t<=0&&r<=0&&this.width<=u&&this.height<=p){if(_)return!0;for(let A=0;A<this.boxKeys.length;A++)w.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const D=this.circles[3*A],L=this.circles[3*A+1],k=this.circles[3*A+2];w.push({key:this.circleKeys[A],x1:D-k,y1:L-k,x2:D+k,y2:L+k})}return v?w.filter(v):w}return this._forEachCell(t,r,u,p,this._queryCell,w,{hitTest:_,seenUids:{box:{},circle:{}}},v),_?w.length>0:w}_queryCircle(t,r,u,p,_){const v=t-u,w=t+u,A=r-u,D=r+u;if(w<0||v>this.width||D<0||A>this.height)return!p&&[];const L=[];return this._forEachCell(v,A,w,D,this._queryCellCircle,L,{hitTest:p,circle:{x:t,y:r,radius:u},seenUids:{box:{},circle:{}}},_),p?L.length>0:L}query(t,r,u,p,_){return this._query(t,r,u,p,!1,_)}hitTest(t,r,u,p,_){return this._query(t,r,u,p,!0,_)}hitTestCircle(t,r,u,p){return this._queryCircle(t,r,u,!0,p)}_queryCell(t,r,u,p,_,v,w,A){const D=w.seenUids,L=this.boxCells[_];if(L!==null){const O=this.bboxes;for(const N of L)if(!D.box[N]){D.box[N]=!0;const Z=4*N;if(t<=O[Z+2]&&r<=O[Z+3]&&u>=O[Z+0]&&p>=O[Z+1]&&(!A||A(this.boxKeys[N]))){if(w.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[N],x1:O[Z],y1:O[Z+1],x2:O[Z+2],y2:O[Z+3]})}}}const k=this.circleCells[_];if(k!==null){const O=this.circles;for(const N of k)if(!D.circle[N]){D.circle[N]=!0;const Z=3*N;if(this._circleAndRectCollide(O[Z],O[Z+1],O[Z+2],t,r,u,p)&&(!A||A(this.circleKeys[N]))){if(w.hitTest)return v.push(!0),!0;{const j=O[Z],X=O[Z+1],Y=O[Z+2];v.push({key:this.circleKeys[N],x1:j-Y,y1:X-Y,x2:j+Y,y2:X+Y})}}}}}_queryCellCircle(t,r,u,p,_,v,w,A){const D=w.circle,L=w.seenUids,k=this.boxCells[_];if(k!==null){const N=this.bboxes;for(const Z of k)if(!L.box[Z]){L.box[Z]=!0;const j=4*Z;if(this._circleAndRectCollide(D.x,D.y,D.radius,N[j+0],N[j+1],N[j+2],N[j+3])&&(!A||A(this.boxKeys[Z])))return v.push(!0),!0}}const O=this.circleCells[_];if(O!==null){const N=this.circles;for(const Z of O)if(!L.circle[Z]){L.circle[Z]=!0;const j=3*Z;if(this._circlesCollide(N[j],N[j+1],N[j+2],D.x,D.y,D.radius)&&(!A||A(this.circleKeys[Z])))return v.push(!0),!0}}}_forEachCell(t,r,u,p,_,v,w,A){const D=this._convertToXCellCoord(t),L=this._convertToYCellCoord(r),k=this._convertToXCellCoord(u),O=this._convertToYCellCoord(p);for(let N=D;N<=k;N++)for(let Z=L;Z<=O;Z++)if(_.call(this,t,r,u,p,this.xCellCount*Z+N,v,w,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,r,u,p,_,v){const w=p-t,A=_-r,D=u+v;return D*D>w*w+A*A}_circleAndRectCollide(t,r,u,p,_,v,w){const A=(v-p)/2,D=Math.abs(t-(p+A));if(D>A+u)return!1;const L=(w-_)/2,k=Math.abs(r-(_+L));if(k>L+u)return!1;if(D<=A||k<=L)return!0;const O=D-A,N=k-L;return O*O+N*N<=u*u}}const ql={unknown:0,flipRequired:1,flipNotRequired:2},Zs=Math.tan(85*Math.PI/180);function Xs(c,t,r,u,p,_,v){const w=o.bz();if(r)if(_.name==="globe"){const A=o.bA(p,t);o.az(w,w,A)}else{const A=o.bB([],v);w[0]=A[0],w[1]=A[1],w[4]=A[2],w[5]=A[3],u||o.by(w,w,p.angle)}else o.az(w,p.labelPlaneMatrix,c);return w}function Ic(c,t,r,u,p,_,v){const w=Xs(c,t,r,u,p,_,v);return _.name==="globe"&&r||(w[2]=w[6]=w[10]=w[14]=0),w}function Zl(c,t,r,u,p,_,v){if(r){if(_.name==="globe"){const w=Xs(c,t,r,u,p,_,v);return o.bi(w,w),o.az(w,c,w),w}{const w=o.bw(c),A=o.bx([]);return A[0]=v[0],A[1]=v[1],A[4]=v[2],A[5]=v[3],o.az(w,w,A),u||o.by(w,w,-p.angle),w}}return p.glCoordMatrix}function sa(c,t,r,u){const p=[c,t,r,1];r?o.aA(p,p,u):sn(p,p,u);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Mc(c,t){return Math.min(.5+c/t*.5,1.5)}function hl(c,t){const r=c[0]/c[3],u=c[1]/c[3];return r>=-t[0]&&r<=t[0]&&u>=-t[1]&&u<=t[1]}function Xl(c,t,r,u,p,_,v,w,A,D){const L=r.transform,k=u?c.textSizeData:c.iconSizeData,O=o.bH(k,r.transform.zoom),N=L.projection.name==="globe",Z=[256/r.width*2+1,256/r.height*2+1],j=u?c.text.dynamicLayoutVertexArray:c.icon.dynamicLayoutVertexArray;j.clear();let X=null;N&&(X=u?c.text.globeExtVertexArray:c.icon.globeExtVertexArray);const Y=c.lineVertexArray,J=u?c.text.placedSymbolArray:c.icon.placedSymbolArray,oe=r.transform.width/r.transform.height;let ce,ye=!1;for(let fe=0;fe<J.length;fe++){const de=J.get(fe),{numGlyphs:he,writingMode:_e}=de;if(_e!==o.bI.vertical||ye||ce===o.bI.horizontal||(ye=!0),ce=_e,(de.hidden||_e===o.bI.vertical)&&!ye){Dc(he,j);continue}ye=!1;const be=new o.P(de.tileAnchorX,de.tileAnchorY);let{x:De,y:ze,z:qe}=L.projection.projectTilePoint(be.x,be.y,D.canonical);if(A){const[Ot,zt,Dt]=A(be);De+=Ot,ze+=zt,qe+=Dt}const We=[De,ze,qe,1];if(o.aA(We,We,t),!hl(We,Z)){Dc(he,j);continue}const rt=We[3],Ie=Mc(r.transform.getCameraToCenterDistance(L.projection),rt),Ue=o.bJ(k,O,de),Ee=v?Ue/Ie:Ue*Ie,$e=sa(De,ze,qe,p);if($e[3]<=0){Dc(he,j);continue}let Fe={};const tt=o.al(c.layers[0].layout.get("text-max-angle")),gt=Math.cos(tt),Ye=v?null:A,ht=Rc(de,Ee,!1,w,t,p,_,c.glyphOffsetArray,Y,j,X,$e,be,Fe,oe,Ye,L.projection,D,v,gt);ye=ht.useVertical,Ye&&ht.needsFlipping&&(Fe={}),(ht.notEnoughRoom||ye||ht.needsFlipping&&Rc(de,Ee,!0,w,t,p,_,c.glyphOffsetArray,Y,j,X,$e,be,Fe,oe,Ye,L.projection,D,v,gt).notEnoughRoom)&&Dc(he,j)}u?(c.text.dynamicLayoutVertexBuffer.updateData(j),X&&c.text.globeExtVertexBuffer&&c.text.globeExtVertexBuffer.updateData(X)):(c.icon.dynamicLayoutVertexBuffer.updateData(j),X&&c.icon.globeExtVertexBuffer&&c.icon.globeExtVertexBuffer.updateData(X))}function Iu(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X){const{lineStartIndex:Y,glyphStartIndex:J,segment:oe}=w,ce=J+w.numGlyphs,ye=Y+w.lineLength,fe=t.getoffsetX(J),de=t.getoffsetX(ce-1),he=Wl(c*fe,r,u,p,_,v,oe,Y,ye,A,D,L,k,O,!0,N,Z,j,X);if(!he)return null;const _e=Wl(c*de,r,u,p,_,v,oe,Y,ye,A,D,L,k,O,!0,N,Z,j,X);return _e?{first:he,last:_e}:null}function Ih(c,t,r,u){return c===o.bI.horizontal&&Math.abs(u)>Math.abs(r)?{useVertical:!0}:c===o.bI.vertical?u>0?{needsFlipping:!0}:null:t!==ql.unknown&&function(p,_){return p===0||Math.abs(_/p)>Zs}(r,u)?t===ql.flipRequired?{needsFlipping:!0}:null:r<0?{needsFlipping:!0}:null}function Rc(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J,oe){const ce=t/24,ye=c.lineOffsetX*ce,fe=c.lineOffsetY*ce,{lineStartIndex:de,glyphStartIndex:he,numGlyphs:_e,segment:be,writingMode:De,flipState:ze}=c,qe=de+c.lineLength,We=rt=>{if(L){const[$e,Fe,tt]=rt.up,gt=D.length;o.bK(L,gt+0,$e,Fe,tt),o.bK(L,gt+1,$e,Fe,tt),o.bK(L,gt+2,$e,Fe,tt),o.bK(L,gt+3,$e,Fe,tt)}const[Ie,Ue,Ee]=rt.point;o.bL(D,Ie,Ue,Ee,rt.angle)};if(_e>1){const rt=Iu(ce,w,ye,fe,r,k,O,c,A,_,N,j,!1,X,Y,J,oe);if(!rt)return{notEnoughRoom:!0};if(u&&!r){let[Ie,Ue,Ee]=rt.first.point,[$e,Fe,tt]=rt.last.point;[Ie,Ue]=sa(Ie,Ue,Ee,v),[$e,Fe]=sa($e,Fe,tt,v);const gt=Ih(De,ze,($e-Ie)*Z,Fe-Ue);if(c.flipState=gt&&gt.needsFlipping?ql.flipRequired:ql.flipNotRequired,gt)return gt}We(rt.first);for(let Ie=he+1;Ie<he+_e-1;Ie++){const Ue=Wl(ce*w.getoffsetX(Ie),ye,fe,r,k,O,be,de,qe,A,_,N,j,!1,!1,X,Y,J,oe);if(!Ue)return D.length-=4*(Ie-he),{notEnoughRoom:!0};We(Ue)}We(rt.last)}else{if(u&&!r){const Ie=sa(O.x,O.y,0,p),Ue=de+be+1,Ee=new o.P(A.getx(Ue),A.gety(Ue)),$e=sa(Ee.x,Ee.y,0,p),Fe=$e[3]>0?$e:qf(O,Ee,Ie,1,p,void 0,X,Y.canonical),tt=Ih(De,ze,(Fe[0]-Ie[0])*Z,Fe[1]-Ie[1]);if(c.flipState=tt&&tt.needsFlipping?ql.flipRequired:ql.flipNotRequired,tt)return tt}const rt=Wl(ce*w.getoffsetX(he),ye,fe,r,k,O,be,de,qe,A,_,N,j,!1,!1,X,Y,J,oe);if(!rt)return{notEnoughRoom:!0};We(rt)}return{}}function io(c,t,r,u,p){const{x:_,y:v,z:w}=u.projectTilePoint(c.x,c.y,t);if(!p)return sa(_,v,w,r);const[A,D,L]=p(c);return sa(_+A,v+D,w+L,r)}function qf(c,t,r,u,p,_,v,w){const A=io(c.sub(t)._unit()._add(c),w,p,v,_);return o.at(A,r,A),o.au(A,A),o.bE(A,r,A,u)}function Wl(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J){const oe=u?c-t:c+t;let ce=oe>0?1:-1,ye=0;u&&(ce*=-1,ye=Math.PI),ce<0&&(ye+=Math.PI);let fe=w+v+(ce>0?0:1)|0,de=p,he=p,_e=0,be=0;const De=Math.abs(oe),ze=[],qe=[];let We=_,rt=We,Ie=o.bC([]);const Ue=()=>qf(rt,We,he,De-_e+1,L,O,j,X.canonical);for(;_e+be<=De;){if(fe+=ce,fe<w||fe>=A)return null;if(he=de,rt=We,ze.push(he),N&&qe.push(rt),We=new o.P(D.getx(fe),D.gety(fe)),de=k[fe],!de){const Dt=io(We,X.canonical,L,j,O);de=Dt[3]>0?k[fe]=Dt:Ue()}_e+=be;const Ot=o.at([],de,he),zt=o.bD(he,de);if(r&&zt>0&&be>0&&o.bG(Ie,Ot)/(be*zt)<J)return null;be=zt,Ie=Ot}Z&&O&&(k[fe]&&(de=Ue(),be=o.bD(he,de),Ie=o.at([],de,he)),k[fe]=de);const Ee=(De-_e)/be,$e=We.sub(rt)._mult(Ee)._add(rt),Fe=o.bE([],he,Ie,Ee);let tt=[0,0,1],gt=Ie[0],Ye=Ie[1];if(Y&&(tt=j.upVector(X.canonical,$e.x,$e.y),tt[0]!==0||tt[1]!==0||tt[2]!==1)){const Ot=[tt[2],0,-tt[0]],zt=o.bF([],tt,Ot);o.au(Ot,Ot),o.au(zt,zt),gt=o.bG(Ie,Ot),Ye=o.bG(Ie,zt)}if(r){const Ot=o.bF([],tt,Ie);o.au(Ot,Ot),o.bE(Fe,Fe,Ot,r*ce)}const ht=ye+Math.atan2(Ye,gt);return ze.push(Fe),N&&qe.push($e),{point:Fe,angle:ht,path:ze,tilePath:qe,up:tt}}function Dc(c,t){const r=t.length,u=r+4*c;t.resize(u),t.float32.fill(-1/0,4*r,4*u)}function sn(c,t,r){const u=t[0],p=t[1];return c[0]=r[0]*u+r[4]*p+r[12],c[1]=r[1]*u+r[5]*p+r[13],c[3]=r[3]*u+r[7]*p+r[15],c}const oa=100;class c_{constructor(t,r,u=new Cu(t.width+200,t.height+200,25),p=new Cu(t.width+200,t.height+200,25)){this.transform=t,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+oa,this.screenBottomBoundary=t.height+oa,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=r}placeCollisionBox(t,r,u,p,_,v,w,A){let D=u.projectedAnchorX,L=u.projectedAnchorY,k=u.projectedAnchorZ;const O=u.elevation,N=u.tileID,Z=t.getProjection();if(O&&N){const[fe,de,he]=Z.upVector(N.canonical,u.tileAnchorX,u.tileAnchorY),_e=Z.upVectorScale(N.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=fe*O*_e,L+=de*O*_e,k+=he*O*_e}const j=this.projectAndGetPerspectiveRatio(w,D,L,k,u.tileID,Z.name==="globe"||!!O||this.transform.pitch>0,Z),X=v*j.perspectiveRatio,Y=(u.x1*r+p.x-u.padding)*X+j.point.x,J=(u.y1*r+p.y-u.padding)*X+j.point.y,oe=(u.x2*r+p.x+u.padding)*X+j.point.x,ce=(u.y2*r+p.y+u.padding)*X+j.point.y,ye=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(Y,J,oe,ce)||!_&&this.grid.hitTest(Y,J,oe,ce,A)||ye?{box:[],offscreen:!1,occluded:j.occluded}:{box:[Y,J,oe,ce],offscreen:this.isOffscreen(Y,J,oe,ce),occluded:!1}}placeCollisionCircles(t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j){const X=[],Y=this.transform.elevation,J=t.getProjection(),oe=Y?Y.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,J):null,ce=new o.P(u.tileAnchorX,u.tileAnchorY);let{x:ye,y:fe,z:de}=J.projectTilePoint(ce.x,ce.y,j.canonical);if(oe){const[tt,gt,Ye]=oe(ce);ye+=tt,fe+=gt,de+=Ye}const he=J.name==="globe",_e=this.projectAndGetPerspectiveRatio(w,ye,fe,de,j,he||!!Y||this.transform.pitch>0,J),{perspectiveRatio:be}=_e,De=(k?v/be:v*be)/o.bO,ze=sa(ye,fe,de,A),qe=u.lineOffsetX*De,We=u.lineOffsetY*De,rt=o.al(t.layers[0].layout.get("text-max-angle")),Ie=Math.cos(rt),Ue=_e.signedDistanceFromCamera>0?Iu(De,_,qe,We,!1,ze,ce,u,p,A,{},Y&&!k?oe:null,k&&!!Y,J,j,k,Ie):null;let Ee=!1,$e=!1,Fe=!0;if(Ue&&!_e.occluded){const tt=.5*N*be+Z,gt=new o.P(-100,-100),Ye=new o.P(this.screenRightBoundary,this.screenBottomBoundary),ht=new Au,{first:Ot,last:zt}=Ue,Dt=Ot.path.length;let Ht=[];for(let qt=Dt-1;qt>=1;qt--)Ht.push(Ot.path[qt]);for(let qt=1;qt<zt.path.length;qt++)Ht.push(zt.path[qt]);const $t=2.5*tt;D&&(Ht=Ht.map(([qt,Xt,ui],Ti)=>(oe&&!he&&(ui=oe(Ti<Dt-1?Ot.tilePath[Dt-1-Ti]:zt.tilePath[Ti-Dt+2])[2]),sa(qt,Xt,ui,D))),Ht.some(qt=>qt[3]<=0)&&(Ht=[]));let Lt=[];if(Ht.length>0){let qt=1/0,Xt=-1/0,ui=1/0,Ti=-1/0;for(const Bi of Ht)qt=Math.min(qt,Bi[0]),ui=Math.min(ui,Bi[1]),Xt=Math.max(Xt,Bi[0]),Ti=Math.max(Ti,Bi[1]);Xt>=gt.x&&qt<=Ye.x&&Ti>=gt.y&&ui<=Ye.y&&(Lt=[Ht.map(Bi=>new o.P(Bi[0],Bi[1]))],(qt<gt.x||Xt>Ye.x||ui<gt.y||Ti>Ye.y)&&(Lt=o.bM(Lt,gt.x,gt.y,Ye.x,Ye.y)))}for(const qt of Lt){ht.reset(qt,.25*tt);let Xt=0;Xt=ht.length<=.5*tt?1:Math.ceil(ht.paddedLength/$t)+1;for(let ui=0;ui<Xt;ui++){const Ti=ui/Math.max(Xt-1,1),Bi=ht.lerp(Ti),Wi=Bi.x+oa,Zn=Bi.y+oa;X.push(Wi,Zn,tt,0);const gi=Wi-tt,mi=Zn-tt,ii=Wi+tt,an=Zn+tt;if(Fe=Fe&&this.isOffscreen(gi,mi,ii,an),$e=$e||this.isInsideGrid(gi,mi,ii,an),!r&&this.grid.hitTestCircle(Wi,Zn,tt,O)&&(Ee=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ee,occluded:!1}}}}return{circles:!L&&Ee||!$e?[]:X,offscreen:Fe,collisionDetected:Ee,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const r=[];let u=1/0,p=1/0,_=-1/0,v=-1/0;for(const L of t){const k=new o.P(L.x+oa,L.y+oa);u=Math.min(u,k.x),p=Math.min(p,k.y),_=Math.max(_,k.x),v=Math.max(v,k.y),r.push(k)}const w=this.grid.query(u,p,_,v).concat(this.ignoredGrid.query(u,p,_,v)),A={},D={};for(const L of w){const k=L.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const O=[new o.P(L.x1,L.y1),new o.P(L.x2,L.y1),new o.P(L.x2,L.y2),new o.P(L.x1,L.y2)];o.bN(r,O)&&(A[k.bucketInstanceId][k.featureIndex]=!0,D[k.bucketInstanceId]===void 0&&(D[k.bucketInstanceId]=[]),D[k.bucketInstanceId].push(k.featureIndex))}return D}insertCollisionBox(t,r,u,p,_){(r?this.ignoredGrid:this.grid).insert({bucketInstanceId:u,featureIndex:p,collisionGroupID:_},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,r,u,p,_){const v=r?this.ignoredGrid:this.grid,w={bucketInstanceId:u,featureIndex:p,collisionGroupID:_};for(let A=0;A<t.length;A+=4)v.insertCircle(w,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,r,u,p,_,v,w){const A=[r,u,p,1];let D=!1;p||this.transform.pitch>0?(o.aA(A,A,t),this.fogState&&_&&w.name!=="globe"&&(D=function(O,N,Z,j,X,Y){const J=Y.calculateFogTileMatrix(X),oe=[N,Z,j];return o.ad(oe,oe,J),xt(O,o.ae(oe),Y.pitch,Y._fov)}(this.fogState,r,u,p,_.toUnwrapped(),this.transform)>.9)):sn(A,A,t);const L=A[3];return{point:new o.P((A[0]/L+1)/2*this.transform.width+oa,(-A[1]/L+1)/2*this.transform.height+oa),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(w)/L*.5,1.5),signedDistanceFromCamera:L,occluded:v&&A[2]>L||D}}isOffscreen(t,r,u,p){return u<oa||t>=this.screenRightBoundary||p<oa||r>this.screenBottomBoundary}isInsideGrid(t,r,u,p){return u>=0&&t<this.gridRightBoundary&&p>=0&&r<this.gridBottomBoundary}getViewportMatrix(){const t=o.bx([]);return o.bo(t,t,[-100,-100,0]),t}}function Zf(c,t,r){const u=t.createTileMatrix(c,c.worldSize,r.toUnwrapped());return o.az(new Float32Array(16),c.projMatrix,u)}function ei(c,t,r){if(t.projection.name===r.projection.name)return c.projMatrix;const u=r.clone();return u.setProjection(t.projection),Zf(u,t.getProjection(),c)}function kd(c,t,r){return t.name===r.projection.name?c.projMatrix:Zf(r,t,c)}class Mh{constructor(t,r,u,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?r:-r))):p&&u?1:0,this.placed=u}isHidden(){return this.opacity===0&&!this.placed}}class zc{constructor(t,r,u,p,_,v=!1){this.text=new Mh(t?t.text:null,r,u,_),this.icon=new Mh(t?t.icon:null,r,p,_),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yo{constructor(t,r,u,p=!1){this.text=t,this.icon=r,this.skipFade=u,this.clipped=p}}class Rh{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class Mu{constructor(t,r,u,p,_){this.bucketInstanceId=t,this.featureIndex=r,this.sourceLayerIndex=u,this.bucketIndex=p,this.tileID=_}}class Wt{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const r=++this.maxGroupID;this.collisionGroups[t]={ID:r,predicate:u=>u.collisionGroupID===r}}return this.collisionGroups[t]}}function un(c,t,r,u,p){const{horizontalAlign:_,verticalAlign:v}=o.bT(c),w=-(_-.5)*t,A=-(v-.5)*r,D=o.bU(c,u);return new o.P(w+D[0]*p,A+D[1]*p)}function nn(c,t,r,u,p){const _=new o.P(c,t);return r&&_._rotate(u?p:-p),_}class no{constructor(t,r,u,p,_,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new c_(this.transform,_),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=r,this.retainedQueryData={},this.collisionGroups=new Wt(u),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,r,u,p,_=1){const v=u.getBucket(r),w=u.latestFeatureIndex;if(!v||!w||r.fqid!==v.layerIds[0])return;const A=v.layers[0].layout,D=v.layers[0].paint,L=u.collisionBoxArray,k=Math.pow(2,this.transform.zoom-u.tileID.overscaledZ),O=u.tileSize/o.aj,N=u.tileID.toUnwrapped();this.transform.setProjection(v.projection);const Z=(j=u.tileID,X=v.getProjection(),Y=this.transform,X.name===this.projection?Y.calculateProjMatrix(j.toUnwrapped()):Zf(Y,X,j));var j,X,Y;const J=A.get("text-pitch-alignment")==="map",oe=A.get("text-rotation-alignment")==="map";r.compileFilter(r.options);const ce=r.dynamicFilter(),ye=r.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(u),de=Ic(Z,u.tileID.canonical,J,oe,this.transform,v.getProjection(),fe);let he=null;if(J){const Ue=Zl(Z,u.tileID.canonical,J,oe,this.transform,v.getProjection(),fe);he=o.az([],this.transform.labelPlaneMatrix,Ue)}let _e=null;ce&&u.latestFeatureIndex&&(_e={unwrappedTileID:N,dynamicFilter:ce,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[v.bucketInstanceId]=new Mu(v.bucketInstanceId,w,v.sourceLayerIndex,v.index,u.tileID);const[be,De]=v.layers[0].layout.get("text-size-scale-range"),ze=o.ay(_,be,De),[qe,We]=A.get("icon-size-scale-range"),rt=o.ay(_,qe,We),Ie={bucket:v,layout:A,paint:D,posMatrix:Z,textLabelPlaneMatrix:de,labelToScreenMatrix:he,clippingData:_e,scale:k,textPixelRatio:O,holdingForFade:u.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:o.bH(v.textSizeData,this.transform.zoom,ze),partiallyEvaluatedIconSize:o.bH(v.iconSizeData,this.transform.zoom,rt),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:u.latestFeatureIndex};if(p)for(const Ue of v.sortKeyRanges){const{sortKey:Ee,symbolInstanceStart:$e,symbolInstanceEnd:Fe}=Ue;t.push({sortKey:Ee,symbolInstanceStart:$e,symbolInstanceEnd:Fe,parameters:Ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Ie})}attemptAnchorPlacement(t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J){const{textOffset0:oe,textOffset1:ce,crossTileID:ye}=O,fe=[oe,ce],de=un(t,u,p,fe,_),he=this.collisionIndex.placeCollisionBox(Z,_,r,nn(de.x,de.y,v,w,this.transform.angle),k,A,D,L.predicate);if(X){const _e=Z.getSymbolInstanceIconSize(J,this.transform.zoom,O.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Z,_e,X,nn(de.x,de.y,v,w,this.transform.angle),k,A,D,L.predicate).box.length===0)return}if(he.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(_e=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:fe,width:u,height:p,anchor:t,textScale:_,prevAnchor:_e},this.markUsedJustification(Z,t,O,j),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,j,O),this.placedOrientations[ye]=j),{shift:de,placedGlyphBoxes:he}}}placeLayerBucketPart(t,r,u,p,_=1){const{bucket:v,layout:w,paint:A,posMatrix:D,textLabelPlaneMatrix:L,labelToScreenMatrix:k,clippingData:O,textPixelRatio:N,holdingForFade:Z,collisionBoxArray:j,partiallyEvaluatedTextSize:X,partiallyEvaluatedIconSize:Y,collisionGroup:J,latestFeatureIndex:oe}=t.parameters,ce=w.get("text-optional"),ye=w.get("icon-optional"),fe=w.get("text-allow-overlap"),de=w.get("icon-allow-overlap"),he=w.get("text-rotation-alignment")==="map",_e=w.get("text-pitch-alignment")==="map",be=A.get("symbol-z-offset"),De=w.get("symbol-elevation-reference")==="sea",[ze,qe]=w.get("text-size-scale-range"),[We,rt]=w.get("icon-size-scale-range"),Ie=o.ay(_,ze,qe),Ue=o.ay(_,We,rt);this.transform.setProjection(v.projection);let Ee=fe&&(de||!v.hasIconData()||ye),$e=de&&(fe||!v.hasTextData()||ce);const Fe=!be.isConstant();!v.collisionArrays&&j&&v.deserializeCollisionBoxes(j),u&&p&&v.updateCollisionDebugBuffers(this.transform.zoom,j,Ie,Ue);const tt=(Ye,ht,Ot)=>{const{crossTileID:zt,numVerticalGlyphVertices:Dt}=Ye;let Ht=null;if(O&&O.dynamicFilterNeedsFeature||Fe){const yn=this.retainedQueryData[v.bucketInstanceId];Ht=oe.loadFeature({featureIndex:Ye.featureIndex,bucketIndex:yn.bucketIndex,sourceLayerIndex:yn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ht,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new o.P(Ye.tileAnchorX,Ye.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[zt]=new yo(!1,!1,!1,!0),void r.add(zt);const $t=be.evaluate(Ht,{});if(r.has(zt))return;if(Z)return void(this.placements[zt]=new yo(!1,!1,!1));let Lt=!1,qt=!1,Xt=!0,ui=!1,Ti=!1,Bi=null,Wi={box:null,offscreen:null,occluded:null},Zn={box:null},gi=null,mi=null,ii=null,an=0,dr=0,wn=0;Ot.textFeatureIndex?an=Ot.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(an=Ye.featureIndex),Ot.verticalTextFeatureIndex&&(dr=Ot.verticalTextFeatureIndex);const Pi=yn=>{yn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const Sn=this.transform.elevation;yn.elevation=De?$t:$t+(Sn?Sn.getAtTileOffset(yn.tileID,yn.tileAnchorX,yn.tileAnchorY):0),yn.elevation+=Ye.zOffset},On=Ot.textBox;if(On){Pi(On);const yn=Ki=>{let Rn=o.bI.horizontal;if(v.allowVerticalPlacement&&!Ki&&this.prevPlacement){const Xn=this.prevPlacement.placedOrientations[zt];Xn&&(this.placedOrientations[zt]=Xn,Rn=Xn,this.markUsedOrientation(v,Rn,Ye))}return Rn},Sn=(Ki,Rn)=>{if(v.allowVerticalPlacement&&Dt>0&&Ot.verticalTextBox){for(const Xn of v.writingModes)if(Xn===o.bI.vertical?(Wi=Rn(),Zn=Wi):Wi=Ki(),Wi&&Wi.box&&Wi.box.length)break}else Wi=Ki()};if(w.get("text-variable-anchor")){let Ki=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[zt]){const dn=this.prevPlacement.variableOffsets[zt];Ki.indexOf(dn.anchor)>0&&(Ki=Ki.filter(Hi=>Hi!==dn.anchor),Ki.unshift(dn.anchor))}const Rn=(dn,Hi,ls)=>{const Cs=v.getSymbolInstanceTextSize(X,Ye,this.transform.zoom,ht),Qs=(dn.x2-dn.x1)*Cs+2*dn.padding,qo=(dn.y2-dn.y1)*Cs+2*dn.padding,Us=Ye.hasIconTextFit&&!de?Hi:null;Us&&Pi(Us);let Is={box:[],offscreen:!1,occluded:!1};const es=fe?2*Ki.length:Ki.length;for(let Zo=0;Zo<es;++Zo){const ts=this.attemptAnchorPlacement(Ki[Zo%Ki.length],dn,Qs,qo,Cs,he,_e,N,D,J,Zo>=Ki.length,Ye,ht,v,ls,Us,X,Y);if(ts&&(Is=ts.placedGlyphBoxes,Is&&Is.box&&Is.box.length)){Lt=!0,Bi=ts.shift;break}}return Is};Sn(()=>Rn(On,Ot.iconBox,o.bI.horizontal),()=>{const dn=Ot.verticalTextBox;return dn&&Pi(dn),v.allowVerticalPlacement&&!(Wi&&Wi.box&&Wi.box.length)&&Dt>0&&dn?Rn(dn,Ot.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),Wi&&(Lt=Wi.box,Xt=Wi.offscreen,ui=Wi.occluded);const Xn=yn(!(!Wi||!Wi.box));if(!Lt&&this.prevPlacement){const dn=this.prevPlacement.variableOffsets[zt];dn&&(this.variableOffsets[zt]=dn,this.markUsedJustification(v,dn.anchor,Ye,Xn))}}else{const Ki=(Rn,Xn)=>{const dn=v.getSymbolInstanceTextSize(X,Ye,this.transform.zoom,ht,_),Hi=this.collisionIndex.placeCollisionBox(v,dn,Rn,new o.P(0,0),fe,N,D,J.predicate);return Hi&&Hi.box&&Hi.box.length&&(this.markUsedOrientation(v,Xn,Ye),this.placedOrientations[zt]=Xn),Hi};Sn(()=>Ki(On,o.bI.horizontal),()=>{const Rn=Ot.verticalTextBox;return v.allowVerticalPlacement&&Dt>0&&Rn?(Pi(Rn),Ki(Rn,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),yn(!!(Wi&&Wi.box&&Wi.box.length))}}if(gi=Wi,Lt=gi&&gi.box&&gi.box.length>0,Xt=gi&&gi.offscreen,ui=gi&&gi.occluded,Ye.useRuntimeCollisionCircles){const yn=v.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex>=0?Ye.centerJustifiedTextSymbolIndex:Ye.verticalPlacedTextSymbolIndex),Sn=o.bJ(v.textSizeData,X,yn),Ki=w.get("text-padding");mi=this.collisionIndex.placeCollisionCircles(v,fe,yn,v.lineVertexArray,v.glyphOffsetArray,Sn,D,L,k,u,_e,J.predicate,Ye.collisionCircleDiameter*Sn/o.bO,Ki,this.retainedQueryData[v.bucketInstanceId].tileID),Lt=fe||mi.circles.length>0&&!mi.collisionDetected,Xt=Xt&&mi.offscreen,ui=mi.occluded}if(Ot.iconFeatureIndex&&(wn=Ot.iconFeatureIndex),Ot.iconBox){const yn=Sn=>{Pi(Sn);const Ki=Ye.hasIconTextFit&&Bi?nn(Bi.x,Bi.y,he,_e,this.transform.angle):new o.P(0,0),Rn=v.getSymbolInstanceIconSize(Y,this.transform.zoom,Ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,Rn,Sn,Ki,de,N,D,J.predicate)};Zn&&Zn.box&&Zn.box.length&&Ot.verticalIconBox?(ii=yn(Ot.verticalIconBox),qt=ii.box.length>0):(ii=yn(Ot.iconBox),qt=ii.box.length>0),Xt=Xt&&ii.offscreen,Ti=ii.occluded}const Fi=ce||Ye.numHorizontalGlyphVertices===0&&Dt===0,Tn=ye||Ye.numIconVertices===0;if(Fi||Tn?Tn?Fi||(qt=qt&&Lt):Lt=qt&&Lt:qt=Lt=qt&&Lt,Lt&&gi&&gi.box&&this.collisionIndex.insertCollisionBox(gi.box,w.get("text-ignore-placement"),v.bucketInstanceId,Zn&&Zn.box&&dr?dr:an,J.ID),qt&&ii&&this.collisionIndex.insertCollisionBox(ii.box,w.get("icon-ignore-placement"),v.bucketInstanceId,wn,J.ID),mi&&(Lt&&this.collisionIndex.insertCollisionCircles(mi.circles,w.get("text-ignore-placement"),v.bucketInstanceId,an,J.ID),u)){const yn=v.bucketInstanceId;let Sn=this.collisionCircleArrays[yn];Sn===void 0&&(Sn=this.collisionCircleArrays[yn]=new Rh);for(let Ki=0;Ki<mi.circles.length;Ki+=4)Sn.circles.push(mi.circles[Ki+0]),Sn.circles.push(mi.circles[Ki+1]),Sn.circles.push(mi.circles[Ki+2]),Sn.circles.push(mi.collisionDetected?1:0)}const Cn=v.projection.name!=="globe";Ee=Ee&&(Cn||!ui),$e=$e&&(Cn||!Ti),this.placements[zt]=new yo(Lt||Ee,qt||$e,Xt||v.justReloaded),r.add(zt)},gt=this.retainedQueryData[v.bucketInstanceId].tileID;if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,gt),v.elevationType==="road"&&v.updateRoadElevation(gt.canonical),v.updateZOffset(),v.sortFeaturesByY){const Ye=v.getSortedSymbolIndexes(this.transform.angle);for(let ht=Ye.length-1;ht>=0;--ht){const Ot=Ye[ht];tt(v.symbolInstances.get(Ot),Ot,v.collisionArrays[Ot])}v.hasAnyZOffset&&o.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Ye=v.getSortedIndexesByZOffset();for(let ht=0;ht<Ye.length;++ht){const Ot=Ye[ht];tt(v.symbolInstances.get(Ot),Ot,v.collisionArrays[Ot])}}else for(let Ye=t.symbolInstanceStart;Ye<t.symbolInstanceEnd;Ye++)tt(v.symbolInstances.get(Ye),Ye,v.collisionArrays[Ye]);if(u&&v.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[v.bucketInstanceId];o.bi(Ye.invProjMatrix,D),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,r,u,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:w,verticalPlacedTextSymbolIndex:A,crossTileID:D}=u,L=o.bV(r),k=p===o.bI.vertical?A:L==="left"?_:L==="center"?v:L==="right"?w:-1;_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=k>=0&&_!==k?0:D),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=k>=0&&v!==k?0:D),w>=0&&(t.text.placedSymbolArray.get(w).crossTileID=k>=0&&w!==k?0:D),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:D)}markUsedOrientation(t,r,u){const p=r===o.bI.horizontal||r===o.bI.horizontalOnly?r:0,_=r===o.bI.vertical?r:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:w,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:D}=u,L=t.text.placedSymbolArray;v>=0&&(L.get(v).placedOrientation=p),w>=0&&(L.get(w).placedOrientation=p),A>=0&&(L.get(A).placedOrientation=p),D>=0&&(L.get(D).placedOrientation=_)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const r=this.prevPlacement;let u=!1;this.prevZoomAdjustment=r?r.zoomAdjustment(this.transform.zoom):0;const p=r?r.symbolFadeChange(t):1,_=r?r.opacities:{},v=r?r.variableOffsets:{},w=r?r.placedOrientations:{};for(const A in this.placements){const D=this.placements[A],L=_[A];L?(this.opacities[A]=new zc(L,p,D.text,D.icon,null,D.clipped),u=u||D.text!==L.text.placed||D.icon!==L.icon.placed):(this.opacities[A]=new zc(null,p,D.text,D.icon,D.skipFade,D.clipped),u=u||D.text||D.icon)}for(const A in _){const D=_[A];if(!this.opacities[A]){const L=new zc(D,p,!1,!1);L.isHidden()||(this.opacities[A]=L,u=u||D.text.placed||D.icon.placed)}}for(const A in v)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=v[A]);for(const A in w)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=w[A]);u?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=r?r.lastPlacementChangeTime:t)}updateLayerOpacities(t,r,u,p){const _=new Set;for(const v of r){const w=v.getBucket(t);w&&v.latestFeatureIndex&&t.fqid===w.layerIds[0]&&(this.updateBucketOpacities(w,_,v,v.collisionBoxArray,u,p,v.tileID,t.scope),w.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(w,v.tileID),w.elevationType==="road"&&w.updateRoadElevation(v.tileID.canonical),w.updateZOffset())}}updateBucketOpacities(t,r,u,p,_,v,w,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const D=t.layers[0].layout,L=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),O=new zc(null,0,!1,!1,!0),N=D.get("text-allow-overlap"),Z=D.get("icon-allow-overlap"),j=D.get("text-variable-anchor"),X=D.get("text-rotation-alignment")==="map",Y=D.get("text-pitch-alignment")==="map",J=L.get("symbol-z-offset"),oe=D.get("symbol-elevation-reference")==="sea",ce=!J.isConstant(),ye=new zc(null,0,N&&(Z||!t.hasIconData()||D.get("icon-optional")),Z&&(N||!t.hasTextData()||D.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const fe=(he,_e,be)=>{for(let De=0;De<_e/4;De++)he.opacityVertexArray.emplaceBack(be)};let de=0;v&&t.updateReplacement(w,v);for(let he=0;he<t.symbolInstances.length;he++){const _e=t.symbolInstances.get(he),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:De,crossTileID:ze,numIconVertices:qe,tileAnchorX:We,tileAnchorY:rt}=_e;let Ie=null;const Ue=this.retainedQueryData[t.bucketInstanceId];ce&&_e&&Ue&&(Ie=u.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:Ue.bucketIndex,sourceLayerIndex:Ue.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ee=J.evaluate(Ie,{}),$e=r.has(ze);let Fe=this.opacities[ze];$e?Fe=O:Fe||(Fe=ye,this.opacities[ze]=Fe),r.add(ze);const tt=be>0||De>0,gt=qe>0,Ye=this.placedOrientations[ze],ht=Ye===o.bI.vertical,Ot=Ye===o.bI.horizontal||Ye===o.bI.horizontalOnly;!tt&&!gt||Fe.isHidden()||de++;let zt=!1;if((tt||gt)&&v)for(const Dt of t.activeReplacements){if(o.bP(Dt,_,o.bQ.Symbol,A)||Dt.min.x>We||We>Dt.max.x||Dt.min.y>rt||rt>Dt.max.y)continue;const Ht=o.bR(We,rt,w.canonical,Dt.footprintTileId.canonical);if(zt=o.bS(Ht,Dt.footprint),zt)break}if(tt){const Dt=zt?zo:$l(Fe.text);fe(t.text,be,ht?zo:Dt),fe(t.text,De,Ot?zo:Dt);const Ht=Fe.text.isHidden(),{leftJustifiedTextSymbolIndex:$t,centerJustifiedTextSymbolIndex:Lt,rightJustifiedTextSymbolIndex:qt,verticalPlacedTextSymbolIndex:Xt}=_e,ui=t.text.placedSymbolArray,Ti=Ht||ht?1:0;$t>=0&&(ui.get($t).hidden=Ti),Lt>=0&&(ui.get(Lt).hidden=Ti),qt>=0&&(ui.get(qt).hidden=Ti),Xt>=0&&(ui.get(Xt).hidden=Ht||Ot?1:0);const Bi=this.variableOffsets[ze];Bi&&this.markUsedJustification(t,Bi.anchor,_e,Ye);const Wi=this.placedOrientations[ze];Wi&&(this.markUsedJustification(t,"left",_e,Wi),this.markUsedOrientation(t,Wi,_e))}if(gt){const Dt=zt?zo:$l(Fe.icon),{placedIconSymbolIndex:Ht,verticalPlacedIconSymbolIndex:$t}=_e,Lt=t.icon.placedSymbolArray,qt=Fe.icon.isHidden()?1:0;Ht>=0&&(fe(t.icon,qe,ht?zo:Dt),Lt.get(Ht).hidden=qt),$t>=0&&(fe(t.icon,_e.numVerticalIconVertices,Ot?zo:Dt),Lt.get($t).hidden=qt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Dt=t.collisionArrays[he];if(Dt){let Ht=new o.P(0,0),$t=!0;if(Dt.textBox||Dt.verticalTextBox){if(j){const qt=this.variableOffsets[ze];qt?(Ht=un(qt.anchor,qt.width,qt.height,qt.textOffset,qt.textScale),X&&Ht._rotate(Y?this.transform.angle:-this.transform.angle)):$t=!1}k&&($t=!Fe.clipped),Dt.textBox&&dl(t.textCollisionBox.collisionVertexArray,Fe.text.placed,!$t||ht,Ee,oe,Ht.x,Ht.y),Dt.verticalTextBox&&dl(t.textCollisionBox.collisionVertexArray,Fe.text.placed,!$t||Ot,Ee,oe,Ht.x,Ht.y)}const Lt=$t&&!!(!Ot&&Dt.verticalIconBox);Dt.iconBox&&dl(t.iconCollisionBox.collisionVertexArray,Fe.icon.placed,Lt,Ee,oe,_e.hasIconTextFit?Ht.x:0,_e.hasIconTextFit?Ht.y:0),Dt.verticalIconBox&&dl(t.iconCollisionBox.collisionVertexArray,Fe.icon.placed,!Lt,Ee,oe,_e.hasIconTextFit?Ht.x:0,_e.hasIconTextFit?Ht.y:0)}}}if(t.fullyClipped=de===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,r){const u=this.zoomAtLastRecencyCheck===r?1-this.zoomAdjustment(r):1;return this.zoomAtLastRecencyCheck=r,this.commitTime+this.fadeDuration*u>t}setStale(){this.stale=!0}}function dl(c,t,r,u,p,_,v){c.emplaceBack(t?1:0,r?1:0,_||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,v||0,u,p?1:0),c.emplaceBack(t?1:0,r?1:0,_||0,v||0,u,p?1:0)}const on=Math.pow(2,25),Bd=Math.pow(2,24),Dh=Math.pow(2,17),zh=Math.pow(2,16),Fs=Math.pow(2,9),Rr=Math.pow(2,8),u_=Math.pow(2,1);function $l(c){if(c.opacity===0&&!c.placed)return 0;if(c.opacity===1&&c.placed)return 4294967295;const t=c.placed?1:0,r=Math.floor(127*c.opacity);return r*on+t*Bd+r*Dh+t*zh+r*Fs+t*Rr+r*u_+t}const zo=0;class Lh{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,r,u,p,_,v){const w=this._bucketParts;for(;this._currentTileIndex<t.length;)if(r.getBucketParts(w,p,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((A,D)=>A.sortKey-D.sortKey));this._currentPartIndex<w.length;){const A=w[this._currentPartIndex];if(r.placeLayerBucketPart(A,this._seenCrossTileIDs,u,A.symbolInstanceStart===0,v),this._currentPartIndex++,_())return!0}return!1}}class Ph{constructor(t,r,u,p,_,v,w,A,D){this.placement=new no(t,_,v,w,A,D),this._currentPlacementIndex=r.length-1,this._forceFullPlacement=u,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(t,r,u,p,_){const v=o.q.now(),w=()=>{const A=o.q.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=r[t[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=D)&&(!A.maxzoom||A.maxzoom>D)){const L=A,k=L.layout.get("symbol-z-elevate"),O=L.layout.get("symbol-sort-key").constantOr(1)!==void 0,N=L.layout.get("symbol-z-order"),Z=N==="viewport-y"||N==="auto"&&!(N!=="viewport-y"&&O),j=L.layout.get("text-allow-overlap")||L.layout.get("icon-allow-overlap")||L.layout.get("text-ignore-placement")||L.layout.get("icon-ignore-placement"),X=Z&&j,Y=this._inProgressLayer=this._inProgressLayer||new Lh(L),J=o.C(A.source,A.scope);if(Y.continuePlacement(k||X?p[J]:u[J],this.placement,this._showCollisionBoxes,A,w,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ru=512/o.aj/2;class Oh{constructor(t,r,u){this.tileID=t,this.bucketInstanceId=u,this.index=new o.bW(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=t.canonical.x*o.aj,_=t.canonical.y*o.aj;for(let v=0;v<r.length;v++){const{key:w,crossTileID:A,tileAnchorX:D,tileAnchorY:L}=r.get(v),k=Math.floor((p+D)*Ru),O=Math.floor((_+L)*Ru);this.index.add(k,O),this.keys.push(w),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,r,u){const p=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),_=Ru/Math.pow(2,r.canonical.z-this.tileID.canonical.z),v=r.canonical.x*o.aj,w=r.canonical.y*o.aj;for(let A=0;A<t.length;A++){const D=t.get(A);if(D.crossTileID)continue;const{key:L,tileAnchorX:k,tileAnchorY:O}=D,N=Math.floor((v+k)*_),Z=Math.floor((w+O)*_),j=this.index.range(N-p,Z-p,N+p,Z+p).sort((X,Y)=>X-Y);for(const X of j){const Y=this.crossTileIDs[X];if(this.keys[X]===L&&!u.has(Y)){u.add(Y),D.crossTileID=Y;break}}}}}class Ts{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ca{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const r=Math.round((t-this.lng)/360);if(r!==0)for(const u in this.indexes){const p=this.indexes[u],_={};for(const v in p){const w=p[v];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+r),_[w.tileID.key]=w}this.indexes[u]=_}this.lng=t}addBucket(t,r,u){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===r.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let _=0;_<r.symbolInstances.length;_++)r.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const p=this.usedCrossTileIDs[t.overscaledZ];for(const _ in this.indexes){const v=this.indexes[_];if(Number(_)>t.overscaledZ)for(const w in v){const A=v[w];A.tileID.isChildOf(t)&&A.findMatches(r.symbolInstances,t,p)}else{const w=v[t.scaledTo(Number(_)).key];w&&w.findMatches(r.symbolInstances,t,p)}}for(let _=0;_<r.symbolInstances.length;_++){const v=r.symbolInstances.get(_);v.crossTileID||(v.crossTileID=u.generate(),p.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Oh(t,r.symbolInstances,r.bucketInstanceId),!0}removeBucketCrossTileIDs(t,r){for(const u of r.crossTileIDs)this.usedCrossTileIDs[t].delete(u)}removeStaleBuckets(t){let r=!1;for(const u in this.indexes){const p=this.indexes[u];for(const _ in p)t[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(u,p[_]),delete p[_],r=!0)}return r}}class Jr{constructor(){this.layerIndexes={},this.crossTileIDs=new Ts,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,r,u,p){let _=this.layerIndexes[t.fqid];_===void 0&&(_=this.layerIndexes[t.fqid]=new Ca);let v=!1;const w={};p.name!=="globe"&&_.handleWrapJump(u);for(const A of r){const D=A.getBucket(t);D&&t.fqid===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(A.tileID,D,this.crossTileIDs)&&(v=!0),w[D.bucketInstanceId]=!0)}return _.removeStaleBuckets(w)&&(v=!0),v}pruneUnusedLayers(t){const r={};t.forEach(u=>{r[u]=!0});for(const u in this.layerIndexes)r[u]||delete this.layerIndexes[u]}}const Lc=771;class Ii{constructor(t,r,u,p){this.blendFunction=t,this.blendColor=r.toNonPremultipliedRenderColor(null),this.mask=u,this.blendEquation=p}}Ii.Replace=[1,0,1,0],Ii.disabled=new Ii(Ii.Replace,o.am.transparent,[!1,!1,!1,!1]),Ii.unblended=new Ii(Ii.Replace,o.am.transparent,[!0,!0,!0,!0]),Ii.alphaBlended=new Ii([1,Lc,1,Lc],o.am.transparent,[!0,!0,!0,!0]),Ii.alphaBlendedNonPremultiplied=new Ii([770,Lc,770,Lc],o.am.transparent,[!0,!0,!0,!0]),Ii.multiply=new Ii([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class kt{constructor(t,r,u){this.func=t,this.mask=r,this.range=u}}kt.ReadOnly=!1,kt.ReadWrite=!0,kt.disabled=new kt(519,kt.ReadOnly,[0,1]);const vo=7680;class li{constructor(t,r,u,p,_,v){this.test=t,this.ref=r,this.mask=u,this.fail=p,this.depthFail=_,this.pass=v}}li.disabled=new li({func:519,mask:0},0,0,vo,vo,vo);const mr=1029,fl=2305;class Jt{constructor(t,r,u){this.enable=t,this.mode=r,this.frontFace=u}}function pl(c,t){const r=o.c1(c,3);o.c3(c,t),o.c7(c,3,r)}function Pc(c,t){const r=o.b_([]);return o.b$(r,r,-t),o.c0(r,r,-c),r}function ml(c,t){const r=[c[0],c[1],0],u=[t[0],t[1],0];if(o.ae(r)>=1e-15){const v=o.au([],r);o.bY(u,v,o.bG(u,v)),t[0]=u[0],t[1]=u[1]}const p=o.bF([],t,c);if(o.bZ(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return Pc(Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2]),_)}Jt.disabled=new Jt(!1,mr,fl),Jt.backCCW=new Jt(!0,mr,fl),Jt.backCW=new Jt(!0,mr,2304),Jt.frontCW=new Jt(!0,1028,2304),Jt.frontCCW=new Jt(!0,1028,fl);class Fd{constructor(t,r){this.position=t,this.orientation=r}get position(){return this._position}set position(t){if(t){const r=t instanceof o.ac?t:new o.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=o.bX(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r){if(this.orientation=null,!this.position)return;const u=this.position,p=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(t)):0,_=o.ac.fromLngLat(t,p),v=[_.x-u.x,_.y-u.y,_.z-u.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=ml(v,r)}setPitchBearing(t,r){this.orientation=Pc(o.al(t),o.al(-r))}}class ro{constructor(t,r){this._transform=o.bx([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new o.ac(t[0],t[1],t[2])}get position(){const t=o.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&o.c7(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.b_([]),t&&pl(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),r=this.right();return{bearing:Math.atan2(-r[1],r[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,r){this._orientation=Pc(t,r),pl(this._transform,this._orientation)}forward(){const t=o.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const u=new Float64Array(16);return o.bi(u,this.getWorldToCamera(t,r)),u}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,u){const p=this.position;o.bY(p,p,-t);const _=new Float64Array(16);return o.bn(_,[u,u,u]),o.bo(_,_,p),_[10]*=r,_}getWorldToCamera(t,r){const u=new Float64Array(16),p=new Float64Array(4),_=this.position;return o.c2(p,this._orientation),o.bY(_,_,-t),o.c3(u,p),o.bo(u,u,_),u[1]*=-1,u[5]*=-1,u[9]*=-1,u[13]*=-1,u[8]*=r,u[9]*=r,u[10]*=r,u[11]*=r,u}getCameraToClipPerspective(t,r,u,p){const _=new Float64Array(16);return o.c4(_,t,r,u,p),_}getCameraToClipOrthographic(t,r,u,p,_,v){const w=new Float64Array(16);return o.c5(w,t,r,u,p,_,v),w}getDistanceToElevation(t,r=!1){const u=t===0?0:o.c6(t,r?o.aY(this.position[1]):this.position[1]),p=this.forward();return(u-this.position[2])/p[2]}clone(){return new ro([...this.position],[...this.orientation])}}const Ss={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Du{constructor(t=0,r=0,u=0,p=0){if(isNaN(t)||t<0||isNaN(r)||r<0||isNaN(u)||u<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=r,this.left=u,this.right=p}interpolate(t,r,u){return r.top!=null&&t.top!=null&&(this.top=o.ai(t.top,r.top,u)),r.bottom!=null&&t.bottom!=null&&(this.bottom=o.ai(t.bottom,r.bottom,u)),r.left!=null&&t.left!=null&&(this.left=o.ai(t.left,r.left,u)),r.right!=null&&t.right!=null&&(this.right=o.ai(t.right,r.right,u)),this}getCenter(t,r){const u=o.ay((this.left+t-this.right)/2,0,t),p=o.ay((this.top+r-this.bottom)/2,0,r);return new o.P(u,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Du(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Wr=15;class Xf{constructor(t,r,u,p,_,v,w){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=u??0,this._maxPitch=p??60,this.setProjection(v),this.setMaxBounds(w),this.width=0,this.height=0,this._center=new o.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Du,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ro,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Xf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Wr}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,r=!1){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||u)&&this._updateCameraOnTerrain(),(t||u)&&this._constrainCamera(r),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=o.ce(this.projectionOptions);const u=this.getProjection(),p=!o.bv(r,u);return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.ce({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=o.cf(),o.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=o.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const r=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==r&&(this._unmodified=!1,this._setZoom(r),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,r=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!r||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const u=this._elevation;r||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&u.exaggeration()&&this._centerAltitudeValidForExaggeration!==u.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*u.exaggeration(),this._centerAltitudeValidForExaggeration=u.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=u.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],u=this.horizonLineFromTop();let p=0,_=0;for(let v=0;v<r.length;v++){const w=new o.P(r[v][0]*this.width,u+r[v][1]*(this.height-u)),A=t.pointCoordinate(w);if(!A)continue;const D=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);p+=A[3]*D,_+=D}return _===0?NaN:p/_}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,r=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),u=this.pixelsPerMeter/this.worldSize*r,p=this._mercatorZfromZoom(t),_=this._mercatorZfromZoom(this._maxZoom),v=Math.max(p-u,_);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let u;u=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const p=o.ae(o.at([],this._camera.position,u));return o.ay(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!o.ch(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const u=[t.position.x,t.position.y,t.position.z];o.ci(u,this._camera.position)||(this._setCameraPosition(u),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new Fd;return r.position=new o.ac(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!o.cj(t))return!1;o.ck(t,t);const r=o.cl([],[0,0,-1],t),u=o.cl([],[0,-1,0],t);if(u[2]<0)return!1;const p=ml(r,u);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,u=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;t[2]=o.ay(t[2],p/u,p/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,r,u){this._unmodified=!1,this._edgeInsets.interpolate(t,r,u),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const r=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,r)}getVisibleUnwrappedCoordinates(t){const r=[new o.cm(0,t)];if(this.renderWorldCopies){const u=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),_=this.pointCoordinate(new o.P(this.width,this.height)),v=this.pointCoordinate(new o.P(0,this.height)),w=Math.floor(Math.min(u.x,p.x,_.x,v.x)),A=Math.floor(Math.max(u.x,p.x,_.x,v.x)),D=1;for(let L=w-D;L<=A+D;L++)L!==0&&r.push(new o.cm(L,t))}return r}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,u){let p=[];const _=u!=null,v=!_;if(v&&this.zoom<r||_&&u[0]===0&&u[1]===0)return p;const w=new Set,A=(L,k,O,N,Z)=>{const j=o.cK(k,L,O,N,Z);w.has(j)||(p.push(new o.aM(L,k,O,N,Z)),w.add(j))};for(let L=0;L<t.length;L++){const k=t[L];if(v&&k.canonical.z!==r)continue;const O=k.canonical,N=k.overscaledZ,Z=k.wrap,j=1<<O.z,X=O.x+1<j,Y=O.x>0,J=O.y+1<j,oe=O.y>0,ce=k.wrap-(Y?0:1),ye=k.wrap+(X?0:1),fe=Y?O.x-1:j-1,de=X?O.x+1:0;if(_)u[0]<0?(A(N,ye,O.z,de,O.y),u[1]<0&&J&&(A(N,Z,O.z,O.x,O.y+1),A(N,ye,O.z,de,O.y+1)),u[1]>0&&oe&&(A(N,Z,O.z,O.x,O.y-1),A(N,ye,O.z,de,O.y-1))):u[0]>0?(A(N,ce,O.z,fe,O.y),u[1]<0&&J&&(A(N,Z,O.z,O.x,O.y+1),A(N,ce,O.z,fe,O.y+1)),u[1]>0&&oe&&(A(N,Z,O.z,O.x,O.y-1),A(N,ce,O.z,fe,O.y-1))):u[1]<0&&J?A(N,Z,O.z,O.x,O.y+1):oe&&A(N,Z,O.z,O.x,O.y-1);else{const he=k.visibleQuadrants;1&he&&(A(N,ce,O.z,fe,O.y),oe&&(A(N,Z,O.z,O.x,O.y-1),A(N,ce,O.z,fe,O.y-1))),2&he&&(A(N,ye,O.z,de,O.y),oe&&(A(N,Z,O.z,O.x,O.y-1),A(N,ye,O.z,de,O.y-1))),4&he&&(A(N,ce,O.z,fe,O.y),J&&(A(N,Z,O.z,O.x,O.y+1),A(N,ce,O.z,fe,O.y+1))),8&he&&(A(N,ye,O.z,de,O.y),J&&(A(N,Z,O.z,O.x,O.y+1),A(N,ye,O.z,de,O.y+1)))}}const D=[];for(const L of p)p.some(k=>L.isChildOf(k))||D.push(L);if(p=D.filter(L=>!t.some(k=>!!(L.overscaledZ<r&&k.isChildOf(L))||L.equals(k)||L.isChildOf(k))),v){const L=1<<r,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[L*k.x,L*k.y],N=4,Z=N*N;p=p.filter(j=>{const X=j.canonical.x+.5-O[0],Y=j.canonical.y+.5-O[1];return X*X+Y*Y<Z})}return p}coveringTiles(t){let r=this.coveringZoomLevel(t);const u=r,p=this.elevation&&this.elevation.exaggeration(),_=p&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&r<t.minzoom)return[];t.maxzoom!==void 0&&r>t.maxzoom&&(r=t.maxzoom);const w=this.locationCoordinate(this.center),A=this.center.lat,D=1<<r,L=[D*w.x,D*w.y,0],k=this.projection.name==="globe",O=!k,N=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,O),Z=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=D*o.c6(1,this.center.lat),X=this._camera.position[2]/o.c6(1,this.center.lat),Y=[D*Z.x,D*Z.y,X*(O?1:j)],J=k||p,oe=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?r:0;let ye;if(this._elevation&&t.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ee=this._elevation.getMinMaxForVisibleTiles();ye=Ee?Ee.max:this._centerAltitude}else ye=this._centerAltitude;const fe=t.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,de=this.projection.isReprojectedInTileSpace?o.co(this):1,he=Ee=>{const Fe=new o.ac(Ee.x+25e-6,Ee.y,Ee.z),tt=new o.ac(Ee.x,Ee.y+25e-6,Ee.z),gt=Ee.toLngLat(),Ye=Fe.toLngLat(),ht=tt.toLngLat(),Ot=this.locationCoordinate(gt),zt=this.locationCoordinate(Ye),Dt=this.locationCoordinate(ht),Ht=Math.hypot(zt.x-Ot.x,zt.y-Ot.y),$t=Math.hypot(Dt.x-Ot.x,Dt.y-Ot.y);return Math.sqrt(Ht*$t)*de/25e-6},_e=Ee=>{const $e=ye,Fe=fe;return{aabb:o.cr(this,D,0,0,0,Ee,Fe,$e,this.projection),zoom:0,x:0,y:0,minZ:Fe,maxZ:$e,wrap:Ee,fullyVisible:!1}},be=[];let De=[];const ze=r,qe=t.reparseOverscaled?u:r,We=(X-this._centerAltitude)*j,rt=Ee=>{if(!this._elevation||!Ee.tileID||!v)return;const $e=this._elevation.getMinMaxForTile(Ee.tileID),Fe=Ee.aabb;$e?(Fe.min[2]=$e.min,Fe.max[2]=$e.max,Fe.center[2]=(Fe.min[2]+Fe.max[2])/2):(Ee.shouldSplit=Ue(Ee),Ee.shouldSplit||(Fe.min[2]=Fe.max[2]=Fe.center[2]=this._centerAltitude))},Ie=(Ee,$e)=>{if(.707*$e<Ee)return 1;const Fe=$e/Ee;return Fe/(1.4144271570014144+(Math.pow(1.1,Fe-1.4144271570014144+1)-1)/(1.1-1)-1)},Ue=Ee=>{if(Ee.zoom<ce)return!0;if(Ee.zoom===ze)return!1;if(Ee.shouldSplit!=null)return Ee.shouldSplit;const $e=Ee.aabb.distanceX(Y),Fe=Ee.aabb.distanceY(Y);let tt=We,gt=1;if(k){tt=Ee.aabb.distanceZ(Y);const $t=Math.pow(2,Ee.zoom),Lt=o.aY((Ee.y+1)/$t),qt=o.aY(Ee.y/$t),Xt=Math.min(Math.max(A,Lt),qt),ui=o.cO(Xt)/o.cO(A);if(gt=Xt===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ui/this._mercatorScaleRatio),this.zoom<=o.cL&&Ee.zoom===ze-1&&ui>=.9)return!0}else if(_&&(tt=Ee.aabb.distanceZ(Y)*j),this.projection.isReprojectedInTileSpace&&u<=5){const $t=Math.pow(2,Ee.zoom),Lt=he(new o.ac((Ee.x+.5)/$t,(Ee.y+.5)/$t));gt=Lt>.85?1:Lt}if(!v){const $t=Math.sqrt($e*$e+Fe*Fe+tt*tt);let Lt=(1<<ze-Ee.zoom)*oe*gt;return Lt*=Ie(Math.max(tt,We),$t),$t<Lt}let Ye=Number.MAX_VALUE,ht=0;const Ot=Ee.aabb.getCorners(),zt=[];for(const $t of Ot){o.at(zt,$t,Y),k||(_?zt[2]*=j:zt[2]=We);const Lt=o.bG(zt,this._camera.forward());Lt<Ye&&(Ye=Lt,ht=Math.abs(zt[2]))}let Dt=(1<<ze-Ee.zoom)*oe*gt;if(Dt*=Ie(Math.max(ht,We),Ye),Ye<Dt)return!0;const Ht=Ee.aabb.closestPoint(L);return Ht[0]===L[0]&&Ht[1]===L[1]};if(this.renderWorldCopies)for(let Ee=1;Ee<=3;Ee++)be.push(_e(-Ee)),be.push(_e(Ee));for(be.push(_e(0));be.length>0;){const Ee=be.pop(),$e=Ee.x,Fe=Ee.y;let tt=Ee.fullyVisible;const gt=()=>this.projection.name==="globe"&&(Ee.y===0||Ee.y===(1<<Ee.zoom)-1);if(!tt){let Ye=J?Ee.aabb.intersects(N):Ee.aabb.intersectsFlat(N);if(Ye===0&&gt()){const ht=new o.cp(Ee.zoom,$e,Fe);Ye=o.cq(this,D,ht,!0).intersects(N)}if(Ye===0)continue;tt=Ye===2}if(Ee.zoom!==ze&&Ue(Ee))for(let Ye=0;Ye<4;Ye++){const ht=($e<<1)+Ye%2,Ot=(Fe<<1)+(Ye>>1),zt={aabb:v?Ee.aabb.quadrant(Ye):o.cr(this,D,Ee.zoom+1,ht,Ot,Ee.wrap,Ee.minZ,Ee.maxZ,this.projection),zoom:Ee.zoom+1,x:ht,y:Ot,wrap:Ee.wrap,fullyVisible:tt,tileID:void 0,shouldSplit:void 0,minZ:Ee.minZ,maxZ:Ee.maxZ};_&&!k&&(zt.tileID=new o.aM(Ee.zoom+1===ze?qe:Ee.zoom+1,Ee.wrap,Ee.zoom+1,ht,Ot),rt(zt)),be.push(zt)}else{const Ye=Ee.zoom===ze?qe:Ee.zoom;if(t.minzoom&&t.minzoom>Ye)continue;let ht=0;if(!tt){let Ht=J?Ee.aabb.intersectsPrecise(N):Ee.aabb.intersectsPreciseFlat(N);if(Ht===0&&gt()){const $t=new o.cp(Ee.zoom,$e,Fe);Ht=o.cq(this,D,$t,!0).intersectsPrecise(N)}if(Ht===0)continue;if(t.calculateQuadrantVisibility)if(N.containsPoint(Ee.aabb.center))ht=15;else for(let $t=0;$t<4;$t++)Ee.aabb.quadrant($t).intersects(N)!==0&&(ht|=1<<$t)}const Ot=L[0]-(.5+$e+(Ee.wrap<<Ee.zoom))*(1<<r-Ee.zoom),zt=L[1]-.5-Fe,Dt=Ee.tileID?Ee.tileID:new o.aM(Ye,Ee.wrap,Ee.zoom,$e,Fe);t.calculateQuadrantVisibility&&(Dt.visibleQuadrants=ht),De.push({tileID:Dt,distanceSq:Ot*Ot+zt*zt})}}if(this.fogCullDistSq){const Ee=this.fogCullDistSq,$e=this.horizonLineFromTop();De=De.filter(Fe=>{const tt=[0,0,0,1],gt=[o.aj,o.aj,0,1],Ye=this.calculateFogTileMatrix(Fe.tileID.toUnwrapped());o.aA(tt,tt,Ye),o.aA(gt,gt,Ye);const ht=o.cs([],tt,gt),Ot=o.ct([],tt,gt),zt=o.cM(ht,Ot);if(zt===0)return!0;let Dt=!1;const Ht=this._elevation;if(Ht&&zt>Ee&&$e!==0){const $t=this.calculateProjMatrix(Fe.tileID.toUnwrapped());let Lt;t.isTerrainDEM||(Lt=Ht.getMinMaxForTile(Fe.tileID)),Lt||(Lt={min:fe,max:ye});const qt=o.cu(this.rotation),Xt=[qt[0]*o.aj,qt[1]*o.aj,Lt.max];o.ad(Xt,Xt,$t),Dt=(1-Xt[1])*this.height*.5<$e}return zt<Ee||Dt})}return De.sort((Ee,$e)=>Ee.distanceSq-$e.distanceSq).map(Ee=>Ee.tileID)}resize(t,r){this.width=t,this.height=r,this.pixelsToGLUnits=[2/t,-2/r],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const r=o.ay(t.lat,-85.051129,o.cv),u=this.projection.project(t.lng,r);return new o.P(u.x*this.worldSize,u.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let u,p;const _=this.centerPoint;if(this.projection.name==="globe"){const w=this.worldSize;u=(r.x-_.x)/w,p=(r.y-_.y)/w}else{const w=this.pointCoordinate(r),A=this.pointCoordinate(_);u=w.x-A.x,p=w.y-A.y}const v=this.locationCoordinate(t);this.setLocation(new o.ac(v.x-u,v.y-p))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,r){return this.projection.locationPoint(this,t,r)}locationPoint3D(t,r){return this.projection.locationPoint(this,t,r,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,r){return this.coordinateLocation(this.pointCoordinate3D(t,r))}locationCoordinate(t,r){const u=r?o.c6(r,t.lat):void 0,p=this.projection.project(t.lng,t.lat);return new o.ac(p.x,p.y,u)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,r){const u=r??this._centerAltitude,p=[t.x,t.y,0,1],_=[t.x,t.y,1,1];o.aA(p,p,this.pixelMatrixInverse),o.aA(_,_,this.pixelMatrixInverse);const v=_[3];o.cw(p,p,1/p[3]),o.cw(_,_,1/v);const w=p[2],A=_[2];return{p0:p,p1:_,t:w===A?0:(u-w)/(A-w)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],u=[t.x,t.y,1,1];return o.aA(r,r,this.pixelMatrixInverse),o.aA(u,u,this.pixelMatrixInverse),o.cw(r,r,1/r[3]),o.cw(u,u,1/u[3]),r[2]=o.c6(r[2],this._center.lat)*this.worldSize,u[2]=o.c6(u[2],this._center.lat)*this.worldSize,o.cw(r,r,1/this.worldSize),o.cw(u,u,1/this.worldSize),new o.av([r[0],r[1],r[2]],o.au([],o.at([],u,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:u,t:p}=t,_=o.c6(r[2],this._center.lat),v=o.c6(u[2],this._center.lat);return new o.ac(o.ai(r[0],u[0],p)/this.worldSize,o.ai(r[1],u[1],p)/this.worldSize,o.ai(_,v,p))}pointCoordinate(t,r=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,r)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let u=this.projection.pointCoordinate3D(this,t.x,t.y);if(u)return new o.ac(u[0],u[1],u[2]);let p=0,_=this.horizonLineFromTop();if(t.y>_)return this.pointCoordinate(t,r);const v=.02*_,w=t.clone();for(let A=0;A<10&&_-p>v;A++){w.y=o.ai(p,_,.66);const D=this.projection.pointCoordinate3D(this,w.x,w.y);D?(_=w.y,u=D):p=w.y}return u?new o.ac(u[0],u[1],u[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cx)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const u=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,p=[t.x*this.worldSize,t.y*this.worldSize,u+t.toAltitude(),1];return o.aA(p,p,this.pixelMatrix),p[3]>0?new o.P(p[0]/p[3],p[1]/p[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,u=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.P(r,t)),v=this.pointLocation3D(new o.P(p,t)),w=this.pointLocation3D(new o.P(p,u)),A=this.pointLocation3D(new o.P(r,u));let D=Math.min(_.lng,v.lng,w.lng,A.lng),L=Math.max(_.lng,v.lng,w.lng,A.lng),k=Math.min(_.lat,v.lat,w.lat,A.lat),O=Math.max(_.lat,v.lat,w.lat,A.lat);const N=Math.pow(2,-this.zoom)/16*270,Z=this.projection.name==="globe"?1:4,j=(X,Y,J,oe,ce)=>{const ye=(X+J)/2,fe=(Y+oe)/2,de=new o.P(ye,fe),{lng:he,lat:_e}=this.pointLocation3D(de),be=Math.max(0,D-he,k-_e,he-L,_e-O);D=Math.min(D,he),L=Math.max(L,he),k=Math.min(k,_e),O=Math.max(O,_e),(ce<Z||be>N)&&(j(X,Y,ye,fe,ce+1),j(ye,fe,J,oe,ce+1))};if(j(r,t,p,t,1),j(p,t,p,u,1),j(p,u,r,u,1),j(r,u,r,t,1),this.projection.name==="globe"){const[X,Y]=o.cy(this);X?(O=90,L=180,D=-180):Y&&(k=-90,L=180,D=-180)}return new o.aG(new o.cd(D,k),new o.cd(L,O))}_getBoundsRectangular(t,r){const{top:u,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,w=new o.P(p,u),A=new o.P(v,u),D=new o.P(v,_),L=new o.P(p,_);let k=this.pointCoordinate(w,t),O=this.pointCoordinate(A,t);const N=this.pointCoordinate(D,r),Z=this.pointCoordinate(L,r),j=(X,Y)=>(Y.y-X.y)/(Y.x-X.x);return k.y>1&&O.y>=0?k=new o.ac((1-Z.y)/j(Z,k)+Z.x,1):k.y<0&&O.y<=1&&(k=new o.ac(-Z.y/j(Z,k)+Z.x,0)),O.y>1&&k.y>=0?O=new o.ac((1-N.y)/j(N,O)+N.x,1):O.y<0&&k.y<=1&&(O=new o.ac(-N.y/j(N,O)+N.x,0)),new o.aG().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(N))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const r=t.visibleDemTiles.reduce((u,p)=>{if(p.dem){const _=p.dem.tree;u.min=Math.min(u.min,_.minimums[0]),u.max=Math.max(u.max,_.maximums[0])}return u},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(r.min*t.exaggeration(),r.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const r=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,u=this.height/2-r*(1-this._horizonShift);return t?Math.max(0,u):u}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=o.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,r){return this.projection.createTileMatrix(this,r,t)}calculateDistanceTileData(t){const r=t.key,u=this._distanceTileDataCache;if(u[r])return u[r];const p=t.canonical,_=1/this.height,v=this.cameraWorldSize,w=v/this.zoomScale(p.z),A=(p.x+Math.pow(2,p.z)*t.wrap)*w,D=p.y*w,L=this.point;L.x*=v/this.worldSize,L.y*=v/this.worldSize;const k=this.angle,O=Math.sin(-k),N=-Math.cos(-k);return u[r]={bearing:[O,N],center:[(L.x-A)*_,(L.y-D)*_],scale:w/o.aj*_},u[r]}calculateFogTileMatrix(t){const r=t.key,u=this._fogTileMatrixCache;if(u[r])return u[r];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.az(p,this.worldToFogMatrix,p),u[r]=new Float32Array(p),u[r]}calculateProjMatrix(t,r=!1,u=!1){const p=t.key;let _;if(_=u?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const v=this.calculatePosMatrix(t,this.worldSize);let w;return w=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,o.az(v,w,v),_[p]=new Float32Array(v),_[p]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,u=this._pixelsToTileUnitsCache;if(u[r])return u[r];const p=o.cz(t,this);return u[r]=p,u[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,r=o.bn([],[t,t,t]);return o.az(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const r=o.c6(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(r),p=this._camera.forward(),_=o.c6(1,this._center.lat);u[2]/=_,p[2]/=_,o.au(p,p);const v=t.raycast(u,p,t.exaggeration());if(v){const w=o.bE([],u,p,v),A=new o.ac(w[0],w[1],o.c6(w[2],o.aY(w[1]))),D=(A.z+o.ae([A.x-u[0],A.y-u[1],A.z-u[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(D),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const r=this._elevation,u=o.c6(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(u),_=r.getAtPointOrZero(new o.ac(...p)),v=this.pixelsPerMeter/this.worldSize*_,w=this._minimumHeightOverTerrain(),A=p[2]-v;if(A<=w)if(A<0||t){const D=this.locationCoordinate(this._center,this._centerAltitude),L=[p[0],p[1],D.z-p[2]],k=o.ae(L);L[2]-=(w-A)/this._pixelsPerMercatorPixel;const O=o.ae(L);if(O===0)return;o.bY(L,L,k/O*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],D.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const O=this.center;return O.lat=o.ay(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(O.lng=o.ay(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const r=this._unmodified,{x:u,y:p}=this.point;let _=0,v=u,w=p;const A=this.width/2,D=this.height/2,L=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(p-D<L&&(w=L+D),p+D>k&&(w=k-D),k-L<this.height&&(_=Math.max(_,this.height/(k-L)),w=(k+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,N=this.worldMaxX*this.scale,Z=this.worldSize/2-(O+N)/2;v=(u+Z+this.worldSize)%this.worldSize-Z,v-A<O&&(v=O+A),v+A>N&&(v=N-A),N-O<this.width&&(_=Math.max(_,this.width/(N-O)),v=(N+O)/2)}v===u&&w===p||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(v,w))),_&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r=this.projection.name==="globe",u=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.c6(1,this.center.lat)/o.c6(1,o.cP));const p=o.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?u:1,v=this._camera.getWorldToCamera(this.worldSize,_);let w;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),be=_e*this.aspect,De=-be,ze=-_e;be-=t.x,De-=t.x,_e+=t.y,ze+=t.y,w=this._camera.getCameraToClipOrthographic(De,be,ze,_e,this._nearZ,this._farZ),((qe,We,rt,Ie)=>{for(let Ue=0;Ue<16;Ue++)qe[Ue]=o.ai(We[Ue],rt[Ue],Ie)})(w,w,A,o.cN(this.pitch>=Wr?1:this.pitch/Wr))}else w=A;const D=o.cB([],A,v);let L=o.cB([],w,v);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),be=o.bx([]);o.bo(be,be,[_e.x*this.worldSize,_e.y*this.worldSize,0]),o.az(be,be,o.cC(this)),o.bo(be,be,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),o.az(L,L,be),o.az(D,D,be),this.inverseAdjustmentMatrix=o.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cE([],L,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=L,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),r){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cB([],_e,v)}else this.expandedFarZProjMatrix=this.projMatrix;const k=o.bi([],w);this.frustumCorners=o.cF.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const O=new Float32Array(16);o.bx(O),o.cE(O,O,[1,-1,1]),o.cG(O,O,this._pitch),o.by(O,O,this.angle);const N=o.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(N);const Z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;N[8]=2*-t.x/this.width,N[9]=2*(t.y+Z)/this.height,this.skyboxMatrix=o.az(O,N,O);const j=this.point,X=j.x,Y=j.y,J=this.width%2/2,oe=this.height%2/2,ce=Math.cos(this.angle),ye=Math.sin(this.angle),fe=X-Math.round(X)+ce*J+ye*oe,de=Y-Math.round(Y)+ce*oe+ye*J,he=new Float64Array(L);if(o.bo(he,he,[fe>.5?fe-1:fe,de>.5?de-1:de,0]),this.alignedProjMatrix=he,L=o.bz(),o.cE(L,L,[this.width/2,-this.height/2,1]),o.bo(L,L,[1,-1,0]),this.labelPlaneMatrix=L,L=o.bz(),o.cE(L,L,[1,-1,1]),o.bo(L,L,[-1,-1,0]),o.cE(L,L,[2/this.width,2/this.height,1]),this.glCoordMatrix=L,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,D),this._calcFogMatrices(),this._distanceTileDataCache={},L=o.bi(new Float64Array(16),this.pixelMatrix),!L)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=L,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cH(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(_e,_e,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=L;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,u=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[t,t,r];o.bY(_,_,p),o.bY(u,u,-1),o.cI(u,u,_);const v=o.bz();o.bo(v,v,u),o.cE(v,v,_),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,p)}_computeCameraPosition(t){const r=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,u=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*r-t/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-u[0]*_,p.y/this.worldSize-u[1]*_,t/this.worldSize*this._centerAltitude-u[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),u=this._camera.position[2],p=t[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((r-u)/p,1)),this._camera.position=o.bE([],this._camera.position,t,_),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:u,bearing:p}=this._camera.getPitchBearing(),_=o.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),w=Math.max((t[2]-_)/Math.cos(u),v),A=this._zoomFromMercatorZ(w);o.bE(t,t,r,w),this._pitch=o.ay(u,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bX(p,-Math.PI,Math.PI),this._setZoom(o.ay(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,u=o.cx,p=0,_=1/0;for(;u-r>1e-6&&u>r;){const v=r+.5*(u-r),w=this.tileSize*Math.pow(2,v),A=this.getCameraToCenterDistance(this.projection,v,w),D=this.scaleZoom(A/(Math.max(0,t)*this.tileSize)),L=Math.abs(v-D);L<_&&(_=L,p=v),v<D?r=v:u=v}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const u=Math.min(t.x,r.x),p=Math.max(t.x,r.x),_=Math.min(t.y,r.y),v=Math.max(t.y,r.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const w=[new o.P(u,_),new o.P(p,v),new o.P(u,v),new o.P(p,_)],A=this.renderWorldCopies?-3:0,D=this.renderWorldCopies?4:1;for(const L of w){const k=this.pointRayIntersection(L);if(k.t<0)return!0;const O=this.rayIntersectionCoordinate(k);if(O.x<A||O.y<0||O.x>D||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,r){const u=o.ae(o.at([],this._camera.position,t)),p=this._zoomFromMercatorZ(u)+r;return u-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([r,u,p],_){const v=[r,u,p,1];o.aA(v,v,_);const w=v[3]=Math.max(v[3],1e-6);return v[0]/=w,v[1]/=w,v[2]/=w,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,r=this.zoom,u=this.worldSize){const p=o.cA(t,r,this.width,this.height,1024),_=t.pixelSpaceConversion(this.center.lat,u,p);let v=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(v=o.ai(1,v,o.cN(this.pitch>=Wr?1:this.pitch/Wr))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(t,t,this.globeMatrix),t}getFrustum(t){return o.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const Ia=(c,t)=>{if(t>0&&c.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||c.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const r=c.transform,u=Math.max(Math.abs(r._zoom-(c.minCutoffZoom-1)),1),p=r.isLODDisabled(!1)?o.af(60,45,r.pitch):o.af(30,15,r.pitch),_=r._farZ-r._nearZ,v=t*r.height,w=((1-(A=p))*r.cameraToCenterDistance+A*(r._farZ+v))*u;var A;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[r._nearZ,r._farZ,(w-r._nearZ)/_,(w-v-r._nearZ)/_]}}},Es={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class kh{constructor(t,r){this.aabb=t,this.lastCascade=r}}class h_{add(t,r){const u=this.receivers[t.key];u!==void 0?(u.aabb.min[0]=Math.min(u.aabb.min[0],r.min[0]),u.aabb.min[1]=Math.min(u.aabb.min[1],r.min[1]),u.aabb.min[2]=Math.min(u.aabb.min[2],r.min[2]),u.aabb.max[0]=Math.max(u.aabb.max[0],r.max[0]),u.aabb.max[1]=Math.max(u.aabb.max[1],r.max[1]),u.aabb.max[2]=Math.max(u.aabb.max[2],r.max[2])):this.receivers[t.key]=new kh(r,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,r,u){const p=o.cW.fromPoints(t.points);let _=0;for(const v in this.receivers){const w=this.receivers[v];if(!w||!p.intersectsAabb(w.aabb))continue;w.aabb.min=p.closestPoint(w.aabb.min),w.aabb.max=p.closestPoint(w.aabb.max);const A=w.aabb.getCorners();for(let D=0;D<u.length;D++){let L=!0;for(const k of A){const O=[k[0]*r,k[1]*r,k[2]];if(o.ad(O,O,u[D].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){L=!1;break}}if(w.lastCascade=D,_=Math.max(_,D),L)break}}return _+1}}class xo{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new h_,this._depthMode=new kt(t.context.gl.LEQUAL,kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(Es,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(Es,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(Es,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const u=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const p=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||p<=0||(this._shadowLayerCount=u.style.order.reduce((Z,j)=>{const X=u.style._mergedLayers[j];return Z+(X.hasShadowPass()&&!X.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const _=u.context,v=Es.shadowMapResolution,w=Es.shadowMapResolution;if(this._cascades.length===0||Es.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Z=0;Z<Es.cascadeCount;++Z){const j=u._shadowMapDebug,X=_.gl,Y=_.createFramebuffer(v,w,j,"texture"),J=new o.T(_,{width:v,height:w,data:null},X.DEPTH_COMPONENT16);if(Y.depthAttachment.set(J.texture),j){const oe=new o.T(_,{width:v,height:w,data:null},X.RGBA8);Y.colorAttachment.set(oe.texture)}this._cascades.push({framebuffer:Y,texture:J,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cn,scale:0})}}this.shadowDirection=Oc(r);let A=0;if(t.elevation){const Z=t.elevation,j=[1e4,-1e4];Z.visibleDemTiles.filter(X=>X.dem).forEach(X=>{const Y=X.dem.tree;j[0]=Math.min(j[0],Y.minimums[0]),j[1]=Math.max(j[1],Y.maximums[0])}),j[0]!==1e4&&(A=(j[1]-j[0])*Z.exaggeration())}const D=1.5*t.cameraToCenterDistance,L=3*D,k=new Float64Array(16);for(let Z=0;Z<this._cascades.length;++Z){const j=this._cascades[Z];let X=t.height/50,Y=1;Es.cascadeCount===1?Y=L:Z===0?Y=D:(X=D,Y=L);const[J,oe]=kc(t,this.shadowDirection,X,Y,Es.shadowMapResolution,A);j.scale=t.scale,j.matrix=J,j.boundingSphereRadius=oe,o.bi(k,j.matrix),j.frustum=o.cn.fromInvProjectionMatrix(k,1,0,!0),j.far=Y}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Es.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Es.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ss.ShadowMap0,this._uniformValues.u_shadowmap_1=Ss.ShadowMap0+1,this._groundShadowTiles=u.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const N=u.transform.elevation;for(const Z of this._groundShadowTiles){let j={min:0,max:0};if(N){const X=N.getMinMaxForTile(Z);X&&(j=X)}this.addShadowReceiver(Z.toUnwrapped(),j.min,j.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,r){if(!this.enabled)return;const u=this.painter,p=u.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(u.transform.getFrustum(0),u.transform.worldSize,this._cascades),p.viewport.set([0,0,Es.shadowMapResolution,Es.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){u.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:o.am.white,depth:1});for(const v of t.order){const w=t._mergedLayers[v];if(!w.hasShadowPass()||w.isHidden(u.transform.zoom))continue;const A=t.getLayerSourceCache(w),D=A?r[A.id]:void 0;(w.type==="model"||D&&D.length)&&u.renderLayer(u,A,w,D)}}u.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,r=t.style,u=t.context,p=u.gl,_=r.directionalLight,v=r.ambientLight;if(!_||!v)return;const w=[],A=Ia(t,t.longestCutoffRange);A.shouldRenderCutoff&&w.push("RENDER_CUTOFF"),w.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&w.push("NORMAL_OFFSET");const D=Yl(r,_,v),L=new kt(p.LEQUAL,kt.ReadOnly,t.depthRangeFor3D),k=new li({func:p.EQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.KEEP);for(const O of this._groundShadowTiles){const N=O.toUnwrapped(),Z=t.isTileAffectedByFog(O),j=t.getOrCreateProgram("groundShadow",{defines:w,overrideFog:Z});this.setupShadows(N,j),t.uploadCommonUniforms(u,j,N,null,A);const X={u_matrix:t.transform.calculateProjMatrix(N),u_ground_shadow_factor:D};j.draw(t,p.TRIANGLES,L,k,Ii.multiply,Jt.disabled,X,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Ii.unblended:Ii.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,u=r.calculatePosMatrix(t,r.worldSize);return o.az(u,this._cascades[this.painter.currentShadowCascade].matrix,u),Float32Array.from(u)}calculateShadowPassMatrixFromMatrix(t){return o.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,r,u,p=0){if(!this.enabled)return;const _=this.painter.transform,v=this.painter.context,w=v.gl,A=this._uniformValues,D=new Float64Array(16),L=_.calculatePosMatrix(t,_.worldSize);for(let k=0;k<this._cascades.length;k++)o.az(D,this._cascades[k].matrix,L),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),v.activeTexture.set(w.TEXTURE0+Ss.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=!!u,this.useNormalOffset){const k=o.cU(t.canonical),O=2/_.tileSize*o.aj/Es.shadowMapResolution,N=O*this._cascades[0].boundingSphereRadius,Z=O*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(u==="vector-tile"?1:3)/Math.pow(2,p-t.canonical.z-(1-_.zoom+Math.floor(_.zoom)));A.u_shadow_normal_offset=[k,N*j,Z*j],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(v,A)}setupShadowsFromMatrix(t,r,u=!1){if(!this.enabled)return;const p=this.painter.context,_=p.gl,v=this._uniformValues,w=new Float64Array(16);for(let A=0;A<Es.cascadeCount;A++)o.az(w,this._cascades[A].matrix,t),v[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(w),p.activeTexture.set(_.TEXTURE0+Ss.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=u,u){const A=Es.normalOffset;v.u_shadow_normal_offset=[1,A,A],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(p,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,u,p){if(p[2]>=0)return{};const _=function(A,D,L){const k=L/(1<<A.canonical.z);return new o.cW([A.canonical.x*k+A.wrap*L,A.canonical.y*k+A.wrap*L,0],[(A.canonical.x+1)*k+A.wrap*L,(A.canonical.y+1)*k+A.wrap*L,D])}(t,r,u).getCorners(),v=r/-p[2];p[0]<0?(o.cV(_[0],_[0],[p[0]*v,0,0]),o.cV(_[3],_[3],[p[0]*v,0,0])):p[0]>0&&(o.cV(_[1],_[1],[p[0]*v,0,0]),o.cV(_[2],_[2],[p[0]*v,0,0])),p[1]<0?(o.cV(_[0],_[0],[0,p[1]*v,0]),o.cV(_[1],_[1],[0,p[1]*v,0])):p[1]>0&&(o.cV(_[2],_[2],[0,p[1]*v,0]),o.cV(_[3],_[3],[0,p[1]*v,0]));const w={};return w.vertices=_,w.planes=[Lo(_[1],_[0],_[4]),Lo(_[2],_[1],_[5]),Lo(_[3],_[2],_[6]),Lo(_[0],_[3],_[7])],w}addShadowReceiver(t,r,u){this._receivers.add(t,o.cW.fromTileIdAndHeight(t,r,u))}getMaxCascadeForTile(t){const r=this._receivers.get(t);return r&&r.lastCascade?r.lastCascade:0}}function Lo(c,t,r){const u=o.at([],r,t),p=o.at([],c,t),_=o.bF([],u,p),v=o.ae(_);return v===0?[0,0,1,0]:(o.bY(_,_,1/v),[_[0],_[1],_[2],-o.bG(_,t)])}function Oc(c){const t=c.properties.get("direction"),r=o.cR(t.x,t.y,t.z);r[2]=o.ay(r[2],0,75);const u=o.cT([r[0],r[1],r[2]]);return o.cS(u.x,u.y,u.z)}function Yl(c,t,r){const u=t.properties.get("color-use-theme")==="none",p=t.properties.get("color"),_=t.properties.get("intensity"),v=t.properties.get("direction"),w=[v.x,v.y,v.z],A=r.properties.get("color-use-theme")==="none",D=r.properties.get("color"),L=r.properties.get("intensity"),k=Math.max(o.bG([0,0,1],w),0),O=[0,0,0];o.bY(O,D.toPremultipliedRenderColor(A?null:c.getLut(t.scope)).toArray01Linear().slice(0,3),L);const N=[0,0,0];return o.bY(N,p.toPremultipliedRenderColor(u?null:c.getLut(r.scope)).toArray01Linear().slice(0,3),k*_),o.cY([O[0]>0?O[0]/(O[0]+N[0]):0,O[1]>0?O[1]/(O[1]+N[1]):0,O[2]>0?O[2]/(O[2]+N[2]):0])}function kc(c,t,r,u,p,_){const v=c.zoom,w=c.scale,A=c.worldSize,D=1/A,L=c.aspect,k=Math.sqrt(1+L*L)*Math.tan(.5*c.fovX),O=k*k,N=u-r,Z=u+r;let j,X;O>N/Z?(j=u,X=u*k):(j=.5*Z*(1+O),X=.5*Math.sqrt(N*N+2*(u*u+r*r)*O+Z*Z*O*O));const Y=c.projection.pixelsPerMeter(c.center.lat,A),J=c._camera.getCameraToWorldMercator(),oe=[0,0,-j*D];o.ad(oe,oe,J);let ce=X*D;const ye=c._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const tt=c._camera.getWorldToCamera(c.worldSize,c.projection.zAxisUnit==="meters"?Y:1),gt=c._camera.getCameraToClipPerspective(c._fov,c.width/c.height,r,u);gt[8]=2*-c.centerOffset.x/c.width,gt[9]=2*c.centerOffset.y/c.height;const Ye=new Float64Array(16);o.cB(Ye,gt,tt);const ht=new Float64Array(16);o.bi(ht,Ye);const Ot=o.cn.fromInvProjectionMatrix(ht,A,v,!0);for(const zt of Ot.points){const Dt=((fe=zt)[0]/=w,fe[1]/=w,fe[2]=o.c6(fe[2],c._center.lat),fe);ce=Math.max(ce,o.bZ(o.cX([],oe,Dt)))}}var fe;ce*=p/(p-1);const de=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),_e=new ro;_e.position=oe,_e.setPitchBearing(de,he);const be=_e.getWorldToCamera(A,Y),De=ce*A,ze=Math.min(c._mercatorZfromZoom(17)*A*-2,-2*De),qe=_e.getCameraToClipOrthographic(-De,De,-De,De,ze,(De+_*Y)/t[2]),We=new Float64Array(16);o.az(We,qe,be);const rt=o.cS(Math.floor(1e6*oe[0])/1e6*A,Math.floor(1e6*oe[1])/1e6*A,0),Ie=.5*p,Ue=[0,0,0];o.ad(Ue,rt,We),o.bY(Ue,Ue,Ie);const Ee=[Math.floor(Ue[0]),Math.floor(Ue[1]),Math.floor(Ue[2])],$e=[0,0,0];o.at($e,Ue,Ee),o.bY($e,$e,-1/Ie);const Fe=new Float64Array(16);return o.bx(Fe),o.bo(Fe,Fe,$e),o.az(We,Fe,We),[We,De]}class Wf extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return o.aS(this.requestManager.transformRequest(r,o.R.Model).url).then(u=>{if(!u)return;const p=o.aT(u),_=new o.aU(t,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(u=>{if(u&&u.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${t} from ${r}: ${u.message}`)))})}load(t,r,u={forceReload:!1}){this.models[r]||(this.models[r]={});const p=Object.keys(t),_=[],v=[];for(const w of p){const A=t[w];this.hasURLBeenRequested(A)&&!u.forceReload||(this.modelByURL[A]={modelId:w,scope:r},_.push(this.loadModel(w,A)),v.push(w)),this.models[r][w]||(this.models[r][w]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+v.length,Promise.allSettled(_).then(w=>{for(let A=0;A<w.length;A++){const{status:D}=w[A];if(D==="rejected")continue;const{value:L}=w[A];this.models[r][v[A]]||(this.models[r][v[A]]={model:null,numReferences:1}),this.models[r][v[A]].model=L}this.numModelsLoading[r]-=v.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(w=>{this.fire(new o.z(new Error(`Could not load models: ${w.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,r,u={exactIdMatch:!1}){return!!(u.exactIdMatch?this.getModel(t,r):this.getModelByURL(this.modelUris[r][t]))}getModel(t,r){return this.models[r]||(this.models[r]={}),this.models[r][t]?this.models[r][t].model:void 0}getModelByURL(t){if(!t)return null;const r=this.modelByURL[t];return r?this.models[r.scope][r.modelId].model:null}hasModelBeenAdded(t,r){return this.models[r]&&this.models[r][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,r,u){this.models[u]||(this.models[u]={}),this.modelUris[u]||(this.modelUris[u]={});const p=this.requestManager.normalizeModelURL(r);if((this.hasModel(t,u,{exactIdMatch:!0})||this.hasModelBeenAdded(t,u))&&this.modelUris[u][t]===p)this.models[u][t].numReferences++;else if(this.hasURLBeenRequested(p)){const{scope:_,modelId:v}=this.modelByURL[p];this.models[_][v].numReferences++}else this.modelUris[u][t]=p,this.load({[t]:this.modelUris[u][t]},u)}addModelURLs(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u=this.modelUris[r];for(const p in t)u[p]=this.requestManager.normalizeModelURL(t[p])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const u={};for(const p of t)this.hasModel(p,r,{exactIdMatch:!0})||this.hasURLBeenRequested(p)?this.models[r][p].numReferences++:this.modelUris[r][p]&&!this.hasURLBeenRequested(p)?u[p]=this.modelUris[r][p]:!this.hasURLBeenRequested(p)&&o.cZ(p,!1)&&(this.modelUris[r][p]=this.requestManager.normalizeModelURL(p),u[p]=this.modelUris[r][p]);this.load(u,r)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,r,u=!1){if(this.models[r]&&this.models[r][t]&&(this.models[r][t].numReferences--,this.models[r][t].numReferences===0)){const p=this.modelUris[r][t];u||delete this.modelUris[r][t],delete this.modelByURL[p];const _=this.models[r][t].model;if(!_)return;delete this.models[r][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const r of Object.keys(this.models[t])){const u=this.models[t][r].model;delete this.models[t][r],u&&u.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,r){this.models[r]||(this.models[r]={});for(const u in this.models[r])this.models[r][u].model&&this.models[r][u].model.upload(t.context)}}const zu=new o.a7({data:new o.a8(o.a5.colorTheme.data)}),$f={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function so(c){return c=c||{},Object.assign(c,$f)}class Yf extends o.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},o.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new o.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=this._map.transform.width,p=this._map.transform.height,_=u*(2/3),v=p*(2/3),w=.5*(u-_),A=.5*(p-v),D=[new o.P(w,A),new o.P(w+_,A+v)],L=this._map.queryRenderedFeatures(D,r);L.length>0?this._selectedFloorplan&&L[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=L[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,r=t?this._indoorData.buildings.find(w=>w.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,u=this._floorplanStates[this._indoorData.id].selectedLevel,p=this._indoorData.levels.find(w=>w.id===u),_=this._indoorData.levels.find(w=>!(!r||!r.levels)&&Number(w.levelOrder)===0&&r.levels.includes(w.id)),v=p?p.id:_?_.id:void 0;this.fire(new o.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),r&&this._buildingSelected(r,!1),v&&this._levelSelected(v)}_buildingSelected(t,r){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");r&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const u=this._indoorData.levels.filter(p=>t.levels.includes(p.id));this.fire(new o.A("buildingselected",{buildingId:t.id,levels:u}))}_levelSelected(t){const r=this._indoorData.levels.find(u=>u.id===t);r?(this._updateLevels(r,!0),this.fire(new o.A("levelselected",{levelId:r.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,r){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function u(D){const L=D.indexOf("/floor/");if(L===-1)return D;const k=L+7,O=D.indexOf("/",k);return O===-1?D.slice(k):D.slice(k,O)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const p=[],_={},v={},w={},A={};for(const D of this._indoorData.levels){if(p.push(D.id),_[D.id]=D.levelOrder>=0?3*Math.abs(D.levelOrder+1):3*Math.abs(D.levelOrder),v[D.id]=D.levelOrder>=0?3*D.levelOrder:0,this.mergeFloors){const L=u(t.id),k=u(D.id);w[D.id]=k===L?"true":"false"}else w[D.id]=D.id===t.id?"true":"false";A[D.id]=D.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",p]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const r={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},u=[new o.P(0,0),new o.P(this._map.transform.width,this._map.transform.height)],p=this._map.queryRenderedFeatures(u,r);if(p.length>0){for(const _ of p)if(JSON.parse(_.properties["indoor-data"]).id===t){this._selectedFloorplan=_,this._floorplanSelected();break}}}selectBuilding(t){const r=this._indoorData.buildings.find(u=>u.id===t);this._buildingSelected(r,!0)}selectLevel(t){this._levelSelected(t)}}function Bh(c){if(!c.metadata||!c.metadata.content_area)return;const t=o.q.devicePixelRatio,{left:r,top:u,width:p,height:_}=c.metadata.content_area,v=r*t,w=u*t;return[v,w,v+p*t,w+_*t]}function Nd(c){if(c)return c.map(([t,r])=>[t*o.q.devicePixelRatio,r*o.q.devicePixelRatio])}class Kf{constructor(t,r,u){this.id=t,this.scope=r,this.sourceCache=u,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(r.length===0)return t;const u=this.sourceCache.getSource();if(!(u instanceof ss))return t;const p=r.map(v=>this.sourceCache.getTile(v)),_=u.getImages(p,Array.from(this.pendingRequests));for(const[v,w]of _)t.set(o.I.from({name:v,iconsetId:this.id}),w),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const bo=(c,t)=>me(c,t&&t.filter(r=>r.identifier!=="source.canvas")),Kl=o.aF(ji,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Ud=o.aF(ji,["setCenter","setZoom","setBearing","setPitch"]),Fh=new Set(["background","sky","slot","custom"]),_l={version:8,layers:[],sources:{}},Vd={duration:300,delay:0};class hs extends o.E{constructor(t,r={}){super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=o.h({},Vd),this._buildingIndex=new Hf(this),this.crossTileSymbolIndex=new Jr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=r.styleChanges||new vr,this.dispatcher=r.dispatcher?r.dispatcher:new o.D(o.c$(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new Nl(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new o.d0(t._requestManager,r.localFontFamily?o.d1.all:r.localIdeographFontFamily?o.d1.ideographs:o.d1.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new Wf(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",o.d2());const u=this;this._rtlTextPluginCallback=hs.registerForPluginStateChange(p=>{u.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,v)=>{if(o.d3(_),v&&v.every(w=>w))for(const w in u._sourceCaches){const A=u._sourceCaches[w],D=A.getSource().type;D!=="vector"&&D!=="geojson"||A.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const v in this._layers){const w=this._layers[v];w.source===_.id&&this._validateLayer(w)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.j(t))return t;const r=o.d4(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch{return r}return r}return`json://${o.d5(JSON.stringify(t))}`}_diffStyle(t,r,u){this.globalId=this._getGlobalId(t);const p=(_,v)=>{try{v(null,this.setState(_,u))}catch(w){v(w,!1)}};if(typeof t=="string"){const _=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(_,o.R.Style);o.n(v,(w,A)=>{w?this.fire(new o.z(w)):A&&p(A,r)})}else typeof t=="object"&&p(t,r)}loadURL(t,r={}){this.fire(new o.A("dataloading",{dataType:"style"}));const u=typeof r.validate=="boolean"?r.validate:!o.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const p=this.importsCache.get(t);if(p)return this._load(p,u);const _=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.n(_,(v,w)=>{if(this._request=null,v)this.fire(new o.z(v));else if(w)return this.importsCache.set(t,w),this._load(w,u)})}loadJSON(t,r={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.q.frame(()=>{this._request=null,this._load(t,r.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(_l,!1)}_loadImports(t,r,u){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of t){const v=this._createFragmentStyle(_),w=new Promise(L=>{v.once("style.import.load",L),v.once("error",L)}).then(()=>this.mergeAll());if(p.push(w),this.resolvedImports.has(_.url)){v.loadEmpty();continue}const A=_.data||this.importsCache.get(_.url);A?(v.loadJSON(A,{validate:r}),this._isInternalStyle(A)&&(v.globalId=null)):_.url?v.loadURL(_.url,{validate:r}):v.loadEmpty();const D={style:v,id:_.id,config:_.config};if(u){const L=this.fragments.findIndex(({id:k})=>k===u);this.fragments=this.fragments.slice(0,L).concat(D).concat(this.fragments.slice(L))}else this.fragments.push(D)}return Promise.allSettled(p)}getImportGlobalIds(t=this,r=new Set){for(const u of t.fragments)u.style.globalId&&r.add(u.style.globalId),this.getImportGlobalIds(u.style,r);return[...r.values()]}_createFragmentStyle(t){const r=this.scope?o.C(t.id,this.scope):t.id;let u;const p=this._initialConfig&&this._initialConfig[r];(t.config||p)&&(u=o.h({},t.config,p));const _=new hs(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:u,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return _.setEventedParent(this.map,{style:_}),_}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,r){const u=t.indoor?so(t.schema):t.schema;if(this._isInternalStyle(t)){const v=o.h({},_l,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,r)}if(this.updateConfig(this._config,u),r&&bo(this,ks(t)))return;this._loaded=!0,this.stylesheet=o.d6(t);const p=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const D in t.iconsets)this.addIconset(D,t.iconsets[D]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=Eu(this.stylesheet.layers);if(this._order=v.map(D=>D.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new Oe(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Oe(this.stylesheet.light)),this._layers={};for(const D of v){const L=o.db(D,this.scope,this._styleColorTheme.lut,this.options);L.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const k=this.getOwnLayerSourceCache(L),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&L.canCastShadows()&&O&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const w=this.stylesheet.terrain;w&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(w,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const A=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new o.A(A?"style.load":"style.import.load"))}).catch(D=>{this.fire(new o.z(new Error("Failed to load imports",D))),this.fire(new o.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const _=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(_){const v=this._evaluateColorThemeData(_);this._loadColorTheme(v).then(()=>{p()}).catch(w=>{o.w(`Couldn't load color theme from the stylesheet: ${w}`),p()})}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,r,u,p,_,v,w,A,D,L;const k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(t=O.light),O.stylesheet.lights)for(const N of O.stylesheet.lights)N.type==="ambient"&&O.ambientLight!=null&&(r=O.ambientLight),N.type==="directional"&&O.directionalLight!=null&&(u=O.directionalLight);p=this._prioritizeTerrain(p,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(_=O.fog),O.stylesheet.snow&&O.snow!=null&&(v=O.snow),O.stylesheet.rain&&O.rain!=null&&(w=O.rain),O.stylesheet.camera!=null&&(L=O.stylesheet.camera),O.stylesheet.projection!=null&&(A=O.stylesheet.projection),O.stylesheet.transition!=null&&(D=O.stylesheet.transition),k[O.scope]=O._styleColorTheme}}),this.light=t,this.ambientLight=r,this.directionalLight=u,this.fog=_,this.snow=v,this.rain=w,this._styleColorThemeForScope=k,p===null?delete this.terrain:this.terrain=p,this.camera=L||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=o.h({},Vd,D),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const r=u=>{for(const p of u.fragments)r(p.style);t(u)};r(this)}_prioritizeTerrain(t,r,u){const p=t&&t.drapeRenderMode===0;return u===null?r&&r.drapeRenderMode===0?r:p?t:null:r!=null&&(!t||p||r&&r.drapeRenderMode===1)?r:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(r=>{t=this._prioritizeTerrain(t,r.terrain,r.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(r=>{r.stylesheet.projection!=null&&(t=r.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},r={},u={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const v=o.C(_,p.scope);t[v]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const v=o.C(_,p.scope);r[v]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const v=o.C(_,p.scope);u[v]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=u}mergeLayers(){const t={},r=[],u={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const v of _._order){const w=_._layers[v];if(w.type==="slot"){const A=o.d7(v);if(t[A])continue;t[A]=[]}w.slot&&t[w.slot]?t[w.slot].push(w):r.push(w)}}),this._mergedOrder=[];const p=(_=[])=>{for(const v of _)if(v.type==="slot"){const w=o.d7(v.id);t[w]&&p(t[w]),this._mergedSlots.push(w)}else{const w=o.C(v.id,v.scope);this._mergedOrder.push(w),u[w]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};p(r),this._mergedOrder.sort((_,v)=>{const w=u[_],A=u[v];return w.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:w.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=u,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=o.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(r,u,p,_){const v=o.h({},u);for(const A of Object.keys(o.a5.colorTheme))v[A]===void 0&&(v[A]=o.a5.colorTheme[A].default);const w=new o.a6(zu,r,new Map(p));return w.setTransitionOrValue(v,p),w.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((u,p)=>{const _="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void u();let v=t;v.startsWith(_)||(v=_+v);const w=o.I.from("mapbox-reserved-lut"),A=new Image;A.src=v,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,p(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void u();this._styleColorTheme.lutLoading=!1;const{width:D,height:L,data:k}=o.q.getImageData(A);if(L>32)return void p(new Error("The height of the image must be less than or equal to 32 pixels."));if(D!==L*L)return void p(new Error("The width of the image must be equal to the height squared."));this.getImage(w)&&this.removeImage(w),this.addImage(w,{data:new o.r({width:D,height:L},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(w,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:t},u()):p(new Error("Missing LUT image."))}})}getLut(t){const r=this._styleColorThemeForScope[t];return r?r.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(r,u,p){let _,v,w;const A=o.q.devicePixelRatio>1?"@2x":"";let D=o.n(u.transformRequest(u.normalizeSpriteURL(r,A,".json"),o.R.SpriteJSON),(O,N)=>{D=null,w||(w=O,_=N,k())}),L=o.o(u.transformRequest(u.normalizeSpriteURL(r,A,".png"),o.R.SpriteImage),(O,N)=>{L=null,w||(w=O,v=N,k())});function k(){if(w)p(w);else if(_&&v){const O=o.q.getImageData(v),N={};for(const Z in _){const{width:j,height:X,x:Y,y:J,sdf:oe,pixelRatio:ce,stretchX:ye,stretchY:fe,content:de}=_[Z],he=new o.r({width:j,height:X});o.r.copy(O,he,{x:Y,y:J},{x:0,y:0},{width:j,height:X},null),N[Z]={data:he,pixelRatio:ce,sdf:oe,stretchX:ye,stretchY:fe,content:de,usvg:!1}}p(null,N)}}return{cancel(){D&&(D.cancel(),D=null),L&&(L.cancel(),L=null)}}}(t,this.map._requestManager,(r,u)=>{if(this._spriteRequest=null,r)this.fire(new o.z(r));else if(u){const p=new Map;for(const _ in u)p.set(o.I.from(_),u[_]);this.addImages(p)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(t,r){if(r.type==="sprite")return void this._loadSprite(r.url);const u=this.getOwnSourceCache(r.source);if(!u)return void this.fire(new o.z(new Error(`Source "${r.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const p=u.getSource();if(p.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${r.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));p.partial=!1;const _=new Kf(t,this.scope,u);this.imageManager.addImageProvider(_,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const r=this.map._spriteFormat==="auto";var u,p;this._spriteRequest=(p=(_,v)=>{if(this._spriteRequest=null,_)r?this._loadSprite(t):this.fire(new o.z(_));else if(v){const w=new Map;for(const A in v)w.set(o.I.from(A),v[A]);this.addImages(w)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((u=this.map._requestManager).transformRequest(u.normalizeIconsetURL(t),o.R.Iconset),(_,v)=>{if(_)return void p(_);const w={},A=o.c_(new o.bq(v));for(const D of A.icons){const L={version:1,pixelRatio:o.q.devicePixelRatio,content:Bh(D),stretchX:D.metadata?Nd(D.metadata.stretch_x_areas):void 0,stretchY:D.metadata?Nd(D.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:D};w[D.name]=L}p(null,w)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const u=t.sourceLayer;u&&(r.type==="geojson"||r.vectorLayerIds&&r.vectorLayerIds.indexOf(u)===-1)&&this.fire(new o.z(new Error(`Source layer "${u}" does not exist on source "${r.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,r)=>{const u=this.fragments[r];return u&&u.style&&(t.data=u.style.serialize()),t})}_serializeSources(){const t={};for(const r in this._sourceCaches){const u=this._sourceCaches[r].getSource();t[u.id]||(t[u.id]=u.serialize())}return t}_serializeLayers(t){const r=[];for(const u of t){const p=this._layers[u];p&&p.type!=="custom"&&r.push(p.serialize())}return r}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new o.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new o.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,r){const u=this.map.painter;if(u)for(let p=t.minzoom||0;p<(t.maxzoom||25.5);p++){const _=t.getProgramIds();if(_)for(const v of _){const w=t.getDefaultProgramParams(v,r.zoom,this._styleColorTheme.lut);w&&(u.style=this,this.fog&&(u._fogVisible=!0,w.overrideFog=!0,u.getOrCreateProgram(v,w)),u._fogVisible=!1,w.overrideFog=!1,u.getOrCreateProgram(v,w),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(w.overrideRtt=!0,u.getOrCreateProgram(v,w)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const u=this._changes.isDirty();let p=!1;if(this._changes.isDirty()){const w=this._changes.getLayerUpdatesByScope();for(const A in w){const{updatedIds:D,removedIds:L}=w[A];(D||L)&&(this._updateWorkerLayers(A,D,L),p=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const _={};for(const w in this._mergedSourceCaches){const A=this._mergedSourceCaches[w];_[w]=A.used,A.used=!1,A.tileCoverLift=0}for(const w of this._mergedOrder){const A=this._mergedLayers[w];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const D=this.getLayerSourceCache(A);D&&(D.used=!0,D.tileCoverLift=Math.max(D.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&p&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const w of v)w.sourceCache.used=!0;for(const w in _){const A=this._mergedSourceCaches[w];_[w]!==A.used&&A.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),u&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const r of t){const u=r.resolvePendingRequests(),p=this.getFragmentStyle(r.scope);p&&p.addImages(u)}}_updateTilesForChangedImages(){const t={};for(const r in this._mergedSourceCaches){const u=this._mergedSourceCaches[r].getSource().scope;t[u]=t[u]||this._changes.getUpdatedImages(u),t[u].length!==0&&this._mergedSourceCaches[r].reloadTilesForDependencies(["icons","patterns"],t[u])}for(const r in t)this._changes.resetUpdatedImages(r)}_updateWorkerLayers(t,r,u){const p=this.getFragmentStyle(t);p&&this.dispatcher.broadcast("updateLayers",{layers:r?p._serializeLayers(r):[],scope:t,removedIds:u||[],options:p.options})}setState(t,r){if(this._checkLoaded(),bo(this,ks(t)))return!1;(t=o.d6(t)).layers=Eu(t.layers);const u=function(v,w){if(!v)return[{command:ji.setStyle,args:[w]}];let A=[];try{if(!o.bv(v.version,w.version))return[{command:ji.setStyle,args:[w]}];if(o.bv(v.center,w.center)||A.push({command:ji.setCenter,args:[w.center]}),o.bv(v.zoom,w.zoom)||A.push({command:ji.setZoom,args:[w.zoom]}),o.bv(v.bearing,w.bearing)||A.push({command:ji.setBearing,args:[w.bearing]}),o.bv(v.pitch,w.pitch)||A.push({command:ji.setPitch,args:[w.pitch]}),o.bv(v.sprite,w.sprite)||A.push({command:ji.setSprite,args:[w.sprite]}),o.bv(v.glyphs,w.glyphs)||A.push({command:ji.setGlyphs,args:[w.glyphs]}),o.bv(v.imports,w.imports)||function(N=[],Z=[],j){Z=Z||[];const X=(N=N||[]).map(Aa),Y=Z.map(Aa),J=N.reduce(ul,{}),oe=Z.reduce(ul,{}),ce=X.slice();let ye,fe,de,he;for(ye=0,fe=0;ye<X.length;ye++)de=X[ye],oe.hasOwnProperty(de)?fe++:(j.push({command:ji.removeImport,args:[de]}),ce.splice(ce.indexOf(de,fe),1));for(ye=0,fe=0;ye<Y.length;ye++)de=Y[Y.length-1-ye],ce[ce.length-1-ye]!==de&&(J.hasOwnProperty(de)?(j.push({command:ji.removeImport,args:[de]}),ce.splice(ce.lastIndexOf(de,ce.length-fe),1)):fe++,he=ce[ce.length-ye],j.push({command:ji.addImport,args:[oe[de],he]}),ce.splice(ce.length-ye,0,de));for(const _e of Z){const be=J[_e.id];be&&(delete be.data,o.bv(be,_e)||j.push({command:ji.updateImport,args:[_e.id,_e]}))}}(v.imports,w.imports,A),o.bv(v.transition,w.transition)||A.push({command:ji.setTransition,args:[w.transition]}),o.bv(v.light,w.light)||A.push({command:ji.setLight,args:[w.light]}),o.bv(v.fog,w.fog)||A.push({command:ji.setFog,args:[w.fog]}),o.bv(v.snow,w.snow)||A.push({command:ji.setSnow,args:[w.snow]}),o.bv(v.rain,w.rain)||A.push({command:ji.setRain,args:[w.rain]}),o.bv(v.projection,w.projection)||A.push({command:ji.setProjection,args:[w.projection]}),o.bv(v.lights,w.lights)||A.push({command:ji.setLights,args:[w.lights]}),o.bv(v.camera,w.camera)||A.push({command:ji.setCamera,args:[w.camera]}),o.bv(v.iconsets,w.iconsets)||function(N,Z,j){let X;for(X in Z=Z||{},N=N||{})N.hasOwnProperty(X)&&(Z.hasOwnProperty(X)||j.push({command:ji.removeIconset,args:[X]}));for(X in Z){if(!Z.hasOwnProperty(X))continue;const Y=Z[X];N.hasOwnProperty(X)?o.bv(N[X],Y)||(j.push({command:ji.removeIconset,args:[X]}),j.push({command:ji.addIconset,args:[X,Y]})):j.push({command:ji.addIconset,args:[X,Y]})}}(v.iconsets,w.iconsets,A),!o.bv(v["color-theme"],w["color-theme"]))return[{command:ji.setStyle,args:[w]}];const D={},L=[];(function(N,Z,j,X){let Y;for(Y in Z=Z||{},N=N||{})N.hasOwnProperty(Y)&&(Z.hasOwnProperty(Y)||Gl(Y,j,X));for(Y in Z){if(!Z.hasOwnProperty(Y))continue;const J=Z[Y];N.hasOwnProperty(Y)?o.bv(N[Y],J)||(N[Y].type==="geojson"&&J.type==="geojson"&&Hl(N,Z,Y)?j.push({command:ji.setGeoJSONSourceData,args:[Y,J.data]}):cl(Y,Z,j,X)):Do(Y,Z,j)}})(v.sources,w.sources,L,D);const k=[];v.layers&&v.layers.forEach(N=>{N.source&&D[N.source]?A.push({command:ji.removeLayer,args:[N.id]}):k.push(N)});let O=v.terrain;O&&D[O.source]&&(A.push({command:ji.setTerrain,args:[void 0]}),O=void 0),A=A.concat(L),o.bv(O,w.terrain)||A.push({command:ji.setTerrain,args:[w.terrain]}),function(N,Z,j){Z=Z||[];const X=(N=N||[]).map(Aa),Y=Z.map(Aa),J=N.reduce(ul,{}),oe=Z.reduce(ul,{}),ce=X.slice(),ye=Object.create(null);let fe,de,he,_e,be,De,ze;for(fe=0,de=0;fe<X.length;fe++)he=X[fe],oe.hasOwnProperty(he)?de++:(j.push({command:ji.removeLayer,args:[he]}),ce.splice(ce.indexOf(he,de),1));for(fe=0,de=0;fe<Y.length;fe++)he=Y[Y.length-1-fe],ce[ce.length-1-fe]!==he&&(J.hasOwnProperty(he)?(j.push({command:ji.removeLayer,args:[he]}),ce.splice(ce.lastIndexOf(he,ce.length-de),1)):de++,De=ce[ce.length-fe],j.push({command:ji.addLayer,args:[oe[he],De]}),ce.splice(ce.length-fe,0,he),ye[he]=!0);for(fe=0;fe<Y.length;fe++)if(he=Y[fe],_e=J[he],be=oe[he],!ye[he]&&!o.bv(_e,be))if(o.bv(_e.source,be.source)&&o.bv(_e["source-layer"],be["source-layer"])&&o.bv(_e.type,be.type)){for(ze in Cc(_e.layout,be.layout,j,he,null,ji.setLayoutProperty),Cc(_e.paint,be.paint,j,he,null,ji.setPaintProperty),o.bv(_e.slot,be.slot)||j.push({command:ji.setSlot,args:[he,be.slot]}),o.bv(_e.filter,be.filter)||j.push({command:ji.setFilter,args:[he,be.filter]}),o.bv(_e.minzoom,be.minzoom)&&o.bv(_e.maxzoom,be.maxzoom)||j.push({command:ji.setLayerZoomRange,args:[he,be.minzoom,be.maxzoom]}),_e)_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?Cc(_e[ze],be[ze],j,he,ze.slice(6),ji.setPaintProperty):o.bv(_e[ze],be[ze])||j.push({command:ji.setLayerProperty,args:[he,ze,be[ze]]}));for(ze in be)be.hasOwnProperty(ze)&&!_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?Cc(_e[ze],be[ze],j,he,ze.slice(6),ji.setPaintProperty):o.bv(_e[ze],be[ze])||j.push({command:ji.setLayerProperty,args:[he,ze,be[ze]]}))}else j.push({command:ji.removeLayer,args:[he]}),De=ce[ce.lastIndexOf(he)+1],j.push({command:ji.addLayer,args:[be,De]})}(k,w.layers,A)}catch(D){console.warn("Unable to compute style diff:",D),A=[{command:ji.setStyle,args:[w]}]}return A}(this.serialize(),t).filter(v=>!(v.command in Ud));if(u.length===0)return!1;const p=u.filter(v=>!(v.command in Kl));if(p.length>0)throw new Error(`Unimplemented: ${p.map(v=>v.command).join(", ")}.`);const _=[];return u.forEach(v=>{_.push(this[v.command](...v.args))}),r&&Promise.all(_).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[r,u]of t.entries()){if(this.getImage(r))return this.fire(new o.z(new Error(`An image with the name "${r.name}" already exists.`)));this.imageManager.addImage(r,this.scope,u),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new o.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(t,r,u=!1){this.imageManager.updateImage(t,this.scope,r),u&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(t,r,u={}){return this._checkLoaded(),this._validate(le,`models.${t}`,r,null,u)||(this.modelManager.addModel(t,r,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,r,u={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!r.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(r).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Sc,`sources.${t}`,r,null,u))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const p=Eh(t,r,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=v=>{const w=(v?"symbol:":"other:")+p.id,A=o.C(w,this.scope),D=this._sourceCaches[w]=new ws(A,p,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=D,D.onAdd(this.map)};_(!1),r.type!=="vector"&&r.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),u.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const p=Object.entries(this.stylesheet.iconsets).find(([_,v])=>v.type==="source"&&v.source===t);if(p)return this.fire(new o.z(new Error(`Source "${t}" cannot be removed while iconset "${p[0]}" is using it.`)))}const u=this.getOwnSourceCaches(t);for(const p of u){const _=o.d7(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,r){this._checkLoaded(),this.getOwnSource(t).setData(r),this._changes.setDirty()}getOwnSource(t){const r=this.getOwnSourceCache(t);return r&&r.getSource()}getOwnSources(){const t=[];for(const r in this._otherSourceCaches){const u=this.getOwnSourceCache(r);u&&t.push(u.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const r in t){const u=t[r]._tiles;for(const p in u){const _=u[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const _ of t){if(this._validate(Vl,"lights",_))return;switch(_.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(_),v.updateTransitions(r)}else this.ambientLight=new tn(_,vi||(vi=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(_),v.updateTransitions(r)}else this.directionalLight=new tn(_,gn||(gn=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const u=Object.assign(r,{worldview:this.map.getWorldview()}),p=new o.aa(this.z||0,u);this.ambientLight&&this.ambientLight.recalculate(p),this.directionalLight&&this.directionalLight.recalculate(p),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const u=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),p=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),_=t.properties.get("intensity"),v=t.properties.get("direction"),w=1-o.cR(v.x,v.y,v.z)[2]/90,A=u(p)*_*w,D=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),L=r.properties.get("intensity"),k=u(D)*L;return Number(((A+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.d8(t)){const r=o.d9(t),u=this.fragments.find(({id:_})=>_===r);if(!u)return;const p=o.d7(t);return u.style.getFragmentStyle(p)}{const r=this.fragments.find(({id:u})=>u===t);return r?r.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},u=(p,_="")=>`${p}::${_}`;this._featuresetSelectors={};for(const p in t){const _=this._featuresetSelectors[p]=[];for(const v of t[p].selectors){if(v.featureNamespace){const A=this.getOwnLayer(v.layer);if(!A){o.w(`Layer is undefined for selector: ${v.layer}`);continue}const D=u(A.source,A.sourceLayer);if(D in r&&r[D]!==v.featureNamespace){o.w(`"featureNamespace ${v.featureNamespace} of featureset ${p}'s selector is not associated to the same source, skip this selector`);continue}r[D]=v.featureNamespace}let w;if(v.properties)for(const A in v.properties){const D=o.X(v.properties[A]);D.result==="success"&&(w=w||{},w[A]=D.value)}_.push({layerId:v.layer,namespace:v.featureNamespace,properties:w,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const r=this.getFragmentStyle(t);if(!r||!r.stylesheet.featuresets)return[];const u=[];for(const p in r.stylesheet.featuresets)u.push({featuresetId:p,importId:r.scope?r.scope:void 0});return u}getFeaturesetLayers(t,r){const u=this.getFragmentStyle(r),p=u.stylesheet.featuresets;if(!p||!p[t])return this.fire(new o.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const _=[];for(const v of p[t].selectors){const w=u.getOwnLayer(v.layer);w&&_.push(w)}return _}getConfigProperty(t,r){const u=this.getFragmentStyle(t);if(!u)return null;const p=o.C(r,u.scope),_=u.options.get(p),v=_?_.value||_.default:null;return v?v.serialize():null}setConfigProperty(t,r,u){const p=this.getFragmentStyle(t);if(!p)return;const _=p.stylesheet.indoor?so(p.stylesheet.schema):p.stylesheet.schema;if(!_||!_[r])return;const v=o.X(u);if(v.result!=="success")return void bo(this,v.value);const w=v.value.expression,A=o.C(r,p.scope),D=p.options.get(A);if(!D)return;let L;const{minValue:k,maxValue:O,stepValue:N,type:Z,values:j}=_[r],X=o.X(_[r].default);X.result==="success"&&(L=X.value.expression),L?(this.options.set(A,Object.assign({},D,{value:w,default:L,minValue:k,maxValue:O,stepValue:N,type:Z,values:j})),this.updateConfigDependencies(r)):this.fire(new o.z(new Error(`No schema defined for the config option "${r}" in the "${t}" fragment.`)))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const u=r.stylesheet.schema;if(!u)return null;const p={};for(const _ in u){const v=o.C(_,r.scope),w=r.options.get(v),A=w?w.value||w.default:null;p[_]=A?A.serialize():null}return p}setConfig(t,r){const u=this.getFragmentStyle(t);u&&(u.updateConfig(r,u.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const r=this.getFragmentStyle(t);return r?r.stylesheet.schema:null}setSchema(t,r){const u=this.getFragmentStyle(t);u&&(u.stylesheet.schema=r,u.updateConfig(u._config,r),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const u in r){let p,_;const v=o.X(r[u].default);if(v.result==="success"&&(p=v.value.expression),t&&t[u]!==void 0){const O=o.X(t[u]);O.result==="success"&&(_=O.value.expression)}const{minValue:w,maxValue:A,stepValue:D,type:L,values:k}=r[u];if(p){const O=o.C(u,this.scope);this.options.set(O,{default:p,value:_,minValue:w,maxValue:A,stepValue:D,type:L,values:k})}else this.fire(new o.z(new Error(`No schema defined for config option "${u}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const r of this._configDependentLayers){const u=this.getLayer(r);if(u){if(t&&!u.configDependencies.has(t))continue;u.possiblyEvaluateVisibility(),this._updateLayer(u)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(r=>{const u=r._styleColorTheme.colorThemeOverride?r._styleColorTheme.colorThemeOverride:r._styleColorTheme.colorTheme;if(u){const p=r._evaluateColorThemeData(u);(!r._styleColorTheme.lut&&p!==""||r._styleColorTheme.lut&&p!==r._styleColorTheme.lut.data)&&r.setColorTheme(u)}}),this._changes.setDirty()}addLayer(t,r,u={}){this._checkLoaded();const p=t.id;if(this._layers[p])return void this.fire(new o.z(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(t.type==="custom"){if(bo(this,o.da(t)))return;_=o.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=o.d6(t),t=o.h(t,{source:p})),this._validate(en,`layers.${p}`,t,{arrayIndex:-1},u))return;_=o.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}})}_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid);let v=this._order.length;if(r){const L=this._order.indexOf(r);if(L===-1)return void this.fire(new o.z(new Error(`Layer with id "${r}" does not exist on this map.`)));_.slot===this._layers[r].slot?v=L:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const w=this.getOwnLayerSourceCache(_),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();w&&_.canCastShadows()&&A&&(w.castsShadows=!0);const D=this._changes.getRemovedLayer(_);if(D&&_.source&&w&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const L=o.C(_.source,_.scope);D.type!==_.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),w.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const u=this._checkLayer(t);if(!u||t===r)return;const p=this._order.indexOf(t);this._order.splice(p,1);let _=this._order.length;if(r){const v=this._order.indexOf(r);if(v===-1)return void this.fire(new o.z(new Error(`Layer with id "${r}" does not exist on this map.`)));u.slot===this._layers[r].slot?_=v:o.w(`Layer with id "${r}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const r=this._checkLayer(t);if(!r)return;r.setEventedParent(null);const u=this._order.indexOf(t);this._order.splice(u,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(r.fqid),this._changes.removeLayer(r);const p=this.getOwnLayerSourceCache(r);if(p&&p.castsShadows){let _=!1;for(const v in this._layers)if(this._layers[v].source===r.source&&this._layers[v].canCastShadows()){_=!0;break}p.castsShadows=_}r.onRemove&&r.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const r in this._layers)if(this._layers[r].type===t)return!0;return!1}setLayerZoomRange(t,r,u){this._checkLoaded();const p=this._checkLayer(t);p&&(p.minzoom===r&&p.maxzoom===u||(r!=null&&(p.minzoom=r),u!=null&&(p.maxzoom=u),this._updateLayer(p)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,r){this._checkLoaded();const u=this._checkLayer(t);u&&u.slot!==r&&(u.slot=r,this._updateLayer(u))}setFilter(t,r,u={}){this._checkLoaded();const p=this._checkLayer(t);if(p&&!o.bv(p.filter,r))return r==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Be,`layers.${p.id}.filter`,r,{layerType:p.type},u)||(p.filter=o.d6(r),this._updateLayer(p)))}getFilter(t){const r=this._checkLayer(t);if(r)return o.d6(r.filter)}setLayoutProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!o.bv(_.getLayoutProperty(r),u)){if(u!=null&&(!p||p.validate!==!1)&&bo(_,K.call(ks,{key:`layers.${t}.layout.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(r,u),_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(t,r){const u=this._checkLayer(t);if(u)return u.getLayoutProperty(r)}setPaintProperty(t,r,u,p={}){this._checkLoaded();const _=this._checkLayer(t);if(!_||o.bv(_.getPaintProperty(r),u)||u!=null&&(!p||p.validate!==!1)&&bo(_,W.call(ks,{key:`layers.${t}.paint.${r}`,layerType:_.type,objectKey:r,value:u,styleSpec:o.a5})))return;const v=_.setPaintProperty(r,u);_.configDependencies.size!==0&&this._configDependentLayers.add(_.fqid),v&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(t,r){const u=this._checkLayer(t);if(u)return u.getPaintProperty(r)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:D}=t.target,L=this.getFragmentStyle(D),k=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:N}of k)L.setFeatureState({id:t.id,source:O,sourceLayer:N},r)}else if("layerId"in t.target){const{layerId:A}=t.target,D=this.getLayer(A);this.setFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},r)}return}const u=t.source,p=t.sourceLayer,_=this._checkSource(u);if(!_)return;const v=_.type;if(v==="geojson"&&p)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!p)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.setFeatureState(p,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:D}=t.target,L=this.getFragmentStyle(D),k=L.getFeaturesetLayers(A);for(const{source:O,sourceLayer:N}of k)L.removeFeatureState({id:t.id,source:O,sourceLayer:N},r)}else if("layerId"in t.target){const{layerId:A}=t.target,D=this.getLayer(A);this.removeFeatureState({id:t.id,source:D.source,sourceLayer:D.sourceLayer},r)}return}const u=t.source,p=this._checkSource(u);if(!p)return;const _=p.type,v=_==="vector"?t.sourceLayer:void 0;if(_==="vector"&&!v)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const w=this.getOwnSourceCaches(u);for(const A of w)A.removeFeatureState(v,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let _;if("featuresetId"in t.target){const{featuresetId:v,importId:w}=t.target,A=this.getFragmentStyle(w),D=A.getFeaturesetLayers(v);for(const{source:L,sourceLayer:k}of D){const O=A.getFeatureState({id:t.id,source:L,sourceLayer:k});if(O&&!_)_=O;else if(!o.bv(_,O))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,w=this.getLayer(v);_=this.getFeatureState({id:t.id,source:w.source,sourceLayer:w.sourceLayer})}return _}const r=t.source,u=t.sourceLayer,p=this._checkSource(r);if(p){if(p.type!=="vector"||u)return t.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(u,t.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=o.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},u=>u!==void 0)}_updateFilteredLayers(t){for(const r of Object.values(this._mergedLayers))t(r)&&this._updateLayer(r)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),u=o.C(t.source,t.scope),p=this._changes.getUpdatedSourceCaches();t.source&&!p[u]&&r&&r.getSource().type!=="raster"&&(this._changes.updateSourceCache(u,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const r=w=>this._mergedLayers[w].is3D(!!this.terrain),u=this.order,p={},_=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(r(A)){p[A]=w;for(const D of t){const L=D[A];if(L)for(const k of L)_.push(k)}}}_.sort((w,A)=>A.intersectionZ-w.intersectionZ);const v=[];for(let w=u.length-1;w>=0;w--){const A=u[w];if(r(A))for(let D=_.length-1;D>=0;D--){const L=_[D].feature;if(L.layer&&p[L.layer.id]<w)break;v.push(L),_.pop()}else for(const D of t){const L=D[A];if(L)for(const k of L)v.push(k.feature)}}return v}queryRenderedFeatures(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Be,"queryRenderedFeatures.filter",r.filter,null,r),p=o.b3(r.filter));const _={},v=L=>{if(Fh.has(L.type))return;const k=this.getOwnLayerSourceCache(L),O=_[k.id]=_[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};L.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[L.fqid]=O.layers[L.fqid]||{styleLayer:L,targets:[]},O.layers[L.fqid].targets.push({filter:p})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const L of r.layers){const k=this._layers[L];if(!k)return this.fire(new o.z(new Error(`The layer '${L}' does not exist in the map's style and cannot be queried for features.`))),[];v(k)}}else for(const L in this._layers)v(this._layers[L]);const w=this._queryRenderedFeatures(t,_,u),A=this._flattenAndSortRenderedFeatures(w),D=[];for(const L of A)o.dd(L.layer.id)===this.scope&&D.push(L);return D}queryRenderedFeatureset(t,r,u){let p;r&&!Array.isArray(r)&&r.filter&&(this._validate(Be,"queryRenderedFeatures.filter",r.filter,null,r),p=o.b3(r.filter));const _="mock",v=[];if(r&&r.target)v.push(Object.assign({},r,{targetId:_,filter:p}));else{const L=this.getFeaturesetDescriptors();for(const k of L)v.push({targetId:_,filter:p,target:k});for(const{style:k}of this.fragments){const O=k.getFeaturesetDescriptors();for(const N of O)v.push({targetId:_,filter:p,target:N})}}const w=this.queryRenderedTargets(t,v,u),A=[],D=new Set;for(const L of w)for(const k of L.variants[_])Ah(k,L,D)||A.push(new o.de(L,k));return A}queryRenderedTargets(t,r,u){const p={},_=(w,A,D,L)=>{const k=p[A.id]=p[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(k.layers[w.fqid]=k.layers[w.fqid]||{styleLayer:w,targets:[]},w.is3D(!!this.terrain)&&(k.has3DLayers=!0),!L)return D.uniqueFeatureID=!1,void k.layers[w.fqid].targets.push(D);k.layers[w.fqid].targets.push(Object.assign({},D,{namespace:L.namespace,properties:L.properties,uniqueFeatureID:L.uniqueFeatureID}))};for(const w of r)if("featuresetId"in w.target){const{featuresetId:A,importId:D}=w.target,L=this.getFragmentStyle(D);if(!L||!L._featuresetSelectors)continue;const k=L._featuresetSelectors[A];if(!k){this.fire(new o.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of k){const N=L.getOwnLayer(O.layerId);N&&!Fh.has(N.type)&&_(N,L.getOwnLayerSourceCache(N),w,O)}}else if("layerId"in w.target){const{layerId:A}=w.target,D=this.getLayer(A);if(!D||Fh.has(D.type))continue;_(D,this.getLayerSourceCache(D),w)}const v=this._queryRenderedFeatures(t,p,u);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,r,u){const p=[],_=!!this.map._showQueryGeometry,v=Xi.createFromScreenPoints(t,u);for(const w in r){const A=Ec(v,r[w],this._availableImages,u,_);Object.keys(A).length&&p.push(A)}if(this.placement)for(const w in r){if(!r[w].sourceCache._onlySymbols)continue;const A=Ac(v.screenGeometry,r[w],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&p.push(A)}return p}querySourceFeatures(t,r){const u=r&&r.filter;u&&this._validate(Be,"querySourceFeatures.filter",u,null,r);let p=[];const _=this.getOwnSourceCaches(t);for(const v of _)p=p.concat(Bs(v,r));return p}addSourceType(t,r,u){return hs.getSourceType(t)?u(new Error(`A source type called "${t}" already exists.`)):(hs.setSourceType(t,r),r.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:r.workerSourceURL},u):u(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r,u={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const w in t)if(!o.bv(t[w],p[w])){_=!0;break}if(!_)return;const v=this._getTransitionParameters();this.light.setLight(t,r,u),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,r=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),r===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let u=t;const p=t.source==null;if(r===1){if(this.disableElevatedTerrain)return;if(typeof u.source=="object"){const w="terrain-dem-src";this.addSource(w,u.source),u=o.d6(u),u=o.h(u,{source:w})}const _=o.h({},u),v={};if(this.terrain&&p){_.source=this.terrain.get().source;const w=this.terrain?this.getFragmentStyle(this.terrain.scope):null;w&&(v.style=w.serialize())}if(this._validate(Tt,"terrain",_,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&r!==this.terrain.drapeRenderMode){if(!u)return;this._createTerrain(u,r),this.fire(new o.A("data",{dataType:"style"}))}else{const _=this.terrain,v=_.get();for(const w of Object.keys(o.a5.terrain))!u.hasOwnProperty(w)&&o.a5.terrain[w].default&&(u[w]=o.a5.terrain[w].default);for(const w in t)if(!o.bv(t[w],v[w])){_.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});_.updateTransitions(A),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const r=this.fog=new fi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createSnow(t){const r=this.snow=new Ln(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_createRain(t){const r=this.rain=new Nn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!o.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!o.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!o.bv(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const u=this._getTransitionParameters({duration:0});r.updateTransitions(u)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const p in this._layers)this._layers[p].lut=this._styleColorTheme.lut;for(const p in this._sourceCaches)this._sourceCaches[p].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const u=this._evaluateColorThemeData(r);this._loadColorTheme(u).then(()=>{this.fire(new o.A("colorthemeset")),t()}).catch(p=>{o.w(`Couldn't set color theme: ${p}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,r){const u=this.getFragmentStyle(t);u&&(u._styleColorTheme.colorThemeOverride=r,u._reloadColorTheme())}_getTransitionParameters(t){return{now:o.q.now(),transition:o.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],r=[];for(const u of this._mergedOrder)this.isLayerDraped(this._mergedLayers[u])?t.push(u):r.push(u);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...r)}_createTerrain(t,r){const u=this.terrain=new Ae(t,r,this.scope,this.options,this.map.getWorldview());r===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});u.updateTransitions(p)}_force3DLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="fill-extrusion"&&this._updateLayer(r)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const r=this._layers[t];r.type==="symbol"&&this._updateLayer(r)}}_validate(t,r,u,p,_={}){if(_&&_.validate===!1)return!1;const v=o.h({},this.serialize());return bo(this,t.call(ks,o.h({key:r,style:v,value:u,styleSpec:o.a5},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const r=this.getSourceCaches(t);for(const u of r)u.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const r=this.getSourceCaches(t);for(const u of r)u.resume(),u.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let r;this.directionalLight&&(r=Oc(this.directionalLight));const u=new Set;for(const p in this._mergedLayers){const _=this._mergedLayers[p];_.hasElevation()&&!u.has(_.source)&&u.add(_.source)}for(const p in this._mergedSourceCaches){const _=this._mergedSourceCaches[p],v=u.has(_._source.id);_.update(t,void 0,void 0,r,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const r=this._sourceCaches[t];r.resume(),r.reload()}}_updatePlacement(t,r,u,p,_,v,w=!1){let A=!1,D=!1;const L={},k={};for(const O of this._mergedOrder){const N=this._mergedLayers[O];if(N.type!=="symbol")continue;const Z=o.C(N.source,N.scope);let j=L[Z];if(!j){const Y=this.getLayerSourceCache(N);if(!Y)continue;const J=Y.getRenderableIds(!0).map(oe=>Y.getTileByID(oe));k[Z]=J.slice(),j=L[Z]=J.sort((oe,ce)=>ce.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(ce.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(N,j,r.center.lng,r.projection);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),w=w||this._layerOrderChanged||p===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(w||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),r.zoom))&&(this.pauseablePlacement=new Ph(r,this._mergedOrder,w,u,p,_,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),D=!0),A&&this.pauseablePlacement.placement.setStale()),D||A){this._buildingIndex.onNewFrame(r.zoom);for(let O=0;O<this._mergedOrder.length;O++){const N=this._mergedLayers[this._mergedOrder[O]];if(N.type!=="symbol")continue;const Z=this.isLayerClipped(N);this.placement.updateLayerOpacities(N,L[o.C(N.source,N.scope)],O,Z?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const u=this.stylesheet.imports=this.stylesheet.imports||[];if(u.findIndex(({id:_})=>_===t.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!r)return u.push(t),this._loadImports([t],!0);const p=u.findIndex(({id:_})=>_===r);return p===-1&&this.fire(new o.z(new Error(`Import with id "${r}" does not exist on this map.`))),this.stylesheet.imports=u.slice(0,p).concat(t).concat(u.slice(p)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);return p===-1?this:typeof r=="string"?(this.setImportUrl(t,r),this):(r.url&&r.url!==u[p].url&&this.setImportUrl(t,r.url),o.bv(r.config,u[p].config)||this.setImportConfig(t,r.config,r.data.schema),o.bv(r.data,u[p].data)||this.setImportData(t,r.data),this)}moveImport(t,r){this._checkLoaded();let u=this.stylesheet.imports||[];const p=this.getImportIndex(t);if(p===-1)return this;const _=this.getImportIndex(r);if(_===-1)return this;const v=u[p],w=this.fragments[p];return u=u.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=u.slice(0,_).concat(v).concat(u.slice(_)),this.fragments=this.fragments.slice(0,_).concat(w).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(t,r){this._checkLoaded();const u=this.stylesheet.imports||[],p=this.getImportIndex(t);if(p===-1)return this;u[p].url=r;const _=this.fragments[p];return _.style=this._createFragmentStyle(u[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(r),this}setImportData(t,r){this._checkLoaded();const u=this.getImportIndex(t),p=this.stylesheet.imports||[];return u===-1?this:r?(this.fragments[u].style.setState(r),this._reloadImports(),this):(delete p[u].data,this.setImportUrl(t,p[u].url))}setImportConfig(t,r,u){this._checkLoaded();const p=this.getImportIndex(t),_=this.stylesheet.imports||[];if(p===-1)return this;r?_[p].config=r:delete _[p].config;const v=this.fragments[p];u&&v.style.stylesheet&&(v.style.stylesheet.schema=u);const w=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=r,v.style.updateConfig(r,w),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const r=this.stylesheet.imports||[],u=this.getImportIndex(t);u!==-1&&(r.splice(u,1),this.fragments[u].style._remove(),this.fragments.splice(u,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(u=>u.id===t);return r===-1&&this.fire(new o.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),r}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const r in this._mergedOtherSourceCaches){const u=this._mergedOtherSourceCaches[r];u&&t.push(u.getSource())}return t}getSource(t,r){const u=this.getSourceCache(t,r);return u&&u.getSource()}getLayerSource(t){const r=this.getLayerSourceCache(t);return r&&r.getSource()}getSourceCache(t,r){const u=o.C(t,r);return this._mergedOtherSourceCaches[u]}getLayerSourceCache(t){const r=o.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const r=[];return this._mergedOtherSourceCaches[t]&&r.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&r.push(this._mergedSymbolSourceCaches[t]),r}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const r in t){const u=t[r];u==="reload"?this.reloadSource(r):u==="clear"&&this.clearSource(r)}}updateLayers(t){const r=this._changes.getUpdatedPaintProperties();for(const u of r){const p=this.getLayer(u);p&&p.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,r,u){this.imageManager.getImages(r.images,r.scope,u),this._updateTilesForChangedImages();const p=v=>{if(v){const w=r.images.map(A=>o.I.toString(A));v.setDependencies(r.tileID.key,r.type,w)}},_=o.C(r.source,r.scope);p(this._mergedOtherSourceCaches[_]),p(this._mergedSymbolSourceCaches[_])}rasterizeImages(t,r,u){this.imageManager.rasterizeImages(r,u)}getGlyphs(t,r,u){this.glyphManager.getGlyphs(r.stacks,r.scope,u)}getResource(t,r,u){return o.dg(r,u)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const r=[];return this._otherSourceCaches[t]&&r.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&r.push(this._symbolSourceCaches[t]),r}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return r.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${t}'`))),!1):r.every(u=>u.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,r){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const u=t.type==="fill-extrusion"&&t.sourceLayer==="building",p=t.type==="building";if(t.is3D(!!this.terrain)){if(u||p||r&&r.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}hs.getSourceType=function(c){return Sh[c]},hs.setSourceType=function(c,t){Sh[c]=t},hs.registerForPluginStateChange=o.dh;var Lu=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Qf=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Jf=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Pu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bc=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,jd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ou=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Lr=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Nh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,vt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,oo=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const aa=[];wo(Lu,aa),wo(Jf,aa),wo(Qf,aa);const Ql={"_prelude_fog.vertex.glsl":jd,"_prelude_terrain.vertex.glsl":Bc,"_prelude_shadow.vertex.glsl":vt,"_prelude_fog.fragment.glsl":Ou,"_prelude_shadow.fragment.glsl":oo,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Lr,"_prelude_raster_particle.glsl":Nh},Jl={};Li("",Bc),Li(Ou,jd),Li(oo,vt),Li(Lr,""),Li(Nh,"");const ec=Li(Qf,Jf),Po=Lu;var gl={background:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Li(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Li("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Li(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Li(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Li("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Li("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Li("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Li(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Li(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Li(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Li(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Li(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Li(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Li("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Li("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Li(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Li(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Li("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Li(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Pu),skyboxGradient:Li(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Pu),skyboxCapture:Li(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Li(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Li(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Li(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Li(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Li("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Li("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Li("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Li("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function wo(c,t){const r=c.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let u of r)if(u=u.trim(),u[0]==="#"&&u.includes("if")&&!u.includes("endif")){u=u.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=u.split(" ");for(const _ of p)t.includes(_)||t.push(_)}}function Li(c,t){const r=/#include\s+"([^"]+)"/g,u=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(D=>{const L=D.split(" ");return L[L.length-1]}),p=[...new Set(p)]);const _={},v=[],w=[];if(c=c.replace(r,(D,L)=>(w.push(L),"")),(t=t.replace(r,(D,L)=>(v.push(L),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...aa];wo(c,A),wo(t,A);for(const D of[...v,...w])Ql[D]||console.error(`Undefined include: ${D}`),Jl[D]||(Jl[D]=[],wo(Ql[D],Jl[D])),A=[...A,...Jl[D]];return{fragmentSource:c=c.replace(u,(D,L,k,O,N)=>(_[N]=!0,L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
in ${k} ${O} ${N};
#else
uniform ${k} ${O} u_${N};
#endif
`:L==="initialize"?`
#ifdef HAS_UNIFORM_u_${N}
    ${k} ${O} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${O} ${N};
#endif
`:L==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(u,(D,L,k,O,N)=>{const Z=O==="float"?"vec2":O,j=N.match(/color/)?"color":Z;return L==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${N}
in ${k} ${O} a_${N};
#endif
`:_[N]?L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${Z} a_${N};
out ${k} ${O} ${N};
#else
uniform ${k} ${O} u_${N};
#endif
`:L==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = a_${N};
#else
    ${k} ${O} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${N} = unpack_mix_${j}(a_${N}, u_${N}_t);
#else
    ${k} ${O} ${N} = u_${N};
#endif
`:L==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    in ${k} ${O} a_${N};
    out ${k} ${O} ${N};
#endif
`:L==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${N} = a_${N};
#endif
`:void 0:L==="define"?`
#ifndef HAS_UNIFORM_u_${N}
uniform lowp float u_${N}_t;
in ${k} ${Z} a_${N};
#else
uniform ${k} ${O} u_${N};
#endif
`:L==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${N}0;
in vec4 a_${N}1;
in vec4 a_${N}2;
in vec4 a_${N}3;
#else
uniform ${k} ${O} u_${N};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${Z} a_${N};
#else
uniform ${k} ${O} u_${N};
#endif
`:L==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${N}
    ${k} ${O} ${N} = a_${N};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${O} ${N} = a_${N};
#else
    ${k} ${O} ${N} = u_${N};
#endif
`:`
#ifndef HAS_UNIFORM_u_${N}
    ${k} ${O} ${N} = unpack_mix_${j}(a_${N}, u_${N}_t);
#else
    ${k} ${O} ${N} = u_${N};
#endif
`}),staticAttributes:p,usedDefines:A,vertexIncludes:v,fragmentIncludes:w}}class la{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,r,u,p,_,v,w,A){this.context=t;let D=this.boundPaintVertexBuffers.length!==p.length;for(let k=0;!D&&k<p.length;k++)this.boundPaintVertexBuffers[k]!==p[k]&&(D=!0);let L=this.boundDynamicVertexBuffers.length!==w.length;for(let k=0;!L&&k<w.length;k++)this.boundDynamicVertexBuffers[k]!==w[k]&&(L=!0);if(!this.vao||this.boundProgram!==r||this.boundLayoutVertexBuffer!==u||D||L||this.boundIndexBuffer!==_||this.boundVertexOffset!==v)this.freshBind(r,u,p,_,v,w,A);else{t.bindVertexArrayOES.set(this.vao);for(const k of w)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,r,A));_&&_.dynamicDraw&&_.bind()}}freshBind(t,r,u,p,_,v,w){const A=t.numAttributes,D=this.context,L=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=r,this.boundPaintVertexBuffers=u,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=v,r.enableAttributes(L,t),r.bind(),r.setVertexAttribPointers(L,t,_);for(const k of u)k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,_);for(const k of v)k&&(k.enableAttributes(L,t),k.bind(),k.setVertexAttribPointers(L,t,_),w&&k.instanceCount&&k.setVertexAttribDivisor(L,t,w));p&&p.bind(),D.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function d_(c,t){const r=Math.pow(2,t.canonical.z),u=t.canonical.y;return[new o.ac(0,u/r).toLngLat().lat,new o.ac(0,(u+1)/r).toLngLat().lat]}function To(c,t,r,u,p,_,v){const w=c.context,A=w.gl,D=r.hillshadeFBO;if(!D)return;c.prepareDrawTile();const L=c.isTileAffectedByFog(t),k=c.getOrCreateProgram("hillshade",{overrideFog:L});w.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,D.colorAttachment.get());const O=((X,Y,J,oe)=>{const ce=J.paint.get("hillshade-shadow-color"),ye=J.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=J.paint.get("hillshade-highlight-color"),de=J.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=J.paint.get("hillshade-accent-color"),_e=J.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",be=J.paint.get("hillshade-emissive-strength");let De=o.al(J.paint.get("hillshade-illumination-direction"));if(J.paint.get("hillshade-illumination-anchor")==="viewport")De-=X.transform.angle;else if(X.style&&X.style.enable3dLights()&&X.style.directionalLight){const qe=X.style.directionalLight.properties.get("direction"),We=o.cR(qe.x,qe.y,qe.z);De=o.al(We[1])}const ze=!X.options.moving;return{u_matrix:oe||X.transform.calculateProjMatrix(Y.tileID.toUnwrapped(),ze),u_image:0,u_latrange:d_(0,Y.tileID),u_light:[J.paint.get("hillshade-exaggeration"),De],u_shadow:ce.toPremultipliedRenderColor(ye?null:J.lut),u_highlight:fe.toPremultipliedRenderColor(de?null:J.lut),u_emissive_strength:be,u_accent:he.toPremultipliedRenderColor(_e?null:J.lut)}})(c,r,u,c.terrain?t.projMatrix:null);c.uploadCommonUniforms(w,k,t.toUnwrapped());const{tileBoundsBuffer:N,tileBoundsIndexBuffer:Z,tileBoundsSegments:j}=c.getTileBoundsBuffers(r);k.draw(c,A.TRIANGLES,p,_,v,Jt.disabled,O,u.id,N,Z,j)}function ku(c,t,r){if(!t.needsDEMTextureUpload)return;const u=c.context,p=u.gl;u.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||c.getTileTexture(r.stride);const _=r.getPixels();t.demTexture?t.demTexture.update(_,{premultiply:!1}):t.demTexture=new o.T(u,_,p.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function yl(c,t,r){const u=c.context,p=u.gl;if(!t.dem)return;const _=t.dem;if(u.activeTexture.set(p.TEXTURE1),ku(c,t,_),!t.demTexture)return;t.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const v=_.dim;u.activeTexture.set(p.TEXTURE0);let w=t.hillshadeFBO;if(!w){const O=new o.T(u,{width:v,height:v,data:null},p.RGBA8);O.bind(p.LINEAR,p.CLAMP_TO_EDGE),w=t.hillshadeFBO=u.createFramebuffer(v,v,!0,"renderbuffer"),w.colorAttachment.set(O.texture)}u.bindFramebuffer.set(w.framebuffer),u.viewport.set([0,0,v,v]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:D,tileBoundsSegments:L}=c.getMercatorTileBoundsBuffers(),k=[];c.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),c.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(c,p.TRIANGLES,kt.disabled,li.disabled,Ii.unblended,Jt.disabled,((O,N)=>{const Z=N.stride,j=o.bz();return o.c5(j,0,o.aj,-8192,0,0,1),o.bo(j,j,[0,-8192,0]),{u_matrix:j,u_image:1,u_dimension:[Z,Z],u_zoom:O.overscaledZ}})(t.tileID,_),r.id,A,D,L),t.needsHillshadePrepare=!1}class Jn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Uh extends Jn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class vl extends Jn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class ep extends Jn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class tp extends Jn{getDefault(){return[!0,!0,!0,!0]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Bu extends Jn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Fu extends Jn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Vh extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const r=this.current;(t.func!==r.func||t.ref!==r.ref||t.mask!==r.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Gd extends Jn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ws extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),this.current=t,this.dirty=!1}}class Oo extends Jn{getDefault(){return[0,1]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class tc extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),this.current=t,this.dirty=!1}}class ca extends Jn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class ko extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.BLEND):r.disable(r.BLEND),this.current=t,this.dirty=!1}}class xl extends Jn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ic extends Jn{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const r=this.current;(t.r!==r.r||t.g!==r.g||t.b!==r.b||t.a!==r.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class nc extends Jn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Nu extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;t?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),this.current=t,this.dirty=!1}}class ds extends Jn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Tr extends Jn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let cr=class extends Jn{getDefault(){return null}set(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)}};class bl extends Jn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class ua extends Jn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const r=this.current;(t[0]!==r[0]||t[1]!==r[1]||t[2]!==r[2]||t[3]!==r[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class rc extends Jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindFramebuffer(r.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class Ma extends Jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindRenderbuffer(r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class jh extends Jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindTexture(r.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Hd extends Jn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.bindBuffer(r.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class sc extends Jn{getDefault(){return null}set(t){const r=this.gl;r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wl extends Jn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class ip extends Jn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Uu extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class qd extends Jn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const r=this.gl;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class ao extends Jn{constructor(t,r){super(t),this.context=t,this.parent=r}getDefault(){return null}}class Ra extends ao{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Tl extends ao{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferRenderbuffer(r.FRAMEBUFFER,this.attachment(),r.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sl extends ao{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,this.attachment(),r.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class np extends Tl{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Gh=(c,t,r)=>({u_matrix:c,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:r}),oc=(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j)=>({u_proj_matrix:Float32Array.from(c),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(u),u_merc_matrix:r,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:v,u_frustum_tr:w,u_frustum_br:A,u_frustum_bl:D,u_globe_pos:L,u_globe_radius:k,u_viewport:O,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9),u_skirt_height:N,u_far_z_cutoff:Z});function Fc(c,t){return c!=null&&t!=null&&!(!c.hasData()||!t.hasData())&&c.demTexture!=null&&t.demTexture!=null&&c.tileID.key!==t.tileID.key}const lo=new class{constructor(){this.operations={}}newMorphing(c,t,r,u,p){if(c in this.operations){const _=this.operations[c];_.to.tileID.key!==r.tileID.key&&(_.queued=r)}else this.operations[c]={startTime:u,phase:0,duration:p,from:t,to:r,queued:null}}getMorphValuesForProxy(c){if(!(c in this.operations))return null;const t=this.operations[c];return{from:t.from,to:t.to,phase:t.phase}}update(c){for(const t in this.operations){const r=this.operations[t];for(r.phase=(c-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,c)){delete this.operations[t];break}}}_nextOp(c,t){return!!c.queued&&(c.from=c.to,c.to=c.queued,c.queued=null,c.phase=0,c.startTime=t,!0)}_validOp(c){return c.from.hasData()&&c.to.hasData()}},fs={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Vu(c,t,r){if(t===0)return 0;const u=t<1&&r===514?.25/t:1;return 6*Math.pow(1.5,22-c)*Math.max(t,1)*u}function rm(c,t){const r=1<<c.z;return!t&&(c.x===0||c.x===r-1)||c.y===0||c.y===r-1}const Nc=c=>({u_matrix:c});function Uc(c,t,r,u,p){if(p>0){const _=o.q.now(),v=(_-c.timeAdded)/p,w=t?(_-t.timeAdded)/p:-1,A=r.getSource(),D=u.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(c.tileID.overscaledZ-D),k=L&&c.refreshedUponExpiration?1:o.ay(L?v:1-w,0,1);return c.refreshedUponExpiration&&v>=1&&(c.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class sm extends ws{constructor(t){const r={type:"raster-dem",maxzoom:t.transform.maxZoom},u=new o.D(o.c$(),null),p=Eh("mock-dem",r,u,t.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,r){t.state="loaded",r(null)}}class hr extends ws{constructor(t){const r=Eh("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new o.D(o.c$(),null),t.style);super("proxy",r,!1),r.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,r,u){if(t.freezeTileCoverage)return;this.transform=t;const p=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,v)=>{if(_[v.key]="",!this._tiles[v.key]){const w=new al(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);w.state="loaded",this._tiles[v.key]=w}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(t){const r=this.proxyCachedFBO[t];if(r!==void 0){const u=Object.values(r);this.renderCachePool.push(...u),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ju extends o.aM{constructor(t,r,u){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=r,this.projMatrix=u}}class El extends o.dt{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[u,p,_]=function(A){const D=new o.ba,L=new o.a_,k=131;D.reserve(17161),L.reserve(33800);const O=o.aj/128,N=o.aj+O/2,Z=N+O;for(let X=-64;X<Z;X+=O)for(let Y=-64;Y<Z;Y+=O){const J=Y<0||Y>N||X<0||X>N?24575:0,oe=o.ay(Math.round(Y),0,o.aj),ce=o.ay(Math.round(X),0,o.aj);D.emplaceBack(oe+J,ce)}const j=(X,Y)=>{const J=Y*k+X;L.emplaceBack(J+1,J,J+k),L.emplaceBack(J+k,J+k+1,J+1)};for(let X=1;X<129;X++)for(let Y=1;Y<129;Y++)j(Y,X);return[0,129].forEach(X=>{for(let Y=0;Y<130;Y++)j(Y,X),j(X,Y)}),[D,L,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(u,o.bc.members),this.gridIndexBuffer=v.createIndexBuffer(p),this.gridSegments=o.bd.simpleSegment(0,0,u.length,p.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,u.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new hr(r.map),this.orthoMatrix=o.bz(),o.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const w=v.gl;this._overlapStencilMode=new li({func:w.GEQUAL,mask:255},0,255,w.KEEP,w.KEEP,w.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new sm(r.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,u){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const p=t.terrain.properties,_=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const w=t.terrain&&t.terrain.scope,A=p.get("source"),D=_?this._mockSourceCache:t.getSourceCache(A,w);if(!D)return void o.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=D,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(r):p.get("exaggeration"),!r.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const L=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(r,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,L(),this._initializing=!0),L(),r.updateElevation(!0,u),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,u=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=u;const p=r!=null?u-r:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(_);let w=_-this._previousZoom;const A=this._previousUpdateTimestamp;let D=_;this._evaluationZoom!=null&&(D=this._evaluationZoom,Math.abs(_-D)>.5&&(w=.5*(_-D+w)),w*p<0&&(D+=w)),this._evaluationZoom=D;const L=v.getExaggeration(D),k=L===v.getExaggeration(Math.max(0,D-.1));if(k&&Math.abs(L-this._exaggeration)<.01)return L;let O=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||L<.1||Math.abs(w)<1e-4)&&(O=Math.min(.2,4*O)),o.ai(this._exaggeration,L,O)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,u=this.painter.transform;this._initializing&&(this._initializing=u._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(u.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=r.getIds().map(A=>{const D=r.getTileByID(A).tileID;return D.projMatrix=u.calculateProjMatrix(D.toUnwrapped()),D});(function(A,D){const L=D.transform.pointCoordinate(D.transform.getCameraPoint()),k=new o.P(L.x,L.y);A.sort((O,N)=>{if(N.overscaledZ-O.overscaledZ)return N.overscaledZ-O.overscaledZ;const Z=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),j=new o.P(N.canonical.x+(1<<N.canonical.z)*N.wrap,N.canonical.y),X=k.mult(1<<O.canonical.z);return X.x-=.5,X.y-=.5,X.distSqr(Z)-X.distSqr(j)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const A in v){const D=v[A];if(!D.used||(D!==this.sourceCache&&this.resetTileLookupCache(D.id),this._setupProxiedCoordsForOrtho(D,t[A],_),D.usedForTerrain))continue;const L=t[A];D.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[r.id]=p.map(A=>new ju(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const w={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const D=this.terrainTileForTile[A.key];if(!D)continue;const L=D.tileID.key;L in w||(this._visibleDemTiles.push(D),w[L]=L)}}_assignTerrainTiles(t){this._initializing||t.forEach(r=>{if(this.terrainTileForTile[r.key])return;const u=this._findTileCoveringTileID(r,this.sourceCache);u&&(this.terrainTileForTile[r.key]=u)})}_prepareDEMTextures(){const t=this.painter.context,r=t.gl;for(const u in this.terrainTileForTile){const p=this.terrainTileForTile[u],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(t.activeTexture.set(r.TEXTURE1),ku(this.painter,p,_))}}_prepareDemTileUniforms(t,r,u,p){if(!r||r.demTexture==null)return!1;const _=t.tileID.canonical,v=Math.pow(2,r.tileID.canonical.z-_.z),w=p||"";return u[`u_dem_tl${w}`]=[_.x*v%1,_.y*v%1],u[`u_dem_scale${w}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const r=this._visibleDemTiles.reduce((u,p)=>{if(!p.dem)return u;const _=p.dem.tree.minimums[0];return _>0&&t++,u+_},0);return t?r/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const u=this._getLoadedAreaMinimum(),p=new o.du({width:1,height:1},new Float32Array([u]));this._emptyDEMTextureDirty=!1;let _=this._emptyDEMTexture;return _?_.update(p,{premultiply:!1}):_=this._emptyDEMTexture=new o.T(t,p,r.R32F,{premultiply:!1}),_}setupElevationDraw(t,r,u){const p=this.painter.context,_=p.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let w=null,A=null,D=1;if(u&&u.morphing&&this._useVertexMorphing){const N=u.morphing.srcDemTile,Z=u.morphing.dstDemTile;D=u.morphing.phase,N&&Z&&(this._prepareDemTileUniforms(t,N,v,"_prev")&&(A=N),this._prepareDemTileUniforms(t,Z,v)&&(w=Z))}const L=N=>N&&N.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST;let k=null;var O;if(this.enabled?A&&w?(k=w.demTexture,p.activeTexture.set(_.TEXTURE4),A.demTexture.bind(L(A),_.CLAMP_TO_EDGE),v.u_dem_lerp=D):(w=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,w,v)?w.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,p.activeTexture.set(_.TEXTURE2),k&&(v.u_dem_size=(O=k).size[0]===1?1:O.size[0]-2,k.bind(L(w),_.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(u&&u.useDepthForOcclusion,r,v),u&&u.useMeterToDem&&w){const N=(1<<w.tileID.canonical.z)*o.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=N}if(u&&u.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=u.labelPlaneMatrixInv),r.setTerrainUniformValues(p,v),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,t.tileID.canonical,u&&u.useDenormalizedUpVectorScale);r.setGlobeUniformValues(p,N)}}globeUniformValues(t,r,u){const p=t.projection;return{u_tile_tl_up:p.upVector(r,0,0),u_tile_tr_up:p.upVector(r,o.aj,0),u_tile_br_up:p.upVector(r,o.aj,o.aj),u_tile_bl_up:p.upVector(r,0,o.aj),u_tile_up_scale:u?o.dv(1):p.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,u=this.painter.context;t.length!==0&&(u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,v,w,A){if(p.transform.projection.name==="globe")(function(D,L,k,O,N){const Z=D.context,j=Z.gl;let X,Y;const J=D.transform,oe=o.dl(D,Z,J),ce=(qe,We)=>{if(Y===We)return;const rt=[fs[We],"PROJECTION_GLOBE_VIEW"];oe&&rt.push("CUSTOM_ANTIALIASING");const Ie=D.isTileAffectedByFog(qe);X=D.getOrCreateProgram("globeRaster",{defines:rt,overrideFog:Ie}),Y=We},ye=D.colorModeForRenderPass(),fe=new kt(j.LEQUAL,kt.ReadWrite,D.depthRangeFor3D);lo.update(N);const de=o.dm(J),he=[o.aD(J.center.lng),o.aH(J.center.lat)],_e=D.globeSharedBuffers,be=[J.width*o.q.devicePixelRatio,J.height*o.q.devicePixelRatio],De=Float32Array.from(J.globeMatrix),ze={useDenormalizedUpVectorScale:!0};{const qe=D.transform,We=Vu(qe.zoom,L.exaggeration(),L.sourceCache._source.tileSize);Y=-1;const rt=j.TRIANGLES;for(const Ie of O){const Ue=k.getTile(Ie),Ee=li.disabled,$e=L.prevTerrainTileForTile[Ie.key],Fe=L.terrainTileForTile[Ie.key];Fc($e,Fe)&&lo.newMorphing(Ie.key,$e,Fe,N,250),Z.activeTexture.set(j.TEXTURE0),Ue.texture&&Ue.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const tt=lo.getMorphValuesForProxy(Ie.key),gt=tt?1:0;tt&&o.L(ze,{morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:o.dk(tt.phase)}});const Ye=o.dn(Ie.canonical),ht=o.dp(Ye.getCenter().lat),Ot=o.dq(Ie.canonical,Ye,ht,qe.worldSize/qe._pixelsPerMercatorPixel),zt=o.bh(o.dr(Ie.canonical)),Dt=oc(qe.expandedFarZProjMatrix,De,de,zt,o.ah(qe.zoom),he,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,be,We,qe._farZ,Ot);if(ce(Ie,gt),X&&(L.setupElevationDraw(Ue,X,ze),D.uploadCommonUniforms(Z,X,Ie.toUnwrapped()),_e)){const[Ht,$t,Lt]=_e.getGridBuffers(ht,We!==0);X.draw(D,rt,fe,Ee,ye,Jt.backCCW,Dt,"globe_raster",Ht,$t,Lt)}}}if(_e&&(D.renderDefaultNorthPole||D.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];oe&&qe.push("CUSTOM_ANTIALIASING"),X=D.getOrCreateProgram("globeRaster",{defines:qe});for(const We of O){const{x:rt,y:Ie,z:Ue}=We.canonical,Ee=Ie===0,$e=Ie===(1<<Ue)-1,[Fe,tt,gt,Ye]=_e.getPoleBuffers(Ue,!1);if(Ye&&(Ee||$e)){const ht=k.getTile(We);Z.activeTexture.set(j.TEXTURE0),ht.texture&&ht.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let Ot=o.ds(Ue,rt,J);const zt=o.bh(o.dr(We.canonical)),Dt=(Ht,$t)=>Ht.draw(D,j.TRIANGLES,fe,li.disabled,ye,Jt.disabled,oc(J.expandedFarZProjMatrix,Ot,Ot,zt,0,he,J.frustumCorners.TL,J.frustumCorners.TR,J.frustumCorners.BR,J.frustumCorners.BL,J.globeCenterInViewSpace,J.globeRadius,be,0,J._farZ),"globe_pole_raster",$t,gt,Ye);L.setupElevationDraw(ht,X,ze),D.uploadCommonUniforms(Z,X,We.toUnwrapped()),Ee&&D.renderDefaultNorthPole&&Dt(X,Fe),$e&&D.renderDefaultSouthPole&&(Ot=o.cE(o.bz(),Ot,[1,-1,1]),Dt(X,tt))}}}})(p,_,v,w,A);else{const D=p.context,L=D.gl;let k,O;const N=p.shadowRenderer,Z=Ia(p,p.longestCutoffRange),j=ye=>{if(O===ye)return;const fe=[];fe.push(fs[ye]),Z.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),N&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&fe.push("NORMAL_OFFSET")),k=p.getOrCreateProgram("terrainRaster",{defines:fe}),O=ye},X=p.colorModeForRenderPass(),Y=new kt(L.LEQUAL,kt.ReadWrite,p.depthRangeFor3D);lo.update(A);const J=p.transform,oe=Vu(J.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let ce=[0,0,0];if(N){const ye=p.style.directionalLight,fe=p.style.ambientLight;ye&&fe&&(ce=Yl(p.style,ye,fe))}{O=-1;const ye=L.TRIANGLES,[fe,de]=[_.gridIndexBuffer,_.gridSegments];for(const he of w){const _e=v.getTile(he),be=li.disabled,De=_.prevTerrainTileForTile[he.key],ze=_.terrainTileForTile[he.key];Fc(De,ze)&&lo.newMorphing(he.key,De,ze,A,250),D.activeTexture.set(L.TEXTURE0),_e.texture&&_e.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const qe=lo.getMorphValuesForProxy(he.key),We=qe?1:0;let rt;qe&&(rt={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:o.dk(qe.phase)}});const Ie=Gh(he.projMatrix,rm(he.canonical,J.renderWorldCopies)?oe/10:oe,ce);if(j(We),!k)continue;_.setupElevationDraw(_e,k,rt);const Ue=he.toUnwrapped();N&&N.setupShadows(Ue,k),p.uploadCommonUniforms(D,k,Ue,null,Z),k.draw(p,ye,Y,be,X,Jt.backCCW,Ie,"terrain_raster",_.gridBuffer,fe,de)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const r=this.painter,u=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],v=this._drapedRenderBatches.shift(),w=r.style.order,A=[];let D=0;for(const L of _){const k=p.getTileByID(L.proxyTileKey),O=p.proxyCachedFBO[L.key]?p.proxyCachedFBO[L.key][t]:void 0,N=O!==void 0?p.renderCache[O]:this.pool[D++],Z=O!==void 0;if(k.texture=N.tex,Z&&!N.dirty){A.push(k.tileID);continue}let j;u.bindFramebuffer.set(N.fb.framebuffer),this.renderedToTile=!1,N.dirty&&(u.clear({color:o.am.transparent,stencil:0}),N.dirty=!1);for(let X=v.start;X<=v.end;++X){const Y=r.style._mergedLayers[w[X]];if(Y.isHidden(r.transform.zoom))continue;const J=r.style.getLayerSourceCache(Y),oe=J?this.proxyToSource[L.key][J.id]:[L];if(!oe)continue;const ce=oe;u.viewport.set([0,0,N.fb.width,N.fb.height]),j!==(J?J.id:null)&&(this._setupStencil(N,oe,Y,J),j=J?J.id:null),r.renderLayer(r,J,Y,ce)}if(this._drapedRenderBatches.length===0)for(const X of this._pendingGroundEffectLayers){const Y=r.style._mergedLayers[w[X]];if(Y.isHidden(r.transform.zoom))continue;const J=r.style.getLayerSourceCache(Y),oe=J?this.proxyToSource[L.key][J.id]:[L];if(!oe)continue;const ce=oe;u.viewport.set([0,0,N.fb.width,N.fb.height]),j!==(J?J.id:null)&&(this._setupStencil(N,oe,Y,J),j=J?J.id:null),r.renderLayer(r,J,Y,ce)}this.renderedToTile?(N.dirty=!0,A.push(k.tileID)):Z||--D,D===5&&(D=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,u.bindFramebuffer.set(null),u.viewport.set([0,0,r.width,r.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const r=t.order.length;let u=-1,p=r;for(let _=0;_<r;++_)this._style.isLayerDraped(t._mergedLayers[t.order[_]])?u=Math.max(u,_):p=Math.min(p,_);return p>u}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(r=>r.dem).forEach(r=>{t=Math.min(t,r.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,r,u){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const v=_.tileID,w=1<<v.overscaledZ,{x:A,y:D}=v.canonical,L=A/w,k=(A+1)/w,O=D/w,N=(D+1)/w;return{minx:L,miny:O,maxx:k,maxy:N,t:_.dem.tree.raycastRoot(L,O,k,N,t,r,u),tile:_}});p.sort((_,v)=>(_.t!==null?_.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const v=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,t,r,u);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,r=t.gl,u=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const p=new o.T(t,{width:u[0],height:u[1],data:null},r.RGBA8);p.bind(r.LINEAR,r.CLAMP_TO_EDGE);const _=t.createFramebuffer(u[0],u[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new np(t,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,u[0],u[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const r=this._style._mergedLayers[t],u=r.isHidden(this.painter.transform.zoom);return r.type==="hillshade"||r.type==="custom"?!u&&r.shouldRedrape():!u&&r.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const u of this._style.getSources())if(u instanceof Th){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(_&&!r[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.ab){r[_.id]=!0;for(const v of this.proxyCoords){const w=this.proxyToSource[v.key][_.id];if(w)for(const A of w)this._clearRenderCacheForTile(_.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const u in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[u]._source instanceof Qr){t=!0;break}if(!t)return;const r={};for(let u=0;u<this._style.order.length;++u){const p=this._style._mergedLayers[this._style.order[u]],_=this._style.getLayerSourceCache(p);if(!_||r[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const v=p.paint.get("raster-fade-duration");for(const w of this.proxyCoords){const A=this.proxyToSource[w.key][_.id];if(A)for(const D of A){const L=Uc(_.getTile(D),_.findLoadedParent(D,0),_,this.painter.transform,v);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(_.id,D)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(r===0)return;const u=[];this._pendingGroundEffectLayers=[];let p,_=0,v=this._style._mergedLayers[t[_]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++_<r;)v=this._style._mergedLayers[t[_]];for(;_<r;++_){const w=this._style._mergedLayers[t[_]];w.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(w)?p===void 0&&(p=_):(w.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(u.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&u.push({start:p,end:_-1}),u.length!==0){const w=u[u.length-1];this._pendingGroundEffectLayers.every(A=>A>w.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=u}_setupRenderCache(t){const r=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,r.renderCache.length>r.renderCachePool.length){const v=Object.values(r.proxyCachedFBO);r.proxyCachedFBO={};for(let w=0;w<v.length;++w){const A=Object.values(v[w]);r.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const u=this.proxyCoords,p=this._tilesDirty;for(let v=u.length-1;v>=0;v--){const w=u[v];if(r.getTileByID(w.key),r.proxyCachedFBO[w.key]!==void 0){const A=t[w.key],D=this.proxyToSource[w.key];let L=0;for(const k in D){const O=D[k],N=A[k];if(!N||N.length!==O.length||O.some((Z,j)=>Z!==N[j]||p[k]&&p[k].hasOwnProperty(Z.key))){L=-1;break}++L}for(const k in r.proxyCachedFBO[w.key])r.renderCache[r.proxyCachedFBO[w.key][k]].dirty=L<0||L!==Object.values(A).length}}const _=[...this._drapedRenderBatches];_.sort((v,w)=>w.end-w.start-(v.end-v.start));for(const v of _)for(const w of u){if(r.proxyCachedFBO[w.key])continue;let A=r.renderCachePool.pop();A===void 0&&r.renderCache.length<50&&(A=r.renderCache.length,r.renderCache.push(this._createFBO())),A!==void 0&&(r.proxyCachedFBO[w.key]={},r.proxyCachedFBO[w.key][v.start]=A,r.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,r,u,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,v=_.gl;if(r.length<=1)return void(this._overlapStencilType=!1);let w;if(u.isTileClipped())w=r.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(r[0].overscaledZ>r[r.length-1].overscaledZ))return void(this._overlapStencilType=!1);w=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+w>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=w,this._overlapStencilMode.ref=this._stencilRef,u.isTileClipped()&&this._renderTileClippingMasks(r,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):li.disabled}_renderTileClippingMasks(t,r){const u=this.painter,p=this.painter.context,_=p.gl;u._tileClippingMaskIDs={},p.setColorMode(Ii.disabled),p.setDepthMode(kt.disabled);const v=u.getOrCreateProgram("clippingMask");for(const w of t){const A=u._tileClippingMaskIDs[w.key]=--r;v.draw(u,_.TRIANGLES,kt.disabled,new li({func:_.ALWAYS,mask:0},A,255,_.KEEP,_.KEEP,_.REPLACE),Ii.disabled,Jt.disabled,Nc(w.projMatrix),"$clipping",u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const u=[t.x,t.y,1,1];o.aA(u,u,r.pixelMatrixInverse),o.cw(u,u,1/u[3]),u[0]/=r.worldSize,u[1]/=r.worldSize;const p=r._camera.position,_=o.c6(1,r.center.lat),v=[p[0],p[1],p[2]/_,0],w=o.cX([],u.slice(0,3),v);o.au(w,w);const A=this.raycast(v,w,this._exaggeration);return A!==null&&A?(o.bE(v,v,w,A),v[3]=v[2],v[2]*=_,v):null}_setupProxiedCoordsForOrtho(t,r,u){if(t.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(t,r,u);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords;for(let A=0;A<_.length;A++){const D=_[A],L=this._findTileCoveringTileID(D,t);if(L){const k=this._createProxiedId(D,L,u[D.key]&&u[D.key][t.id]);p.push(k),this.proxyToSource[D.key][t.id]=[k]}}let v=!1;const w=new Set;for(let A=0;A<r.length;A++){const D=t.getTile(r[A]);if(!D||!D.hasData())continue;const L=this._findTileCoveringTileID(D.tileID,this.proxySourceCache);if(L&&L.tileID.canonical.z!==D.tileID.canonical.z){const k=this.proxyToSource[L.tileID.key][t.id],O=this._createProxiedId(L.tileID,D,u[L.tileID.key]&&u[L.tileID.key][t.id]);k?k.splice(k.length-1,0,O):this.proxyToSource[L.tileID.key][t.id]=[O];const N=this.proxyToSource[L.tileID.key][t.id];w.has(N)||w.add(N),p.push(O),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const A of w)A.sort((D,L)=>L.overscaledZ-D.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,u){if(!t.getSource().loaded())return;const p=this.proxiedCoords[t.id]=[],_=this.proxyCoords,v=t.getSource(),w=v.tileID;if(!w)return;const A=new o.P(w.x,w.y)._div(1<<w.z),D=v.coordinates.map(o.ac.fromLngLat).reduce((k,O)=>(k.min.x=Math.min(k.min.x,O.x-A.x),k.min.y=Math.min(k.min.y,O.y-A.y),k.max.x=Math.max(k.max.x,O.x-A.x),k.max.y=Math.max(k.max.y,O.y-A.y),k),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),L=(k,O)=>{const N=k.wrap+k.canonical.x/(1<<k.canonical.z),Z=k.canonical.y/(1<<k.canonical.z),j=o.aj/(1<<k.canonical.z),X=O.wrap+O.canonical.x/(1<<O.canonical.z),Y=O.canonical.y/(1<<O.canonical.z);return N+j<X+D.min.x||N>X+D.max.x||Z+j<Y+D.min.y||Z>Y+D.max.y};for(let k=0;k<_.length;k++){const O=_[k];for(let N=0;N<r.length;N++){const Z=t.getTile(r[N]);if(!Z||!Z.hasData()||L(O,Z.tileID))continue;const j=this._createProxiedId(O,Z,u[O.key]&&u[O.key][t.id]),X=this.proxyToSource[O.key][t.id];X?X.push(j):this.proxyToSource[O.key][t.id]=[j],p.push(j)}}}_createProxiedId(t,r,u){let p=this.orthoMatrix;if(u){const _=u.find(v=>v.key===r.tileID.key);if(_)return _}if(r.tileID.key!==t.key){const _=t.canonical.z-r.tileID.canonical.z;let v,w,A;p=o.bz();const D=r.tileID.wrap-t.wrap<<t.overscaledZ;_>0?(v=o.aj>>_,w=v*((r.tileID.canonical.x<<_)-t.canonical.x+D),A=v*((r.tileID.canonical.y<<_)-t.canonical.y)):(v=o.aj<<-_,w=o.aj*(r.tileID.canonical.x-(t.canonical.x+D<<-_)),A=o.aj*(r.tileID.canonical.y-(t.canonical.y<<-_))),o.c5(p,0,v,0,v,0,1),o.bo(p,p,[w,A,0])}return new ju(r.tileID,t.key,p)}_findTileCoveringTileID(t,r){let u=r.getTile(t);if(u&&u.hasData())return u;const p=this._findCoveringTileCache[r.id],_=p[t.key];if(u=_?r.getTileByID(_):null,u&&u.hasData()||_===null)return u;let v=u?u.tileID:t,w=v.overscaledZ;const A=r.getSource().minzoom,D=[];if(!_){const k=r.getSource().maxzoom;if(t.canonical.z>=k){const O=t.canonical.z-k;r.getSource().reparseOverscaled?(w=Math.max(t.canonical.z+2,r.transform.tileZoom),v=new o.aM(w,t.wrap,k,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(w=k,v=new o.aM(w,t.wrap,k,t.canonical.x>>O,t.canonical.y>>O))}v.key!==t.key&&(D.push(v.key),u=r.getTile(v))}const L=k=>{D.forEach(O=>{p[O]=k}),D.length=0};for(w-=1;w>=A&&(!u||!u.hasData());w--){u&&L(u.tileID.key);const k=v.calculateScaledKey(w);if(u=r.getTileByID(k),u&&u.hasData())break;const O=p[k];if(O===null)break;O===void 0?D.push(k):u=r.getTileByID(O)}return L(u?u.tileID.key:null),u&&u.hasData()?u:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,r){let u=this._tilesDirty[t];u||(u=this._tilesDirty[t]={}),u[r.key]=!0}}function ac(c,t,r){const u=function(w,A,D){const L=o.bG(A,w),k=o.bG(D,[.2126,.7152,.0722]),O=(Z,j,X)=>(1-X)*Z+X*j,N=O(1-.3*Math.min(k,1),1,Math.min(L+1,1));return O(.92,1,Math.asin(o.ay(A[2],-1,1))/Math.PI+.5)*N}(c,[0,0,1],t),p=[0,0,0];o.bY(p,r.slice(0,3),u);const _=[0,0,0];o.bY(_,t.slice(0,3),c[2]);const v=[0,0,0];return o.cV(v,p,_),o.cY(v)}const Hh=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],lc=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class Al{static cacheKey(t,r,u,p){let _=`${r}${p?p.cacheKey:""}`;for(const v of u)t.usedDefines.includes(v)&&(_+=`/${v}`);return _}constructor(t,r,u,p,_,v){const w=t.gl;this.program=w.createProgram(),this.configuration=p,this.name=r,this.fixedDefines=[...v];const A=p?p.getBinderAttributes():[],D=(u.staticAttributes||[]).concat(A);let L=p?p.defines():[];L=L.concat(v.map(X=>`#define ${X}`));const k=`#version 300 es
`;let O=k+L.concat("precision mediump float;",Po,ec.fragmentSource).join(`
`);for(const X of u.fragmentIncludes)O+=`
${Ql[X]}`;O+=`
${u.fragmentSource}`;let N=k+L.concat("precision highp float;",Po,ec.vertexSource).join(`
`);for(const X of u.vertexIncludes)N+=`
${Ql[X]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&u.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(N+=`
uniform int u_instanceID;
`),N+=`
${u.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(N=N.replaceAll("gl_InstanceID","u_instanceID"));const Z=w.createShader(w.FRAGMENT_SHADER);if(w.isContextLost())return void(this.failedToCreate=!0);w.shaderSource(Z,O),w.compileShader(Z),w.attachShader(this.program,Z);const j=w.createShader(w.VERTEX_SHADER);if(w.isContextLost())this.failedToCreate=!0;else{w.shaderSource(j,N),w.compileShader(j),w.attachShader(this.program,j),this.attributes={},this.numAttributes=D.length;for(let X=0;X<this.numAttributes;X++)if(D[X]){const Y=D[X].startsWith("a_")?D[X]:`a_${D[X]}`;w.bindAttribLocation(this.program,X,Y),this.attributes[Y]=X}w.linkProgram(this.program),w.deleteShader(j),w.deleteShader(Z),this.fixedUniforms=_(t),this.binderUniforms=p?p.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(X=>({u_instanceID:new o.c8(X)}))(t)),(v.includes("TERRAIN")||r.indexOf("symbol")!==-1||r.indexOf("circle")!==-1)&&(this.terrainUniforms=(X=>({u_dem:new o.c8(X),u_dem_prev:new o.c8(X),u_dem_tl:new o.cb(X),u_dem_scale:new o.ca(X),u_dem_tl_prev:new o.cb(X),u_dem_scale_prev:new o.ca(X),u_dem_size:new o.ca(X),u_dem_lerp:new o.ca(X),u_exaggeration:new o.ca(X),u_depth:new o.c8(X),u_depth_size_inv:new o.cb(X),u_depth_range_unpack:new o.cb(X),u_occluder_half_size:new o.ca(X),u_occlusion_depth_offset:new o.ca(X),u_meter_to_dem:new o.ca(X),u_label_plane_matrix_inv:new o.cc(X)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(X=>({u_tile_tl_up:new o.c9(X),u_tile_tr_up:new o.c9(X),u_tile_br_up:new o.c9(X),u_tile_bl_up:new o.c9(X),u_tile_up_scale:new o.ca(X)}))(t)),v.includes("FOG")&&(this.fogUniforms=(X=>({u_fog_matrix:new o.cc(X),u_fog_range:new o.cb(X),u_fog_color:new o.cQ(X),u_fog_horizon_blend:new o.ca(X),u_fog_vertical_limit:new o.cb(X),u_fog_temporal_offset:new o.ca(X),u_frustum_tl:new o.c9(X),u_frustum_tr:new o.c9(X),u_frustum_br:new o.c9(X),u_frustum_bl:new o.c9(X),u_globe_pos:new o.c9(X),u_globe_radius:new o.ca(X),u_globe_transition:new o.ca(X),u_is_globe:new o.c8(X),u_viewport:new o.cb(X)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(X=>({u_cutoff_params:new o.cQ(X)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(X=>({u_lighting_ambient_color:new o.c9(X),u_lighting_directional_dir:new o.c9(X),u_lighting_directional_color:new o.c9(X),u_ground_radiance:new o.c9(X)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(X=>({u_light_matrix_0:new o.cc(X),u_light_matrix_1:new o.cc(X),u_fade_range:new o.cb(X),u_shadow_normal_offset:new o.c9(X),u_shadow_intensity:new o.ca(X),u_shadow_texel_size:new o.ca(X),u_shadow_map_resolution:new o.ca(X),u_shadow_direction:new o.c9(X),u_shadow_bias:new o.c9(X),u_shadowmap_0:new o.c8(X),u_shadowmap_1:new o.c8(X)}))(t))}}setTerrainUniformValues(t,r){if(!this.terrainUniforms)return;const u=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setGlobeUniformValues(t,r){if(!this.globeUniforms)return;const u=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p]&&u[p].set(this.program,p,r[p])}}setFogUniformValues(t,r){if(!this.fogUniforms)return;const u=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setCutoffUniformValues(t,r){if(!this.cutoffUniforms)return;const u=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setLightsUniformValues(t,r){if(!this.lightsUniforms)return;const u=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}}setShadowUniformValues(t,r){if(this.failedToCreate||!this.shadowUniforms)return;const u=this.shadowUniforms;t.program.set(this.program);for(const p in r)u[p].set(this.program,p,r[p])}_drawDebugWireframe(t,r,u,p,_,v,w,A,D,L){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const O=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!Hh.includes(this.name))||!(!k.layers3D||!lc.includes(this.name))))return;const N=O.gl,Z=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,_,O);if(!Z)return;const j=[...this.fixedDefines];j.push("DEBUG_WIREFRAME");const X=t.getOrCreateProgram(this.name,{config:this.configuration,defines:j});O.program.set(X.program);const Y=(ce,ye,fe)=>{if(ye[ce]&&fe[ce])for(const de in ye[ce])fe[ce][de]&&fe[ce][de].set(fe.program,de,ye[ce][de].current)};D&&D.setUniforms(X.program,O,X.binderUniforms,w,{zoom:A}),Y("fixedUniforms",this,X),Y("terrainUniforms",this,X),Y("globeUniforms",this,X),Y("fogUniforms",this,X),Y("lightsUniforms",this,X),Y("shadowUniforms",this,X),Z.bind(),O.setColorMode(new Ii([N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ZERO,N.ONE],o.am.transparent,[!0,!0,!0,!1])),O.setDepthMode(new kt(r.func===N.LESS?N.LEQUAL:r.func,kt.ReadOnly,r.range)),O.setStencilMode(li.disabled);const J=3*v.primitiveLength*2,oe=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=L||1;for(let ye=0;ye<ce;++ye)X.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),N.drawElements(N.LINES,J,N.UNSIGNED_SHORT,oe)}else L&&L>1?N.drawElementsInstanced(N.LINES,J,N.UNSIGNED_SHORT,oe,L):N.drawElements(N.LINES,J,N.UNSIGNED_SHORT,oe);_.bind(),O.program.set(this.program),O.setDepthMode(r),O.setStencilMode(u),O.setColorMode(p)}checkUniforms(t,r,u){if(this.fixedDefines.includes(r)){for(const p of Object.keys(u))if(!u[p].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${p} not set but required by ${r} being defined`)}}draw(t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X){const Y=t.context,J=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(u),Y.setStencilMode(p),Y.setColorMode(_),Y.setCullFace(v);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,w[ye]);Z&&Z.setUniforms(this.program,Y,this.binderUniforms,O,{zoom:N});const oe={[J.POINTS]:1,[J.LINES]:2,[J.TRIANGLES]:3,[J.LINE_STRIP]:1}[r];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ce=X&&X>0?1:void 0;for(const ye of k.get()){const fe=ye.vaos||(ye.vaos={});if((fe[A]||(fe[A]=new la)).bind(Y,this,D,Z?Z.getPaintVertexBuffers():[],L,ye.vertexOffset,j||[],ce),this.forceManualRenderingForInstanceIDShaders){const de=X||1;for(let he=0;he<de;++he)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",he),L?J.drawElements(r,ye.primitiveLength*oe,J.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):J.drawArrays(r,ye.vertexOffset,ye.vertexLength)}else X&&X>1?J.drawElementsInstanced(r,ye.primitiveLength*oe,J.UNSIGNED_SHORT,ye.primitiveOffset*oe*2,X):L?J.drawElements(r,ye.primitiveLength*oe,J.UNSIGNED_SHORT,ye.primitiveOffset*oe*2):J.drawArrays(r,ye.vertexOffset,ye.vertexLength);r===J.TRIANGLES&&L&&this._drawDebugWireframe(t,u,p,_,L,ye,O,N,Z,X)}}}function qh(c,t,r=0){const u=Math.pow(2,t.tileID.overscaledZ),p=t.tileSize*Math.pow(2,c.transform.tileZoom)/u,_=p*(t.tileID.canonical.x+t.tileID.wrap*u),v=p*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(t,1,c.transform.tileZoom),u_pixel_coord_upper:[_>>16,v>>16],u_pixel_coord_lower:[65535&_,65535&v],u_pattern_transition:r}}const Vc={terrain:0,flat:1},rp=o.bz(),Gu=(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y)=>{const J=t.style.light,oe=J.properties.get("position"),ce=[oe.x,oe.y,oe.z],ye=o.dx();J.properties.get("anchor")==="viewport"&&(o.dy(ye,-t.transform.angle),o.dz(ce,ce,ye));const fe=J.properties.get("color").toPremultipliedRenderColor(null),de=t.transform,he={u_matrix:c,u_lightpos:ce,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+r,u_opacity:u,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Vc[D],u_base_type:Vc[L],u_ao:p,u_edge_radius:_,u_width_scale:v,u_flood_light_color:Z,u_vertical_scale:j,u_flood_light_intensity:X,u_ground_shadow_factor:Y};return de.projection.name==="globe"&&(he.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],he.u_zoom_transition=k,he.u_inv_rot_matrix=N,he.u_merc_center=O,he.u_up_dir=de.projection.upVector(new o.cp(0,0,0),O[0]*o.aj,O[1]*o.aj),he.u_height_lift=A),he},cc=(c,t,r,u,p,_)=>({u_matrix:c,u_edge_radius:t,u_width_scale:r,u_vertical_scale:u,u_height_type:Vc[p],u_base_type:Vc[_]}),Zd=(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y)=>{const J=Gu(c,t,r,u,p,_,v,w,D,L,k,O,N,Z,j,X,1,[0,0,0]),oe={u_height_factor:-Math.pow(2,w.overscaledZ)/A.tileSize/8};return o.h(J,qh(t,A,Y),oe)},Da=(c,t,r)=>({u_matrix:c,u_emissive_strength:t,u_ground_shadow_factor:r}),sp=(c,t,r,u,p,_=0)=>o.h(Da(c,t,p),qh(r,u,_)),Zh=(c,t,r,u)=>({u_matrix:c,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:u}),om=(c,t,r,u,p,_,v=0)=>o.h(sp(c,t,r,u,_,v),{u_world:p}),Xd=(c,t)=>({u_matrix:c,u_ground_shadow_factor:t}),Hu=(c,t,r,u,p)=>({u_matrix:c,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:u,u_reset_depth:p}),am=(c,t,r,u)=>{const p=o.aj/r.tileSize;return{u_matrix:c,u_camera_to_center_distance:t.getCameraToCenterDistance(u),u_extrude_scale:[t.pixelsToGLUnits[0]/p,t.pixelsToGLUnits[1]/p]}},jc=(c,t,r=1)=>({u_matrix:c,u_color:t,u_overlay:0,u_overlay_scale:r}),Wd=o.bz(),qu=(c,t,r,u,p,_,v)=>{const w=c.transform,A=w.projection.name==="globe",D=A?o.dA(w.zoom,t.canonical)*w._pixelsPerMercatorPixel:o.aw(r,1,_),L={u_matrix:t.projMatrix,u_extrude_scale:D,u_intensity:v,u_inv_rot_matrix:Wd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=u,L.u_merc_center=p,L.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],L.u_zoom_transition=o.ah(w.zoom);const k=p[0]*o.aj,O=p[1]*o.aj;L.u_up_dir=w.projection.upVector(new o.cp(0,0,0),k,O)}return L};function uc(c,[t,r,u,p],[_,v]){if(_===v)return[0,0,0,0];const w=255*(c-1)/(c*(v-_));return[t*w,r*w,u*w,p*w]}function $d(c,t,[r,u]){return r===u?0:.5/c+(t-r)*(c-1)/(c*(u-r))}const za=(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J,oe,ce)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:o.dC(k.paint.get("raster-saturation")),u_contrast_factor:o.dB(k.paint.get("raster-contrast")),u_spin_weights:Yd(k.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:N,u_zoom_transition:v,u_merc_center:w,u_cutoff_params:A,u_colorization_mix:uc(o.dD,j,Y),u_colorization_offset:$d(o.dD,X,Y),u_color_ramp:Z,u_texture_offset:[oe/(J+2*oe),J/(J+2*oe)],u_texture_res:[J+2*oe,J+2*oe],u_emissive_strength:ce});function Yd(c){c*=Math.PI/180;const t=Math.sin(c),r=Math.cos(c);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const La=.05,co=(c,t,r,u,p,_,v,w,A,D,L,k)=>({u_matrix:c,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:u,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:D,u_fade_t:L.mix,u_opacity:L.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:v,u_merc_center:w,u_cutoff_params:A}),Cl=(c,t,r,u,p,_,v,w,A,D)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:u,u_color_ramp:_,u_velocity_res:p,u_max_speed:v,u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),Bo=(c,t,r,u,p,_,v,w,A,D)=>({u_particle_texture:c,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:u,u_max_speed:p,u_speed_factor:_,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:w,u_data_scale:[255*A[0],255*A[1]],u_data_offset:D,u_particle_pos_scale:1.1,u_particle_pos_offset:[La,La]}),Zu=o.bz(),Gc=(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J,oe,ce,ye,fe,de)=>{const he=p.transform,_e={u_is_size_zoom_constant:+(c==="constant"||c==="source"),u_is_size_feature_constant:+(c==="constant"||c==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:he.getCameraToCenterDistance(J),u_rotate_symbol:+r,u_aspect_ratio:he.width/he.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:v,u_coord_matrix:w,u_is_text:+D,u_elevation_from_sea:A?1:0,u_pitch_with_map:+u,u_texsize:L,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Zu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Zu,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:fe||0,u_gamma_scale:u?p.transform.getCameraToCenterDistance(J)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:de||1,u_ground_shadow_factor:oe,u_inv_matrix:o.bi(o.bz(),v),u_normal_scale:ce};return J.name==="globe"&&(_e.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],_e.u_zoom_transition=Z,_e.u_inv_rot_matrix=X,_e.u_merc_center=j,_e.u_camera_forward=he._camera.forward(),_e.u_ecef_origin=o.dE(he.globeMatrix,N.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(he.globeMatrix),_e.u_up_vector=Y),_e},Hc=(c,t,r,u)=>({u_matrix:c,u_emissive_strength:t,u_opacity:r,u_color:u}),qc=(c,t,r,u,p,_,v,w,A)=>o.h(function(D,L,k,O,N,Z){const{width:j,height:X}=O.imageManager.getPixelSize(L),Y=Math.pow(2,Z.tileID.overscaledZ),J=Z.tileSize*Math.pow(2,O.transform.tileZoom)/Y,oe=J*(Z.tileID.canonical.x+Z.tileID.wrap*Y),ce=J*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[j,X],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:N?[O.transform.width,-1*O.transform.height]:[1/o.aw(Z,1,O.transform.tileZoom),1/o.aw(Z,1,O.transform.tileZoom)],u_pixel_coord_upper:[oe>>16,ce>>16],u_pixel_coord_lower:[65535&oe,65535&ce]}}(0,_,v,u,w,A),{u_matrix:c,u_emissive_strength:t,u_opacity:r}),Xu=new Float32Array(o.bx([])),Wu=(c,t,r,u,p,_,v,w,A,D,L,k,O,N=[0,0,0],Z)=>{const j=p.style.light,X=j.properties.get("position"),Y=[-X.x,-X.y,X.z],J=o.dx();j.properties.get("anchor")==="viewport"&&(o.dy(J,-p.transform.angle),o.dz(Y,Y,J));const oe=L.alphaMode==="MASK",ce=j.properties.get("color").toNonPremultipliedRenderColor(null),ye=O.paint.get("model-ambient-occlusion-intensity"),fe=O.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return fe.a=O.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:c,u_lighting_matrix:t,u_normal_matrix:r,u_node_matrix:u||Xu,u_lightpos:Y,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:N,u_opacity:_,u_baseTextureIsAlpha:0,u_alphaMask:+oe,u_alphaCutoff:L.alphaCutoff,u_baseColorFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:w.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:D,u_baseColorTexture:Ss.BaseColor,u_metallicRoughnessTexture:Ss.MetallicRoughness,u_normalTexture:Ss.Normal,u_occlusionTexture:Ss.Occlusion,u_emissionTexture:Ss.Emission,u_lutTexture:Ss.LUT,u_color_mix:fe.toArray01(),u_aoIntensity:ye,u_emissive_strength:k,u_occlusionTextureTransform:Z||[0,0,0,0]}},Zc=(c,t=Xu,r=Xu)=>({u_matrix:c,u_instance:t,u_node_matrix:r}),Xh={fillExtrusion:c=>({u_matrix:new o.cc(c),u_lightpos:new o.c9(c),u_lightintensity:new o.ca(c),u_lightcolor:new o.c9(c),u_vertical_gradient:new o.ca(c),u_opacity:new o.ca(c),u_edge_radius:new o.ca(c),u_width_scale:new o.ca(c),u_ao:new o.cb(c),u_height_type:new o.c8(c),u_base_type:new o.c8(c),u_tile_id:new o.c9(c),u_zoom_transition:new o.ca(c),u_inv_rot_matrix:new o.cc(c),u_merc_center:new o.cb(c),u_up_dir:new o.c9(c),u_height_lift:new o.ca(c),u_flood_light_color:new o.c9(c),u_vertical_scale:new o.ca(c),u_flood_light_intensity:new o.ca(c),u_ground_shadow_factor:new o.c9(c)}),fillExtrusionDepth:c=>({u_matrix:new o.cc(c),u_edge_radius:new o.ca(c),u_width_scale:new o.ca(c),u_vertical_scale:new o.ca(c),u_height_type:new o.c8(c),u_base_type:new o.c8(c)}),fillExtrusionPattern:c=>({u_matrix:new o.cc(c),u_lightpos:new o.c9(c),u_lightintensity:new o.ca(c),u_lightcolor:new o.c9(c),u_vertical_gradient:new o.ca(c),u_height_factor:new o.ca(c),u_edge_radius:new o.ca(c),u_width_scale:new o.ca(c),u_ao:new o.cb(c),u_height_type:new o.c8(c),u_base_type:new o.c8(c),u_tile_id:new o.c9(c),u_zoom_transition:new o.ca(c),u_inv_rot_matrix:new o.cc(c),u_merc_center:new o.cb(c),u_up_dir:new o.c9(c),u_height_lift:new o.ca(c),u_image:new o.c8(c),u_texsize:new o.cb(c),u_pixel_coord_upper:new o.cb(c),u_pixel_coord_lower:new o.cb(c),u_tile_units_to_pixels:new o.ca(c),u_opacity:new o.ca(c),u_pattern_transition:new o.ca(c)}),fillExtrusionGroundEffect:c=>({u_matrix:new o.cc(c),u_opacity:new o.ca(c),u_ao_pass:new o.ca(c),u_meter_to_tile:new o.ca(c),u_ao:new o.cb(c),u_flood_light_intensity:new o.ca(c),u_flood_light_color:new o.c9(c),u_attenuation:new o.ca(c),u_edge_radius:new o.ca(c),u_fb:new o.c8(c),u_fb_size:new o.ca(c),u_dynamic_offset:new o.ca(c)}),fill:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_ground_shadow_factor:new o.c9(c)}),fillPattern:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_image:new o.c8(c),u_texsize:new o.cb(c),u_pixel_coord_upper:new o.cb(c),u_pixel_coord_lower:new o.cb(c),u_tile_units_to_pixels:new o.ca(c),u_ground_shadow_factor:new o.c9(c),u_pattern_transition:new o.ca(c)}),fillOutline:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_world:new o.cb(c),u_ground_shadow_factor:new o.c9(c)}),fillOutlinePattern:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_world:new o.cb(c),u_image:new o.c8(c),u_texsize:new o.cb(c),u_pixel_coord_upper:new o.cb(c),u_pixel_coord_lower:new o.cb(c),u_tile_units_to_pixels:new o.ca(c),u_ground_shadow_factor:new o.c9(c),u_pattern_transition:new o.ca(c)}),building:c=>({u_matrix:new o.cc(c),u_normal_matrix:new o.cc(c),u_opacity:new o.ca(c)}),buildingDepth:c=>({u_matrix:new o.cc(c)}),elevatedStructuresDepth:c=>({u_matrix:new o.cc(c),u_depth_bias:new o.ca(c)}),elevatedStructures:c=>({u_matrix:new o.cc(c),u_ground_shadow_factor:new o.c9(c)}),elevatedStructuresDepthReconstruct:c=>({u_matrix:new o.cc(c),u_camera_pos:new o.c9(c),u_depth_bias:new o.ca(c),u_height_scale:new o.ca(c),u_reset_depth:new o.ca(c)}),circle:o.dH,collisionBox:c=>({u_matrix:new o.cc(c),u_camera_to_center_distance:new o.ca(c),u_extrude_scale:new o.cb(c)}),collisionCircle:c=>({u_matrix:new o.cc(c),u_inv_matrix:new o.cc(c),u_camera_to_center_distance:new o.ca(c),u_viewport_size:new o.cb(c)}),debug:c=>({u_color:new o.di(c),u_matrix:new o.cc(c),u_overlay:new o.c8(c),u_overlay_scale:new o.ca(c)}),clippingMask:c=>({u_matrix:new o.cc(c)}),heatmap:c=>({u_extrude_scale:new o.ca(c),u_intensity:new o.ca(c),u_matrix:new o.cc(c),u_inv_rot_matrix:new o.cc(c),u_merc_center:new o.cb(c),u_tile_id:new o.c9(c),u_zoom_transition:new o.ca(c),u_up_dir:new o.c9(c)}),heatmapTexture:c=>({u_image:new o.c8(c),u_color_ramp:new o.c8(c),u_opacity:new o.ca(c)}),hillshade:c=>({u_matrix:new o.cc(c),u_image:new o.c8(c),u_latrange:new o.cb(c),u_light:new o.cb(c),u_shadow:new o.di(c),u_highlight:new o.di(c),u_emissive_strength:new o.ca(c),u_accent:new o.di(c)}),hillshadePrepare:c=>({u_matrix:new o.cc(c),u_image:new o.c8(c),u_dimension:new o.cb(c),u_zoom:new o.ca(c)}),line:o.dG,linePattern:o.dF,raster:c=>({u_matrix:new o.cc(c),u_normalize_matrix:new o.cc(c),u_globe_matrix:new o.cc(c),u_merc_matrix:new o.cc(c),u_grid_matrix:new o.dj(c),u_tl_parent:new o.cb(c),u_scale_parent:new o.ca(c),u_fade_t:new o.ca(c),u_opacity:new o.ca(c),u_image0:new o.c8(c),u_image1:new o.c8(c),u_brightness_low:new o.ca(c),u_brightness_high:new o.ca(c),u_saturation_factor:new o.ca(c),u_contrast_factor:new o.ca(c),u_spin_weights:new o.c9(c),u_perspective_transform:new o.cb(c),u_raster_elevation:new o.ca(c),u_zoom_transition:new o.ca(c),u_merc_center:new o.cb(c),u_cutoff_params:new o.cQ(c),u_colorization_mix:new o.cQ(c),u_colorization_offset:new o.ca(c),u_color_ramp:new o.c8(c),u_texture_offset:new o.cb(c),u_texture_res:new o.cb(c),u_emissive_strength:new o.ca(c)}),rasterParticle:c=>({u_matrix:new o.cc(c),u_normalize_matrix:new o.cc(c),u_globe_matrix:new o.cc(c),u_merc_matrix:new o.cc(c),u_grid_matrix:new o.dj(c),u_tl_parent:new o.cb(c),u_scale_parent:new o.ca(c),u_fade_t:new o.ca(c),u_opacity:new o.ca(c),u_image0:new o.c8(c),u_image1:new o.c8(c),u_raster_elevation:new o.ca(c),u_zoom_transition:new o.ca(c),u_merc_center:new o.cb(c),u_cutoff_params:new o.cQ(c)}),rasterParticleTexture:c=>({u_texture:new o.c8(c),u_opacity:new o.ca(c)}),rasterParticleDraw:c=>({u_particle_texture:new o.c8(c),u_particle_texture_side_len:new o.ca(c),u_tile_offset:new o.cb(c),u_velocity:new o.c8(c),u_color_ramp:new o.c8(c),u_velocity_res:new o.cb(c),u_max_speed:new o.ca(c),u_uv_offset:new o.cb(c),u_data_scale:new o.cb(c),u_data_offset:new o.ca(c),u_particle_pos_scale:new o.ca(c),u_particle_pos_offset:new o.cb(c)}),rasterParticleUpdate:c=>({u_particle_texture:new o.c8(c),u_particle_texture_side_len:new o.ca(c),u_velocity:new o.c8(c),u_velocity_res:new o.cb(c),u_max_speed:new o.ca(c),u_speed_factor:new o.ca(c),u_reset_rate:new o.ca(c),u_rand_seed:new o.ca(c),u_uv_offset:new o.cb(c),u_data_scale:new o.cb(c),u_data_offset:new o.ca(c),u_particle_pos_scale:new o.ca(c),u_particle_pos_offset:new o.cb(c)}),symbol:c=>({u_is_size_zoom_constant:new o.c8(c),u_is_size_feature_constant:new o.c8(c),u_size_t:new o.ca(c),u_size:new o.ca(c),u_camera_to_center_distance:new o.ca(c),u_rotate_symbol:new o.c8(c),u_aspect_ratio:new o.ca(c),u_fade_change:new o.ca(c),u_matrix:new o.cc(c),u_label_plane_matrix:new o.cc(c),u_coord_matrix:new o.cc(c),u_is_text:new o.c8(c),u_elevation_from_sea:new o.c8(c),u_pitch_with_map:new o.c8(c),u_texsize:new o.cb(c),u_texsize_icon:new o.cb(c),u_texture:new o.c8(c),u_texture_icon:new o.c8(c),u_gamma_scale:new o.ca(c),u_device_pixel_ratio:new o.ca(c),u_tile_id:new o.c9(c),u_zoom_transition:new o.ca(c),u_inv_rot_matrix:new o.cc(c),u_merc_center:new o.cb(c),u_camera_forward:new o.c9(c),u_tile_matrix:new o.cc(c),u_up_vector:new o.c9(c),u_ecef_origin:new o.c9(c),u_is_halo:new o.c8(c),u_icon_transition:new o.ca(c),u_color_adj_mat:new o.cc(c),u_scale_factor:new o.ca(c),u_ground_shadow_factor:new o.c9(c),u_inv_matrix:new o.cc(c),u_normal_scale:new o.ca(c)}),background:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_opacity:new o.ca(c),u_color:new o.di(c)}),backgroundPattern:c=>({u_matrix:new o.cc(c),u_emissive_strength:new o.ca(c),u_opacity:new o.ca(c),u_image:new o.c8(c),u_pattern_tl:new o.cb(c),u_pattern_br:new o.cb(c),u_texsize:new o.cb(c),u_pattern_size:new o.cb(c),u_pixel_coord_upper:new o.cb(c),u_pixel_coord_lower:new o.cb(c),u_pattern_units_to_pixels:new o.cb(c)}),terrainRaster:c=>({u_matrix:new o.cc(c),u_image0:new o.c8(c),u_skirt_height:new o.ca(c),u_ground_shadow_factor:new o.c9(c)}),skybox:c=>({u_matrix:new o.cc(c),u_sun_direction:new o.c9(c),u_cubemap:new o.c8(c),u_opacity:new o.ca(c),u_temporal_offset:new o.ca(c)}),skyboxGradient:c=>({u_matrix:new o.cc(c),u_color_ramp:new o.c8(c),u_center_direction:new o.c9(c),u_radius:new o.ca(c),u_opacity:new o.ca(c),u_temporal_offset:new o.ca(c)}),skyboxCapture:c=>({u_matrix_3f:new o.dj(c),u_sun_direction:new o.c9(c),u_sun_intensity:new o.ca(c),u_color_tint_r:new o.cQ(c),u_color_tint_m:new o.cQ(c),u_luminance:new o.ca(c)}),globeRaster:c=>({u_proj_matrix:new o.cc(c),u_globe_matrix:new o.cc(c),u_normalize_matrix:new o.cc(c),u_merc_matrix:new o.cc(c),u_zoom_transition:new o.ca(c),u_merc_center:new o.cb(c),u_image0:new o.c8(c),u_grid_matrix:new o.dj(c),u_skirt_height:new o.ca(c),u_far_z_cutoff:new o.ca(c),u_frustum_tl:new o.c9(c),u_frustum_tr:new o.c9(c),u_frustum_br:new o.c9(c),u_frustum_bl:new o.c9(c),u_globe_pos:new o.c9(c),u_globe_radius:new o.ca(c),u_viewport:new o.cb(c)}),globeAtmosphere:c=>({u_frustum_tl:new o.c9(c),u_frustum_tr:new o.c9(c),u_frustum_br:new o.c9(c),u_frustum_bl:new o.c9(c),u_horizon:new o.ca(c),u_transition:new o.ca(c),u_fadeout_range:new o.ca(c),u_color:new o.cQ(c),u_high_color:new o.cQ(c),u_space_color:new o.cQ(c),u_temporal_offset:new o.ca(c),u_horizon_angle:new o.ca(c)}),model:c=>({u_matrix:new o.cc(c),u_lighting_matrix:new o.cc(c),u_normal_matrix:new o.cc(c),u_node_matrix:new o.cc(c),u_lightpos:new o.c9(c),u_lightintensity:new o.ca(c),u_lightcolor:new o.c9(c),u_camera_pos:new o.c9(c),u_opacity:new o.ca(c),u_baseColorFactor:new o.cQ(c),u_emissiveFactor:new o.cQ(c),u_metallicFactor:new o.ca(c),u_roughnessFactor:new o.ca(c),u_baseTextureIsAlpha:new o.c8(c),u_alphaMask:new o.c8(c),u_alphaCutoff:new o.ca(c),u_baseColorTexture:new o.c8(c),u_metallicRoughnessTexture:new o.c8(c),u_normalTexture:new o.c8(c),u_occlusionTexture:new o.c8(c),u_emissionTexture:new o.c8(c),u_lutTexture:new o.c8(c),u_color_mix:new o.cQ(c),u_aoIntensity:new o.ca(c),u_emissive_strength:new o.ca(c),u_occlusionTextureTransform:new o.cQ(c)}),modelDepth:c=>({u_matrix:new o.cc(c),u_instance:new o.cc(c),u_node_matrix:new o.cc(c)}),groundShadow:c=>({u_matrix:new o.cc(c),u_ground_shadow_factor:new o.c9(c)}),stars:c=>({u_matrix:new o.cc(c),u_up:new o.c9(c),u_right:new o.c9(c),u_intensity_multiplier:new o.ca(c)}),snowParticle:c=>({u_modelview:new o.cc(c),u_projection:new o.cc(c),u_time:new o.ca(c),u_cam_pos:new o.c9(c),u_velocityConeAperture:new o.ca(c),u_velocity:new o.ca(c),u_horizontalOscillationRadius:new o.ca(c),u_horizontalOscillationRate:new o.ca(c),u_boxSize:new o.ca(c),u_billboardSize:new o.ca(c),u_simpleShapeParameters:new o.cb(c),u_screenSize:new o.cb(c),u_thinningCenterPos:new o.cb(c),u_thinningShape:new o.c9(c),u_thinningAffectedRatio:new o.ca(c),u_thinningParticleOffset:new o.ca(c),u_particleColor:new o.cQ(c),u_direction:new o.c9(c)}),rainParticle:c=>({u_modelview:new o.cc(c),u_projection:new o.cc(c),u_time:new o.ca(c),u_cam_pos:new o.c9(c),u_texScreen:new o.c8(c),u_velocityConeAperture:new o.ca(c),u_velocity:new o.ca(c),u_boxSize:new o.ca(c),u_rainDropletSize:new o.cb(c),u_distortionStrength:new o.ca(c),u_rainDirection:new o.c9(c),u_color:new o.cQ(c),u_screenSize:new o.cb(c),u_thinningCenterPos:new o.cb(c),u_thinningShape:new o.c9(c),u_thinningAffectedRatio:new o.ca(c),u_thinningParticleOffset:new o.ca(c),u_shapeDirectionalPower:new o.ca(c),u_shapeNormalPower:new o.ca(c),u_mode:new o.ca(c)}),vignette:c=>({u_vignetteShape:new o.c9(c),u_vignetteColor:new o.cQ(c)}),occlusion:c=>({u_matrix:new o.cc(c),u_anchorPos:new o.c9(c),u_screenSizePx:new o.cb(c),u_occluderSizePx:new o.cb(c),u_color:new o.cQ(c)})};class So{constructor(t,r,u,p){this.id=So.uniqueIdxCounter,So.uniqueIdxCounter++,this.context=t;const _=t.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!u,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||r.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=So.uniqueIdxCounter,So.uniqueIdxCounter++;const r=this.context.gl;this.context.unbindVAO(),this.bind(),r.bufferSubData(r.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}So.uniqueIdxCounter=0;const op={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ap{constructor(t,r,u,p,_,v){this.length=r.length,this.attributes=u,this.itemSize=r.bytesPerElement,this.dynamicDraw=p,this.instanceCount=v,this.context=t;const w=t.gl;this.buffer=w.createBuffer(),t.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,r.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||_||r.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const r=this.context.gl;this.bind(),r.bufferSubData(r.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,r){for(let u=0;u<this.attributes.length;u++){const p=r.attributes[this.attributes[u].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],v=r.attributes[_.name];v!==void 0&&t.vertexAttribPointer(v,_.components,t[op[_.type]],!1,this.itemSize,_.offset+this.itemSize*(u||0))}}setVertexAttribDivisor(t,r,u){for(let p=0;p<this.attributes.length;p++){const _=r.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(_,u)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Pa{constructor(t,r,u,p,_){this.context=t,this.width=r,this.height=u;const v=this.framebuffer=t.gl.createFramebuffer();p&&(this.colorAttachment=new Ra(t,v)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Tl(t,v):new Sl(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const r=this.colorAttachment.get();r&&t.deleteTexture(r)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const r=this.depthAttachment.get();r&&t.deleteRenderbuffer(r)}else{const r=this.depthAttachment.get();r&&t.deleteTexture(r)}t.deleteFramebuffer(this.framebuffer)}}class An{constructor(t,r){this.gl=t,this.clearColor=new Uh(this),this.clearDepth=new vl(this),this.clearStencil=new ep(this),this.colorMask=new tp(this),this.depthMask=new Bu(this),this.stencilMask=new Fu(this),this.stencilFunc=new Vh(this),this.stencilOp=new Gd(this),this.stencilTest=new Ws(this),this.depthRange=new Oo(this),this.depthTest=new tc(this),this.depthFunc=new ca(this),this.blend=new ko(this),this.blendFunc=new xl(this),this.blendColor=new ic(this),this.blendEquation=new nc(this),this.cullFace=new Nu(this),this.cullFaceSide=new ds(this),this.frontFace=new Tr(this),this.program=new cr(this),this.activeTexture=new bl(this),this.viewport=new ua(this),this.bindFramebuffer=new rc(this),this.bindRenderbuffer=new Ma(this),this.bindTexture=new jh(this),this.bindVertexBuffer=new Hd(this),this.bindElementBuffer=new sc(this),this.bindVertexArrayOES=new wl(this),this.pixelStoreUnpack=new ip(this),this.pixelStoreUnpackPremultiplyAlpha=new Uu(this),this.pixelStoreUnpackFlipY=new qd(this),this.options=r?Object.assign({},r):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=r&&!!r.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,r,u){return new So(this,t,r,u)}createVertexBuffer(t,r,u,p,_){return new ap(this,t,r,u,p,_)}createRenderbuffer(t,r,u){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,t,r,u),this.bindRenderbuffer.set(null),_}createFramebuffer(t,r,u,p){return new Pa(this,t,r,u,p)}clear({color:t,depth:r,stencil:u,colorMask:p}){const _=this.gl;let v=0;t&&(v|=_.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(p||[!0,!0,!0,!0])),r!==void 0&&(v|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),u!==void 0&&(v|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(u),this.stencilMask.set(255)),_.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.bv(t.blendFunction,Ii.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let rr;function Pr(c,t,r,u,p,_,v){const w=c.context,A=w.gl,D=c.transform,L=c.getOrCreateProgram("collisionBox"),k=[];let O=0,N=0;for(let ce=0;ce<u.length;ce++){const ye=u[ce],fe=t.getTile(ye),de=fe.getBucket(r);if(!de)continue;const he=ei(ye,de,D);let _e=he;p[0]===0&&p[1]===0||(_e=c.translatePosMatrix(he,fe,p,_));const be=v?de.textCollisionBox:de.iconCollisionBox,De=de.collisionCircleArray;if(De.length>0){const ze=o.bz(),qe=_e;o.cB(ze,de.placementInvProjMatrix,D.glCoordMatrix),o.cB(ze,ze,de.placementViewportMatrix),k.push({circleArray:De,circleOffset:N,transform:qe,invTransform:ze,projection:de.getProjection()}),O+=De.length/4,N=O}be&&(c.terrain&&c.terrain.setupElevationDraw(fe,L),L.draw(c,A.LINES,kt.disabled,li.disabled,c.colorModeForRenderPass(),Jt.disabled,am(_e,D,fe,de.getProjection()),r.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,D.zoom,null,[be.collisionVertexBuffer,be.collisionVertexBufferExt]))}if(!v||!k.length)return;const Z=c.getOrCreateProgram("collisionCircle"),j=new o.dI;j.resize(4*O),j._trim();let X=0;for(const ce of k)for(let ye=0;ye<ce.circleArray.length/4;ye++){const fe=4*ye,de=ce.circleArray[fe+0],he=ce.circleArray[fe+1],_e=ce.circleArray[fe+2],be=ce.circleArray[fe+3];j.emplace(X++,de,he,_e,be,0),j.emplace(X++,de,he,_e,be,1),j.emplace(X++,de,he,_e,be,2),j.emplace(X++,de,he,_e,be,3)}(!rr||rr.length<2*O)&&(rr=function(ce){const ye=2*ce,fe=new o.a_;fe.resize(ye),fe._trim();for(let de=0;de<ye;de++){const he=6*de;fe.uint16[he+0]=4*de+0,fe.uint16[he+1]=4*de+1,fe.uint16[he+2]=4*de+2,fe.uint16[he+3]=4*de+2,fe.uint16[he+4]=4*de+3,fe.uint16[he+5]=4*de+0}return fe}(O));const Y=w.createIndexBuffer(rr,!0),J=w.createVertexBuffer(j,o.dJ.members,!0);for(const ce of k){const ye={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(oe=D).getCameraToCenterDistance(ce.projection),u_viewport_size:[oe.width,oe.height]};Z.draw(c,A.TRIANGLES,kt.disabled,li.disabled,c.colorModeForRenderPass(),Jt.disabled,ye,r.id,J,Y,o.bd.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,D.zoom)}var oe;J.destroy(),Y.destroy()}const Fo=o.bz();function Oa(c){const t=c._camera.getWorldToCamera(c.worldSize,1),r=o.az([],t,c.globeMatrix);o.bi(r,r);const u=[0,0,0],p=[0,1,0,0];return o.aA(p,p,r),u[0]=p[0],u[1]=p[1],u[2]=p[2],o.au(u,u),u}function ha({width:c,height:t,anchor:r,textOffset:u,textScale:p},_){const{horizontalAlign:v,verticalAlign:w}=o.bT(r),A=-(v-.5)*c,D=-(w-.5)*t,L=o.bU(r,u);return new o.P((A/p+L[0])*_,(D/p+L[1])*_)}function Wh(c,t,r,u,p,_,v,w,A,D){const L=c.text.placedSymbolArray,k=c.text.dynamicLayoutVertexArray,O=c.icon.dynamicLayoutVertexArray,N={},Z=c.getProjection(),j=kd(v,Z,p),X=p.elevation,Y=Z.upVectorScale(v.canonical,p.center.lat,p.worldSize).metersToTile;k.clear();for(let J=0;J<L.length;J++){const oe=L.get(J),{tileAnchorX:ce,tileAnchorY:ye,numGlyphs:fe}=oe,de=oe.hidden||!oe.crossTileID||c.allowVerticalPlacement&&!oe.placedOrientation?null:u[oe.crossTileID];if(de){let he=0,_e=0,be=0;if(X){const $e=X?X.getAtTileOffset(v,ce,ye):0,[Fe,tt,gt]=Z.upVector(v.canonical,ce,ye);he=$e*Fe*Y,_e=$e*tt*Y,be=$e*gt*Y}let[De,ze,qe,We]=sa(oe.projectedAnchorX+he,oe.projectedAnchorY+_e,oe.projectedAnchorZ+be,r?j:_);const rt=Mc(p.getCameraToCenterDistance(Z),We);let Ie=o.bJ(c.textSizeData,A,oe)*rt/o.bO;r&&(Ie*=c.tilePixelRatio/w);const Ue=ha(de,Ie);r?({x:De,y:ze,z:qe}=Z.projectTilePoint(ce+Ue.x,ye+Ue.y,v.canonical),[De,ze,qe]=sa(De+he,ze+_e,qe+be,_)):(t&&Ue._rotate(-p.angle),De+=Ue.x,ze+=Ue.y,qe=0);const Ee=c.allowVerticalPlacement&&oe.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let $e=0;$e<fe;$e++)o.bL(k,De,ze,qe,Ee);D&&oe.associatedIconIndex>=0&&(N[oe.associatedIconIndex]={x:De,y:ze,z:qe,angle:Ee})}else Dc(fe,k)}if(D){O.clear();const J=c.icon.placedSymbolArray;for(let oe=0;oe<J.length;oe++){const ce=J.get(oe),{numGlyphs:ye}=ce,fe=N[oe];if(ce.hidden||!fe)Dc(ye,O);else{const{x:de,y:he,z:_e,angle:be}=fe;for(let De=0;De<ye;De++)o.bL(O,de,he,_e,be)}}c.icon.dynamicLayoutVertexBuffer.updateData(O)}c.text.dynamicLayoutVertexBuffer.updateData(k)}function ka(c,t,r,u,p,_,v={}){const w=r.paint.get("icon-translate"),A=r.paint.get("text-translate"),D=r.paint.get("icon-translate-anchor"),L=r.paint.get("text-translate-anchor"),k=r.layout.get("icon-rotation-alignment"),O=r.layout.get("text-rotation-alignment"),N=r.layout.get("icon-pitch-alignment"),Z=r.layout.get("text-pitch-alignment"),j=r.layout.get("icon-keep-upright"),X=r.layout.get("text-keep-upright"),Y=r.paint.get("icon-color-saturation"),J=r.paint.get("icon-color-contrast"),oe=r.paint.get("icon-color-brightness-min"),ce=r.paint.get("icon-color-brightness-max"),ye=r.layout.get("symbol-elevation-reference")==="sea",fe=c.context,de=fe.gl,he=c.transform,_e=k==="map",be=O==="map",De=N==="map",ze=Z==="map",qe=r.layout.get("symbol-sort-key").constantOr(1)!==void 0;let We=!1;const rt=c.depthModeForSublayer(0,kt.ReadOnly),Ie=new kt(c.context.gl.LEQUAL,kt.ReadOnly,c.depthRangeFor3D),Ue=[o.aD(he.center.lng),o.aH(he.center.lat)],Ee=r.layout.get("text-variable-anchor"),$e=he.projection.name==="globe",Fe=[],tt=[0,-1,0];for(const gt of u){const Ye=t.getTile(gt),ht=Ye.getBucket(r);if(!ht||ht.projection.name==="mercator"&&$e||ht.fullyClipped)continue;const Ot=ht.projection.name==="globe",zt=Ot?o.ah(he.zoom):0,Dt=kd(gt,ht.getProjection(),he),Ht=he.calculatePixelsToTileUnitsMatrix(Ye),$t=Ee&&ht.hasTextData(),Lt=ht.hasIconTextFit()&&$t&&ht.hasIconData(),qt=ht.getProjection().createInversionMatrix(he,gt.canonical),Xt=(1<<Ye.tileID.canonical.z)*o.aj/c.transform.worldSize,ui=wn=>{let Pi=[0,0,0];if(wn){const On=c.style.directionalLight,Fi=c.style.ambientLight;On&&Fi&&(Pi=Yl(c.style,On,Fi))}return Pi},Ti=wn=>{he.depthOcclusionForSymbolsAndCircles&&(r.hasInitialOcclusionOpacityProperties||c.terrain)&&(wn.push("DEPTH_D24"),wn.push("DEPTH_OCCLUSION"))},Bi=()=>{const wn=_e&&r.layout.get("symbol-placement")!=="point",Pi=[];Ti(Pi);const On=wn||Lt,Fi=ht.elevationType==="road"&&De,Tn=c.shadowRenderer,Cn=Fi&&!!Tn&&Tn.enabled,yn=ui(Cn),Sn=Fi?Ie:rt,Ki=r.paint.get("icon-image-cross-fade");c.terrainRenderModeElevated()&&De&&Pi.push("PITCH_WITH_MAP_TERRAIN"),Ot&&(Pi.push("PROJECTION_GLOBE_VIEW"),On&&Pi.push("PROJECTED_POS_ON_VIEWPORT")),Ki>0&&Pi.push("ICON_TRANSITION"),ht.icon.zOffsetVertexBuffer&&Pi.push("Z_OFFSET"),Y===0&&J===0&&oe===0&&ce===1||Pi.push("COLOR_ADJUSTMENT"),ht.sdfIcons&&Pi.push("RENDER_SDF"),Cn&&Pi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Fi&&ht.icon.orientationVertexBuffer&&Pi.push("ELEVATED_ROADS");const Rn=ht.icon.programConfigurations.get(r.id),Xn=c.getOrCreateProgram("symbol",{config:Rn,defines:Pi}),dn=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Hi=ht.iconSizeData,ls=o.bH(Hi,he.zoom),Cs=De||!he.isOrthographic,Qs=Xs(Dt,Ye.tileID.canonical,De,_e,he,ht.getProjection(),Ht),qo=Zl(Dt,Ye.tileID.canonical,De,_e,he,ht.getProjection(),Ht),Us=c.translatePosMatrix(qo,Ye,w,D,!0),Is=c.translatePosMatrix(Dt,Ye,w,D),es=On?Fo:Qs,Zo=_e&&!De&&!wn;let ts=tt;!$e&&!he.mercatorFromTransition||_e||(ts=Oa(he));const ch=Ot?ts:tt,gf=r.getColorAdjustmentMatrix(Y,J,oe,ce),uh=Gc(Hi.kind,ls,Zo,De,c,Is,es,Us,ye,!1,dn,[0,0],0,gt,zt,Ue,qt,ch,ht.getProjection(),yn,Xt,gf,Ki,null),Qa=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,_c=r.layout.get("icon-size").constantOr(0)!==1||ht.iconsNeedLinear,hh=ht.sdfIcons||c.options.rotating||c.options.zooming||_c||Cs?de.LINEAR:de.NEAREST,zl=ht.sdfIcons&&r.paint.get("icon-halo-width").constantOr(1)!==0,ga=c.terrain&&De&&wn?o.bi(o.bz(),Qs):Fo;if(wn&&ht.icon){const ru=he.elevation,gc=ru?ru.getAtTileOffsetFunc(gt,he.center.lat,he.worldSize,ht.getProjection()):null,Ja=Ic(Dt,Ye.tileID.canonical,De,_e,he,ht.getProjection(),Ht);Xl(ht,Dt,c,!1,Ja,qo,De,j,gc,gt)}return{program:Xn,buffers:ht.icon,uniformValues:uh,atlasTexture:Qa,atlasTextureIcon:null,atlasInterpolation:hh,atlasInterpolationIcon:null,isSDF:ht.sdfIcons,hasHalo:zl,depthMode:Sn,tile:Ye,renderWithShadows:Cn,labelPlaneMatrixInv:ga}},Wi=()=>{const wn=be&&r.layout.get("symbol-placement")!=="point",Pi=[],On=wn||Ee||Lt,Fi=ht.elevationType==="road"&&ze,Tn=c.shadowRenderer,Cn=Fi&&!!Tn&&Tn.enabled,yn=ui(Cn),Sn=Fi?Ie:rt;c.terrainRenderModeElevated()&&ze&&Pi.push("PITCH_WITH_MAP_TERRAIN"),Ot&&(Pi.push("PROJECTION_GLOBE_VIEW"),On&&Pi.push("PROJECTED_POS_ON_VIEWPORT")),ht.text.zOffsetVertexBuffer&&Pi.push("Z_OFFSET"),ht.iconsInText&&Pi.push("RENDER_TEXT_AND_SYMBOL"),Pi.push("RENDER_SDF"),Cn&&Pi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Fi&&ht.text.orientationVertexBuffer&&Pi.push("ELEVATED_ROADS"),Ti(Pi);const Ki=ht.text.programConfigurations.get(r.id),Rn=c.getOrCreateProgram("symbol",{config:Ki,defines:Pi});let Xn,dn=[0,0],Hi=null;const ls=ht.textSizeData;ht.iconsInText&&(dn=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Hi=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,Xn=ze||!he.isOrthographic||c.options.rotating||c.options.zooming||ls.kind==="composite"||ls.kind==="camera"?de.LINEAR:de.NEAREST);const Cs=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture.size:[0,0],Qs=r.layout.get("text-size-scale-range"),qo=o.ay(c.scaleFactor,Qs[0],Qs[1]),Us=o.bH(ls,he.zoom,qo),Is=Xs(Dt,Ye.tileID.canonical,ze,be,he,ht.getProjection(),Ht),es=Zl(Dt,Ye.tileID.canonical,ze,be,he,ht.getProjection(),Ht),Zo=c.translatePosMatrix(es,Ye,A,L,!0),ts=c.translatePosMatrix(Dt,Ye,A,L),ch=On?Fo:Is,gf=be&&!ze&&!wn;let uh=tt;!$e&&!he.mercatorFromTransition||be||(uh=Oa(he));const Qa=Gc(ls.kind,Us,gf,ze,c,ts,ch,Zo,ye,!0,Cs,dn,0,gt,zt,Ue,qt,Ot?uh:tt,ht.getProjection(),yn,Xt,null,null,qo),_c=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture:null,hh=de.LINEAR,zl=r.paint.get("text-halo-width").constantOr(1)!==0,ga=c.terrain&&ze&&wn?o.bi(o.bz(),Is):Fo;if(wn&&ht.text){const ru=he.elevation,gc=ru?ru.getAtTileOffsetFunc(gt,he.center.lat,he.worldSize,ht.getProjection()):null,Ja=Ic(Dt,Ye.tileID.canonical,ze,be,he,ht.getProjection(),Ht);Xl(ht,Dt,c,!0,Ja,es,ze,X,gc,gt)}return{program:Rn,buffers:ht.text,uniformValues:Qa,atlasTexture:_c,atlasTextureIcon:Hi,atlasInterpolation:hh,atlasInterpolationIcon:Xn,isSDF:!0,hasHalo:zl,depthMode:Sn,tile:Ye,renderWithShadows:Cn,labelPlaneMatrixInv:ga}},Zn=ht.icon.segments.get().length,gi=ht.text.segments.get().length,mi=Zn&&!v.onlyText?Bi():null,ii=gi&&!v.onlyIcons?Wi():null,an=r.paint.get("icon-opacity").constantOr(1),dr=r.paint.get("text-opacity").constantOr(1);if(qe&&ht.canOverlap){We=!0;const wn=an&&!v.onlyText?ht.icon.segments.get():[],Pi=dr&&!v.onlyIcons?ht.text.segments.get():[];for(const On of wn)Fe.push({segments:new o.bd([On]),sortKey:On.sortKey,state:mi});for(const On of Pi)Fe.push({segments:new o.bd([On]),sortKey:On.sortKey,state:ii})}else v.onlyText||Fe.push({segments:an?ht.icon.segments:new o.bd([]),sortKey:0,state:mi}),v.onlyIcons||Fe.push({segments:dr?ht.text.segments:new o.bd([]),sortKey:0,state:ii})}We&&Fe.sort((gt,Ye)=>gt.sortKey-Ye.sortKey);for(const gt of Fe){const Ye=gt.state;if(Ye)if(c.terrain?c.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}):c.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Ye.program),fe.activeTexture.set(de.TEXTURE0),Ye.atlasTexture&&Ye.atlasTexture.bind(Ye.atlasInterpolation,de.CLAMP_TO_EDGE,!0),Ye.atlasTextureIcon&&(fe.activeTexture.set(de.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,de.CLAMP_TO_EDGE,!0)),Ye.renderWithShadows&&c.shadowRenderer.setupShadows(Ye.tile.tileID.toUnwrapped(),Ye.program,"vector-tile",Ye.tile.tileID.overscaledZ),c.uploadCommonLightUniforms(c.context,Ye.program),Ye.hasHalo){const ht=Ye.uniformValues;ht.u_is_halo=1,da(Ye.buffers,gt.segments,r,c,Ye.program,Ye.depthMode,p,_,ht,2),ht.u_is_halo=0}else{if(Ye.isSDF){const ht=Ye.uniformValues;Ye.hasHalo&&(ht.u_is_halo=1,da(Ye.buffers,gt.segments,r,c,Ye.program,Ye.depthMode,p,_,ht,1)),ht.u_is_halo=0}da(Ye.buffers,gt.segments,r,c,Ye.program,Ye.depthMode,p,_,Ye.uniformValues,1)}}}function da(c,t,r,u,p,_,v,w,A,D){const L=[c.dynamicLayoutVertexBuffer,c.opacityVertexBuffer,c.iconTransitioningVertexBuffer,c.globeExtVertexBuffer,c.zOffsetVertexBuffer,c.orientationVertexBuffer];p.draw(u,u.context.gl.TRIANGLES,_,v,w,Jt.disabled,A,r.id,c.layoutVertexBuffer,c.indexBuffer,t,r.paint,u.transform.zoom,c.programConfigurations.get(r.id),L,D)}function Kd(c,t){const r=1<<c.canonical.z,u=(t.x*r-c.canonical.x-c.wrap*r)*o.aj,p=(t.y*r-c.canonical.y)*o.aj,_=o.dS(t.z,t.y);return o.cS(u,p,_)}function Or(c,t,r,u,p){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const _=c.context.gl,v=new kt(c.context.gl.LEQUAL,kt.ReadWrite,c.depthRangeFor3D),w=new kt(c.context.gl.GREATER,kt.ReadWrite,c.depthRangeFor3D),A=function(N){const Z=o.cJ(N.pitch);let j=.01;return N.isOrthographic&&(j=o.ai(1e-4,j,o.cN(Z>=Wr?1:Z/Wr))),2*j}(c.transform),D=c.transform.getFreeCameraOptions().position,L="elevatedStructuresDepthReconstruct",k=c.getOrCreateProgram(L,{defines:["DEPTH_RECONSTRUCTION"]}),O=c.getOrCreateProgram(L);for(const N of u){const Z=t.getTile(N),j=Z.getBucket(r);if(!j)continue;const X=j.elevatedStructures;if(!X)continue;const Y=j.elevationBufferData.heightRange,J=Kd(N.toUnwrapped(),D),oe=c.translatePosMatrix(N.projMatrix,Z,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));let ce,ye,fe,de;if(p==="initialize"){if(!Y||Y.min>=1||X.depthSegments.segments[0].primitiveLength===0)continue;ce=Hu(oe,J,A,1,0),ye=v,fe=X.depthSegments,de=k}else if(p==="reset"){if(!Y||Y.min>=0||X.maskSegments.segments[0].primitiveLength===0)continue;ce=Hu(oe,J,0,0,1),ye=w,fe=X.maskSegments,de=k}else if(p==="geometry"){if(X.depthSegments.segments[0].primitiveLength===0)continue;ce=Hu(oe,J,A,1,0),ye=v,fe=X.depthSegments,de=O}de.draw(c,_.TRIANGLES,ye,li.disabled,Ii.disabled,Jt.disabled,ce,r.id,X.vertexBuffer,X.indexBuffer,fe,r.paint,c.transform.zoom)}}function $h(c,t,r){const{painter:u,sourceCache:p,layer:_,coords:v,colorMode:w,elevationType:A,terrainEnabled:D,pass:L}=c,k=u.context.gl,O=_.paint.get("fill-pattern"),N=_.paint.get("fill-pattern-cross-fade"),Z=O.constantOr(null);let j=A;A!=="road"||t&&!D||(j="none");const X=j==="road",Y=c.painter.shadowRenderer,J=X&&!!Y&&Y.enabled,oe=new kt(u.context.gl.LEQUAL,kt.ReadOnly,u.depthRangeFor3D);let ce=[0,0,0];if(J){const de=u.style.directionalLight,he=u.style.ambientLight;de&&he&&(ce=Yl(u.style,de,he))}const ye=O&&O.constantOr(1),fe=(de,he)=>{let _e,be,De,ze,qe;he?(_e=ye&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",De=k.LINES):(_e=ye?"fillPattern":"fill",De=k.TRIANGLES);for(const We of v){const rt=p.getTile(We);if(ye&&!rt.patternsLoaded())continue;const Ie=rt.getBucket(_);if(!Ie)continue;const Ue=t?Ie.elevationBufferData:Ie.bufferData;if(Ue.isEmpty())continue;u.prepareDrawTile();const Ee=Ue.programConfigurations.get(_.id),$e=u.isTileAffectedByFog(We),Fe=[],tt=[];X&&(Fe.push("ELEVATED_ROADS"),tt.push(Ue.elevatedLayoutVertexBuffer)),J&&Fe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ye&&(u.context.activeTexture.set(k.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ee.updatePaintBuffers());let gt=!1;if(Z&&rt.imageAtlas){const Dt=rt.imageAtlas,Ht=o.dN.from(Z),$t=Ht.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Lt=Ht.getSecondary(),qt=Dt.patternPositions.get($t),Xt=Lt?Dt.patternPositions.get(Lt.scaleSelf(o.q.devicePixelRatio).toString()):null;gt=!!qt&&!!Xt,qt&&Ee.setConstantPatternPositions(qt,Xt)}N>0&&(gt||Ee.getPatternTransitionVertexBuffer("fill-pattern"))&&Fe.push("FILL_PATTERN_TRANSITION");const Ye=u.getOrCreateProgram(_e,{config:Ee,overrideFog:$e,defines:Fe}),ht=u.translatePosMatrix(We.projMatrix,rt,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));J&&Y.setupShadows(rt.tileID.toUnwrapped(),Ye,"vector-tile",rt.tileID.overscaledZ);const Ot=_.paint.get("fill-emissive-strength");if(he){ze=Ue.lineIndexBuffer,qe=Ue.lineSegments;const Dt=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];be=_e==="fillOutlinePattern"&&ye?om(ht,Ot,u,rt,Dt,ce,N):Zh(ht,Ot,Dt,ce)}else ze=Ue.indexBuffer,qe=Ue.triangleSegments,be=ye?sp(ht,Ot,u,rt,ce,N):Da(ht,Ot,ce);u.uploadCommonUniforms(u.context,Ye,We.toUnwrapped());let zt=de;(A==="road"&&!D||A==="offset")&&(zt=oe),Ye.draw(u,De,zt,r||u.stencilModeForClipping(We),w,Jt.disabled,be,_.id,Ue.layoutVertexBuffer,ze,qe,_.paint,u.transform.zoom,Ee,tt)}};u.renderPass===L&&fe(u.depthModeForSublayer(1,u.renderPass==="opaque"?kt.ReadWrite:kt.ReadOnly),!1),j==="none"&&u.renderPass==="translucent"&&_.paint.get("fill-antialias")&&fe(u.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,kt.ReadOnly),!0)}function fa(c,t,r,u,p,_,v,w){r.resetLayerRenderingStats(c);const A=c.context,D=A.gl,L=c.transform,k=r.paint.get("fill-extrusion-pattern"),O=r.paint.get("fill-extrusion-pattern-cross-fade"),N=k.constantOr(null),Z=k.constantOr(1),j=r.paint.get("fill-extrusion-opacity"),X=c.style.enable3dLights(),Y=r.paint.get(X&&!Z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),J=[r.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y],oe=r.layout.get("fill-extrusion-edge-radius"),ce=oe>0&&!r.paint.get("fill-extrusion-rounded-roof"),ye=ce?0:oe,fe=L.projection.name==="globe"?o.dV():0,de=L.projection.name==="globe",he=de?o.ah(L.zoom):0,_e=[o.aD(L.center.lng),o.aH(L.center.lat)],be=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(be?null:r.lut).toArray01().slice(0,3),ze=r.paint.get("fill-extrusion-flood-light-intensity"),qe=r.paint.get("fill-extrusion-vertical-scale"),We=r.paint.get("fill-extrusion-line-width").constantOr(1)!==0,rt=r.paint.get("fill-extrusion-height-alignment"),Ie=r.paint.get("fill-extrusion-base-alignment"),Ue=Ia(c,r.paint.get("fill-extrusion-cutoff-fade-range")),Ee=[];let $e;de&&Ee.push("PROJECTION_GLOBE_VIEW"),J[0]>0&&Ee.push("FAUX_AO"),ce&&Ee.push("ZERO_ROOF_RADIUS"),w&&Ee.push("HAS_CENTROID"),ze>0&&Ee.push("FLOOD_LIGHT"),Ue.shouldRenderCutoff&&Ee.push("RENDER_CUTOFF"),We&&Ee.push("RENDER_WALL_MODE");const Fe=c.renderPass==="shadow",tt=c.shadowRenderer,gt=Fe&&!!tt,Ye=Fe?Jt.disabled:Jt.backCCW;c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!0);let ht=[0,0,0];if(tt){const Dt=c.style.directionalLight,Ht=c.style.ambientLight;Dt&&Ht&&(ht=Yl(c.style,Dt,Ht)),Fe||(Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE"),tt.useNormalOffset&&Ee.push("NORMAL_OFFSET")),$e=Ee.concat(["SHADOWS_SINGLE_CASCADE"])}const Ot=gt?"fillExtrusionDepth":Z?"fillExtrusionPattern":"fillExtrusion",zt=r.getLayerRenderingStats();for(const Dt of u){const Ht=t.getTile(Dt),$t=Ht.getBucket(r);if(!$t||$t.projection.name!==L.projection.name)continue;let Lt=!1;tt&&(Lt=tt.getMaxCascadeForTile(Dt.toUnwrapped())===0);const qt=c.isTileAffectedByFog(Dt),Xt=$t.programConfigurations.get(r.id);let ui=!1;if(N&&Ht.imageAtlas){const ii=Ht.imageAtlas,an=o.dN.from(N),dr=an.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),wn=an.getSecondary(),Pi=ii.patternPositions.get(dr),On=wn?ii.patternPositions.get(wn.scaleSelf(o.q.devicePixelRatio).toString()):null;ui=!!Pi&&!!On,Pi&&Xt.setConstantPatternPositions(Pi,On)}O>0&&(ui||Xt.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ee.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ti=c.getOrCreateProgram(Ot,{config:Xt,defines:Lt?$e:Ee,overrideFog:qt});if(c.terrain&&c.terrain.setupElevationDraw(Ht,Ti,{useMeterToDem:!0}),!$t.centroidVertexBuffer){const ii=Ti.attributes.a_centroid_pos;ii!==void 0&&D.vertexAttrib2f(ii,0,0)}!Fe&&tt&&tt.setupShadows(Ht.tileID.toUnwrapped(),Ti,"vector-tile",Ht.tileID.overscaledZ),Z&&(c.context.activeTexture.set(D.TEXTURE0),Ht.imageAtlasTexture&&Ht.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Xt.updatePaintBuffers());const Bi=r.paint.get("fill-extrusion-vertical-gradient"),Wi=1/$t.tileToMeter;let Zn;if(Fe&&tt){if(Na(Ht.tileID,$t,c))continue;const ii=tt.calculateShadowPassMatrixFromTile(Ht.tileID.toUnwrapped());Zn=cc(ii,ye,Wi,qe,rt,Ie)}else{const ii=c.translatePosMatrix(Dt.expandedProjMatrix,Ht,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),an=L.projection.createInversionMatrix(L,Dt.canonical);Zn=Z?Zd(ii,c,Bi,j,J,ye,Wi,Dt,Ht,fe,rt,Ie,he,_e,an,De,qe,O):Gu(ii,c,Bi,j,J,ye,Wi,Dt,fe,rt,Ie,he,_e,an,De,qe,ze,ht)}c.uploadCommonUniforms(A,Ti,Dt.toUnwrapped(),null,Ue);let gi=$t.segments;if(L.projection.name==="mercator"&&!Fe&&(gi=$t.getVisibleSegments(Ht.tileID,c.terrain,c.transform.getFrustum(0)),!gi.get().length))continue;if(zt)if(Fe)for(const ii of gi.get())zt.numRenderedVerticesInShadowPass+=ii.primitiveLength;else for(const ii of gi.get())zt.numRenderedVerticesInTransparentPass+=ii.primitiveLength;const mi=[];(c.terrain||w)&&mi.push($t.centroidVertexBuffer),de&&mi.push($t.layoutVertexExtBuffer),We&&mi.push($t.wallVertexBuffer),Ti.draw(c,A.gl.TRIANGLES,p,_,v,Ye,Zn,r.id,$t.layoutVertexBuffer,$t.indexBuffer,gi,r.paint,c.transform.zoom,Xt,mi)}c.shadowRenderer&&(c.shadowRenderer.useNormalOffset=!1)}function Ba(c,t,r,u,p,_,v,w,A,D,L,k,O,N,Z,j,X,Y,J){const oe=c.context,ce=oe.gl,ye=c.transform,fe=c.transform.zoom,de=[],he=Ia(c,r.paint.get("fill-extrusion-cutoff-fade-range"));D==="clear"?(de.push("CLEAR_SUBPASS"),J&&(de.push("CLEAR_FROM_TEXTURE"),oe.activeTexture.set(ce.TEXTURE0),J.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):D==="sdf"&&de.push("SDF_SUBPASS"),X&&de.push("HAS_CENTROID"),he.shouldRenderCutoff&&de.push("RENDER_CUTOFF");const _e=r.layout.get("fill-extrusion-edge-radius"),be=(De,ze,qe,We,rt)=>{const Ie=ze.programConfigurations.get(r.id),Ue=c.isTileAffectedByFog(De),Ee=c.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ie,defines:de,overrideFog:Ue}),$e=((tt,gt,Ye,ht,Ot,zt,Dt,Ht,$t,Lt,qt)=>({u_matrix:gt,u_opacity:Ye,u_ao_pass:ht?1:0,u_meter_to_tile:Ot,u_ao:zt,u_flood_light_intensity:Dt,u_flood_light_color:Ht,u_attenuation:$t,u_edge_radius:Lt,u_fb:0,u_fb_size:qt,u_dynamic_offset:1}))(0,We,L,A,rt,[k,O*rt],N,Z,j,fe>=17?0:_e*rt,J?J.size[0]:0),Fe=[];X&&Fe.push(ze.hiddenByLandmarkVertexBuffer),c.uploadCommonUniforms(oe,Ee,De.toUnwrapped(),null,he),Ee.draw(c,oe.gl.TRIANGLES,p,_,v,w,$e,r.id,ze.vertexBuffer,ze.indexBuffer,qe,r.paint,fe,Ie,Fe)};for(const De of u){const ze=t.getTile(De),qe=ze.getBucket(r);if(!qe||qe.projection.name!==ye.projection.name||!qe.groundEffect||qe.groundEffect&&!qe.groundEffect.hasData())continue;const We=qe.groundEffect,rt=1/qe.tileToMeter;{const Ie=c.translatePosMatrix(De.projMatrix,ze,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),Ue=We.getDefaultSegment();be(De,We,Ue,Ie,rt)}if(Y)for(let Ie=0;Ie<4;Ie++){const Ue=o.dT[Ie](De),Ee=t.getTile(Ue);if(!Ee)continue;const $e=Ee.getBucket(r);if(!$e||$e.projection.name!==ye.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const Fe=$e.groundEffect;let tt,gt;Ie===0?(tt=[-8192,0,0],gt=1):Ie===1?(tt=[o.aj,0,0],gt=0):Ie===2?(tt=[0,-8192,0],gt=3):(tt=[0,o.aj,0],gt=2);const Ye=Fe.regionSegments[gt];if(!Ye)continue;const ht=new Float32Array(16);o.bo(ht,De.projMatrix,tt),be(De,Fe,Ye,c.translatePosMatrix(ht,ze,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),rt)}}}function Pt(c,t,r,u,p,_,v){u.centroidVertexArray.length===0&&u.createCentroidsBuffer();const w=_?_.findDEMTileFor(r):null;if(!(w&&w.dem||v))return;_&&w&&w.dem&&u.selfDEMTileTimestamp!==w.dem._timestamp&&(u.borderDoneWithNeighborZ=[-1,-1,-1,-1],u.selfDEMTileTimestamp=w.dem._timestamp);const A=Y=>new o.P(Math.ceil((Y+o.dX)*o.dY),0),D=Y=>{const J=t.getSource().minzoom,oe=ye=>{const fe=t.getTileByID(ye);if(fe&&fe.hasData())return fe.getBucket(p)},ce=[0,-1,1];for(const ye of ce){if(Y.overscaledZ+ye<J)continue;const fe=oe(Y.calculateScaledKey(Y.overscaledZ+ye));if(fe)return fe}},L=[0,0,0],k=(Y,J)=>(L[0]=Math.min(Y.min.y,J.min.y),L[1]=Math.max(Y.max.y,J.max.y),L[2]=o.aj-J.min.x>Y.max.x?J.min.x-o.aj:Y.max.x,L),O=(Y,J)=>(L[0]=Math.min(Y.min.x,J.min.x),L[1]=Math.max(Y.max.x,J.max.x),L[2]=o.aj-J.min.y>Y.max.y?J.min.y-o.aj:Y.max.y,L),N=[(Y,J)=>k(Y,J),(Y,J)=>k(J,Y),(Y,J)=>O(Y,J),(Y,J)=>O(J,Y)],Z=(Y,J,oe,ce,ye,fe,de)=>{if(!_)return 0;const he=[[fe?oe:Y,fe?Y:oe,0],[fe?oe:J,fe?J:oe,0]],_e=de<0?o.aj+de:de,be=[fe?_e:(Y+J)/2,fe?(Y+J)/2:_e,0];return oe===0&&de<0||oe!==0&&de>0?_.getForTilePoints(ye,[be],!0,ce):he.push(be),_.getForTilePoints(r,he,!0,w),Math.max(he[0][2],he[1][2],be[2])/_.exaggeration()};for(let Y=0;Y<4;Y++){const J=u.borderFeatureIndices[Y];if(J.length===0)continue;const oe=o.dT[Y](r),ce=D(oe);if(!(ce&&ce instanceof o.dU))continue;const ye=_?_.findDEMTileFor(oe):null;if(!(ye&&ye.dem||v)||(_&&ye&&ye.dem&&u.borderDEMTileTimestamp[Y]!==ye.dem._timestamp&&(u.borderDoneWithNeighborZ[Y]=-1,u.borderDEMTileTimestamp[Y]=ye.dem._timestamp),u.borderDoneWithNeighborZ[Y]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const fe=(Y<2?1:5)-Y,de=ce.borderDoneWithNeighborZ[fe]!==u.canonical.z,he=ce.borderFeatureIndices[fe];let _e=0;if(u.canonical.z!==ce.canonical.z){for(const be of J)u.showCentroid(u.featuresOnBorder[be]);if(de)for(const be of he)ce.showCentroid(ce.featuresOnBorder[be]);u.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=u.canonical.z}for(const be of J){const De=u.featuresOnBorder[be],ze=u.centroidData[De.centroidDataIndex],qe=De.borders[Y];let We;for(;_e<he.length;){We=ce.featuresOnBorder[he[_e]];const rt=We.borders[fe];if(rt[1]>qe[0]+3||rt[0]>qe[0]-3)break;ce.showCentroid(We),_e++}if(We&&_e<he.length){const rt=_e;let Ie=0;for(;!(We.borders[fe][0]>qe[1]-3)&&(Ie++,++_e!==he.length);)We=ce.featuresOnBorder[he[_e]];We=ce.featuresOnBorder[he[rt]];let Ue=!1;if(Ie>=1){const Fe=We.borders[fe];Math.abs(qe[0]-Fe[0])<3&&Math.abs(qe[1]-Fe[1])<3&&(Ie=1,Ue=!0,_e=rt+1)}else if(Ie===0){u.showCentroid(De);continue}const Ee=ce.centroidData[We.centroidDataIndex];v&&Ue&&(((j=ze).flags|(X=Ee).flags)&o.dW?(j.flags|=o.dW,X.flags|=o.dW):(j.flags&=2147483647,X.flags&=2147483647));const $e=De.intersectsCount()>1||We.intersectsCount()>1;if(Ie>1)_e=rt,ze.centroidXY=Ee.centroidXY=new o.P(0,0);else if(ye&&ye.dem&&!$e){const Fe=N[Y](ze,Ee),tt=Y%2?o.aj-1:0,gt=Z(Fe[0],Math.min(o.aj-1,Fe[1]),tt,ye,oe,Y<2,Fe[2]);ze.centroidXY=Ee.centroidXY=A(gt)}else $e?ze.centroidXY=Ee.centroidXY=new o.P(0,0):(ze.centroidXY=u.encodeBorderCentroid(De),Ee.centroidXY=ce.encodeBorderCentroid(We));u.writeCentroidToBuffer(ze),ce.writeCentroidToBuffer(Ee)}else u.showCentroid(De)}u.borderDoneWithNeighborZ[Y]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=u.canonical.z}var j,X;(u.needsCentroidUpdate||!u.centroidVertexBuffer&&u.centroidVertexArray.length!==0)&&u.uploadCentroid(c)}const lm=[1,0,0],Qd=[0,1,0],Fa=[0,0,1];function Na(c,t,r){const u=r.transform,p=r.shadowRenderer;if(!p)return!0;const _=c.toUnwrapped(),v=u.tileSize*p._cascades[r.currentShadowCascade].scale;let w=t.maxHeight;if(u.elevation){const j=u.elevation.getMinMaxForTile(c);j&&(w+=j.max)}const A=[...p.shadowDirection];A[2]=-A[2];const D=p.computeSimplifiedTileShadowVolume(_,w,v,A);if(!D)return!1;const L=[lm,Qd,Fa,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=u.projection.name==="globe",O=u.scaleZoom(v),N=o.cn.fromInvProjectionMatrix(u.invProjMatrix,u.worldSize,O,!k),Z=p.getCurrentCascadeFrustum();return N.intersectsPrecise(D.vertices,D.planes,L)===0||Z.intersectsPrecise(D.vertices,D.planes,L)===0}function Zt(c){return[c[0]*o.dZ,c[1]*o.dZ,c[2]*o.dZ,0]}function Dr(c,t,r,u,p,_,v,w,A){const D=u.getSource(),L=r.globeSharedBuffers;if(!L)return;let k,O,N;if(t&&(k=u.getTile(t)),D instanceof o.aP?(O=D.texture,N=o.ds(0,0,r.transform)):k&&t&&(O=k.texture,N=o.ds(t.canonical.z,t.canonical.x,r.transform)),!O||!N)return;c||(N=o.cE(o.bz(),N,[1,-1,1]));const Z=r.context,j=Z.gl,X=p.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR,Y=r.colorModeForDrapableLayerRenderPass(_),J=v.defines;J.push("GLOBE_POLES");const oe=new kt(j.LEQUAL,kt.ReadWrite,r.depthRangeFor3D),ce=Float32Array.from(r.transform.expandedFarZProjMatrix),ye=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0))));r.terrain&&r.terrain.prepareDrawTile(),Z.activeTexture.set(j.TEXTURE0),O.bind(X,j.CLAMP_TO_EDGE),Z.activeTexture.set(j.TEXTURE1),O.bind(X,j.CLAMP_TO_EDGE),"useMipmap"in O&&Z.extTextureFilterAnisotropic&&r.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const[fe,de,he,_e]=t?L.getPoleBuffers(t.canonical.z,!1):L.getPoleBuffers(0,!0),be=p.paint.get("raster-elevation");let De;c?(De=fe,r.renderDefaultNorthPole=be!==0):(De=de,r.renderDefaultSouthPole=be!==0);const ze=Zt(v.mix),qe=((rt,Ie,Ue,Ee,$e,Fe,tt,gt,Ye,ht,Ot,zt,Dt)=>za(rt,Ie,Ue,new Float32Array(16),new Float32Array(9),[0,0],Ee,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Fe,[0,0],gt,2,ht,Ot,zt,1,0,Dt))(ce,ye,N,o.ah(r.transform.zoom),0,p,0,be,0,ze,v.offset,v.range,_),We=r.getOrCreateProgram("raster",{defines:J});r.uploadCommonUniforms(Z,We,null),We.draw(r,j.TRIANGLES,oe,A,Y,w,qe,p.id,De,he,_e)}function lp(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}function Yh(c,t,r,u){if(c)return t instanceof ss&&c instanceof Tu?t.getTextureDescriptor(c,r,!0):{texture:c.texture,mix:Zt(u.mix),offset:u.offset,buffer:0,tileSize:1}}var $u=o.d_([{name:"a_index",type:"Int16",components:1}]);class Jd{constructor(t,r,u,p){const _={width:u[0],height:u[1],data:null},v=t.gl;this.targetColorTexture=new o.T(t,_,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,_,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,p),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const u=this.context.gl,p=r.width*r.height;this.particleTexture0=new o.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,r,u.RGBA8,{premultiply:!1,useMipmap:!1});const _=new o.d$;_.reserve(p);for(let v=0;v<p;v++)_.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(_,$u.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Il(c,t,r){if(!c)return null;const u=t.getTextureDescriptor(c,r,!0);if(!u)return null;let{texture:p,mix:_,offset:v,tileSize:w,buffer:A,format:D}=u;if(!p||!D)return null;let L=!1;return D==="uint32"&&(L=!0,_[3]=0,_=uc(o.e0,_,[0,r.paint.get("raster-particle-max-speed")]),v=$d(o.e0,v,[0,r.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[A/(w+2*A),w/(w+2*A)],tileSize:w,scalarData:L,scale:_,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[D]]}}function Kh(c){const t=c._nearZ,r=c.projection.farthestPixelDistance(c),u=r-t,p=.2*c.height,_=t+p;return[t,r,(_-p-t)/u,(_-t)/u]}const cp=new o.am(1,0,0,1),up=new o.am(0,1,0,1),$s=new o.am(0,0,1,1),ef=new o.am(1,0,1,1),As=new o.am(0,1,1,1);function Ua(c,t,r,u,p,_){for(let v=0;v<r.length;v++)if(p){const D=new o.am(u.r*.8,u.g*.8,u.b*.8,1);hc(c,t,r[v],u,-1,-1,_),hc(c,t,r[v],u,-1,1,_),hc(c,t,r[v],u,1,1,_),hc(c,t,r[v],u,1,-1,_),hc(c,t,r[v],D,0,0,_)}else hc(c,t,r[v],u,0,0,_)}function hc(c,t,r,u,p,_,v){const w=c.context,A=c.transform,D=w.gl,L=A.projection.name==="globe",k=L?["PROJECTION_GLOBE_VIEW"]:[];let O=o.bw(r.projMatrix);if(L&&o.ah(A.zoom)>0){const ze=o.bg(r.canonical,A),qe=o.e1(ze);O=o.az(new Float32Array(16),A.globeMatrix,qe),o.az(O,A.projMatrix,O)}const N=o.bz();N[12]+=2*p/(o.q.devicePixelRatio*A.width),N[13]+=2*_/(o.q.devicePixelRatio*A.height),o.az(O,N,O);const Z=c.getOrCreateProgram("debug",{defines:k}),j=t.getTileByID(r.key);c.terrain&&c.terrain.setupElevationDraw(j,Z);const X=kt.disabled,Y=li.disabled,J=c.colorModeForRenderPass(),oe="$debug";w.activeTexture.set(D.TEXTURE0),c.emptyTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L?j._makeGlobeTileDebugBuffers(c.context,A):j._makeDebugTileBoundsBuffers(c.context,A.projection);const ce=j._tileDebugBuffer||c.debugBuffer,ye=j._tileDebugIndexBuffer||c.debugIndexBuffer,fe=j._tileDebugSegments||c.debugSegments;if(Z.draw(c,D.LINE_STRIP,X,Y,J,Jt.disabled,jc(O,u.toPremultipliedRenderColor(null)),oe,ce,ye,fe,null,null,null,[j._globeTileDebugBorderBuffer]),v){const ze=j.latestRawTileData,qe=Math.floor((ze&&ze.byteLength||0)/1024);let We=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(We+=` => ${r.overscaledZ}`),We+=` ${j.state}`,We+=` ${qe}kb`,function(rt,Ie){rt.initDebugOverlayCanvas();const Ue=rt.debugOverlayCanvas,Ee=rt.context.gl,$e=rt.debugOverlayCanvas.getContext("2d");$e.clearRect(0,0,Ue.width,Ue.height),$e.shadowColor="white",$e.shadowBlur=2,$e.lineWidth=1.5,$e.strokeStyle="white",$e.textBaseline="top",$e.font="bold 36px Open Sans, sans-serif",$e.fillText(Ie,5,5),$e.strokeText(Ie,5,5),rt.debugOverlayTexture.update(Ue),rt.debugOverlayTexture.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE)}(c,We)}const de=t.getTile(r).tileSize,he=512/Math.min(de,512)*(r.overscaledZ/A.zoom)*.5,_e=j._tileDebugTextBuffer||c.debugBuffer,be=j._tileDebugTextIndexBuffer||c.quadTriangleIndexBuffer,De=j._tileDebugTextSegments||c.debugSegments;Z.draw(c,D.TRIANGLES,X,Y,Ii.alphaBlended,Jt.disabled,jc(O,o.am.transparent.toPremultipliedRenderColor(null),he),oe,_e,be,De,null,null,null,[j._globeTileDebugTextBuffer])}function Qh(c,t,r,u){Xc(c,0,t+r/2,c.transform.width,r,u)}function Yu(c,t,r,u){Xc(c,t-r/2,0,r,c.transform.height,u)}function Xc(c,t,r,u,p,_){const v=c.context,w=v.gl;w.enable(w.SCISSOR_TEST),w.scissor(t*o.q.devicePixelRatio,r*o.q.devicePixelRatio,u*o.q.devicePixelRatio,p*o.q.devicePixelRatio),v.clear({color:_}),w.disable(w.SCISSOR_TEST)}const cm=o.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Va}=cm;function hn(c,t,r,u){c.emplaceBack(t,r,u)}class Ku{constructor(t){this.vertexArray=new o.e2,this.indices=new o.a_,hn(this.vertexArray,-1,-1,1),hn(this.vertexArray,1,-1,1),hn(this.vertexArray,-1,1,1),hn(this.vertexArray,1,1,1),hn(this.vertexArray,-1,-1,-1),hn(this.vertexArray,1,-1,-1),hn(this.vertexArray,-1,1,-1),hn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Va),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function ja(c,t,r,u,p,_){const v=c.context.gl,w=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),D=t.paint.get("sky-atmosphere-sun-intensity"),L=((k,O,N,Z,j)=>({u_matrix_3f:k,u_sun_direction:O,u_sun_intensity:N,u_color_tint_r:[Z.r,Z.g,Z.b,Z.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(o.e4(o.dx(),u),p,D,w.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+_,t.skyboxTexture,0),r.draw(c,v.TRIANGLES,kt.disabled,li.disabled,Ii.unblended,Jt.frontCW,L,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const hp=o.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dp{constructor(t){const r=new o.e5;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const u=new o.a_;u.emplaceBack(0,1,2),u.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,hp.members),this.indexBuffer=t.createIndexBuffer(u),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const fp=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class um{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wc{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Ii([1,Lc,1,Lc],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Ii([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new um,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new dp(r);const u=this.params.sizeRange,p=this.params.intensityRange,_=function(L){const k=o.e7(30),O=[];for(let N=0;N<L;++N){const Z=2*Math.PI*k(),j=Math.acos(1-2*k())-.5*Math.PI;O.push(o.cS(Math.cos(j)*Math.cos(Z),Math.cos(j)*Math.sin(Z),Math.sin(j)))}return O}(this.params.starsCount),v=o.e7(300),w=new o.e6,A=new o.a_;let D=0;for(let L=0;L<_.length;++L){const k=o.bY([],_[L],200),O=Math.max(0,1+.01*u*(1*v()-.5)),N=Math.max(0,1+.01*p*(1*v()-.5));w.emplaceBack(k[0],k[1],k[2],-1,-1,O,N),w.emplaceBack(k[0],k[1],k[2],1,-1,O,N),w.emplaceBack(k[0],k[1],k[2],1,1,O,N),w.emplaceBack(k[0],k[1],k[2],-1,1,O,N),A.emplaceBack(D+0,D+1,D+2),A.emplaceBack(D+0,D+2,D+3),D+=4}this.starsVx=r.createVertexBuffer(w,fp.members),this.starsIdx=r.createIndexBuffer(A),this.starsSegments=o.bd.simpleSegment(0,0,w.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const u=t.context,p=u.gl,_=t.transform,v=new kt(p.LEQUAL,kt.ReadOnly,[0,1]),w=o.ah(_.zoom),A=t.style.getLut(r.scope),D=r.properties.get("color-use-theme")==="none",L=r.properties.get("color").toNonPremultipliedRenderColor(D?null:A).toArray01(),k=r.properties.get("high-color-use-theme")==="none",O=r.properties.get("high-color").toNonPremultipliedRenderColor(k?null:A).toArray01(),N=r.properties.get("space-color-use-theme")==="none",Z=r.properties.get("space-color").toNonPremultipliedRenderColor(N?null:A).toArray01(),j=5e-4,X=o.e8(r.properties.get("horizon-blend"),0,1,j,.25),Y=o.dl(t,u,_)&&X===j?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,J=t.frameCounter/1e3%1,oe=o.ae(_.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(oe,2)-Math.pow(Y,2)),ye=Math.acos(ce/oe),fe=de=>{const he=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];de&&he.push("ALPHA_PASS");const _e=t.getOrCreateProgram("globeAtmosphere",{defines:he}),be=((ze,qe,We,rt,Ie,Ue,Ee,$e,Fe,tt,gt,Ye)=>({u_frustum_tl:ze,u_frustum_tr:qe,u_frustum_br:We,u_frustum_bl:rt,u_horizon:Ie,u_transition:Ue,u_fadeout_range:Ee,u_color:$e,u_high_color:Fe,u_space_color:tt,u_temporal_offset:gt,u_horizon_angle:Ye}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,w,X,L,O,Z,J,ye);t.uploadCommonUniforms(u,_e);const De=this.atmosphereBuffer;De&&_e.draw(t,p.TRIANGLES,v,li.disabled,de?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Jt.backCW,be,de?"atmosphere_glow_alpha":"atmosphere_glow",De.vertexBuffer,De.indexBuffer,De.segments)};fe(!1),fe(!0)}drawStars(t,r){const u=o.ay(r.properties.get("star-intensity"),0,1);if(u===0)return;const p=t.context,_=p.gl,v=t.transform,w=t.getOrCreateProgram("stars"),A=o.b_([]);o.c0(A,A,-v._pitch),o.b$(A,A,-v.angle),o.c0(A,A,o.al(v._center.lat)),o.e9(A,A,-o.al(v._center.lng));const D=o.c3(new Float32Array(16),A),L=o.az([],v.starsProjMatrix,D),k=o.e4([],D),O=o.ea([],k),N=[0,1,0];o.dz(N,N,O),o.bY(N,N,this.params.sizeMultiplier);const Z=[1,0,0];o.dz(Z,Z,O),o.bY(Z,Z,this.params.sizeMultiplier);const j=(X=N,Y=Z,J=u,{u_matrix:Float32Array.from(L),u_up:X,u_right:Y,u_intensity_multiplier:J});var X,Y,J;t.uploadCommonUniforms(p,w),this.starsVx&&this.starsIdx&&w.draw(t,_.TRIANGLES,kt.disabled,li.disabled,this.colorModeAlphaBlendedWriteRGB,Jt.disabled,j,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function $c(c,t){const r=[...c],u=t.cameraWorldSizeForFog/t.worldSize,p=o.bx([]);return o.cE(p,p,[u,u,1]),o.az(r,p,r),o.az(r,t.worldToFogMatrix,r),r}function dt(c,t,r,u,p){const _=r.material,v=u.context,{baseColorTexture:w,metallicRoughnessTexture:A}=_.pbrMetallicRoughness,{normalTexture:D,occlusionTexture:L,emissionTexture:k}=_;function O(Z,j,X){if(Z&&(c.push(j),v.activeTexture.set(v.gl.TEXTURE0+X),Z.gfxTexture)){const{minFilter:Y,magFilter:J,wrapS:oe,wrapT:ce}=Z.sampler;Z.gfxTexture.bindExtraParam(Y,J,oe,ce)}}O(w,"HAS_TEXTURE_u_baseColorTexture",Ss.BaseColor),O(A,"HAS_TEXTURE_u_metallicRoughnessTexture",Ss.MetallicRoughness),O(D,"HAS_TEXTURE_u_normalTexture",Ss.Normal),O(L,"HAS_TEXTURE_u_occlusionTexture",Ss.Occlusion),O(k,"HAS_TEXTURE_u_emissionTexture",Ss.Emission),p&&(p.texture||(p.texture=new o.eh(u.context,p.image,[p.image.height,p.image.height,p.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+Ss.LUT),p.texture&&p.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),c.push("APPLY_LUT_ON_GPU")),r.texcoordBuffer&&(c.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(r.texcoordBuffer)),r.colorBuffer&&(c.push(r.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(r.colorBuffer)),r.normalBuffer&&(c.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(r.normalBuffer)),r.pbrBuffer&&(c.push("HAS_ATTRIBUTE_a_pbr"),c.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(r.pbrBuffer)),_.alphaMode!=="OPAQUE"&&_.alphaMode!=="MASK"||c.push("UNPREMULT_TEXTURE_IN_SHADER"),_.defined||c.push("DIFFUSE_SHADED");const N=u.shadowRenderer;N&&(c.push("RENDER_SHADOWS","DEPTH_TEXTURE"),N.useNormalOffset&&c.push("NORMAL_OFFSET"))}function St(c,t,r,u,p,_){const v=r.paint.get("model-opacity").constantOr(1),w=t.context,A=new kt(t.context.gl.LEQUAL,kt.ReadWrite,t.depthRangeFor3D),D=t.transform,L=c.mesh,k=L.material,O=k.pbrMetallicRoughness,N=t.style.fog;let Z;Z=t.transform.projection.zAxisUnit==="pixels"?[...c.nodeModelMatrix]:o.az([],u.zScaleMatrix,c.nodeModelMatrix),o.az(Z,u.negCameraPosMatrix,Z);const j=o.bi([],Z);o.ee(j,j);const X=r.paint.get("model-color-use-theme").constantOr("default")==="none",Y=r.paint.get("model-emissive-strength").constantOr(0),J=Wu(new Float32Array(c.worldViewProjection),new Float32Array(Z),new Float32Array(j),null,t,v,O.baseColorFactor,k.emissiveFactor,O.metallicFactor,O.roughnessFactor,k,Y,r),oe={defines:[]},ce=[],ye=t.shadowRenderer;ye&&(ye.useNormalOffset=!1),dt(oe.defines,ce,L,t,X?null:r.lut);let fe=null;if(N){const _e=$c(c.nodeModelMatrix,t.transform);if(fe=new Float32Array(_e),D.projection.name!=="globe"){const be=L.aabb.min,De=L.aabb.max,[ze,qe]=N.getOpacityForBounds(_e,be[0],be[1],De[0],De[1]);oe.overrideFog=ze>=Ne||qe>=Ne}}const de=Ia(t,r.paint.get("model-cutoff-fade-range"));de.shouldRenderCutoff&&oe.defines.push("RENDER_CUTOFF");const he=t.getOrCreateProgram("model",oe);t.uploadCommonUniforms(w,he,null,fe,de),t.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(c.nodeModelMatrix,he),he.draw(t,w.gl.TRIANGLES,A,p,_,L.material.doubleSided?Jt.disabled:Jt.backCCW,J,r.id,L.vertexBuffer,L.indexBuffer,L.segments,r.paint,t.transform.zoom,void 0,ce)}function Ga(c,t,r,u,p,_,v){let w;w=c.projection.name==="globe"?o.ed(r,c):[...r],o.az(w,w,t.matrix);const A=o.az([],u,w);if(t.meshes)for(const D of t.meshes){if(D.material.alphaMode!=="BLEND"){v.push({mesh:D,depth:0,modelIndex:p,worldViewProjection:A,nodeModelMatrix:w});continue}const L=o.ad([],D.centroid,A);!c.isOrthographic&&L[2]<=0||_.push({mesh:D,depth:L[2],modelIndex:p,worldViewProjection:A,nodeModelMatrix:w})}if(t.children)for(const D of t.children)Ga(c,D,r,u,p,_,v)}function sr(c,t,r,u){const p=r.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),v=p.getShadowPassColorMode(),w=p.calculateShadowPassMatrixFromMatrix(t),A=Zc(w);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,_,li.disabled,v,Jt.backCCW,A,u.id,c.vertexBuffer,c.indexBuffer,c.segments,u.paint,r.transform.zoom,void 0,void 0)}function Re(c,t,r){const u=t.updateZoomBasedPaintProperties(),p=function(_,v,w){let A,D,L,k=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&k>0){const O=_.terrain,N=O.findDEMTileFor(w);N&&N.dem?A=o.ei.create(O,w,N):k=0}if(k===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),k===v.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===v.validForDEMTile.id&&A._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const O in v.instancesPerModel){const N=v.instancesPerModel[O];for(let Z=0;Z<N.instancedDataArray.length;++Z){const j=(A?k*A.getElevationAt(0|N.instancedDataArray.float32[16*Z],0|N.instancedDataArray.float32[16*Z+1],!0,!0):0)+N.instancesEvaluatedElevation[Z];N.instancedDataArray.float32[16*Z+6]=j,D=D?Math.min(v.terrainElevationMin,j):j,L=L?Math.max(v.terrainElevationMax,j):j}}return v.terrainElevationMin=D||0,v.terrainElevationMax=L||0,v.validForExaggeration=k,v.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(c,t,r);(u||p)&&(t.uploaded=!1,t.upload(c.context))}const Ys={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.cW([0,0,0],[o.aj,o.aj,0])};function Jh(c,t){const r=1<<c.canonical.z,u=t.getFreeCameraOptions().position,p=t.elevation,_=c.canonical.x/r,v=(c.canonical.x+1)/r,w=c.canonical.y/r,A=(c.canonical.y+1)/r;let D=t._centerAltitude;if(p){const N=p.getMinMaxForTile(c);N&&N.max>D&&(D=N.max)}const L=o.ay(u.x,_,v)-u.x,k=o.ay(u.y,w,A)-u.y,O=o.c6(D,t.center.lat)-u.z;return t._zoomFromMercatorZ(Math.sqrt(L*L+k*k+O*O))}function ed(c,t,r,u,p,_,v){const w=c.context,A=c.renderPass==="shadow",D=c.shadowRenderer,L=A&&D?D.getShadowPassDepthMode():new kt(w.gl.LEQUAL,kt.ReadWrite,c.depthRangeFor3D),k=c.isTileAffectedByFog(_);if(r.meshes)for(const O of r.meshes){const N=["MODEL_POSITION_ON_GPU"],Z=[];let j,X,Y;u.instancedDataArray.length>20&&N.push("INSTANCED_ARRAYS");const J=Ia(c,t.paint.get("model-cutoff-fade-range"));if(J.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),A&&D)j=c.getOrCreateProgram("modelDepth",{defines:N}),X=Zc(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(r.matrix)),Y=D.getShadowPassColorMode();else{dt(N,Z,O,c,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),j=c.getOrCreateProgram("model",{defines:N,overrideFog:k});const ce=O.material,ye=ce.pbrMetallicRoughness,fe=t.paint.get("model-opacity").constantOr(1),de=t.paint.get("model-emissive-strength").constantOr(0);X=Wu(_.expandedProjMatrix,Float32Array.from(r.matrix),new Float32Array(16),null,c,fe,ye.baseColorFactor,ce.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,ce,de,t,p),D&&(v.shadowUniformsInitialized?j.setShadowUniformValues(w,D.getShadowUniformValues()):(D.setupShadows(_.toUnwrapped(),j,"model-tile",_.overscaledZ),v.shadowUniformsInitialized=!0)),Y=J.shouldRenderCutoff||fe<1||ce.alphaMode!=="OPAQUE"?Ii.alphaBlended:Ii.unblended}c.uploadCommonUniforms(w,j,_.toUnwrapped(),null,J);const oe=O.material.doubleSided?Jt.disabled:Jt.backCCW;if(u.instancedDataArray.length>20)Z.push(u.instancedDataBuffer),j.draw(c,w.gl.TRIANGLES,L,li.disabled,Y,oe,X,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,Z,u.instancedDataArray.length);else{const ce=A?"u_instance":"u_normal_matrix";for(let ye=0;ye<u.instancedDataArray.length;++ye)X[ce]=new Float32Array(u.instancedDataArray.arrayBuffer,64*ye,16),j.draw(c,w.gl.TRIANGLES,L,li.disabled,Y,oe,X,t.id,O.vertexBuffer,O.indexBuffer,O.segments,t.paint,c.transform.zoom,void 0,Z)}}if(r.children)for(const O of r.children)ed(c,t,O,u,p,_,v)}const tf=[1,-1,1];function pp(c,t,r,u){if(!r.modelManager)return!0;const p=r.modelManager;if(!r.shadowRenderer)return!0;const _=r.shadowRenderer,v=t.aabb;let w=!0,A=c.maxHeight;if(A===0){let L=0;for(const k in c.instancesPerModel){const O=p.getModel(k,u);O?L=Math.max(L,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):w=!1}A=c.maxScale*L*1.41+c.maxVerticalOffset,w&&(c.maxHeight=A)}v.max[2]=A,v.min[2]+=c.terrainElevationMin,v.max[2]+=c.terrainElevationMax,o.ad(v.min,v.min,t.tileMatrix),o.ad(v.max,v.max,t.tileMatrix);const D=v.intersects(_.getCurrentCascadeFrustum());return r.currentShadowCascade===0&&(c.isInsideFirstShadowMapFrustum=D===2),D===0}function mp(c,t){const r=c.uniformValues.u_cutoff_params[0],u=c.uniformValues.u_cutoff_params[1],p=c.uniformValues.u_cutoff_params[2],_=c.uniformValues.u_cutoff_params[3];return u===r||_===p?1:o.ay(((t-r)/(u-r)-p)/(_-p),0,1)}function Yc(c,t,r,u){if(t.pitch<20)return 1;const p=t.getWorldToCameraMatrix();o.az(p,p,c);const _=o.ej(r.min[0],r.min[1],r.min[2],1);let v=o.aA(o.ek(),_,p),w=v,A=v;_[1]=r.max[1],v=o.aA(o.ek(),_,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A,_[0]=r.max[0],v=o.aA(o.ek(),_,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A,_[1]=r.min[1],v=o.aA(o.ek(),_,p),w=v[1]<w[1]?v:w,A=v[1]>A[1]?v:A;const D=o.ay(u[0],0,1),L=100*t.pixelsPerMeter*o.ay(u[1],0,1),k=o.ay(u[2],0,1),O=o.el(o.ek(),w,A,D),N=Math.tan(.5*t.fovX),Z=-O[2]*N;if(L===0)return O[1]<-Math.abs(Z)?k:1;const j=(-Math.abs(Z)-O[1])/L,X=(J,oe,ce)=>(1-ce)*J+ce*oe,Y=o.ay(X(1,k,j),k,1);return X(1,Y,o.ay((t.pitch-20)/20,0,1))}class _p{}class hm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,u){{const k=this._storage.get(r.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const p=u.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),v=new ArrayBuffer(_),w=new Int16Array(v);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const A=new o.en;for(let k=0;k<_/2;k+=3){const O=w[k],N=w[k+1],Z=w[k+2];A.emplaceBack(O,N),A.emplaceBack(N,Z),A.emplaceBack(Z,O)}const D=u.bindVertexArrayOES.current,L=new _p;return L.buf=new So(u,A),L.lastUsedFrameIdx=t,this._storage.set(r.id,L),u.bindVertexArrayOES.set(D),L.buf}update(t){for(const[r,u]of this._storage)t-u.lastUsedFrameIdx>30&&(u.buf.destroy(),this._storage.delete(r))}destroy(){for(const[t,r]of this._storage)r.buf.destroy(),this._storage.delete(t)}}class gp{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const Qu=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class nf{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class rf{constructor(t,r){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...r,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...r,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const dm=o.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class Ju{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const u=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new o.eo,w=new o.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),w.emplaceBack(0,1,2),w.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,dm.members),this.vignetteIdx=t.context.createIndexBuffer(w)}const p=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,u);const v={u_vignetteShape:(_={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:_.vignetteColor};u.draw(t,t.context.gl.TRIANGLES,kt.disabled,li.disabled,Ii.alphaBlended,Jt.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,p)}var _}}class eh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const u=t.getFreeCameraOptions().position,p=u.toAltitude(),_=u.toLngLat(),v=o.al(_.lng),w=o.al(_.lat),A=t.pixelsPerMeter/r,D=v*o.eq,L=o.eq*Math.log(Math.tan(Math.PI/4+w/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const k=-this._offsetYPrev+L,O=-this._elevationPrev+p;this._accumulatedOffsetX+=(-this._offsetXPrev+D)*A,this._accumulatedOffsetY+=k*A,this._accumulatedElevation+=O*A,this._offsetXPrev=D,this._offsetYPrev=L,this._elevationPrev=p}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function dc(c,t){return[-(c[0]-Math.floor(c[0]/t)*t),-(c[1]-Math.floor(c[1]/t)*t),-(c[2]-Math.floor(c[2]/t)*t)]}function td(c){const t=o.e7(1323123451230),r=[];for(let u=0;u<c;++u){const p=2*t()-1,_=2*t()-1,v=2*t()-1;r.push(o.cS(p,_,v))}return r}function Ml(c,t,r,u,p){const _=o.ay((p-r)/(u-r),0,1);return(1-_)*c+_*t}class ps{constructor(t){this._movement=new eh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ju,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const u=t.transform;this._movement.update(u,this._ppmScaleFactor);const p=u.starsProjMatrix,_=o.b_([]);o.c0(_,_,o.al(90)-u._pitch),o.b$(_,_,-u.angle);const v=o.c3(new Float32Array(16),_),w=o.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=o.ee([],w),D=o.az([],A,v),L=Date.now()/1e3;return this._accumulatedTimeFromStart+=(L-this._prevTime)*r,this._prevTime=L,{projectionMatrix:p,modelviewMatrix:D}}}class f_ extends ps{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new rf(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=td(this.particlesCount),p=new o.er,_=new o.a_;let v=0;const w=o.e7(1323123451230);for(let A=0;A<u.length;++A){const D=u[A],L=[2*w()-1,w(),w(),w()];p.emplaceBack(D[0],D[1],D[2],-1,-1,...L),p.emplaceBack(D[0],D[1],D[2],1,-1,...L),p.emplaceBack(D[0],D[1],D[2],1,1,...L),p.emplaceBack(D[0],D[1],D[2],-1,1,...L),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=r.createVertexBuffer(p,Qu.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},u=t.transform.zoom;if(r.revealStart>u)return;const p=Ml(0,1,r.revealStart,r.revealStart+r.revealRange,u);if(!this.particlesVx||!this.particlesIdx)return;const _=structuredClone(this._params);let v=[-_.direction.x,_.direction.y,-100];o.au(v,v);const w=structuredClone(this._vignetteParams);w.strength*=p,_.overrideStyleParameters||(_.intensity=t.style.rain.state.density,_.timeFactor=t.style.rain.state.intensity,_.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),_.screenThinning.intensity=t.style.rain.state.centerThinning,_.dropletSizeX=t.style.rain.state.dropletSize[0],_.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],_.distortionStrength=100*t.style.rain.state.distortionStrength,w.strength=1,w.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,_.timeFactor),D=t.context,L=D.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(D,{width:t.width,height:t.height,data:null},L.RGBA8)),_.distortionStrength>0&&(D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),L.copyTexSubImage2D(L.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const O=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(D,O),D.activeTexture.set(L.TEXTURE0),this.screenTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE);const N=[_.color.r,_.color.g,_.color.b,_.color.a],Z=(j,X)=>{const Y=dc(this._movement.getPosition(),j),J=_.dropletSizeX,oe=_.dropletSizeX*_.dropletSizeYScale,ce=t.width/2,ye=t.height/2,fe=Ml(0,_.screenThinning.start,0,1,_.screenThinning.intensity),de=Ml(.001,_.screenThinning.range,0,1,_.screenThinning.intensity),he=Ml(0,_.screenThinning.particleOffset,0,1,_.screenThinning.intensity),_e=(be={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:_.velocityConeAperture,velocity:_.velocity,boxSize:j,rainDropletSize:[J,oe],distortionStrength:_.distortionStrength,rainDirection:v,color:N,screenSize:[k.width,k.height],thinningCenterPos:[ce,ye],thinningShape:[fe,de,Math.pow(10,_.screenThinning.fadePower)],thinningAffectedRatio:_.screenThinning.affectedRatio,thinningParticleOffset:he,shapeDirectionalPower:_.shapeDirPower,shapeNormalPower:_.shapeNormalPower,mode:X?0:1},{u_modelview:Float32Array.from(be.modelview),u_projection:Float32Array.from(be.projection),u_time:be.time,u_cam_pos:be.camPos,u_texScreen:0,u_velocityConeAperture:be.velocityConeAperture,u_velocity:be.velocity,u_boxSize:be.boxSize,u_rainDropletSize:be.rainDropletSize,u_distortionStrength:be.distortionStrength,u_rainDirection:be.rainDirection,u_color:be.color,u_screenSize:be.screenSize,u_thinningCenterPos:be.thinningCenterPos,u_thinningShape:be.thinningShape,u_thinningAffectedRatio:be.thinningAffectedRatio,u_thinningParticleOffset:be.thinningParticleOffset,u_shapeDirectionalPower:be.shapeDirectionalPower,u_shapeNormalPower:be.shapeNormalPower,u_mode:be.mode});var be;const De=Math.round(_.intensity*this.particlesCount),ze=o.bd.simpleSegment(0,0,4*De,2*De);O.draw(t,L.TRIANGLES,kt.disabled,li.disabled,Ii.alphaBlended,Jt.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,ze)};_.distortionStrength>0&&Z(_.boxSize,!0),Z(_.boxSize,!1),this._vignette.draw(t,w)}}const id=o.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Pn extends ps{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new rf(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const u=td(this.particlesCount),p=new o.es,_=new o.a_;let v=0;const w=o.e7(1323123451230);for(let A=0;A<u.length;++A){const D=u[A],L=w(),k=w(),O=w(),N=[A/u.length,L,k,O],Z=[w(),w()];p.emplaceBack(D[0],D[1],D[2],-1,-1,...N,...Z),p.emplaceBack(D[0],D[1],D[2],1,-1,...N,...Z),p.emplaceBack(D[0],D[1],D[2],1,1,...N,...Z),p.emplaceBack(D[0],D[1],D[2],-1,1,...N,...Z),_.emplaceBack(v+0,v+1,v+2),_.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=r.createVertexBuffer(p,id.members),this.particlesIdx=r.createIndexBuffer(_)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let u=[-r.direction.x,r.direction.y,-100];o.au(u,u);const p=structuredClone(this._vignetteParams),_=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(_.revealStart>v)return;const w=Ml(0,1,_.revealStart,_.revealStart+_.revealRange,v);p.strength*=w,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),u=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,p.strength=1,p.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const D=t.context,L=D.gl,k=t.transform,O=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(D,O),((N,Z,j)=>{const X=dc(this._movement.getPosition(),N),Y=k.width/2,J=k.height/2,oe=Ml(0,j.screenThinning.start,0,1,j.screenThinning.intensity),ce=Ml(.001,j.screenThinning.range,0,1,j.screenThinning.intensity),ye=Ml(0,j.screenThinning.particleOffset,0,1,j.screenThinning.intensity),fe=(de={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:X,velocityConeAperture:j.velocityConeAperture,velocity:j.velocity,horizontalOscillationRadius:j.horizontalOscillationRadius,horizontalOscillationRate:j.horizontalOscillationRate,boxSize:N,billboardSize:1*j.billboardSize,simpleShapeParameters:[j.shapeFadeStart,j.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[Y,J],thinningShape:[oe,ce,Math.pow(10,j.screenThinning.fadePower)],thinningAffectedRatio:j.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[j.color.r,j.color.g,j.color.b,j.color.a],direction:u},{u_modelview:Float32Array.from(de.modelview),u_projection:Float32Array.from(de.projection),u_time:de.time,u_cam_pos:de.camPos,u_velocityConeAperture:de.velocityConeAperture,u_velocity:de.velocity,u_horizontalOscillationRadius:de.horizontalOscillationRadius,u_horizontalOscillationRate:de.horizontalOscillationRate,u_boxSize:de.boxSize,u_billboardSize:de.billboardSize,u_simpleShapeParameters:de.simpleShapeParameters,u_screenSize:de.screenSize,u_thinningCenterPos:de.thinningCenterPos,u_thinningShape:de.thinningShape,u_thinningAffectedRatio:de.thinningAffectedRatio,u_thinningParticleOffset:de.thinningParticleOffset,u_particleColor:de.color,u_direction:de.direction});var de;const he=Math.round(j.intensity*this.particlesCount),_e=o.bd.simpleSegment(0,0,4*he,2*he);this.particlesVx&&this.particlesIdx&&O.draw(t,L.TRIANGLES,kt.disabled,li.disabled,Ii.alphaBlended,Jt.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(r.boxSize,0,r),this._vignette.draw(t,p)}}const Gi={symbol:function(c,t,r,u,p){if(c.renderPass!=="translucent")return;const _=li.disabled,v=c.colorModeForRenderPass(),w=r.layout.get("text-variable-anchor"),A=r.layout.get("text-size-scale-range"),D=o.ay(c.scaleFactor,A[0],A[1]);w&&function(O,N,Z,j,X,Y,J,oe){const ce=N.transform,ye=X==="map",fe=Y==="map";for(const de of O){const he=j.getTile(de),_e=he.getBucket(Z);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const be=o.bH(_e.textSizeData,ce.zoom,oe),De=kd(de,_e.getProjection(),ce),ze=ce.calculatePixelsToTileUnitsMatrix(he),qe=Xs(De,he.tileID.canonical,fe,ye,ce,_e.getProjection(),ze),We=_e.hasIconTextFit()&&_e.hasIconData();be&&Wh(_e,ye,fe,J,ce,qe,de,Math.pow(2,ce.zoom-he.tileID.overscaledZ),be,We)}}(u,c,r,t,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),p,D);const L=r.paint.get("icon-opacity").constantOr(1)!==0,k=r.paint.get("text-opacity").constantOr(1)!==0;r.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(L||k)?ka(c,t,r,u,_,v):(L&&ka(c,t,r,u,_,v,{onlyIcons:!0}),k&&ka(c,t,r,u,_,v,{onlyText:!0})),t.map.showCollisionBoxes&&(Pr(c,t,r,u,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Pr(c,t,r,u,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("circle-opacity"),_=r.paint.get("circle-stroke-width"),v=r.paint.get("circle-stroke-opacity"),w=r.layout.get("circle-sort-key").constantOr(1)!==void 0,A=r.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||v.constantOr(1)===0))return;const D=c.context,L=D.gl,k=c.transform,O=!(!c.terrain||!c.terrain.enabled),N=r.layout.get("circle-elevation-reference"),Z=c.depthModeForSublayer(0,kt.ReadOnly),j=new kt(c.context.gl.LEQUAL,kt.ReadOnly,c.depthRangeFor3D),X=N==="none"||O?Z:j,Y=li.disabled,J=c.colorModeForDrapableLayerRenderPass(A),oe=k.projection.name==="globe",ce=[o.aD(k.center.lng),o.aH(k.center.lat)],ye=[];for(let de=0;de<u.length;de++){const he=u[de],_e=t.getTile(he),be=_e.getBucket(r);if(!be||be.projection.name!==k.projection.name)continue;const De=be.programConfigurations.get(r.id),ze=be.layoutVertexBuffer,qe=be.globeExtVertexBuffer,We=be.indexBuffer,rt=o.dK(r),Ie=[qe],Ue=c.isTileAffectedByFog(he);oe&&rt.push("PROJECTION_GLOBE_VIEW"),rt.push("DEPTH_D24"),c.terrain&&k.depthOcclusionForSymbolsAndCircles&&rt.push("DEPTH_OCCLUSION"),be.hasElevation&&(rt.push("ELEVATED_ROADS"),Ie.push(be.elevatedLayoutVertexBuffer));const Ee=c.getOrCreateProgram("circle",{config:De,defines:rt,overrideFog:Ue}),$e=k.projection.createInversionMatrix(k,he.canonical),Fe={programConfiguration:De,program:Ee,layoutVertexBuffer:ze,dynamicBuffers:Ie,indexBuffer:We,uniformValues:o.dL(c,he,_e,$e,ce,r),tile:_e};if(w){const tt=be.segments.get();for(const gt of tt)ye.push({segments:new o.bd([gt]),sortKey:gt.sortKey,state:Fe})}else ye.push({segments:be.segments,sortKey:0,state:Fe})}w&&ye.sort((de,he)=>de.sortKey-he.sortKey);const fe={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const de of ye){const{programConfiguration:he,program:_e,layoutVertexBuffer:be,dynamicBuffers:De,indexBuffer:ze,uniformValues:qe,tile:We}=de.state,rt=de.segments;c.terrain&&c.terrain.setupElevationDraw(We,_e,fe),c.uploadCommonUniforms(D,_e,We.tileID.toUnwrapped()),_e.draw(c,L.TRIANGLES,X,Y,J,Jt.disabled,qe,r.id,be,ze,rt,r.paint,k.zoom,he,De)}},heatmap:function(c,t,r,u){if(r.paint.get("heatmap-opacity")!==0)if(c.renderPass==="offscreen"){const p=c.context,_=p.gl,v=li.disabled,w=new Ii([_.ONE,_.ONE,_.ONE,_.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(N,Z,j,X){const Y=N.gl,J=Z.width*X,oe=Z.height*X;N.activeTexture.set(Y.TEXTURE1),N.viewport.set([0,0,J,oe]);let ce=j.heatmapFbo;if(!ce||ce&&(ce.width!==J||ce.height!==oe)){ce&&ce.destroy();const ye=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,ye),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),ce=j.heatmapFbo=N.createFramebuffer(J,oe,!0,null),function(fe,de,he,_e,be,De){const ze=fe.gl;ze.texImage2D(ze.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,be,De,0,ze.RGBA,fe.extRenderToTextureHalfFloat?ze.HALF_FLOAT:ze.UNSIGNED_BYTE,null),_e.colorAttachment.set(he)}(N,0,ye,ce,J,oe)}else Y.bindTexture(Y.TEXTURE_2D,ce.colorAttachment.get()),N.bindFramebuffer.set(ce.framebuffer)})(p,c,r,c.transform.projection.name==="globe"?.5:.25),p.clear({color:o.am.transparent});const A=c.transform,D=A.projection.name==="globe",L=D?["PROJECTION_GLOBE_VIEW"]:[],k=D?Jt.frontCCW:Jt.disabled,O=[o.aD(A.center.lng),o.aH(A.center.lat)];for(let N=0;N<u.length;N++){const Z=u[N];if(t.hasRenderableParent(Z))continue;const j=t.getTile(Z),X=j.getBucket(r);if(!X||X.projection.name!==A.projection.name)continue;const Y=c.isTileAffectedByFog(Z),J=X.programConfigurations.get(r.id),oe=c.getOrCreateProgram("heatmap",{config:J,defines:L,overrideFog:Y}),{zoom:ce}=c.transform;c.terrain&&c.terrain.setupElevationDraw(j,oe),c.uploadCommonUniforms(p,oe,Z.toUnwrapped());const ye=A.projection.createInversionMatrix(A,Z.canonical);oe.draw(c,_.TRIANGLES,kt.disabled,v,w,k,qu(c,Z,j,ye,O,ce,r.paint.get("heatmap-intensity")),r.id,X.layoutVertexBuffer,X.indexBuffer,X.segments,r.paint,c.transform.zoom,J,D?[X.globeExtVertexBuffer]:null)}p.viewport.set([0,0,c.width,c.height])}else c.renderPass==="translucent"&&(c.context.setColorMode(c.colorModeForRenderPass()),function(p,_){const v=p.context,w=v.gl,A=_.heatmapFbo;if(!A)return;v.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_2D,A.colorAttachment.get()),v.activeTexture.set(w.TEXTURE1);let D=_.colorRampTexture;D||(D=_.colorRampTexture=new o.T(v,_.colorRamp,w.RGBA8)),D.bind(w.LINEAR,w.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,w.TRIANGLES,kt.disabled,li.disabled,p.colorModeForRenderPass(),Jt.disabled,((L,k,O,N)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(c,r))},line:function(c,t,r,u){if(c.renderPass!=="translucent")return;const p=r.paint.get("line-opacity"),_=r.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const v=r.paint.get("line-emissive-strength"),w=r.paint.get("line-occlusion-opacity"),A=r.layout.get("line-elevation-reference"),D=r.layout.get("line-width-unit")==="meters",L=A==="sea",k=!(!c.terrain||!c.terrain.enabled),O=c.context,N=O.gl;if(r.hasElevatedBuckets&&c.transform.projection.name==="globe")return;const Z=r.layout.get("line-cross-slope"),j=Z!==void 0,X=Z<1,Y=c.colorModeForDrapableLayerRenderPass(v),J=c.terrain&&c.terrain.renderingToTexture,oe=J?1:o.q.devicePixelRatio,ce=r.paint.get("line-dasharray"),ye=ce.constantOr(1),fe=r.layout.get("line-cap"),de=ce.constantOr(null),he=fe.constantOr(null),_e=r.paint.get("line-pattern"),be=_e.constantOr(1),De=r.paint.get("line-pattern-cross-fade"),ze=_e.constantOr(null),qe=r.paint.get("line-opacity").constantOr(1);let We=!be&&qe!==1||c.depthOcclusion&&w>0&&w<1;const rt=r.paint.get("line-gradient"),Ie=be?"linePattern":"line",Ue=o.dM(r);let Ee;if(J&&c.terrain&&c.terrain.clipOrMaskOverlapStencilType()&&(We=!1),w!==0&&c.depthOcclusion){const gt=r.paint._values["line-opacity"];gt&&gt.value&&gt.value.kind==="constant"?Ee=gt.value:o.w(`Occlusion opacity for layer ${r.id} is supported only when line-opacity isn't data-driven.`)}_.value.kind!=="constant"&&_.value.isLineProgressConstant===!1&&Ue.push("VARIABLE_LINE_WIDTH");const $e=(gt,Ye,ht,Ot,zt,Dt)=>{for(const Ht of gt){const $t=t.getTile(Ht);if(be&&!$t.patternsLoaded())continue;const Lt=$t.getBucket(r);if(!Lt||Lt.elevationType!=="none"&&!zt||Lt.elevationType==="none"&&zt)continue;c.prepareDrawTile();const qt=[...Ye],Xt=c.shadowRenderer,ui=Lt.elevationType==="road"&&!!Xt&&Xt.enabled;let Ti=[0,0,0];if(ui){const Fi=c.style.directionalLight,Tn=c.style.ambientLight;Fi&&Tn&&(Ti=Yl(c.style,Fi,Tn)),qt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Bi=Lt.programConfigurations.get(r.id);let Wi=!1;if(ze&&$t.imageAtlas){const Fi=o.dN.from(ze),Tn=Fi.getPrimary().scaleSelf(oe).toString(),Cn=$t.imageAtlas.patternPositions.get(Tn),yn=Fi.getSecondary(),Sn=yn?$t.imageAtlas.patternPositions.get(yn.scaleSelf(oe).toString()):null;Wi=!!Cn&&!!Sn,Cn&&Bi.setConstantPatternPositions(Cn,Sn)}De>0&&(Wi||Bi.getPatternTransitionVertexBuffer("line-pattern"))&&qt.push("LINE_PATTERN_TRANSITION");const Zn=c.isTileAffectedByFog(Ht),gi=c.getOrCreateProgram(Ie,{config:Bi,defines:qt,overrideFog:Zn,overrideRtt:!zt&&void 0});if(!be&&de&&he&&$t.lineAtlas){const Fi=$t.lineAtlas.getDash(de,he);Fi&&Bi.setConstantPatternPositions(Fi)}ui&&Xt.setupShadows($t.tileID.toUnwrapped(),gi,"vector-tile",$t.tileID.overscaledZ);let[mi,ii]=r.paint.get("line-trim-offset");(he==="round"||he==="square")&&mi!==ii&&(mi===0&&(mi-=1),ii===1&&(ii+=1));const an=J?Ht.projMatrix:null,dr=D?1/Lt.tileToMeter/o.aw($t,1,c.transform.zoom):1,wn=D?1/Lt.tileToMeter/o.aw($t,1,Math.floor(c.transform.zoom)):1,Pi=be?o.dO(c,$t,r,an,oe,dr,wn,[mi,ii],Ti,De):o.dP(c,$t,r,an,Lt.lineClipsArray.length,oe,dr,wn,[mi,ii],Ti);if(rt){const Fi=Lt.gradients[r.id];let Tn=Fi.texture;if(r.gradientVersion!==Fi.version){let Cn=256;if(r.stepInterpolant){const yn=t.getSource().maxzoom,Sn=Ht.canonical.z===yn?Math.ceil(1<<c.transform.maxZoom-Ht.canonical.z):1;Cn=o.ay(o.dQ(Lt.maxLineLength/o.aj*1024*Sn),256,O.maxTextureSize)}Fi.gradient=o.dR({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:Cn,image:Fi.gradient||void 0,clips:Lt.lineClipsArray}),Fi.texture?Fi.texture.update(Fi.gradient):Fi.texture=new o.T(O,Fi.gradient,N.RGBA8),Fi.version=r.gradientVersion,Tn=Fi.texture}O.activeTexture.set(N.TEXTURE1),Tn.bind(r.stepInterpolant?N.NEAREST:N.LINEAR,N.CLAMP_TO_EDGE)}ye&&(O.activeTexture.set(N.TEXTURE0),$t.lineAtlasTexture&&$t.lineAtlasTexture.bind(N.LINEAR,N.REPEAT),Bi.updatePaintBuffers()),be&&(O.activeTexture.set(N.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Bi.updatePaintBuffers()),zt&&!L&&c.terrain.setupElevationDraw($t,gi),c.uploadCommonUniforms(O,gi,Ht.toUnwrapped());const On=Fi=>{Ee!=null&&(Ee.value=qe*w),gi.draw(c,N.TRIANGLES,ht,Fi,Y,Jt.disabled,Pi,r.id,Lt.layoutVertexBuffer,Lt.indexBuffer,Lt.segments,r.paint,c.transform.zoom,Bi,[Lt.layoutVertexBuffer2,Lt.patternVertexBuffer,Lt.zOffsetVertexBuffer]),Ee!=null&&(Ee.value=qe)};if(We&&!zt){const Fi=c.stencilModeForClipping(Ht).ref;Fi===0&&J&&O.clear({stencil:0});const Tn={func:N.EQUAL,mask:255};Pi.u_alpha_discard_threshold=.8,On(new li(Tn,Fi,255,N.KEEP,N.KEEP,N.INVERT)),Pi.u_alpha_discard_threshold=0,On(new li(Tn,Fi,255,N.KEEP,N.KEEP,N.KEEP))}else Pi.u_alpha_discard_threshold=We&&zt&&Dt?.8:0,On(zt?Ot:c.stencilModeForClipping(Ht))}};let Fe=c.depthModeForSublayer(0,kt.ReadOnly);const tt=new kt(c.depthOcclusion?N.GREATER:N.LEQUAL,kt.ReadOnly,c.depthRangeFor3D);if(r.hasNonElevatedBuckets){const gt=!J&&c.terrain;w!==0&&gt?o.w(`Occlusion opacity for layer ${r.id} is supported on terrain only if the layer has line-z-offset enabled.`):gt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${r.id}.`):$e(u,Ue,Fe,li.disabled,!1,!0)}if(r.hasElevatedBuckets){A==="hd-road-markup"?k||(Fe=tt,Ue.push("ELEVATED_ROADS")):(Ue.push("ELEVATED"),Fe=tt,j&&Ue.push(X?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&Ue.push("ELEVATION_REFERENCE_SEA"));const gt=We?c.stencilModeFor3D():li.disabled;c.forceTerrainMode=!0,$e(u,Ue,Fe,gt,!0,!0),We&&$e(u,Ue,Fe,gt,!0,!1),c.forceTerrainMode=!1}We&&(c.resetStencilClippingMasks(),J&&O.clear({stencil:0})),w===0||c.depthOcclusion||J||c.layersWithOcclusionOpacity.push(c.currentLayer)},fill:function(c,t,r,u){const p=r.paint.get("fill-color"),_=r.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const v=r.paint.get("fill-emissive-strength"),w=c.colorModeForDrapableLayerRenderPass(v),A=r.paint.get("fill-pattern"),D=c.opaquePassEnabledForLayer()&&!A.constantOr(1)&&p.constantOr(o.am.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";let L="none";r.layout.get("fill-elevation-reference")!=="none"?L="road":r.paint.get("fill-z-offset").constantOr(1)!==0&&(L="offset");const k=!(!c.terrain||!c.terrain.enabled),O={painter:c,sourceCache:t,layer:r,coords:u,colorMode:w,elevationType:L,terrainEnabled:k,pass:D};if(c.renderPass!=="shadow")if(L!=="offset"){if($h(O,!1),L==="road"){const N=!k&&c.renderPass==="translucent";N&&Or(c,t,r,u,"geometry"),$h(O,!0,li.disabled),N&&function(Z){const{painter:j,sourceCache:X,layer:Y,coords:J,colorMode:oe}=Z,ce=j.context.gl,ye=Z.painter.shadowRenderer,fe=!!ye&&ye.enabled,de=new kt(j.context.gl.LEQUAL,kt.ReadOnly,j.depthRangeFor3D);let he=[0,0,0];if(fe){const be=j.style.directionalLight,De=j.style.ambientLight;be&&De&&(he=Yl(j.style,be,De))}const _e=be=>{for(const De of J){const ze=X.getTile(De),qe=ze.getBucket(Y);if(!qe)continue;const We=qe.elevatedStructures;if(!We)continue;let rt,Ie;if(be?(rt=We.renderableBridgeSegments,Ie=We.bridgeProgramConfigurations.get(Y.id)):(rt=We.renderableTunnelSegments,Ie=We.tunnelProgramConfigurations.get(Y.id)),!rt||rt.segments[0].primitiveLength===0)continue;Ie.updatePaintBuffers(),j.prepareDrawTile();const Ue=j.isTileAffectedByFog(De),Ee=[];fe&&Ee.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const $e=j.getOrCreateProgram("elevatedStructures",{config:Ie,overrideFog:Ue,defines:Ee}),Fe=j.translatePosMatrix(De.projMatrix,ze,Y.paint.get("fill-translate"),Y.paint.get("fill-translate-anchor"));fe&&ye.setupShadows(ze.tileID.toUnwrapped(),$e,"vector-tile",ze.tileID.overscaledZ);const tt=Xd(Fe,he);j.uploadCommonUniforms(j.context,$e,De.toUnwrapped()),$e.draw(j,ce.TRIANGLES,de,li.disabled,oe,Jt.backCCW,tt,Y.id,We.vertexBuffer,We.indexBuffer,rt,Y.paint,j.transform.zoom,Ie,[We.vertexBufferNormal])}};_e(!0),_e(!1)}(O)}}else $h(O,!1,c.stencilModeFor3D());else c.shadowRenderer&&L==="road"&&!k&&function(N){const{painter:Z,sourceCache:j,layer:X,coords:Y}=N,J=Z.context.gl,oe=N.painter.shadowRenderer;for(const ce of Y){const ye=j.getTile(ce),fe=ye.getBucket(X);if(!fe)continue;const de=fe.elevatedStructures;if(!de||!de.shadowCasterSegments||de.shadowCasterSegments.segments[0].primitiveLength===0)continue;Z.prepareDrawTile();const he=fe.bufferData.programConfigurations.get(X.id),_e=Z.isTileAffectedByFog(ce),be=Z.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:_e}),De=oe.calculateShadowPassMatrixFromTile(ye.tileID.toUnwrapped());Z.uploadCommonUniforms(Z.context,be,ce.toUnwrapped());const ze={u_matrix:De,u_depth_bias:.001};be.draw(Z,J.TRIANGLES,oe.getShadowPassDepthMode(),li.disabled,oe.getShadowPassColorMode(),Jt.disabled,ze,X.id,de.vertexBuffer,de.indexBuffer,de.shadowCasterSegments,X.paint,Z.transform.zoom,he)}}(O)},"fill-extrusion":function(c,t,r,u){const p=r.paint.get("fill-extrusion-opacity"),_=c.context,v=_.gl,w=c.terrain,A=w&&w.renderingToTexture;if(p===0)return;const D=c.conflationActive&&c.style.isLayerClipped(r,t.getSource()),L=c.style.order.indexOf(r.fqid);if(D&&function(k,O,N,Z,j){for(const X of Z){const Y=O.getTile(X).getBucket(N);Y&&(Y.updateReplacement(X,k.replacementSource,j),Y.uploadCentroid(k.context))}}(c,t,r,u,L),w||D)for(const k of u){const O=t.getTile(k).getBucket(r);O&&Pt(c.context,t,k,O,r,w,D)}if(c.renderPass==="shadow"&&c.shadowRenderer){const k=c.shadowRenderer;if(w&&p<.65&&r._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const O=k.getShadowPassDepthMode(),N=k.getShadowPassColorMode();fa(c,t,r,u,O,li.disabled,N,D)}else if(c.renderPass==="translucent"){const k=!r.paint.get("fill-extrusion-pattern").constantOr(1),O=r.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!A&&O.a!==0){const N=new kt(c.context.gl.LEQUAL,kt.ReadWrite,c.depthRangeFor3D);p===1&&k?fa(c,t,r,u,N,li.disabled,Ii.unblended,D):(fa(c,t,r,u,N,li.disabled,Ii.disabled,D),fa(c,t,r,u,N,c.stencilModeFor3D(),c.colorModeForRenderPass(),D),c.resetStencilClippingMasks())}if(c.style.enable3dLights()&&k&&(!w&&c.transform.projection.name!=="globe"||A)){const N=r.paint.get("fill-extrusion-opacity"),Z=r.paint.get("fill-extrusion-ambient-occlusion-intensity"),j=r.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),X=r.paint.get("fill-extrusion-flood-light-intensity"),Y=r.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",J=r.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Y?null:r.lut).toArray01().slice(0,3),oe=Z>0&&j>0,ce=X>0,ye=(de,he,_e)=>(1-_e)*de+_e*he,fe=de=>{const he=c.depthModeForSublayer(1,kt.ReadOnly,v.LEQUAL,!0),_e=r.paint.get(de?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),be=ye(.1,3,_e),De=c._showOverdrawInspector;if(!De){const ze=new li({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),qe=new Ii([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0],v.MIN);Ba(c,t,r,u,he,ze,qe,Jt.disabled,de,"sdf",N,Z,j,X,J,be,D,!1)}{const ze=De?li.disabled:new li({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),qe=De?c.colorModeForRenderPass():new Ii([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],o.am.transparent,[!0,!0,!0,!0]);Ba(c,t,r,u,he,ze,qe,Jt.disabled,de,"color",N,Z,j,X,J,be,D,!1)}};if(A){const de=(he,_e,be)=>{const De=c.depthModeForSublayer(1,kt.ReadOnly,v.LEQUAL,!1),ze=r.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=ye(.1,3,ze);{const We=new Ii([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0]);Ba(c,t,r,u,De,li.disabled,We,Jt.disabled,he,"clear",N,Z,j,X,J,qe,D,_e)}{const We=new li({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),rt=new Ii([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!1,!1,!1,!0],v.MIN);Ba(c,t,r,u,De,We,rt,Jt.disabled,he,"sdf",N,Z,j,X,J,qe,D,_e)}{const We=he?v.ZERO:v.ONE_MINUS_DST_ALPHA,rt=new li({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),Ie=new Ii([We,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],o.am.transparent,[!0,!0,!0,!0]);Ba(c,t,r,u,De,rt,Ie,Jt.disabled,he,"color",N,Z,j,X,J,qe,D,_e)}{const We=new Ii([v.ONE,v.ONE,v.ONE,he?v.ZERO:v.ONE],o.am.transparent,[!1,!1,!1,!0],he?v.FUNC_ADD:v.MAX);Ba(c,t,r,u,De,li.disabled,We,Jt.disabled,he,"clear",N,Z,j,X,J,qe,D,_e,be)}};if(oe||ce){let he;if(c.prepareDrawTile(),w){const _e=w.drapeBufferSize[0],be=w.drapeBufferSize[1];he=w.framebufferCopyTexture,he&&(!he||he.size[0]===_e&&he.size[1]===be)||(he&&he.destroy(),he=w.framebufferCopyTexture=new o.T(_,new o.r({width:_e,height:be}),v.RGBA8)),he.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,_e,be)}oe&&de(!0,!1,he),ce&&de(!1,!0,he)}}else oe&&fe(!0),ce&&fe(!1),(oe||ce)&&c.resetStencilClippingMasks()}}},building:function(c,t,r,u){},hillshade:function(c,t,r,u){if(c.renderPass!=="offscreen"&&c.renderPass!=="translucent"||c.style.disableElevatedTerrain)return;const p=c.context,_=c.terrain&&c.terrain.renderingToTexture,[v,w]=c.renderPass!=="translucent"||_?[{},u]:c.stencilConfigForOverlap(u);for(const A of w){const D=t.getTile(A);if(D.needsHillshadePrepare&&c.renderPass==="offscreen")yl(c,D,r);else if(c.renderPass==="translucent"){const L=c.depthModeForSublayer(0,kt.ReadOnly),k=r.paint.get("hillshade-emissive-strength"),O=c.colorModeForDrapableLayerRenderPass(k),N=_&&c.terrain?c.terrain.stencilModeForRTTOverlap(A):v[A.overscaledZ];To(c,A,D,r,L,N,O)}}p.viewport.set([0,0,c.width,c.height]),c.resetStencilClippingMasks()},raster:function(c,t,r,u,p,_){if(c.renderPass!=="translucent"||r.paint.get("raster-opacity")===0)return;const v=c.transform.projection.name==="globe",w=r.paint.get("raster-elevation")!==0,A=w&&v;if(c.renderElevatedRasterBackface&&!A)return;const D=c.context,L=D.gl,k=t.getSource(),O=function(fe,de,he,_e){const be=de.paint.get("raster-color"),De=fe.type==="raster-array",ze=[],qe=de.paint.get("raster-resampling"),We=de.paint.get("raster-color-mix");let rt=de.paint.get("raster-color-range");const Ie=[We[0],We[1],We[2],0],Ue=We[3];let Ee=qe==="nearest"?_e.NEAREST:_e.LINEAR;if(De&&(ze.push("RASTER_ARRAY"),be||ze.push("RASTER_COLOR"),qe==="linear"&&ze.push("RASTER_ARRAY_LINEAR"),Ee=_e.NEAREST,!rt&&fe.rasterLayers)){const $e=fe.rasterLayers.find(({id:Fe})=>Fe===de.sourceLayer);$e&&$e.fields&&$e.fields.range&&(rt=$e.fields.range)}if(rt=rt||[0,1],be){ze.push("RASTER_COLOR"),he.activeTexture.set(_e.TEXTURE2),de.updateColorRamp(rt);let $e=de.colorRampTexture;$e||($e=de.colorRampTexture=new o.T(he,de.colorRamp,_e.RGBA8)),$e.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:Ie,range:rt,offset:Ue,defines:ze,resampling:Ee}}(k,r,D,L);if(k instanceof o.aP&&!u.length&&!v)return;const N=r.paint.get("raster-emissive-strength"),Z=c.colorModeForDrapableLayerRenderPass(N),j=c.terrain&&c.terrain.renderingToTexture,X=!c.options.moving,Y=r.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;if(k instanceof o.aP&&!u.length&&(k.onNorthPole||k.onSouthPole)){const fe=w?c.stencilModeFor3D():li.disabled;return void Dr(!!k.onNorthPole,null,c,t,r,N,O,Jt.disabled,fe)}if(!u.length)return;const[J,oe]=k instanceof o.aP||j?[{},u]:c.stencilConfigForOverlap(u),ce=oe[oe.length-1].overscaledZ;A&&O.defines.push("PROJECTION_GLOBE_VIEW"),w&&O.defines.push("RENDER_CUTOFF");const ye=(fe,de,he)=>{for(const _e of fe){const be=_e.toUnwrapped(),De=t.getTile(_e);if(j&&(!De||!De.hasData()))continue;D.activeTexture.set(L.TEXTURE0);const ze=Yh(De,k,r,O);if(!ze||!ze.texture)continue;const{texture:qe,mix:We,offset:rt,tileSize:Ie,buffer:Ue}=ze;let Ee,$e;j?(Ee=kt.disabled,$e=_e.projMatrix):w?(Ee=new kt(L.LEQUAL,kt.ReadWrite,c.depthRangeFor3D),$e=v?Float32Array.from(c.transform.expandedFarZProjMatrix):c.transform.calculateProjMatrix(be,X)):(Ee=c.depthModeForSublayer(_e.overscaledZ-ce,r.paint.get("raster-opacity")===1?kt.ReadWrite:kt.ReadOnly,L.LESS),$e=c.transform.calculateProjMatrix(be,X));const Fe=c.terrain&&j?c.terrain.stencilModeForRTTOverlap(_e):J[_e.overscaledZ],tt=_?0:r.paint.get("raster-fade-duration");De.registerFadeDuration(tt);const gt=t.findLoadedParent(_e,0),Ye=Uc(De,gt,t,c.transform,tt);let ht,Ot;c.terrain&&c.terrain.prepareDrawTile(),D.activeTexture.set(L.TEXTURE0),qe.bind(Y,L.CLAMP_TO_EDGE),D.activeTexture.set(L.TEXTURE1),gt?(gt.texture&&gt.texture.bind(Y,L.CLAMP_TO_EDGE),ht=Math.pow(2,gt.tileID.overscaledZ-De.tileID.overscaledZ),Ot=[De.tileID.canonical.x*ht%1,De.tileID.canonical.y*ht%1]):qe.bind(Y,L.CLAMP_TO_EDGE),"useMipmap"in qe&&D.extTextureFilterAnisotropic&&c.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,D.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,D.extTextureFilterAnisotropicMax);const zt=c.transform;let Dt;const Ht=w?lp(zt):[0,0,0,0];let $t,Lt,qt,Xt,ui,Ti=0;if(A&&k instanceof o.aP&&k.coordinates.length>3)$t=Float32Array.from(o.bh(o.dr(new o.cp(0,0,0)))),Lt=Float32Array.from(zt.globeMatrix),qt=Float32Array.from(o.dm(zt)),Xt=[o.aD(zt.center.lng),o.aH(zt.center.lat)],Dt=k.elevatedGlobePerspectiveTransform,ui=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const gi=o.dn(_e.canonical);Ti=o.dp(gi.getCenter().lat),$t=Float32Array.from(o.bh(o.dr(_e.canonical))),Lt=Float32Array.from(zt.globeMatrix),qt=Float32Array.from(o.dm(zt)),Xt=[o.aD(zt.center.lng),o.aH(zt.center.lat)],Dt=[0,0],ui=Float32Array.from(o.dq(_e.canonical,gi,Ti,zt.worldSize/zt._pixelsPerMercatorPixel))}else Dt=k instanceof o.aP?k.perspectiveTransform:[0,0],$t=new Float32Array(16),Lt=new Float32Array(9),qt=new Float32Array(16),Xt=[0,0],ui=new Float32Array(9);const Bi=za($e,$t,Lt,qt,ui,Ot||[0,0],o.ah(c.transform.zoom),Xt,Ht,ht||1,Ye,r,Dt,w?r.paint.get("raster-elevation"):0,2,We,rt,O.range,Ie,Ue,N),Wi=c.isTileAffectedByFog(_e),Zn=c.getOrCreateProgram("raster",{defines:O.defines,overrideFog:Wi});if(c.uploadCommonUniforms(D,Zn,be),k instanceof o.aP){const gi=k.elevatedGlobeVertexBuffer,mi=k.elevatedGlobeIndexBuffer;if(j||!v)k.boundsBuffer&&k.boundsSegments&&Zn.draw(c,L.TRIANGLES,Ee,li.disabled,Z,Jt.disabled,Bi,r.id,k.boundsBuffer,c.quadTriangleIndexBuffer,k.boundsSegments);else if(gi&&mi){const ii=zt.zoom<=o.cL?k.elevatedGlobeSegments:k.getSegmentsForLongitude(zt.center.lng);ii&&Zn.draw(c,L.TRIANGLES,Ee,li.disabled,Z,de,Bi,r.id,gi,mi,ii)}}else if(A){Ee=new kt(L.LEQUAL,kt.ReadOnly,c.depthRangeFor3D);const gi=c.globeSharedBuffers;if(gi){const[mi,ii,an]=gi.getGridBuffers(Ti,!1);Zn.draw(c,L.TRIANGLES,Ee,he||Fe,c.colorModeForRenderPass(),de,Bi,r.id,mi,ii,an)}}else{const{tileBoundsBuffer:gi,tileBoundsIndexBuffer:mi,tileBoundsSegments:ii}=c.getTileBoundsBuffers(De);Zn.draw(c,L.TRIANGLES,Ee,Fe,Z,Jt.disabled,Bi,r.id,gi,mi,ii)}}if(!(k instanceof o.aP)&&A)for(const _e of fe){const be=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&Dr(!0,_e,c,t,r,N,O,de,he||li.disabled),be&&Dr(!1,_e,c,t,r,N,O,de===Jt.frontCW?Jt.backCW:Jt.frontCW,he||li.disabled)}};A?ye(oe,c.renderElevatedRasterBackface?Jt.backCW:Jt.frontCW,c.stencilModeFor3D()):ye(oe,Jt.disabled,void 0),c.resetStencilClippingMasks()},"raster-particle":function(c,t,r,u,p,_){c.renderPass==="offscreen"&&function(v,w,A,D){if(!D.length)return;const L=v.context,k=L.gl,O=w.getSource();if(!(O instanceof ss))return;const N=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let Z=A.particlePositionRGBAImage;if(!Z||Z.width!==N){const oe=function(ce){const ye=ce*ce,fe=new Uint8Array(4*ye),de=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let _e=0;_e<ye;_e++){const be=he*(de(2*_e+0)+La),De=he*(de(2*_e+1)+La),ze=255*be%1,qe=255*De%1,We=ze,rt=De-qe/255,Ie=qe;fe[4*_e+0]=255*(be-ze/255),fe[4*_e+1]=255*We,fe[4*_e+2]=255*rt,fe[4*_e+3]=255*Ie}return fe}(N);Z=A.particlePositionRGBAImage=new o.r({width:N,height:N},oe)}let j=A.particleFramebuffer;j?j.width!==N&&(j.destroy(),j=A.particleFramebuffer=L.createFramebuffer(N,N,!0,null)):j=A.particleFramebuffer=L.createFramebuffer(N,N,!0,null);const X=[];for(const oe of D){const ce=w.getTile(oe);if(!(ce instanceof Tu))continue;const ye=Il(ce,O,A);if(!ye)continue;const fe=[ce.tileSize,ce.tileSize];let de=A.tileFramebuffer;de||(de=A.tileFramebuffer=L.createFramebuffer(fe[0],fe[1],!0,null));let he=ce.rasterParticleState;he||(he=ce.rasterParticleState=new Jd(L,oe,fe,Z));const _e=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==N&&he.updateParticleTexture(oe,Z);const be=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=be;const De=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=De,X.push([oe,ye,he,_e])}if(X.length===0)return;const Y=o.q.now(),J=A.previousDrawTimestamp?.001*(Y-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Y,A.hasColorMap()){L.activeTexture.set(k.TEXTURE0+2);let oe=A.colorRampTexture;oe||(oe=A.colorRampTexture=new o.T(L,A.colorRamp,k.RGBA8)),oe.bind(k.LINEAR,k.CLAMP_TO_EDGE)}L.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(oe,ce,ye){const fe=oe.context,de=fe.gl,he=ce.tileFramebuffer;fe.activeTexture.set(de.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(De=ce.paint.get("raster-particle-fade-opacity-factor"))/(De+.05)},be=oe.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var De;for(const ze of ye){const[,,qe,We]=ze;he.colorAttachment.set(qe.targetColorTexture.texture),fe.viewport.set([0,0,he.width,he.height]),fe.clear({color:o.am.transparent}),We&&(qe.backgroundColorTexture.bind(de.NEAREST,de.CLAMP_TO_EDGE),be.draw(oe,de.TRIANGLES,kt.disabled,li.disabled,Ii.alphaBlended,Jt.disabled,_e,ce.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments))}}(v,A,X),function(oe,ce,ye,fe){const de=oe.context,he=de.gl,_e=ye.tileFramebuffer,be=oe.transform.projection.name==="globe",De=ye.paint.get("raster-particle-max-speed");for(const ze of fe){const[qe,We,rt]=ze;de.activeTexture.set(he.TEXTURE0+0),We.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),_e.colorAttachment.set(rt.targetColorTexture.texture);const Ie=oe.getOrCreateProgram("rasterParticleDraw",{defines:We.defines,overrideFog:!1});de.activeTexture.set(he.TEXTURE0+1);const Ue=We.scalarData?[]:[0,1,2,3].map(Fe=>o.dT[Fe](qe));Ue.push(qe);const Ee=qe.canonical.x,$e=qe.canonical.y;for(const Fe of Ue){const tt=ce.getTile(be?Fe.wrapped():Fe);if(!tt)continue;const gt=tt.rasterParticleState;if(!gt)continue;const Ye=Fe.canonical.x+(1<<Fe.canonical.z)*(Fe.wrap-qe.wrap),ht=Fe.canonical.y;gt.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);const Ot=Cl(1,gt.particleTexture0.size[0],[Ye-Ee,ht-$e],0,We.texture.size,2,De,We.textureOffset,We.scale,We.offset);Ie.draw(oe,he.POINTS,kt.disabled,li.disabled,Ii.alphaBlended,Jt.disabled,Ot,ye.id,gt.particleIndexBuffer,void 0,gt.particleSegment)}}}(v,w,A,X),L.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(oe,ce,ye,fe){const de=oe.context,he=de.gl,_e=ce.paint.get("raster-particle-max-speed"),be=fe*ce.paint.get("raster-particle-speed-factor")*.15,De=function(qe){return Math.pow(qe,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),ze=ce.particleFramebuffer;de.viewport.set([0,0,ze.width,ze.height]);for(const qe of ye){const[,We,rt]=qe;de.activeTexture.set(he.TEXTURE0+0),We.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),de.activeTexture.set(he.TEXTURE0+1);const Ie=rt.particleTexture0;Ie.bind(he.NEAREST,he.CLAMP_TO_EDGE);const Ue=Bo(1,Ie.size[0],0,We.texture.size,_e,be,De,We.textureOffset,We.scale,We.offset);ze.colorAttachment.set(rt.particleTexture1.texture),de.clear({color:o.am.transparent}),oe.getOrCreateProgram("rasterParticleUpdate",{defines:We.defines}).draw(oe,he.TRIANGLES,kt.disabled,li.disabled,Ii.unblended,Jt.disabled,Ue,ce.id,oe.viewportBuffer,oe.quadTriangleIndexBuffer,oe.viewportSegments)}}(v,A,X,J)}(c,t,r,u),c.renderPass==="translucent"&&(function(v,w,A,D,L){const k=v.context,O=k.gl,N=w.getSource().tileSize,Z=5*(1-o.af(o.cx,o.cx+1,v.transform.zoom))*N+A.paint.get("raster-particle-elevation"),j=!v.options.moving,X=v.transform.projection.name==="globe";if(!D.length)return;const[Y,J]=v.stencilConfigForOverlap(D),oe=[];X&&oe.push("PROJECTION_GLOBE_VIEW");const ce=v.stencilModeFor3D();for(const ye of J){const fe=ye.toUnwrapped(),de=w.getTile(ye);if(!de.rasterParticleState)continue;const he=de.rasterParticleState,_e=100;de.registerFadeDuration(_e);const be=w.findLoadedParent(ye,0),De=Uc(de,be,w,v.transform,_e);let ze,qe;v.terrain&&v.terrain.prepareDrawTile(),k.activeTexture.set(O.TEXTURE0),he.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),k.activeTexture.set(O.TEXTURE1),be&&be.rasterParticleState?(be.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),ze=Math.pow(2,be.tileID.overscaledZ-de.tileID.overscaledZ),qe=[de.tileID.canonical.x*ze%1,de.tileID.canonical.y*ze%1]):he.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const We=X?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(fe,j),rt=v.transform,Ie=Kh(rt),Ue=o.dn(ye.canonical),Ee=o.dp(Ue.getCenter().lat);let $e,Fe,tt,gt,Ye;X?($e=Float32Array.from(o.bh(o.dr(ye.canonical))),Fe=Float32Array.from(rt.globeMatrix),tt=Float32Array.from(o.dm(rt)),gt=[o.aD(rt.center.lng),o.aH(rt.center.lat)],Ye=Float32Array.from(o.dq(ye.canonical,Ue,Ee,rt.worldSize/rt._pixelsPerMercatorPixel))):($e=new Float32Array(16),Fe=new Float32Array(9),tt=new Float32Array(16),gt=[0,0],Ye=new Float32Array(9));const ht=co(We,$e,Fe,tt,Ye,qe||[0,0],o.ah(v.transform.zoom),gt,Ie,ze||1,De,Z),Ot=v.isTileAffectedByFog(ye),zt=v.getOrCreateProgram("rasterParticle",{defines:oe,overrideFog:Ot});if(v.uploadCommonUniforms(k,zt,fe),X){const Dt=new kt(O.LEQUAL,kt.ReadOnly,v.depthRangeFor3D),Ht=0,$t=v.globeSharedBuffers;if($t){const[Lt,qt,Xt]=$t.getGridBuffers(Ee,Ht!==0);zt.draw(v,O.TRIANGLES,Dt,ce,Ii.alphaBlended,v.renderElevatedRasterBackface?Jt.frontCCW:Jt.backCCW,ht,A.id,Lt,qt,Xt)}}else{const Dt=v.depthModeForSublayer(0,kt.ReadOnly),Ht=Y[ye.overscaledZ],{tileBoundsBuffer:$t,tileBoundsIndexBuffer:Lt,tileBoundsSegments:qt}=v.getTileBoundsBuffers(de);zt.draw(v,O.TRIANGLES,Dt,Ht,Ii.alphaBlended,Jt.disabled,ht,A.id,$t,Lt,qt)}}v.resetStencilClippingMasks()}(c,t,r,u),c.style.map.triggerRepaint())},background:function(c,t,r,u){const p=r.paint.get("background-color"),_=r.paint.get("background-color-use-theme").constantOr("default")==="none",v=r.paint.get("background-opacity"),w=r.paint.get("background-emissive-strength"),A=r.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const D=c.context,L=D.gl,k=c.transform,O=k.tileSize,N=r.paint.get("background-pattern");let Z;if(N!==void 0&&(N===null||(Z=c.imageManager.getPattern(o.I.from(N.toString()),r.scope,c.style.getLut(r.scope)),!Z)))return;const j=!N&&p.a===1&&v===1&&c.opaquePassEnabledForLayer()?"opaque":"translucent";if(c.renderPass!==j)return;const X=li.disabled,Y=c.depthModeForSublayer(0,j==="opaque"?kt.ReadWrite:kt.ReadOnly),J=c.colorModeForDrapableLayerRenderPass(w),oe=N?"backgroundPattern":"background";let ce,ye=u;if(ye||(ce=c.getBackgroundTiles(),ye=Object.values(ce).map(fe=>fe.tileID)),N&&(D.activeTexture.set(L.TEXTURE0),c.imageManager.bind(c.context,r.scope)),A){const fe=c.getOrCreateProgram(oe,{overrideFog:!1,overrideRtt:!0}),de=new Float32Array(o.bx([])),he=new o.aM(0,0,0,0,0),_e=N?qc(de,w,v,c,0,r.scope,Z,A,{tileID:he,tileSize:O}):Hc(de,w,v,p.toPremultipliedRenderColor(_?null:r.lut));fe.draw(c,L.TRIANGLES,Y,X,J,Jt.disabled,_e,r.id,c.viewportBuffer,c.quadTriangleIndexBuffer,c.viewportSegments)}else for(const fe of ye){const de=c.isTileAffectedByFog(fe),he=c.getOrCreateProgram(oe,{overrideFog:de}),_e=fe.toUnwrapped(),be=u?fe.projMatrix:c.transform.calculateProjMatrix(_e);c.prepareDrawTile();const De=t?t.getTile(fe):ce?ce[fe.key]:new al(fe,O,k.zoom,c),ze=N?qc(be,w,v,c,0,r.scope,Z,A,{tileID:fe,tileSize:O}):Hc(be,w,v,p.toPremultipliedRenderColor(_?null:r.lut));c.uploadCommonUniforms(D,he,_e);const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:We,tileBoundsSegments:rt}=c.getTileBoundsBuffers(De);he.draw(c,L.TRIANGLES,Y,X,J,Jt.disabled,ze,r.id,qe,We,rt)}},sky:function(c,t,r){const u=c._atmosphere?o.ah(c.transform.zoom):1,p=r.paint.get("sky-opacity")*u;if(p===0)return;const _=c.context,v=r.paint.get("sky-type"),w=new kt(_.gl.LEQUAL,kt.ReadOnly,[0,1]),A=c.frameCounter/1e3%1;v==="atmosphere"?c.renderPass==="offscreen"?r.needsSkyboxCapture(c)&&(function(D,L,k,O){const N=D.context,Z=N.gl;let j=L.skyboxFbo;if(!j){j=L.skyboxFbo=N.createFramebuffer(32,32,!0,null),L.skyboxGeometry=new Ku(N),L.skyboxTexture=N.gl.createTexture(),Z.bindTexture(Z.TEXTURE_CUBE_MAP,L.skyboxTexture),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_CUBE_MAP,Z.TEXTURE_MAG_FILTER,Z.LINEAR);for(let oe=0;oe<6;++oe)Z.texImage2D(Z.TEXTURE_CUBE_MAP_POSITIVE_X+oe,0,Z.RGBA,32,32,0,Z.RGBA,Z.UNSIGNED_BYTE,null)}N.bindFramebuffer.set(j.framebuffer),N.viewport.set([0,0,32,32]);const X=L.getCenter(D,!0),Y=D.getOrCreateProgram("skyboxCapture"),J=new Float64Array(16);o.bx(J),o.e3(J,J,.5*-Math.PI),ja(D,L,Y,J,X,0),o.bx(J),o.e3(J,J,.5*Math.PI),ja(D,L,Y,J,X,1),o.bx(J),o.cG(J,J,.5*-Math.PI),ja(D,L,Y,J,X,2),o.bx(J),o.cG(J,J,.5*Math.PI),ja(D,L,Y,J,X,3),o.bx(J),ja(D,L,Y,J,X,4),o.bx(J),o.e3(J,J,Math.PI),ja(D,L,Y,J,X,5),N.viewport.set([0,0,D.width,D.height])}(c,r),r.markSkyboxValid(c)):c.renderPass==="sky"&&function(D,L,k,O,N){const Z=D.context,j=Z.gl,X=D.transform,Y=D.getOrCreateProgram("skybox");Z.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_CUBE_MAP,L.skyboxTexture);const J=((oe,ce,ye,fe,de)=>({u_matrix:oe,u_sun_direction:ce,u_cubemap:0,u_opacity:fe,u_temporal_offset:de}))(X.skyboxMatrix,L.getCenter(D,!1),0,O,N);D.uploadCommonUniforms(Z,Y),Y.draw(D,j.TRIANGLES,k,li.disabled,D.colorModeForRenderPass(),Jt.backCW,J,"skybox",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(c,r,w,p,A):v==="gradient"&&c.renderPass==="sky"&&function(D,L,k,O,N){const Z=D.context,j=Z.gl,X=D.transform,Y=D.getOrCreateProgram("skyboxGradient");L.skyboxGeometry||(L.skyboxGeometry=new Ku(Z)),Z.activeTexture.set(j.TEXTURE0);let J=L.colorRampTexture;J||(J=L.colorRampTexture=new o.T(Z,L.colorRamp,j.RGBA8)),J.bind(j.LINEAR,j.CLAMP_TO_EDGE);const oe=((ce,ye,fe,de,he)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:ye,u_radius:o.al(fe),u_opacity:de,u_temporal_offset:he}))(X.skyboxMatrix,L.getCenter(D,!1),L.paint.get("sky-gradient-radius"),O,N);D.uploadCommonUniforms(Z,Y),Y.draw(D,j.TRIANGLES,k,li.disabled,D.colorModeForRenderPass(),Jt.backCW,oe,"skyboxGradient",L.skyboxGeometry.vertexBuffer,L.skyboxGeometry.indexBuffer,L.skyboxGeometry.segment)}(c,r,w,p,A)},custom:function(c,t,r,u){const p=c.context,_=r.implementation;if(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes("custom")||c.terrain&&(c.terrain.renderingToTexture||c.renderPass==="offscreen")&&r.isDraped(t)){if(c.renderPass==="offscreen"){const v=_.prerender;if(v){if(c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),c.transform.projection.name==="globe"){const w=c.transform.pointMerc;v.call(_,p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.ah(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else v.call(_,p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState()}}else if(c.renderPass==="translucent"){if(c.terrain&&c.terrain.renderingToTexture){const w=_.renderToTile;if(w){const A=u[0].canonical,D={x:A.x+u[0].wrap*(_.wrapTileId?0:1<<A.z),y:A.y,z:A.z};p.setDepthMode(kt.disabled),p.setStencilMode(li.disabled),p.setColorMode(c.colorModeForRenderPass()),c.setCustomLayerDefaults(),w.call(_,p.gl,D),p.setDirty(),c.setBaseState()}return}c.setCustomLayerDefaults(),p.setColorMode(c.colorModeForRenderPass()),p.setStencilMode(li.disabled);const v=_.renderingMode==="3d"?new kt(c.context.gl.LEQUAL,kt.ReadWrite,c.depthRangeFor3D):c.depthModeForSublayer(0,kt.ReadOnly);if(p.setDepthMode(v),c.transform.projection.name==="globe"){const w=c.transform.pointMerc;_.render(p.gl,c.transform.customLayerMatrix(),c.transform.getProjection(),c.transform.globeToMercatorMatrix(),o.ah(c.transform.zoom),[w.x,w.y],c.transform.pixelsPerMeterRatio)}else _.render(p.gl,c.transform.customLayerMatrix());p.setDirty(),c.setBaseState(),p.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(c,t,r,u){if(c.renderPass==="opaque")return;const p=r.paint.get("model-opacity").constantOr(1);if(p===0)return;const _=r.paint.get("model-cast-shadows");if(c.renderPass==="shadow"&&(!_||c.terrain&&p<.65&&r._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const v=c.shadowRenderer,w=r.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,w||(v.enabled=!1));const A=()=>{v&&(v.useNormalOffset=!0,w||(v.enabled=!0))},D=t.getSource();if(c.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(Y,J,oe,ce,ye){const fe=Y.transform;if(fe.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);const de=fe.getFreeCameraOptions().position;if(!Y.modelManager)return;const he=Y.modelManager;oe.modelManager=he;const _e=Y.shadowRenderer;if(!oe._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=oe._unevaluatedLayout._values["model-id"],De=Object.assign({},oe.layout.get("model-id").parameters),ze=Y.style.order.indexOf(oe.fqid);for(const qe of ce){const We=J.getTile(qe).getBucket(oe);if(!We||We.projection.name!==fe.projection.name)continue;const rt=We.getModelUris();rt&&!We.modelsRequested&&(he.addModelsFromBucket(rt,ye),We.modelsRequested=!0);const Ie=Jh(qe,fe);De.zoom=Ie;const Ue=be.possiblyEvaluate(De);if(Re(Y,We,qe),Ys.shadowUniformsInitialized=!1,Ys.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(qe.toUnwrapped())===0,Y.renderPass==="shadow"&&_e){if(Y.currentShadowCascade===1&&We.isInsideFirstShadowMapFrustum)continue;const Fe=fe.calculatePosMatrix(qe.toUnwrapped(),fe.worldSize);if(Ys.tileMatrix.set(Fe),Ys.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Fe)),Ys.aabb.min.fill(0),Ys.aabb.max[0]=Ys.aabb.max[1]=o.aj,Ys.aabb.max[2]=0,pp(We,Ys,Y,oe.scope))continue}const Ee=1<<qe.canonical.z,$e=[((de.x-qe.wrap)*Ee-qe.canonical.x)*o.aj,(de.y*Ee-qe.canonical.y)*o.aj,de.z*Ee*o.aj];Y.conflationActive&&Object.keys(We.instancesPerModel).length>0&&Y.style.isLayerClipped(oe,J.getSource())&&We.updateReplacement(qe,Y.replacementSource,ze,ye)&&(We.uploaded=!1,We.upload(Y.context));for(let Fe in We.instancesPerModel){const tt=We.instancesPerModel[Fe];tt.features.length>0&&(Fe=Ue.evaluate(tt.features[0].feature,{}));const gt=he.getModel(Fe,ye);if(gt||he.hasURLBeenRequested(Fe)||We.modelUris.includes(Fe)||(We.modelUris.push(Fe),We.modelsRequested=!1),gt&&gt.uploaded)for(const Ye of gt.nodes)ed(Y,oe,Ye,tt,$e,qe,Ys)}}}(c,t,r,u,D.type==="vector"?r.scope:""),void A();if(!D.loaded())return;if(D.type==="batched-model")return function(Y,J,oe,ce){oe.resetLayerRenderingStats(Y);const ye=Y.context,fe=Y.transform,de=Y.style.fog,he=Y.shadowRenderer;if(fe.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const _e=Y.transform.getFreeCameraOptions().position,be=o.bY([],[_e.x,_e.y,_e.z],Y.transform.worldSize),De=o.eb([],be),ze=o.bx([]),qe=o.ec(fe.center.lat,fe.zoom),We=o.bn([],[1,1,1/qe]);o.bo(ze,ze,De);const rt=oe.paint.get("model-opacity").constantOr(1),Ie=new kt(ye.gl.LEQUAL,kt.ReadWrite,Y.depthRangeFor3D),Ue=new kt(ye.gl.LEQUAL,kt.ReadOnly,Y.depthRangeFor3D),Ee=new o.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),$e=Y.renderPass==="shadow",Fe=$e&&he?he.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),tt=oe.paint.get("model-front-cutoff"),gt=tt[2]<1,Ye=Ia(Y,oe.paint.get("model-cutoff-fade-range")),ht=oe.getLayerRenderingStats();(function(Ot,zt,Dt,Ht){const $t=Ot.terrain?Ot.terrain.exaggeration():0,Lt=Ot.transform.zoom;for(const qt of Ht){const Xt=zt.getTile(qt).getBucket(Dt);Xt&&(Xt.setFilter(Dt.filter),Ot.conflationActive&&Xt.updateReplacement(qt,Ot.replacementSource),Xt.evaluateTransform(Ot,Dt),Ot.terrain&&$t>0&&Xt.elevationUpdate(Ot.terrain,$t,qt,Dt.source),Xt.needsReEvaluation(Ot,Lt,Dt)&&Xt.evaluate(Dt))}})(Y,J,oe,ce),function(){let Ot,zt,Dt;gt?(Ot=ce.length-1,zt=-1,Dt=-1):(Ot=0,zt=ce.length,Dt=1);const Ht=new Float64Array(16),$t=o.ef(),Lt=new o.P(0,0);for(let qt=Ot;qt!==zt;qt+=Dt){const Xt=ce[qt],ui=J.getTile(Xt).getBucket(oe);if(!ui||!ui.uploaded)continue;let Ti=!1;he&&(Ti=he.getMaxCascadeForTile(Xt.toUnwrapped())===0);const Bi=fe.calculatePosMatrix(Xt.toUnwrapped(),fe.worldSize),Wi=ui.modelTraits;!$e&&gt&&(o.bi(Ht,Bi),o.ad($t,be,Ht),Lt.x=$t[0],Lt.y=$t[1]);const Zn=[];ui.setFilter(oe.filter);for(const gi of ui.getNodesInfo()){if(gi.hiddenByReplacement||!gi.node.meshes)continue;const mi=gi.node;let ii=0;Y.terrain&&mi.elevation&&(ii=mi.elevation*Y.terrain.exaggeration());const an=(()=>{const Rn=gi.aabb;return Ee.min=[...Rn.min],Ee.max=[...Rn.max],Ee.min[2]+=ii,Ee.max[2]+=ii,o.ad(Ee.min,Ee.min,Bi),o.ad(Ee.max,Ee.max,Bi),Ee})(),dr=gi.evaluatedScale;if(dr[0]<=1&&dr[1]<=1&&dr[2]<=1&&an.intersects(Fe)===0)continue;if(!$e&&gt){const Rn=.16666666666666666;gi.cameraCollisionOpacity=be[0]>an.min[0]&&be[0]<an.max[0]&&be[1]>an.min[1]&&be[1]<an.max[1]&&be[2]*qe<an.max[2]&&mi.footprint&&o.bS(Lt,mi.footprint)?Math.max(gi.cameraCollisionOpacity-Rn,0):Math.min(1,gi.cameraCollisionOpacity+Rn)}const wn=[...Bi],Pi=1/o.cU(Xt.canonical),On=mi.anchor?mi.anchor[0]:0,Fi=mi.anchor?mi.anchor[1]:0;o.bo(wn,wn,[On*(dr[0]-1)+gi.evaluatedTranslation[0]*Pi,Fi*(dr[1]-1)+gi.evaluatedTranslation[1]*Pi,ii+gi.evaluatedTranslation[2]]),o.ci(dr,o.eg)||o.cE(wn,wn,dr);const Tn=o.az([],wn,mi.matrix),Cn=o.az([],fe.expandedFarZProjMatrix,Tn),yn=o.az([],fe.expandedFarZProjMatrix,wn),Sn=o.aA([],[On,Fi,ii,1],Cn)[2];mi.hidden=!1;let Ki=rt;$e||(gt&&(Ki*=gi.cameraCollisionOpacity,Ki*=Yc(wn,fe,gi.aabb,tt)),Ki*=mp(Ye,Sn)),Ki!==0?Zn.push({nodeInfo:gi,depth:Sn,opacity:Ki,wvpForNode:Cn,wvpForTile:yn,nodeModelMatrix:Tn,tileModelMatrix:wn}):mi.hidden=!0}$e||Zn.sort((gi,mi)=>!gt||gi.opacity===1&&mi.opacity===1?gi.depth<mi.depth?-1:1:gi.opacity===1?-1:mi.opacity===1?1:gi.depth>mi.depth?-1:1);for(const gi of Zn){const mi=gi.nodeInfo,ii=mi.node;let an=o.az([],We,gi.tileModelMatrix);o.az(an,ze,an);const dr=o.bi([],an);o.ee(dr,dr),o.cE(dr,dr,tf),an=o.az(an,an,ii.matrix);const wn=Y.renderPass==="light-beam",Pi=oe.paint.get("model-color-use-theme").constantOr("default")==="none",On=Wi&o.em.HasMapboxMeshFeatures,Fi=On?0:mi.evaluatedRMEA[0][2];for(let Tn=0;Tn<ii.meshes.length;++Tn){const Cn=ii.meshes[Tn],yn=Tn===ii.lightMeshIndex;let Sn=gi.wvpForNode;if(yn){if(!wn&&!Y.terrain&&Y.shadowRenderer){Y.currentLayer<Y.firstLightBeamLayer&&(Y.firstLightBeamLayer=Y.currentLayer);continue}Sn=gi.wvpForTile}else if(wn)continue;const Ki={defines:[]},Rn=[];if(!$e&&he&&(he.useNormalOffset=!!Cn.normalBuffer),dt(Ki.defines,Rn,Cn,Y,Pi?null:oe.lut),On||Ki.defines.push("DIFFUSE_SHADED"),Ti&&Ki.defines.push("SHADOWS_SINGLE_CASCADE"),ht&&($e?ht.numRenderedVerticesInShadowPass+=Cn.vertexArray.length:ht.numRenderedVerticesInTransparentPass+=Cn.vertexArray.length),$e){sr(Cn,gi.nodeModelMatrix,Y,oe);continue}let Xn=null;if(de){const qo=$c(gi.nodeModelMatrix,Y.transform);if(Xn=new Float32Array(qo),fe.projection.name!=="globe"){const Us=Cn.aabb.min,Is=Cn.aabb.max,[es,Zo]=de.getOpacityForBounds(qo,Us[0],Us[1],Is[0],Is[1]);Ki.overrideFog=es>=Ne||Zo>=Ne}}const dn=Cn.material;let Hi;dn.occlusionTexture&&dn.occlusionTexture.offsetScale&&(Hi=dn.occlusionTexture.offsetScale,Ki.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ls=Y.getOrCreateProgram("model",Ki);!$e&&he&&he.setupShadowsFromMatrix(gi.tileModelMatrix,ls,he.useNormalOffset),Y.uploadCommonUniforms(ye,ls,null,Xn);const Cs=dn.pbrMetallicRoughness;Cs.metallicFactor=.9,Cs.roughnessFactor=.5;const Qs=Wu(new Float32Array(Sn),new Float32Array(an),new Float32Array(dr),new Float32Array(ii.matrix),Y,gi.opacity,Cs.baseColorFactor,dn.emissiveFactor,Cs.metallicFactor,Cs.roughnessFactor,dn,Fi,oe,[0,0,0],Hi);!yn&&(mi.hasTranslucentParts||gi.opacity<1)&&ls.draw(Y,ye.gl.TRIANGLES,Ie,li.disabled,Ii.disabled,Jt.backCCW,Qs,oe.id,Cn.vertexBuffer,Cn.indexBuffer,Cn.segments,oe.paint,Y.transform.zoom,void 0,Rn),ls.draw(Y,ye.gl.TRIANGLES,yn?Ue:Ie,li.disabled,yn||gi.opacity<1||mi.hasTranslucentParts?Ii.alphaBlended:Ii.unblended,Jt.backCCW,Qs,oe.id,Cn.vertexBuffer,Cn.indexBuffer,Cn.segments,oe.paint,Y.transform.zoom,void 0,Rn)}}}}()}(c,t,r,u),void A();if(D.type!=="model")return;const L=D.getModels(),k=[],O=c.transform.getFreeCameraOptions().position,N=o.bY([],[O.x,O.y,O.z],c.transform.worldSize);o.eb(N,N);const Z=[],j=[];let X=0;for(const Y of L){const J=r.paint.get("model-rotation").constantOr(null),oe=r.paint.get("model-scale").constantOr(null),ce=r.paint.get("model-translation").constantOr(null);Y.computeModelMatrix(c,J,oe,ce,!0,!0,!1);const ye=o.bx([]),fe=o.ec(Y.position.lat,c.transform.zoom),de=o.bn([],[1,1,1/fe]);o.bo(ye,ye,N),k.push({zScaleMatrix:de,negCameraPosMatrix:ye});for(const he of Y.nodes)Ga(c.transform,he,Y.matrix,c.transform.expandedFarZProjMatrix,X,Z,j);X++}if(Z.sort((Y,J)=>J.depth-Y.depth),c.renderPass!=="shadow"){if(p===1)for(const Y of j)St(Y,c,r,k[Y.modelIndex],li.disabled,c.colorModeForRenderPass());else{for(const Y of j)St(Y,c,r,k[Y.modelIndex],li.disabled,Ii.disabled);for(const Y of j)St(Y,c,r,k[Y.modelIndex],c.stencilModeFor3D(),c.colorModeForRenderPass());c.resetStencilClippingMasks()}for(const Y of Z)St(Y,c,r,k[Y.modelIndex],li.disabled,c.colorModeForRenderPass());A()}else{for(const Y of j)sr(Y.mesh,Y.nodeModelMatrix,c,r);for(const Y of Z)sr(Y.mesh,Y.nodeModelMatrix,c,r);A()}}},nd={line:function(c,t,r){if(c.hasElevatedBuckets=!1,c.hasNonElevatedBuckets=!1,c._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||c._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const u=t.getVisibleCoordinates();for(const p of u){const _=t.getTile(p).getBucket(c);if(_&&(_.elevationType!=="none"?c.hasElevatedBuckets=!0:c.hasNonElevatedBuckets=!0,c.hasElevatedBuckets&&c.hasNonElevatedBuckets))break}}}else c.hasNonElevatedBuckets=!0},model:function(c,t,r){const u=t.getSource();if(!u.loaded())return;if(u.type==="vector"||u.type==="geojson")return void(r.modelManager&&r.modelManager.upload(r,u.type==="vector"?c.scope:""));if(u.type==="batched-model"||u.type!=="model")return;const p=u.getModels();for(const _ of p)_.upload(r.context)},raster:function(c,t,r){const u=t.getSource();if(!(u instanceof ss&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-array-band")||u.getInitialBand(p);if(_==null)return;const v=t.getIds().map(w=>t.getTileByID(w));for(const w of v)w.updateNeeded(p,_)&&u.prepareTile(w,p,_)},"raster-particle":function(c,t,r){const u=t.getSource();if(!(u instanceof ss&&u.loaded()))return;const p=c.sourceLayer||u.rasterLayerIds&&u.rasterLayerIds[0];if(!p)return;const _=c.paint.get("raster-particle-array-band")||u.getInitialBand(p);if(_==null)return;const v=t.getIds().map(w=>t.getTileByID(w));for(const w of v)w.updateNeeded(p,_)&&u.prepareTile(w,p,_)}},No={fill:Or},th={fill:function(c,t,r,u){if(!r.layout||r.layout.get("fill-elevation-reference")==="none")return;const p=c.context.gl,_=new kt(p.LEQUAL,kt.ReadOnly,c.depthRangeFor3D),v=new li({func:p.ALWAYS,mask:255},255,255,p.KEEP,p.KEEP,p.REPLACE),w=c.transform.getFreeCameraOptions().position,A=c.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const D of u){const L=t.getTile(D),k=L.getBucket(r);if(!k)continue;const O=k.elevatedStructures;if(!O||O.maskSegments.segments[0].primitiveLength===0)continue;const N=Kd(D.toUnwrapped(),w),Z=c.translatePosMatrix(D.projMatrix,L,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),j=Hu(Z,N,0,0,0);A.draw(c,p.TRIANGLES,_,v,Ii.disabled,Jt.disabled,j,r.id,O.vertexBuffer,O.indexBuffer,O.maskSegments,r.paint,c.transform.zoom)}}};class Kc{constructor(t,r,u,p,_,v){this.context=new An(t,r),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=_,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const w=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of w)this._debugParams.enabledLayers[D]=!0;_.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),_.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),_.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),_.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),_.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const D of w)_.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],D);this.occlusionParams=new gp(_),this.setup(),this.numSublayers=ws.maxUnderzooming+ws.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new xo(this),this._wireframeDebugCache=new hm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,A,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=p,this.worldview=v}updateTerrain(t,r){const u=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(u||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new El(this,t));const p=this._terrain;this.transform.elevation=u?p:null,p.update(t,this.transform,r),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(t){const r=t.fog;if(!r||this.transform.projection.name==="globe"||r.getOpacity(this.transform.pitch)<1||r.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[u,p]=r.getFovAdjustedRange(this.transform._fov);if(u>p)return void(this.transform.fogCullDistSq=null);const _=u+.78*(p-u);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new El(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*o.q.devicePixelRatio,this.height=r*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const u of this.style.order)this.style._mergedLayers[u].resize()}setup(){const t=this.context,r=new o.ba;r.emplaceBack(0,0),r.emplaceBack(o.aj,0),r.emplaceBack(0,o.aj),r.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=t.createVertexBuffer(r,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const u=new o.ba;u.emplaceBack(0,0),u.emplaceBack(o.aj,0),u.emplaceBack(0,o.aj),u.emplaceBack(o.aj,o.aj),this.debugBuffer=t.createVertexBuffer(u,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const p=new o.ba;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(p,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const _=new o.aZ;_.emplaceBack(0,0,0,0),_.emplaceBack(o.aj,0,o.aj,0),_.emplaceBack(0,o.aj,0,o.aj),_.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(_,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const v=new o.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const w=new o.bb;for(const D of[0,1,3,2,0])w.emplaceBack(D);this.debugIndexBuffer=t.createIndexBuffer(w),this.emptyTexture=new o.T(t,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bz();const A=this.context.gl;this.stencilClearMode=new li({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,kt.disabled,this.stencilClearMode,Ii.disabled,Jt.disabled,Nc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,r,u){if(!r||this.currentStencilSource===r.id||!t.isTileClipped()||!u||u.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let w=!1;for(const A of u)if(this._tileClippingMaskIDs[A.key]===void 0){w=!0;break}if(!w)return}this.currentStencilSource=r.id;const p=this.context,_=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(Ii.disabled),p.setDepthMode(kt.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const w of u){const A=r.getTile(w),D=this._tileClippingMaskIDs[w.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:k,tileBoundsSegments:O}=this.getTileBoundsBuffers(A);v.draw(this,_.TRIANGLES,kt.disabled,new li({func:_.ALWAYS,mask:0},D,255,_.KEEP,_.KEEP,_.REPLACE),Ii.disabled,Jt.disabled,Nc(w.projMatrix),"$clipping",L,k,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,r=this.context.gl;return new li({func:r.NOTEQUAL,mask:255},t,255,r.KEEP,r.KEEP,r.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const r=this.context.gl;return new li({func:r.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,r.KEEP,r.KEEP,r.REPLACE)}stencilConfigForOverlap(t){const r=this.context.gl,u=t.sort((v,w)=>w.overscaledZ-v.overscaledZ),p=u[u.length-1].overscaledZ,_=u[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const v={};for(let w=0;w<_;w++)v[w+p]=new li({func:r.GEQUAL,mask:255},w+this.nextStencilID,255,r.KEEP,r.KEEP,r.REPLACE);return this.nextStencilID+=_,[v,u]}return[{[p]:li.disabled},u]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Ii([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ii.unblended:Ii.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Ii([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,r,u,p=!1){if(this.depthOcclusion)return new kt(this.context.gl.GREATER,kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!p)return kt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new kt(u||this.context.gl.LEQUAL,r,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),u=Math.ceil(this.height),p=this.context.bindFramebuffer.get(),_=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===u||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),r!==0&&u!==0&&(this.depthFBO=new Pa(this.context,r,u,!1,"texture"),this.depthTexture=new o.T(this.context,{width:r,height:u,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(p),t.bindTexture(t.TEXTURE_2D,_),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,u,0,0,r,u,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,r)=>t+r/this._fpsHistory.length,0))}render(t,r){const u=o.q.now();this._dt=u-this._timeStamp,this._timeStamp=u,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const p=this.style._mergedLayers,_=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(_).filter(Ie=>{const Ue=p[Ie];return!(Ue.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ue.type]});let w=v(),A=!1,D=!1;for(const Ie of w){const Ue=p[Ie];Ue.type==="circle"&&(A=!0),Ue.type==="symbol"&&(Ue.hasInitialOcclusionOpacityProperties?D=!0:A=!0)}let L=w.map(Ie=>p[Ie]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let O=0,N=!1;for(const Ie in k){const Ue=k[Ie];Ue.used&&(Ue.prepare(this.context),Ue.getSource().usedInConflation&&++O)}let Z=!1;for(const Ie of L)Ie.isHidden(this.transform.zoom)||(Ie.type==="clip"&&(Z=!0),this.prepareLayer(Ie));const j={},X={},Y={},J={},oe={};for(const Ie in k){const Ue=k[Ie];j[Ie]=Ue.getVisibleCoordinates(),X[Ie]=j[Ie].slice().reverse(),Y[Ie]=Ue.getVisibleCoordinates(!0).reverse(),J[Ie]=Ue.getShadowCasterCoordinates(),oe[Ie]=Ue.sortCoordinatesByDistance(j[Ie])}const ce=Ie=>{const Ue=this.style.getLayerSourceCache(Ie);return Ue&&Ue.used?Ue.getSource():null};if(O||Z||this._clippingActiveLastFrame){const Ie=[],Ue=[];let Ee=0;for(const $e of L)this.isSourceForClippingOrConflation($e,ce($e))&&(Ie.push($e),Ue.push(Ee)),Ee++;if(Ie&&(Z||Ie.length>1)||this._clippingActiveLastFrame){Z=!1;const $e=[];for(let Fe=0;Fe<Ie.length;Fe++){const tt=Ie[Fe],gt=Ue[Fe],Ye=this.style.getLayerSourceCache(tt);if(!Ye||!Ye.used||!Ye.getSource().usedInConflation&&tt.type!=="clip")continue;let ht=o.eu,Ot=o.bQ.None;const zt=[];let Dt=!0;if(tt.type==="clip"){ht=gt;for(const Ht of tt.layout.get("clip-layer-types"))Ot|=Ht==="model"?o.bQ.Model:Ht==="symbol"?o.bQ.Symbol:o.bQ.FillExtrusion;for(const Ht of tt.layout.get("clip-layer-scope"))zt.push(Ht);tt.isHidden(this.transform.zoom)?Dt=!1:Z=!0}Dt&&$e.push({layer:tt.fqid,cache:Ye,order:ht,clipMask:Ot,clipScope:zt})}this.replacementSource.setSources($e),N=!0}}this._clippingActiveLastFrame=Z,N||this.replacementSource.clear(),this.conflationActive=N,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ie=0;Ie<L.length;Ie++){const Ue=L[Ie],Ee=Ue.cutoffRange();if(this.longestCutoffRange=Math.max(Ee,this.longestCutoffRange),Ee>0){const $e=ce(Ue);$e&&(this.minCutoffZoom=Math.max($e.minzoom,this.minCutoffZoom)),Ue.minzoom&&(this.minCutoffZoom=Math.max(Ue.minzoom,this.minCutoffZoom))}Ue.is3D(_)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ie),this._lastOcclusionLayer=Ie)}const ye=this.style&&this.style.fog;ye?(this._fogVisible=ye.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ye.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Y),this.opaquePassCutoff=0,w=v(),L=w.map(Ie=>p[Ie]));const fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ie in k)for(const Ue of j[Ie]){let Ee={min:0,max:0};this.terrain&&(Ee=this.terrain.getMinMaxForTile(Ue)||Ee),fe.addShadowReceiver(Ue.toUnwrapped(),Ee.min,Ee.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wc(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const de=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(de&&!this._snow&&(this._snow=new Pn(this)),!de&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new f_(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ao.has(this.context.gl))return;this.renderPass="offscreen";for(const Ie of L){const Ue=t.getLayerSourceCache(Ie);if(!Ie.hasOffscreenPass()||Ie.isHidden(this.transform.zoom))continue;const Ee=Ue?X[Ue.id]:void 0;(Ie.type==="custom"||Ie.type==="raster"||Ie.type==="raster-particle"||Ie.isSky()||Ee&&Ee.length)&&this.renderLayer(this,Ue,Ie,Ee)}this.depthRangeFor3D=[0,1-(L.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,J)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),be=(()=>{if(r.showOverdrawInspector)return o.am.black;const Ie=this.style.fog;if(Ie&&this.transform.projection.supportsFog){const Ue=this.style.getLut(Ie.scope);if(!_e){const Ee=Ie.properties.get("color-use-theme")==="none",$e=Ie.properties.get("color").toNonPremultipliedRenderColor(Ee?null:Ue).toArray01();return new o.am(...$e)}if(_e){const Ee=Ie.properties.get("space-color-use-theme")==="none",$e=Ie.properties.get("space-color").toNonPremultipliedRenderColor(Ee?null:Ue).toArray01();return new o.am(...$e)}}return o.am.transparent})();if(this.context.clear({color:be,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const Ie=L[this.currentLayer],Ue=t.getLayerSourceCache(Ie);if(Ie.isSky())continue;const Ee=Ue?(Ie.is3D(_)?oe:X)[Ue.id]:void 0;this._renderTileClippingMasks(Ie,Ue,Ee),this.renderLayer(this,Ue,Ie,Ee)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const Ie=L[this.currentLayer],Ue=t.getLayerSourceCache(Ie);Ie.isSky()&&this.renderLayer(this,Ue,Ie,Ue?X[Ue.id]:void 0)}function De(Ie,Ue){let Ee;return Ue&&(Ee=(Ie.type==="symbol"?Y:Ie.is3D(_)?oe:X)[Ue.id]),Ee}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<w.length;){const Ie=L[this.currentLayer];if(Ie.type==="raster"||Ie.type==="raster-particle"){const Ue=t.getLayerSourceCache(Ie);this.renderLayer(this,Ue,Ie,De(Ie,Ue))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;fe&&(ze=fe.getShadowCastingLayerCount());let qe=!1,We=-1;for(let Ie=0;Ie<w.length;++Ie){const Ue=L[Ie];Ue.isHidden(this.transform.zoom)||Ue.is3D(_)&&(We=Ie)}D&&We===-1&&(A=!0);let rt=!1;for(;this.currentLayer<w.length;){const Ie=L[this.currentLayer],Ue=t.getLayerSourceCache(Ie);if(Ie.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ie)){if(Ie.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!rt&&Ie.is3D(_)&&!_){const Ee=this.currentLayer,$e=Fe=>{for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const tt=L[this.currentLayer];if(No[tt.type]){const gt=this.style.getLayerSourceCache(tt);No[tt.type](this,gt,tt,De(tt,gt),Fe)}}};$e("initialize"),$e("reset"),this.currentLayer=Ee,rt=!0}if(A&&!qe&&this.terrain&&!this.transform.isOrthographic&&(qe=!0,this.blitDepth()),D&&We!==-1&&this.currentLayer===We+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ie,Ue,Ue?j[Ue.id]:void 0),this.renderLayer(this,Ue,Ie,De(Ie,Ue)),!this.terrain&&fe&&ze>0&&Ie.hasShadowPass()&&--ze==0){{this.clearStencil();const Ee=this.currentLayer;for(this.currentLayer=0;this.currentLayer<L.length;this.currentLayer++){const $e=L[this.currentLayer];if(th[$e.type]){const Fe=this.style.getLayerSourceCache($e);th[$e.type](this,Fe,$e,De($e,Fe))}}this.currentLayer=Ee}if(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ee=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ee;this.currentLayer++){const $e=L[this.currentLayer];if(!$e.hasLightBeamPass())continue;const Fe=t.getLayerSourceCache($e);this.renderLayer(this,Fe,$e,Fe?X[Fe.id]:void 0)}this.currentLayer=Ee,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ee=this.currentLayer;this.depthOcclusion=!0;for(const $e of this.layersWithOcclusionOpacity){this.currentLayer=$e;const Fe=L[this.currentLayer],tt=t.getLayerSourceCache(Fe),gt=tt?X[tt.id]:void 0;this.terrain||this._renderTileClippingMasks(Fe,tt,tt?j[tt.id]:void 0),this.renderLayer(this,tt,Fe,gt)}this.depthOcclusion=!1,this.currentLayer=Ee,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ie=null;L.forEach(Ue=>{const Ee=t.getLayerSourceCache(Ue);Ee&&!Ue.isHidden(this.transform.zoom)&&Ee.getVisibleCoordinates().length&&(!Ie||Ie.getSource().maxzoom<Ee.getSource().maxzoom)&&(Ie=Ee)}),Ie&&this.options.showTileBoundaries&&Ua(this,Ie,Ie.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Ua(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ie){const Ue=Ie.transform.padding;Qh(Ie,Ie.transform.height-(Ue.top||0),3,cp),Qh(Ie,Ue.bottom||0,3,up),Yu(Ie,Ue.left||0,3,$s),Yu(Ie,Ie.transform.width-(Ue.right||0),3,ef);const Ee=Ie.transform.centerPoint;(function($e,Fe,tt,gt){Xc($e,Fe-1,tt-10,2,20,gt),Xc($e,Fe-10,tt-1,20,2,gt)})(Ie,Ee.x,Ie.transform.height-Ee.y,As)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),N||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:r}=this.transform.projection,u=!r||!r.includes(t.type);if(nd[t.type]&&(u||this.terrain&&t.type==="custom")){const p=this.style.getLayerSourceCache(t);nd[t.type](t,p,this)}this.gpuTimingEnd()}renderLayer(t,r,u,p){u.isHidden(this.transform.zoom)||(u.type==="background"||u.type==="sky"||u.type==="custom"||u.type==="model"||u.type==="raster"||u.type==="raster-particle"||p&&p.length)&&(this.id=u.id,this.gpuTimingStart(u),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(u.type)&&(!t.terrain||u.type!=="custom")||u.type==="clip"||Gi[u.type](t,r,u,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery,u=this.context.gl;let p=this.gpuTimers[t.id];p||(p=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:u.createQuery()}),p.calls++,u.beginQuery(r.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,r=this.context.gl,u=r.createQuery();this.deferredRenderGpuTimeQueries.push(u),r.beginQuery(t.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const r={};for(const u in t){const p=t[u],_=this.context.extTimerQuery,v=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),r[u]=v}return r}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const r=this.context.gl;let u=0;for(const p of t)u+=r.getQueryParameter(p,r.QUERY_RESULT)/1e6,r.deleteQuery(p);return u}translatePosMatrix(t,r,u,p,_){if(!u[0]&&!u[1])return t;const v=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(v){const D=Math.sin(v),L=Math.cos(v);u=[u[0]*L-u[1]*D,u[0]*D+u[1]*L]}const w=[_?u[0]:o.aw(r,u[0],this.transform.zoom),_?u[1]:o.aw(r,u[1],this.transform.zoom),0],A=new Float32Array(16);return o.bo(A,t,w),A}saveTileTexture(t){const r=t.size[0],u=this._tileTextures[r];u?u.push(t):this._tileTextures[r]=[t]}getTileTexture(t){const r=this._tileTextures[t];return r&&r.length>0?r.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,r,u){const p=u===void 0?this.terrain&&this.terrain.renderingToTexture:u,_=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(_.push("LIGHTING_3D_MODE"),_.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||_.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||_.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(_.push("TERRAIN"),this.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&_.push("GLOBE"),!this._fogVisible||p||r!==void 0&&!r||_.push("FOG","FOG_DITHERING"),p&&_.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&_.push("OVERDRAW_INSPECTOR"),_}getOrCreateProgram(t,r){this.cache=this.cache||{};const u=r&&r.defines||[],p=r&&r.config,_=this.currentGlobalDefines(t,r&&r.overrideFog,r&&r.overrideRtt).concat(u),v=Al.cacheKey(gl[t],t,_,p);return this.cache[v]||(this.cache[v]=new Al(this.context,t,gl[t],p,Xh[t],_)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const u=this.style.directionalLight,p=this.style.ambientLight;if(u&&p){const _=((v,w,A)=>{const D=v.properties.get("direction"),L=v.properties.get("color-use-theme")==="none",k=v.properties.get("color").toNonPremultipliedRenderColor(L?null:A.getLut(v.scope)).toArray01(),O=v.properties.get("intensity"),N=w.properties.get("color-use-theme")==="none",Z=w.properties.get("color").toNonPremultipliedRenderColor(N?null:A.getLut(w.scope)).toArray01(),j=w.properties.get("intensity"),X=[D.x,D.y,D.z],Y=o.dw(Z,j),J=o.dw(k,O);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:X,u_lighting_directional_color:J,u_ground_radiance:ac(X,J,Y)}})(u,p,this.style);r.setLightsUniformValues(t,_)}}}uploadCommonUniforms(t,r,u,p,_){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const w=v.getOpacity(this.transform.pitch),A=((D,L,k,O,N,Z,j,X,Y,J,oe,ce)=>{const ye=D.transform,fe=L.properties.get("color-use-theme")==="none",de=L.properties.get("color").toNonPremultipliedRenderColor(fe?null:D.style.getLut(L.scope)).toArray01();de[3]=O;const he=D.frameCounter/1e3%1,[_e,be]=L.properties.get("vertical-range");return{u_fog_matrix:k?ye.calculateFogTileMatrix(k):ce||D.identityMat,u_fog_range:L.getFovAdjustedRange(ye._fov),u_fog_color:de,u_fog_horizon_blend:L.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,be),be],u_fog_temporal_offset:he,u_frustum_tl:N,u_frustum_tr:Z,u_frustum_br:j,u_frustum_bl:X,u_globe_pos:Y,u_globe_radius:J,u_viewport:oe,u_globe_transition:o.ah(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,v,u,w,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],p);r.setFogUniformValues(t,A)}_&&r.setCutoffUniformValues(t,_.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),r}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,r=this._backgroundTiles={},u=this.transform.coveringTiles({tileSize:512});for(const p of u)r[p.key]=t[p.key]||new al(p,512,this.transform.tileZoom,this,void 0,this.worldview);return r}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,r){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!r||r.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let r=this._cachedTileFogOpacities[t.key];return r||(this._cachedTileFogOpacities[t.key]=r=this.style.fog.getOpacityForTile(t)),r[0]>=Ne||r[1]>=Ne}setupDepthForOcclusion(t,r,u){const p=this.context,_=p.gl,v=!!u;var w;u||(u={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),p.activeTexture.set(_.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),u.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],u.u_depth_range_unpack=[2/((w=this.depthRangeFor3D)[1]-w[0]),-1-2*w[0]/(w[1]-w[0])],u.u_occluder_half_size=.5*this.occlusionParams.occluderSize,u.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE0),v||r.setTerrainUniformValues(p,u)}}function pa(c,t){let r=!1,u=null;const p=()=>{u=null,r&&(c(),u=setTimeout(p,t),r=!1)};return()=>(r=!0,u||p(),u)}class sf{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pa(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const r=rd(t);if(this._hashName){const u=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(v=>{const w=v.split("=")[0];return w===u?(p=!0,`${w}=${r}`):v}).filter(v=>v);return p||_.push(`${u}=${r}`),`#${_.join("&")}`}return`#${r}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let r;return t.split("&").map(u=>u.split("=")).forEach(u=>{u[0]===this._hashName&&(r=u)}),(r&&r[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const r=this._getCurrentHash();if(r.length>=3&&!r.some(u=>isNaN(Number(u)))){const u=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(r[3]||0):t.getBearing();return t.jumpTo({center:[+r[2],+r[1]],zoom:+r[0],bearing:u,pitch:+(r[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function rd(c,t){const r=c.getCenter(),u=Math.round(100*c.getZoom())/100,p=Math.ceil((u*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),v=Math.round(r.lng*_)/_,w=Math.round(r.lat*_)/_,A=c.getBearing(),D=c.getPitch();let L=t?`/${v}/${w}/${u}`:`${u}/${w}/${v}`;return(A||D)&&(L+="/"+Math.round(10*A)/10),D&&(L+=`/${Math.round(D)}`),L}const ih={linearity:.3,easing:o.ew(0,0,.3,1)},fc=o.h({deceleration:2500,maxSpeed:1400},ih),uo=o.h({deceleration:20,maxSpeed:1400},ih),ma=o.h({deceleration:1e3,maxSpeed:360},ih),Rl=o.h({deceleration:1e3,maxSpeed:90},ih);class Qc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=o.q.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const r={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)r.zoom+=_.zoomDelta||0,r.bearing+=_.bearingDelta||0,r.pitch+=_.pitchDelta||0,_.panDelta&&r.pan._add(_.panDelta),_.around&&(r.around=_.around),_.pinchAround&&(r.pinchAround=_.pinchAround);const u=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(r.pan.mag()){const _=eu(r.pan.mag(),u,o.h({},fc,t||{}));p.offset=r.pan.mult(_.amount/r.pan.mag()),p.center=this._map.transform.center,Jc(p,_)}if(r.zoom){const _=eu(r.zoom,u,uo);p.zoom=this._map.transform.zoom+_.amount,Jc(p,_)}if(r.bearing){const _=eu(r.bearing,u,ma);p.bearing=this._map.transform.bearing+o.ay(_.amount,-179,179),Jc(p,_)}if(r.pitch){const _=eu(r.pitch,u,Rl);p.pitch=this._map.transform.pitch+_.amount,Jc(p,_)}if(p.zoom||p.bearing){const _=r.pinchAround===void 0?r.around:r.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function Jc(c,t){(!c.duration||c.duration<t.duration)&&(c.duration=t.duration,c.easing=t.easing)}function eu(c,t,r){const{maxSpeed:u,linearity:p,deceleration:_}=r,v=o.ay(c*p/(t/1e3),-u,u),w=Math.abs(v)/(_*p);return{easing:r.easing,duration:1e3*w,amount:v*(w/2)}}class zr extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u,p={}){const _=Kr(r.getCanvasContainer(),u),v=r.unproject(_);super(t,o.h({point:_,lngLat:v,originalEvent:u},p)),this._defaultPrevented=!1,this.target=r}}class tu extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,u){const p=t==="touchend"?u.changedTouches:u.touches,_=ns(r.getCanvasContainer(),p),v=_.map(A=>r.unproject(A)),w=_.reduce((A,D,L,k)=>A.add(D.div(k.length)),new o.P(0,0));super(t,{points:_,point:w,lngLats:v,lngLat:r.unproject(w),originalEvent:u}),this._defaultPrevented=!1}}class os extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r){super("wheel",{originalEvent:r}),this._defaultPrevented=!1}}class Uo{constructor(t,r){this._map=t,this._clickTolerance=r.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new os(this._map,t))}mousedown(t,r){return this._mousedownPos=r,this._firePreventable(new zr(t.type,this._map,t))}mouseup(t){this._map.fire(new zr(t.type,this._map,t))}preclick(t){const r=o.h({},t);r.type="preclick",this._map.fire(new zr(r.type,this._map,r))}click(t,r){this._mousedownPos&&this._mousedownPos.dist(r)>=this._clickTolerance||(this.preclick(t),this._map.fire(new zr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new zr(t.type,this._map,t))}mouseover(t){this._map.fire(new zr(t.type,this._map,t))}mouseout(t){this._map.fire(new zr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new tu(t.type,this._map,t))}touchmove(t){this._map.fire(new tu(t.type,this._map,t))}touchend(t){this._map.fire(new tu(t.type,this._map,t))}touchcancel(t){this._map.fire(new tu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _a{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new zr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new zr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new zr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class of{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=r.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,r){this.isEnabled()&&t.shiftKey&&t.button===0&&(Nr(),this._startPos=this._lastPos=r,this._active=!0)}mousemoveWindow(t,r){if(!this._active)return;const u=r,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(u)||!this._box&&u.dist(p)<this._clickTolerance)return;this._lastPos=u,this._box||(this._box=Yt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(p.x,u.x),w=Math.max(p.x,u.x),A=Math.min(p.y,u.y),D=Math.max(p.y,u.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=w-v+"px",this._box.style.height=D-A+"px")})}mouseupWindow(t,r){if(!this._active)return;const u=this._startPos,p=r;if(u&&t.button===0){if(this.reset(),us(),u.x!==p.x||u.y!==p.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:t})),{cameraAnimation:_=>_.fitScreenCoordinates(u,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),_n(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new o.A(t,{originalEvent:r}))}}function Vo(c,t){const r={};for(let u=0;u<c.length;u++)r[c[u].identifier]=t[u];return r}class Sr{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,u){(this.centroid||u.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),u.length===this.numTouches&&(this.centroid=function(p){const _=new o.P(0,0);for(const v of p)_._add(v);return _.div(p.length)}(r),this.touches=Vo(u,r)))}touchmove(t,r,u){if(this.aborted||!this.centroid)return;const p=Vo(u,r);for(const _ in this.touches){const v=p[_];(!v||v.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(t,r,u){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),u.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class kr{constructor(t){this.singleTap=new Sr(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,r,u){this.singleTap.touchstart(t,r,u)}touchmove(t,r,u){this.singleTap.touchmove(t,r,u)}touchend(t,r,u){const p=this.singleTap.touchend(t,r,u);if(p){const _=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(p)<30;if(_&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class nh{constructor(){this._zoomIn=new kr({numTouches:1,numTaps:2}),this._zoomOut=new kr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,r,u){this._zoomIn.touchstart(t,r,u),this._zoomOut.touchstart(t,r,u)}touchmove(t,r,u){this._zoomIn.touchmove(t,r,u),this._zoomOut.touchmove(t,r,u)}touchend(t,r,u){const p=this._zoomIn.touchend(t,r,u),_=this._zoomOut.touchend(t,r,u);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(p)},{originalEvent:t})}):_?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(_)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const sd={0:1,2:2},Ha={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class rh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,r){return!1}_move(t,r){return{}}mousedown(t,r){if(this._lastPoint)return;const u=rl(t);this._correctButton(t,u)&&(this._lastPoint=r,this._eventButton=u)}mousemoveWindow(t,r){const u=this._lastPoint;if(u){if(t.preventDefault(),this._eventButton!=null&&function(p,_){const v=sd[_];return p.buttons===void 0||(p.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(r.dist(u)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(u,r)}}mouseupWindow(t){this._lastPoint&&rl(t)===this._eventButton&&(this._moved&&us(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class af extends rh{mousedown(t,r){super.mousedown(t,r),this._lastPoint&&(this._active=!0)}_correctButton(t,r){return r===0&&!t.ctrlKey}_move(t,r){return{around:r,panDelta:r.sub(t)}}}class qa extends rh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ha[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=.8*(r.x-t.x);if(u)return this._active=!0,{bearingDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Za extends rh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Ha[t.pitchRotateKey]:void 0}_correctButton(t,r){return this._pitchRotateKey?r===0&&t[this._pitchRotateKey]:r===0&&t.ctrlKey||r===2}_move(t,r){const u=-.5*(r.y-t.y);if(u)return this._active=!0,{pitchDelta:u}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class lf{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,r,u){return this._calculateTransform(t,r,u)}touchmove(t,r,u){if(this._active&&!(u.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(u.length===1&&!o.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,u)}}touchend(t,r,u){this._calculateTransform(t,r,u),this._active&&u.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,u){u.length>0&&(this._active=!0);const p=Vo(u,r),_=new o.P(0,0),v=new o.P(0,0);let w=0;for(const D in p){const L=p[D],k=this._touches[D];k&&(_._add(L),v._add(L.sub(k)),w++,p[D]=L)}if(this._touches=p,w<this._minTouches||!v.mag())return;const A=v.div(w);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(w),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Yt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class sh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,r,u){return{}}touchstart(t,r,u){this._firstTwoTouches||u.length<2||(this._firstTwoTouches=[u[0].identifier,u[1].identifier],this._start([r[0],r[1]]))}touchmove(t,r,u){const p=this._firstTwoTouches;if(!p)return;t.preventDefault();const[_,v]=p,w=iu(u,r,_),A=iu(u,r,v);if(!w||!A)return;const D=this._aroundCenter?null:w.add(A).div(2);return this._move([w,A],D,t)}touchend(t,r,u){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,v=iu(u,r,p),w=iu(u,r,_);v&&w||(this._active&&us(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function iu(c,t,r){for(let u=0;u<c.length;u++)if(c[u].identifier===r)return t[u]}function pc(c,t){return Math.log(c/t)/Math.LN2}class cf extends sh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,r){const u=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(pc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:pc(this._distance,u),pinchAround:r}}}function oh(c,t){return 180*c.angleWith(t)/Math.PI}class yp extends sh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,r){const u=this._vector;if(this._vector=t[0].sub(t[1]),u&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:oh(this._vector,u),pinchAround:r}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const r=25/(Math.PI*this._minDiameter)*360,u=this._startVector;if(!u)return!1;const p=oh(t,u);return Math.abs(p)<r}}function od(c){return Math.abs(c.y)>Math.abs(c.x)}class fm extends sh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,od(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,r,u){const p=this._lastPoints;if(!p)return;const _=t[0].sub(p[0]),v=t[1].sub(p[1]);return this._map._cooperativeGestures&&!o.ex()&&u.touches.length<3||(this._valid=this.gestureBeginsVertically(_,v,u.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(_.y+v.y)/2*-.5})}gestureBeginsVertically(t,r,u){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,_=r.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=u),u-this._firstMove<100&&void 0;const v=t.y>0==r.y>0;return od(t)&&od(r)&&v}}const vp={panStep:100,bearingStep:15,pitchStep:10};class as{constructor(){const t=vp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let r=0,u=0,p=0,_=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:r=1;break;case 189:case 109:case 173:r=-1;break;case 37:t.shiftKey?u=-1:(t.preventDefault(),_=-1);break;case 39:t.shiftKey?u=1:(t.preventDefault(),_=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(u=0,p=0),{cameraAnimation:w=>{const A=w.getZoom();w.easeTo({duration:300,easeId:"keyboardHandler",easing:ms,zoom:r?Math.round(A)+r*(t.shiftKey?2:1):A,bearing:w.getBearing()+u*this._bearingStep,pitch:w.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-v*this._panStep],center:w.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ms(c){return c*(2-c)}const uf=4.000244140625,xp=1/450;class bp{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xp,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const u=o.q.now(),p=u-(this._lastWheelEventTime||0);this._lastWheelEventTime=u,r!==0&&r%uf==0?this._type="wheel":r!==0&&Math.abs(r)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const r=Kr(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:r,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>uf?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&L!==0&&(L=1/L);const k=r(),O=Math.pow(2,k),N=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(N*L))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:r(),p=this._startZoom,_=this._easing;let v,w=!1;if(this._type==="wheel"&&p&&_){const D=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),L=_(D);v=o.ai(p,u,L),D<1?this._frameId||(this._frameId=!0):w=!0}else v=u,w=!0;this._active=!0,w&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=v-r();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!w,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=o.ey;if(this._prevEase){const u=this._prevEase,p=(o.q.now()-u.start)/u.duration,_=u.easing(p+.01)-u.easing(p),v=.27/Math.sqrt(_*_+1e-4)*.01,w=Math.sqrt(.0729-v*v);r=o.ew(v,w,.25,1)}return this._prevEase={start:o.q.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Yt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wp{constructor(t,r){this._clickZoom=t,this._tapZoom=r}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,r){return t.preventDefault(),{cameraAnimation:u=>{u.easeTo({duration:300,zoom:u.getZoom()+(t.shiftKey?-1:1),around:u.unproject(r)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ad{constructor(){this._tap=new kr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,r,u){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?u.length>0&&(this._swipePoint=r[0],this._swipeTouch=u[0].identifier):this._tap.touchstart(t,r,u))}touchmove(t,r,u){if(this._tapTime){if(this._swipePoint){if(u[0].identifier!==this._swipeTouch)return;const p=r[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(t,r,u)}touchend(t,r,u){this._tapTime?this._swipePoint&&u.length===0&&this.reset():this._tap.touchend(t,r,u)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hf{constructor(t,r,u){this._el=t,this._mousePan=r,this._touchPan=u}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pm{constructor(t,r,u){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=r,this._mousePitch=u}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mm{constructor(t,r,u,p){this._el=t,this._touchZoom=r,this._touchRotate=u,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ld=c=>c.zoom||c.drag||c.pitch||c.rotate;class or extends o.A{}class df{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const u=o.at([],r,t);this.radius=o.ae(u[2]<0?o.eA([],u,this.constants):[u[0],u[1],0])}projectRay(t){o.eA(t,t,this.constants),o.au(t,t),o.eB(t,t,this.constants);const r=o.bY([],t,this.radius);if(r[2]>0){const u=o.bY([],[0,0,1],o.bG(r,[0,0,1])),p=o.bY([],o.au([],[r[0],r[1],0]),this.radius),_=o.cV([],r,o.bY([],o.at([],o.cV([],p,u),r),2));r[0]=_[0],r[1]=_[1]}return r}}function ah(c){return c.panDelta&&c.panDelta.mag()||c.zoomDelta||c.bearingDelta||c.pitchDelta}class ff{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Qc(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new df,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),o.aV(["handleEvent","handleWindowEvent"],this);const u=this._el;this._listeners=[[u,"touchstart",{passive:!0}],[u,"touchmove",{passive:!1}],[u,"touchend",void 0],[u,"touchcancel",void 0],[u,"mousedown",void 0],[u,"mousemove",void 0],[u,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[u,"mouseover",void 0],[u,"mouseout",void 0],[u,"dblclick",void 0],[u,"click",void 0],[u,"keydown",{capture:!1}],[u,"keyup",void 0],[u,"wheel",{passive:!1}],[u,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,v]of this._listeners){const w=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,w,v)}}destroy(){for(const[t,r,u]of this._listeners){const p=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(r,p,u)}}_addDefaultHandlers(t){const r=this._map,u=r.getCanvasContainer();this._add("mapEvent",new Uo(r,t));const p=r.boxZoom=new of(r,t);this._add("boxZoom",p);const _=new nh,v=new Tp;r.doubleClickZoom=new wp(v,_),this._add("tapZoom",_),this._add("clickZoom",v);const w=new ad;this._add("tapDragZoom",w);const A=r.touchPitch=new fm(r);this._add("touchPitch",A);const D=new qa(t),L=new Za(t);r.dragRotate=new pm(t,D,L),this._add("mouseRotate",D,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const k=new af(t),O=new lf(r,t);r.dragPan=new hf(u,k,O),this._add("mousePan",k),this._add("touchPan",O,["touchZoom","touchRotate"]);const N=new yp,Z=new cf;r.touchZoomRotate=new mm(u,Z,N,w),this._add("touchRotate",N,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new _a(r));const j=r.scrollZoom=new bp(r,this);this._add("scrollZoom",j,["mousePan"]);const X=r.keyboard=new as;this._add("keyboard",X);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&r[Y].enable(t[Y])}_add(t,r,u){this._handlers.push({handlerName:t,handler:r,allowed:u}),this._handlersById[t]=r}stop(t){if(!this._updatingCamera){for(const{handler:r}of this._handlers)r.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ld(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,r,u){for(const p in t)if(p!==u&&(!r||r.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const r=[];for(const u of t)this._el.contains(u.target)&&r.push(u);return r}handleEvent(t,r){this._updatingCamera=!0;const u=t.type==="renderFrame",p=u?void 0:t,_={needsRenderFrame:!1},v={},w={},A=t.touches?this._getMapTouches(t.touches):void 0,D=A?ns(this._el,A):u?void 0:Kr(this._el,t);for(const{handlerName:O,handler:N,allowed:Z}of this._handlers){if(!N.isEnabled())continue;let j;this._blockedByActive(w,Z,O)?N.reset():N[r||t.type]&&(j=N[r||t.type](t,D,A),this.mergeHandlerResult(_,v,j,O,p),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||N.isActive())&&(w[O]=N)}const L={};for(const O in this._previousActiveHandlers)w[O]||(L[O]=p);this._previousActiveHandlers=w,(Object.keys(L).length||ah(_))&&(this._changes.push([_,v,L]),this._triggerRenderFrame()),(Object.keys(w).length||ah(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=_;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,r,u,p,_){if(!u)return;o.h(t,u);const v={handlerName:p,originalEvent:u.originalEvent||_};u.zoomDelta!==void 0&&(r.zoom=v),u.panDelta!==void 0&&(r.drag=v),u.pitchDelta!==void 0&&(r.pitch=v),u.bearingDelta!==void 0&&(r.rotate=v)}_applyChanges(){const t={},r={},u={};for(const[p,_,v]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.aroundCoord!==void 0&&(t.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),o.h(r,_),o.h(u,v);this._updateMapTransform(t,r,u),this._changes=[]}_updateMapTransform(t,r,u){const p=this._map,_=p.transform,v=J=>[J.x,J.y,J.z];if((J=>{const oe=this._eventsInProgress.drag;return oe&&!this._handlersById[oe.handlerName].isActive()})()&&!ah(t)){const J=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),J!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!ah(t))return void this._fireEvents(r,u,!0);let{panDelta:w,zoomDelta:A,bearingDelta:D,pitchDelta:L,around:k,aroundCoord:O,pinchAround:N}=t;_._isCameraConstrained&&(A>0&&(A=0),_._isCameraConstrained=!1),N!==void 0&&(k=N),(A||(J=>r[J]&&!this._eventsInProgress[J])("drag"))&&k&&(this._dragOrigin=v(_.pointCoordinate3D(k)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),k=k||p.transform.centerPoint,D&&(_.bearing+=D),L&&(_.pitch+=L),_._updateCameraState();const Z=[0,0,0];if(w)if(_.projection.name==="mercator"){const J=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k).dir),oe=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(k.sub(w)).dir);Z[0]=oe[0]-J[0],Z[1]=oe[1]-J[1]}else{const J=_.pointCoordinate(k);if(_.projection.name==="globe"){w=w.rotate(-_.angle);const oe=_._pixelsPerMercatorPixel/_.worldSize;Z[0]=-w.x*o.ez(o.aY(J.y))*oe,Z[1]=-w.y*o.ez(_.center.lat)*oe}else{const oe=_.pointCoordinate(k.sub(w));J&&oe&&(Z[0]=oe.x-J.x,Z[1]=oe.y-J.y)}}const j=_.zoom,X=[0,0,0];if(A){const J=v(O||_.pointCoordinate3D(k)),oe={dir:o.au([],o.at([],J,_._camera.position))};if(oe.dir[2]<0){const ce=_.zoomDeltaToMovement(J,A);o.bY(X,oe.dir,ce)}}const Y=o.cV(Z,Z,X);_._translateCameraConstrained(Y),A&&Math.abs(_.zoom-j)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,u,!0)}_fireEvents(t,r,u){const p=ld(this._eventsInProgress),_=ld(t),v={};for(const L in t){const{originalEvent:k}=t[L];this._eventsInProgress[L]||(v[`${L}start`]=k),this._eventsInProgress[L]=t[L]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const L in v)this._fireEvent(L,v[L]);_&&this._fireEvent("move",_.originalEvent);for(const L in t){const{originalEvent:k}=t[L];this._fireEvent(L,k)}const w={};let A;for(const L in this._eventsInProgress){const{handlerName:k,originalEvent:O}=this._eventsInProgress[L];this._handlersById[k].isActive()||(delete this._eventsInProgress[L],A=r[k]||O,w[`${L}end`]=A)}for(const L in w)this._fireEvent(L,w[L]);const D=ld(this._eventsInProgress);if(u&&(p||_)&&!D){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;L?(k(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new o.A("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new o.A(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new or("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const pf="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class mc extends o.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=r.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,r){return this.jumpTo({center:t},r)}panBy(t,r,u){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,o.h({offset:t},r),u)}panTo(t,r,u){return this.easeTo(o.h({center:t},r),u)}getZoom(){return this.transform.zoom}setZoom(t,r){return this.jumpTo({zoom:t},r),this}zoomTo(t,r,u){return this.easeTo(o.h({zoom:t},r),u)}zoomIn(t,r){return this.zoomTo(this.getZoom()+1,t,r),this}zoomOut(t,r){return this.zoomTo(this.getZoom()-1,t,r),this}getBearing(){return this.transform.bearing}setBearing(t,r){return this.jumpTo({bearing:t},r),this}getPadding(){return this.transform.padding}setPadding(t,r){return this.jumpTo({padding:t},r),this}rotateTo(t,r,u){return this.easeTo(o.h({bearing:t},r),u)}resetNorth(t,r){return this.rotateTo(0,o.h({duration:1e3},t),r),this}resetNorthPitch(t,r){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},t),r),this}snapToNorth(t,r){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,r):this}getPitch(){return this.transform.pitch}setPitch(t,r){return this.jumpTo({pitch:t},r),this}cameraForBounds(t,r){t=o.aG.convert(t);const u=r&&r.bearing||0,p=r&&r.pitch||0,_=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,_,v,u,p,r)}_extendPadding(t){const r={top:0,right:0,bottom:0,left:0};return t==null?o.h({},r,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:o.h({},r,t)}_extendCameraOptions(t){return(t=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,r){const u=r.max[0]-r.min[0],p=r.max[1]-r.min[1];return u/p>t.aspect?u/(2*Math.tan(.5*t.fovX)*t.aspect):p/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,r,u,p,_,v){const w=t.clone(),A=this._extendCameraOptions(v);w.bearing=p,w.pitch=_;const D=o.cd.convert(r),L=o.cd.convert(u),k=.5*(D.lat+L.lat),O=.5*(D.lng+L.lng),N=o.eC(k,O),Z=o.au([],N),j=o.au([],o.bF([],Z,[0,1,0])),X=o.bF([],j,Z),Y=[j[0],j[1],j[2],0,X[0],X[1],X[2],0,Z[0],Z[1],Z[2],0,0,0,0,1],J=[N,o.eC(D.lat,D.lng),o.eC(L.lat,D.lng),o.eC(L.lat,L.lng),o.eC(D.lat,L.lng),o.eC(k,D.lng),o.eC(k,L.lng),o.eC(D.lat,O),o.eC(L.lat,O)];let oe=o.cW.fromPoints(J.map(Fe=>[o.bG(j,Fe),o.bG(X,Fe),o.bG(Z,Fe)]));const ce=o.ad([],oe.center,Y);o.eD(ce)===0&&o.eE(ce,0,0,1),o.au(ce,ce),o.bY(ce,ce,o.aB),w.center=o.eF(ce);const ye=w.getWorldToCameraMatrix(),fe=o.bi(new Float64Array(16),ye);oe=o.cW.applyTransform(oe,o.az([],ye,Y));const de=this._extendAABB(oe,w,A,p);if(!de)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");oe=de,o.ad(ce,ce,ye);const he=.5*(oe.max[2]-oe.min[2]),_e=this._minimumAABBFrustumDistance(w,oe),be=o.bY([],[0,0,1],he),De=o.cV(be,ce,be),ze=_e+(w.pitch===0?0:o.bD(ce,De)),qe=w.globeCenterInViewSpace,We=o.at([],ce,[qe[0],qe[1],qe[2]]);o.au(We,We),o.bY(We,We,ze);const rt=o.cV([],ce,We);o.ad(rt,rt,fe);const Ie=o.eq/o.aB,Ue=o.ae(rt),Ee=o.c6(Math.max(Ue*Ie-o.eq,Number.EPSILON),0),$e=Math.min(w.zoomFromMercatorZAdjusted(Ee),A.maxZoom);return $e>.5*(o.cL+o.cx)?(w.setProjection({name:"mercator"}),w.zoom=$e,this._cameraForBounds(w,r,u,p,_,v)):{center:w.center,zoom:$e,bearing:p,pitch:_}}_extendAABB(t,r,u,p){const _=.5*((u.padding.left||0)+(u.padding.right||0)),v=.5*((u.padding.top||0)+(u.padding.bottom||0)),w=v,A=_,D=_,L=v,k=r.width-(A+D),O=r.height-(w+L),N=o.at([],t.max,t.min),Z=Math.min(k/N[0],O/N[1]),j=Math.min(r.scaleZoom(r.scale*Z),u.maxZoom);if(isNaN(j))return null;const X=r.scale/r.zoomScale(j),Y=new o.cW([t.min[0]-A*X,t.min[1]-L*X,t.min[2]],[t.max[0]+D*X,t.max[1]+w*X,t.max[2]]),J=(typeof u.offset.x=="number"&&typeof u.offset.y=="number"?new o.P(u.offset.x,u.offset.y):o.P.convert(u.offset)).rotate(-o.al(p));return Y.center[0]-=J.x*X,Y.center[1]+=J.y*X,Y}queryTerrainElevation(t,r){const u=this.transform.elevation;return u?(r=o.h({},{exaggerated:!0},r),u.getAtPoint(o.ac.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,u,p,_,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,r,u,p,_,v);const w=t.clone(),A=this._extendCameraOptions(v);w.bearing=p,w.pitch=_;const D=o.cd.convert(r),L=o.cd.convert(u),k=new o.cd(D.lng,L.lat),O=new o.cd(L.lng,D.lat),N=w.project(D),Z=w.project(L),j=this.queryTerrainElevation(D),X=this.queryTerrainElevation(L),Y=this.queryTerrainElevation(k),J=this.queryTerrainElevation(O),oe=[[N.x,N.y,Math.min(j||0,X||0,Y||0,J||0)],[Z.x,Z.y,Math.max(j||0,X||0,Y||0,J||0)]];let ce=o.cW.fromPoints(oe);const ye=w.getWorldToCameraMatrix(),fe=o.bi(new Float64Array(16),ye);ce=o.cW.applyTransform(ce,ye);const de=this._extendAABB(ce,w,A,p);if(!de)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=de;const he=.5*o.at([],ce.max,ce.min)[2],_e=this._minimumAABBFrustumDistance(w,ce),be=[0,0,1,0];o.aA(be,be,ye),o.eG(be,be);const De=o.bY([],be,_e+he),ze=o.cV([],ce.center,De);o.ad(ce.center,ce.center,fe),o.ad(ze,ze,fe);const qe=w.unproject(new o.P(ce.center[0],ce.center[1])),We=o.eH(w.projection,qe),rt=Math.pow(2,We),Ie=Math.min(w._zoomFromMercatorZ(ze[2]*w.pixelsPerMeter*rt/w.worldSize),A.maxZoom);return w.mercatorFromTransition&&Ie<.5*(o.cL+o.cx)?(w.setProjection({name:"globe"}),w.zoom=Ie,this._cameraForBounds(w,r,u,p,_,v)):{center:qe,zoom:Ie,bearing:p,pitch:_}}fitBounds(t,r,u){const p=this.cameraForBounds(t,r);return this._fitInternal(p,r,u)}fitScreenCoordinates(t,r,u,p,_){const v=o.P.convert(t),w=o.P.convert(r),A=new o.P(Math.min(v.x,w.x),Math.min(v.y,w.y)),D=new o.P(Math.max(v.x,w.x),Math.max(v.y,w.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,w))return this;const L=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(D),O=this.transform.pointLocation3D(new o.P(A.x,D.y)),N=this.transform.pointLocation3D(new o.P(D.x,A.y)),Z=[Math.min(L.lng,k.lng,O.lng,N.lng),Math.min(L.lat,k.lat,O.lat,N.lat)],j=[Math.max(L.lng,k.lng,O.lng,N.lng),Math.max(L.lat,k.lat,O.lat,N.lat)],X=p&&p.pitch?p.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,Z,j,u,X,p);return this._fitInternal(Y,p,_)}_fitInternal(t,r,u){return t?(r=o.h(t,r)).linear?this.easeTo(r,u):this.flyTo(r,u):this}jumpTo(t,r){this.stop();const u=t.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,v=!1;"zoom"in t&&u.zoom!==+t.zoom&&(p=!0,u.zoom=+t.zoom),t.center!==void 0&&(u.center=o.cd.convert(t.center)),"bearing"in t&&u.bearing!==+t.bearing&&(_=!0,u.bearing=+t.bearing),"pitch"in t&&u.pitch!==+t.pitch&&(v=!0,u.pitch=+t.pitch);const w=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!u.isPaddingEqual(w))if(t.retainPadding===!1){const A=u.clone();A.padding=w,u.setLocationAtPoint(u.center,A.centerPoint)}else u.padding=w;return t.preloadOnly?(this._preloadTiles(u),this):(this.fire(new o.A("movestart",r)).fire(new o.A("move",r)),p&&this.fire(new o.A("zoomstart",r)).fire(new o.A("zoom",r)).fire(new o.A("zoomend",r)),_&&this.fire(new o.A("rotatestart",r)).fire(new o.A("rotate",r)).fire(new o.A("rotateend",r)),v&&this.fire(new o.A("pitchstart",r)).fire(new o.A("pitch",r)).fire(new o.A("pitchend",r)),this.fire(new o.A("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(pf),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const u=this.transform;if(!u.projection.supportsFreeCamera)return o.w(pf),this;this.stop();const p=u.zoom,_=u.pitch,v=u.bearing;u.setFreeCameraOptions(t);const w=p!==u.zoom,A=_!==u.pitch,D=v!==u.bearing;return this.fire(new o.A("movestart",r)).fire(new o.A("move",r)),w&&this.fire(new o.A("zoomstart",r)).fire(new o.A("zoom",r)).fire(new o.A("zoomend",r)),D&&this.fire(new o.A("rotatestart",r)).fire(new o.A("rotate",r)).fire(new o.A("rotateend",r)),A&&this.fire(new o.A("pitchstart",r)).fire(new o.A("pitch",r)).fire(new o.A("pitchend",r)),this.fire(new o.A("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),((t=o.h({offset:[0,0],duration:500,easing:o.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const u=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),w=this.getPadding(),A="zoom"in t?+t.zoom:p,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),O=o.P.convert(t.offset);let N,Z,j;if(u.projection.name==="globe"){const be=o.ac.fromLngLat(u.center),De=O.rotate(-u.angle);be.x+=De.x/u.worldSize,be.y+=De.y/u.worldSize;const ze=be.toLngLat(),qe=o.cd.convert(t.center||ze);this._normalizeCenter(qe),N=u.centerPoint.add(De),Z=new o.P(be.x,be.y).mult(u.worldSize),j=new o.P(o.aD(qe.lng),o.aH(qe.lat)).mult(u.worldSize).sub(Z)}else{N=u.centerPoint.add(O);const be=u.pointLocation(N),De=o.cd.convert(t.center||be);this._normalizeCenter(De),Z=u.project(be),j=u.project(De).sub(Z)}const X=u.zoomScale(A-p);let Y,J;t.around&&(Y=o.cd.convert(t.around),J=u.locationPoint(Y));const oe=this._zooming||A!==p,ce=this._rotating||_!==D,ye=this._pitching||L!==v,fe=!u.isPaddingEqual(k),de=t.retainPadding===!1?u.clone():u,he=be=>De=>{if(oe&&(be.zoom=o.ai(p,A,De)),ce&&(be.bearing=o.ai(_,D,De)),ye&&(be.pitch=o.ai(v,L,De)),fe&&(de.interpolatePadding(w,k,De),N=de.centerPoint.add(O)),Y)be.setLocationAtPoint(Y,J);else{const ze=be.zoomScale(be.zoom-p),qe=A>p?Math.min(2,X):Math.max(.5,X),We=Math.pow(qe,1-De),rt=be.unproject(Z.add(j.mult(De*We)).mult(ze));be.setLocationAtPoint(be.renderWorldCopies?rt.wrap():rt,N)}return t.preloadOnly||this._fireMoveEvents(r),be};if(t.preloadOnly){const be=this._emulate(he,t.duration,u);return this._preloadTiles(be),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=oe,this._rotating=ce,this._pitching=ye,this._padding=fe,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,_e),this._ease(he(u),be=>{u.cameraElevationReference==="sea"&&u.recenterOnTerrain(),this._afterEase(r,be)},t),this}_prepareEase(t,r,u={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),r||u.moving||this.fire(new o.A("movestart",t)),this._zooming&&!u.zooming&&this.fire(new o.A("zoomstart",t)),this._rotating&&!u.rotating&&this.fire(new o.A("rotatestart",t)),this._pitching&&!u.pitching&&this.fire(new o.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.A("move",t)),this._zooming&&this.fire(new o.A("zoom",t)),this._rotating&&this.fire(new o.A("rotate",t)),this._pitching&&this.fire(new o.A("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const u=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,u&&this.fire(new o.A("zoomend",t)),p&&this.fire(new o.A("rotateend",t)),_&&this.fire(new o.A("pitchend",t)),this.fire(new o.A("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const Fe=o.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Fe,r)}this.stop(),t=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.ey},t);const u=this.transform,p=this.getZoom(),_=this.getBearing(),v=this.getPitch(),w=this.getPadding(),A="zoom"in t?o.ay(+t.zoom,u.minZoom,u.maxZoom):p,D="bearing"in t?this._normalizeBearing(t.bearing,_):_,L="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),O=u.zoomScale(A-p),N=o.P.convert(t.offset);let Z=u.centerPoint.add(N);const j=u.pointLocation(Z),X=o.cd.convert(t.center||j);this._normalizeCenter(X);const Y=u.project(j),J=u.project(X).sub(Y);let oe=t.curve;const ce=Math.max(u.width,u.height),ye=ce/O,fe=J.mag();if("minZoom"in t){const Fe=o.ay(Math.min(t.minZoom,p,A),u.minZoom,u.maxZoom),tt=ce/u.zoomScale(Fe-p);oe=Math.sqrt(tt/fe*2)}const de=oe*oe;function he(Fe){const tt=(ye*ye-ce*ce+(Fe?-1:1)*de*de*fe*fe)/(2*(Fe?ye:ce)*de*fe);return Math.log(Math.sqrt(tt*tt+1)-tt)}function _e(Fe){return(Math.exp(Fe)-Math.exp(-Fe))/2}function be(Fe){return(Math.exp(Fe)+Math.exp(-Fe))/2}const De=he(0);let ze=function(Fe){return be(De)/be(De+oe*Fe)},qe=function(Fe){return ce*((be(De)*(_e(tt=De+oe*Fe)/be(tt))-_e(De))/de)/fe;var tt},We=(he(1)-De)/oe;if(Math.abs(fe)<1e-6||!isFinite(We)){if(Math.abs(ce-ye)<1e-6)return this.easeTo(t,r);const Fe=ye<ce?-1:1;We=Math.abs(Math.log(ye/ce))/oe,qe=function(){return 0},ze=function(tt){return Math.exp(Fe*oe*tt)}}t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/oe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const rt=_!==D,Ie=L!==v,Ue=!u.isPaddingEqual(k),Ee=t.retainPadding===!1?u.clone():u,$e=Fe=>tt=>{const gt=tt*We,Ye=1/ze(gt);Fe.zoom=tt===1?A:p+Fe.scaleZoom(Ye),rt&&(Fe.bearing=o.ai(_,D,tt)),Ie&&(Fe.pitch=o.ai(v,L,tt)),Ue&&(Ee.interpolatePadding(w,k,tt),Z=Ee.centerPoint.add(N));const ht=tt===1?X:Fe.unproject(Y.add(J.mult(qe(gt))).mult(Ye));return Fe.setLocationAtPoint(Fe.renderWorldCopies?ht.wrap():ht,Z),Fe._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),Fe};if(t.preloadOnly){const Fe=this._emulate($e,t.duration,u);return this._preloadTiles(Fe),this}return this._zooming=!0,this._rotating=rt,this._pitching=Ie,this._padding=Ue,this._prepareEase(r,!1),this._ease($e(u),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,r){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const u=this._onEaseEnd;this._onEaseEnd=void 0,u.call(this,r)}if(!t){const u=this.handlers;u&&u.stop(!1)}return this}_ease(t,r,u){u.animate===!1||u.duration===0?(t(1),r()):(this._easeStart=o.q.now(),this._easeOptions=u,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=o.bX(t,-180,180);const u=Math.abs(t-r);return Math.abs(t-360-r)<u&&(t-=360),Math.abs(t+360-r)<u&&(t+=360),t}_normalizeCenter(t){const r=this.transform;if(r.maxBounds||r.projection.name!=="globe"&&!r.renderWorldCopies)return;const u=t.lng-r.center.lng;t.lng+=u>180?-360:u<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,r,u){const p=Math.ceil(15*r/1e3),_=[],v=t(u.clone());for(let w=0;w<=p;w++){const A=v(w/p);_.push(A.clone())}return _}_preloadTiles(t,r){}}class cd{constructor(t={}){this.options=t,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const r=this.options&&this.options.compact,u=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Yt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Yt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",u);const p=Yt("span","mapboxgl-ctrl-icon",this._compactButton);return p.setAttribute("aria-hidden","true"),p.setAttribute("title",u),this._innerContainer=Yt("div","mapboxgl-ctrl-attrib-inner",this._container),r&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),r===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const u=r.reduce((p,_,v)=>(_.value&&(p+=`${_.key}=${_.value}${v<r.length-1?"&":""}`),p),"?");t.href=`${o.e.FEEDBACK_URL}/${u}#${rd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const r=this._map.style._mergedSourceCaches;for(const p in r){const _=r[p];if(_.used){const v=_.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((p,_)=>p.length-_.length),t=t.filter((p,_)=>{for(let v=_+1;v<t.length;v++)if(t[v].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const u=t.join(" | ");u!==this._attribHTML&&(this._attribHTML=u,t.length?(this._innerContainer.innerHTML=u,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ud{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Yt("div","mapboxgl-ctrl");const r=Yt("a","mapboxgl-ctrl-logo");return r.target="_blank",r.rel="noopener nofollow",r.href="https://www.mapbox.com/",r.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),r.setAttribute("rel","noopener nofollow"),this._container.appendChild(r),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const r in t){const u=t[r].getSource();if(u.hasOwnProperty("mapbox_logo")&&!u.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const r=t[0];this._map.getCanvasContainer().offsetWidth<250?r.classList.add("mapboxgl-compact"):r.classList.remove("mapboxgl-compact")}}}class nu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const r=++this._id;return this._queue.push({callback:t,id:r,cancelled:!1}),r}remove(t){const r=this._currentlyRunning,u=r?this._queue.concat(r):this._queue;for(const p of u)if(p.id===t)return void(p.cancelled=!0)}run(t=0){const r=this._currentlyRunning=this._queue;this._queue=[];for(const u of r)if(!u.cancelled&&(u.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Xa{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=o.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,r,u){this._start=this.getValue(r),this._end=t,this._startTime=r,this._endTime=r+u}}const jo={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class _r extends o.A{constructor(t,r,u,p){const{point:_,lngLat:v,originalEvent:w,target:A}=t;super(t.type,{point:_,lngLat:v,originalEvent:w,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=r,this.interaction=u,this.feature=p}}class Wa{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const u=r.filter;let p=r.type;u&&this.filters.set(t,o.b3(u)),p==="mouseover"&&(p="mouseenter"),p==="mouseout"&&(p="mouseleave");const _=this.interactionsByType.get(p)||new Map;p==="mouseenter"||p==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):_.size===0&&this.map.on(p,this.handleType),_.size===0&&this.interactionsByType.set(p,_),_.set(t,r),this.typeById.set(t,p)}get(t){const r=this.typeById.get(t);if(!r)return;const u=this.interactionsByType.get(r);return u?u.get(t):void 0}remove(t){const r=this.typeById.get(t);if(!r)return;this.typeById.delete(t),this.filters.delete(t);const u=this.interactionsByType.get(r);u&&(u.delete(t),r==="mouseenter"||r==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):u.size===0&&this.map.off(r,this.handleType))}queryTargets(t,r){const u=[];for(const[p,_]of r)_.target&&u.push({targetId:p,target:_.target,filter:this.filters.get(p)});return this.map.style.queryRenderedTargets(t,u,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const r=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());r.length&&(t.type="mouseenter",this.handleType(t,r));const u=new Map;for(const[p,{feature:_}]of this.prevHoveredFeatures)this.hoveredFeatures.has(p)||u.set(_.id,_);u.size&&(t.type="mouseleave",this.handleType(t,Array.from(u.values())))}handleOut(t){const r=Array.from(this.hoveredFeatures.values()).map(({feature:u})=>u);r.length&&(t.type="mouseleave",this.handleType(t,r)),this.hoveredFeatures.clear()}handleType(t,r){const u=t.type==="mouseenter";if(u&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const p=Array.from(this.interactionsByType.get(t.type)).reverse(),_=!!r;r=r||this.queryTargets(t.point,p);let v=!1;const w=new Set;for(const A of r){for(const[D,L]of p){if(!L.target)continue;const k=A.variants?A.variants[D]:null;if(k){for(const O of k){if(Ah(O,A,w,D))continue;const N=new o.de(A,O),Z=jl(O,A,D);_&&(N.state=this.map.getFeatureState(N));const j=u?this.prevHoveredFeatures.get(Z):null,X=new _r(t,D,L,N),Y=j?j.stop:L.handler(X);if(u&&this.hoveredFeatures.set(Z,{feature:A,stop:Y}),Y!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[A,D]of p){const{handler:L,target:k}=D;if(!k&&L(new _r(t,A,D,null))!==!1)break}}}function lh(c,t){if(Array.isArray(c)&&Array.isArray(t)){const r=new Set(c),u=new Set(t);return r.size===u.size&&c.every(p=>u.has(p))}return o.bv(c,t)}const Go={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Sp={showCompass:!0,showZoom:!0,visualizePitch:!1};class mf{constructor(t,r,u=!1){this._clickTolerance=10,this.element=r,this.mouseRotate=new qa({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,u&&(this.mousePitch=new Za({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(t,r){this.mouseRotate.mousedown(t,r),this.mousePitch&&this.mousePitch.mousedown(t,r),Nr()}move(t,r){const u=this.map,p=this.mouseRotate.mousemoveWindow(t,r),_=p&&p.bearingDelta;if(_&&u.setBearing(u.getBearing()+_),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,r),w=v&&v.pitchDelta;w&&u.setPitch(u.getPitch()+w)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){_n(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(o.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Kr(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Kr(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ns(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=ns(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function $a(c,t,r){if(c=new o.cd(c.lng,c.lat),t){const u=new o.cd(c.lng-360,c.lat),p=new o.cd(c.lng+360,c.lat),_=360*Math.ceil(Math.abs(c.lng-r.center.lng)/360),v=r.locationPoint3D(c).distSqr(t),w=t.x<0||t.y<0||t.x>r.width||t.y>r.height;r.locationPoint3D(u).distSqr(t)<v&&(w||Math.abs(u.lng-r.center.lng)<_)?c=u:r.locationPoint3D(p).distSqr(t)<v&&(w||Math.abs(p.lng-r.center.lng)<_)&&(c=p)}for(;Math.abs(c.lng-r.center.lng)>180;){const u=r.locationPoint3D(c);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;c.lng>r.center.lng?c.lng-=360:c.lng+=360}return c}const Mr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ya={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class hd extends o.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=o.h({element:t},r)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:u="center",color:p="#3FB1CE",scale:_=1,draggable:v=!1,clickTolerance:w=0,rotation:A=Ya.rotation,rotationAlignment:D=Ya.rotationAlignment,pitchAlignment:L=Ya.pitchAlignment,occludedOpacity:k=Ya.occludedOpacity,altitude:O=Ya.altitude}=t||{};this._anchor=u,this._color=p,this._scale=_,this._draggable=v,this._clickTolerance=w,this._rotation=A,this._rotationAlignment=D,this._pitchAlignment=L,this._occludedOpacity=k,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",j=>{j.preventDefault()}),this._element.addEventListener("mousedown",j=>{j.preventDefault()});const N=this._element.classList;for(const j in Mr)N.remove(`mapboxgl-marker-anchor-${j}`);N.add(`mapboxgl-marker-anchor-${this._anchor}`);const Z=t&&t.className?t.className.trim().split(/\s+/):[];N.add(...Z),this._popup=null}_createDefaultMarker(){const t=Yt("div"),r=Qi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const u=Qi("radialGradient",{id:"shadowGradient"},Qi("defs",{},r));Qi("stop",{offset:"10%","stop-opacity":.4},u),Qi("stop",{offset:"100%","stop-opacity":.05},u),Qi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},r)}return Qi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},r),Qi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},r),Qi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},r),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Ya.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const r=t.code,u=t.charCode||t.keyCode;r!=="Space"&&r!=="Enter"&&u!==32&&u!==13||this.togglePopup()}_onMapClick(t){const r=t.originalEvent.target,u=this._element;this._popup&&(r===u||u.contains(r))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,r=this._pos;if(!t||!r)return!1;const u=t.unproject(r,this._altitude),p=t.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(u)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const u=t.unproject(r,this._altitude);let p;t._showingGlobe()&&o.eK(t.transform,this._lngLat)?p=0:(p=1-t._queryFogOpacity(u),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const r=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${Mr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${r.x}px,${r.y}px)
        `}_calculateXYTransform(){const t=this._pos,r=this._map,u=this.getPitchAlignment();if(!r||!t||u!=="map")return"";if(!r._showingGlobe()){const A=r.getPitch();return A?`rotateX(${A}deg)`:""}const p=o.cJ(o.eL(r.transform,this._lngLat)),_=t.sub(o.eM(r.transform)),v=Math.abs(_.x)+Math.abs(_.y);if(v===0)return"";const w=p/v;return`rotateX(${-_.y*w}deg) rotateY(${_.x*w}deg)`}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let u=0;const p=this.getRotationAlignment();if(p==="map")if(r._showingGlobe()){const _=r.project(new o.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=r.project(new o.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(_);u=o.cJ(Math.atan2(v.y,v.x))-90}else u=-r.getBearing();else if(p==="horizon"){const _=o.af(4,6,r.getZoom()),v=o.eM(r.transform);v.y+=_*r.transform.height;const w=t.sub(v),A=o.cJ(Math.atan2(w.y,w.x));u=(A>90?A-270:A+90)*(1-_)}return u+=this._rotation,u?`rotateZ(${u}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const r=this._map;r&&(r.transform.renderWorldCopies&&(this._lngLat=$a(this._lngLat,this._pos,r.transform)),this._pos=r.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),r._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(r._showingGlobe()||r.getTerrain()||r.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const r=this._map;if(!r)return;const u=this._pointerdownPos,p=this._positionDelta;if(u&&p){if(!this._isDragging){const _=this._clickTolerance||r._clickTolerance;if(t.point.dist(u)<_)return;this._isDragging=!0}this._pos=t.point.sub(p),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(t){const r=this._map,u=this._pos;r&&u&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(u),this._pointerdownPos=t.point,this._state="pending",r.on("mousemove",this._onMove),r.on("touchmove",this._onMove),r.once("mouseup",this._onUp),r.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const r=this._map;return r&&(t?(r.on("mousedown",this._addDragHandler),r.on("touchstart",this._addDragHandler)):(r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Ya.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Ya.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Ya.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Ya.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const _f={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Dl={maxWidth:100,unit:"metric"},Eo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ka={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Ho=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ns(c=new o.P(0,0),t="bottom"){if(typeof c=="number"){const r=Math.round(Math.sqrt(.5*Math.pow(c,2)));switch(t){case"top":return new o.P(0,c);case"top-left":return new o.P(r,r);case"top-right":return new o.P(-r,r);case"bottom":return new o.P(0,-c);case"bottom-left":return new o.P(r,-r);case"bottom-right":return new o.P(-r,-r);case"left":return new o.P(c,0);case"right":return new o.P(-c,0)}return new o.P(0,0)}return c instanceof o.P||Array.isArray(c)?o.P.convert(c):o.P.convert(c[t]||[0,0])}return{version:xe,supported:pi.supported,setRTLTextPlugin:o.eQ,getRTLTextPluginStatus:o.eP,Map:class extends mc{constructor(c){Ke.mark(pe.create);const t=c;if((c=o.h({},Go,c)).minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(c.antialias&&o.eI(window)&&(c.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xf(c.minZoom,c.maxZoom,c.minPitch,c.maxPitch,c.renderWorldCopies,null,null),c),this._repaint=!!c.repaint,this._interactive=c.interactive,this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._failIfMajorPerformanceCaveat=c.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=c.preserveDrawingBuffer,this._antialias=c.antialias,this._trackResize=c.trackResize,this._bearingSnap=c.bearingSnap,this._refreshExpiredTiles=c.refreshExpiredTiles,this._fadeDuration=c.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=c.crossSourceCollisions,this._collectResourceTiming=c.collectResourceTiming,this._language=this._parseLanguage(c.language),this._worldview=c.worldview,this._renderTaskQueue=new nu,this._domRenderTaskQueue=new nu,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},jo,c.locale),this._clickTolerance=c.clickTolerance,this._cooperativeGestures=c.cooperativeGestures,this._performanceMetricsCollection=c.performanceMetricsCollection,this._tessellationStep=c.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=c.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Xa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=c.scaleFactor,this._requestManager=new rn(c.transformRequest,c.accessToken,c.testMode),this._silenceAuthErrors=!!c.testMode,this._contextCreateOptions=c.contextCreateOptions?Object.assign({},c.contextCreateOptions):{},typeof c.container=="string"){const r=document.getElementById(c.container);if(!r)throw new Error(`Container '${c.container.toString()}' not found.`);this._container=r}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),c.maxBounds&&this.setMaxBounds(c.maxBounds),this._spriteFormat=c.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new nf),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ff(this,c),this._localFontFamily=c.localFontFamily,this._localIdeographFontFamily=c.localIdeographFontFamily,(c.style||!c.testMode)&&this.setStyle(c.style||o.e.DEFAULT_STYLE,{config:c.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),c.projection&&this.setProjection(c.projection),this.indoor=new Yf(this),c.hash&&(this._hash=new sf(typeof c.hash=="string"&&c.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch});const r=c.bounds;r&&(this.resize(),this.fitBounds(r,o.h({},c.fitBoundsOptions,{duration:0})))}this.resize(),c.attributionControl&&this.addControl(new cd({customAttribution:c.customAttribution})),this._logoControl=new ud,this.addControl(this._logoControl,c.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new o.A(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new o.A(`${r.dataType}dataloading`,r))}),this._interactions=new Wa(this)}_getMapId(){return this._mapId}addControl(c,t){if(t===void 0&&(t=c.getDefaultPosition?c.getDefaultPosition():"top-right"),!c||!c.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=c.onAdd(this);this._controls.push(c);const u=this._controlPositions[t];return t.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this}removeControl(c){if(!c||!c.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(c);return t>-1&&this._controls.splice(t,1),c.onRemove(this),this}hasControl(c){return this._controls.indexOf(c)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(c){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.A("movestart",c)).fire(new o.A("move",c)),this.fire(new o.A("resize",c)),t&&this.fire(new o.A("moveend",c)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(c){return this.transform.setMaxBounds(o.aG.convert(c)),this._update()}setMinZoom(c){if((c=c??-2)>=-2&&c<=this.transform.maxZoom)return this.transform.minZoom=c,this._update(),this.getZoom()<c?this.setZoom(c):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(c){if((c=c??22)>=this.transform.minZoom)return this.transform.maxZoom=c,this._update(),this.getZoom()>c?this.setZoom(c):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(c){if((c=c??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(c>=0&&c<=this.transform.maxPitch)return this.transform.minPitch=c,this._update(),this.getPitch()<c?this.setPitch(c):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(c){if((c=c??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(c>=this.transform.minPitch)return this.transform.maxPitch=c,this._update(),this.getPitch()>c?this.setPitch(c):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(c){return this._scaleFactor=c,this.painter.scaleFactor=c,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(c){return this.transform.renderWorldCopies=c,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(c){return c==="auto"?navigator.language:Array.isArray(c)?c.length===0?void 0:c.map(t=>t==="auto"?navigator.language:t):c}setLanguage(c){const t=this._parseLanguage(c);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(c){return this.style&&c!==this._worldview?(this._worldview=c,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(c){return this._lazyInitEmptyStyle(),c?typeof c=="string"&&(c={name:c}):c=null,this._useExplicitProjection=!!c,this._prioritizeAndUpdateProjection(c,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const c=this.transform,t=c.projection.name;let r;t==="globe"&&c.zoom>=o.cx?(c.setMercatorFromTransition(),r=!0):t==="mercator"&&c.zoom<o.cx&&(c.setProjection({name:"globe"}),r=!0),r&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(c,t){return this._updateProjection(c||t||{name:"mercator"})}_updateProjection(c){let t;return t=c.name==="globe"&&this.transform.zoom>=o.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(c),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(c,t){return this.transform.locationPoint3D(o.cd.convert(c),t)}unproject(c,t){return this.transform.pointLocation3D(o.P.convert(c),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(c,t,r){const u=p=>{let _=[];if(Array.isArray(t)){const v=t.filter(w=>this.getLayer(w));_=v.length?this.queryRenderedFeatures(p,{layers:v}):[]}else _=this.queryRenderedFeatures(p,{target:t});return _};if(c==="mouseenter"||c==="mouseover"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:v=>{const w=u(v.point);w.length?p||(p=!0,r.call(this,new zr(c,this,v.originalEvent,{features:w}))):p=!1},mouseout:()=>{p=!1}}}}if(c==="mouseleave"||c==="mouseout"){let p=!1;return{listener:r,targets:t,delegates:{mousemove:w=>{u(w.point).length?p=!0:p&&(p=!1,r.call(this,new zr(c,this,w.originalEvent)))},mouseout:w=>{p&&(p=!1,r.call(this,new zr(c,this,w.originalEvent)))}}}}{const p=_=>{const v=u(_.point);v.length&&(_.features=v,r.call(this,_),delete _.features)};return{listener:r,targets:t,delegates:{[c]:p}}}}on(c,t,r){if(typeof t=="function"||r===void 0)return super.on(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[c]=this._delegatedListeners[c]||[],this._delegatedListeners[c].push(u);for(const p in u.delegates)this.on(p,u.delegates[p]);return this}once(c,t,r){if(typeof t=="function"||r===void 0)return super.once(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._createDelegatedListener(c,t,r);for(const p in u.delegates)this.once(p,u.delegates[p]);return this}off(c,t,r){if(typeof t=="function"||r===void 0)return super.off(c,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const u=this._delegatedListeners?this._delegatedListeners[c]:void 0;return u&&(p=>{for(let _=0;_<p.length;_++){const v=p[_];if(v.listener===r&&lh(v.targets,t)){for(const w in v.delegates)this.off(w,v.delegates[w]);return p.splice(_,1),this}}})(u),this}queryRenderedFeatures(c,t){if(!this.style)return[];if(c===void 0||c instanceof o.P||Array.isArray(c)||t!==void 0||(t=c,c=void 0),c=c||[[0,0],[this.transform.width,this.transform.height]],!t){const _=this.style.queryRenderedFeatures(c,void 0,this.transform),v=this.style.queryRenderedFeatureset(c,void 0,this.transform);return _.concat(v)}let r=!0;if(t.target&&(r=this._isTargetValid(t.target),r&&!t.layers))return this.style.queryRenderedFeatureset(c,t,this.transform);let u=!0;if(t.layers&&Array.isArray(t.layers)){for(const _ of t.layers)if(!this._isValidId(_)){u=!1;break}if(u&&!t.target)return this.style.queryRenderedFeatures(c,t,this.transform)}let p=[];return u&&(p=p.concat(this.style.queryRenderedFeatures(c,t,this.transform))),r&&(p=p.concat(this.style.queryRenderedFeatureset(c,t,this.transform))),p}querySourceFeatures(c,t){return!c||typeof c=="string"&&!this._isValidId(c)?[]:this.style.querySourceFeatures(c,t)}isPointOnSurface(c){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(c))}addInteraction(c,t){return this._interactions.add(c,t),this}removeInteraction(c){return this._interactions.remove(c),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(c){return this._cooperativeGestures=c,this}setStyle(c,t){return t=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&c&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(c,(r,u)=>{if(r){const p=typeof r=="string"?r:r instanceof Error?r.message:r.error;o.w(`Unable to perform style diff: ${p}. Rebuilding the style from scratch.`),this._updateStyle(c,t)}else u&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(c,t))}_getUIString(c){const t=this._locale[c];if(t==null)throw new Error(`Missing UI string '${c}'`);return t}_updateStyle(c,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),c){const r=o.h({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new hs(this,r).load(c),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new hs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(c){return c==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.d8(c)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${c}".`))),!1)}_isTargetValid(c){return"featuresetId"in c?this._isValidId("importId"in c?c.importId:c.featuresetId):"layerId"in c&&this._isValidId(c.layerId)}_areTargetsValid(c){if(Array.isArray(c)){for(const t of c)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(c)}addSource(c,t){return this._isValidId(c)?(this._lazyInitEmptyStyle(),this.style.addSource(c,t),this._update(!0)):this}isSourceLoaded(c){return!!this._isValidId(c)&&!!this.style&&this.style._isSourceCacheLoaded(c)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(c,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(c,t,r)}removeSource(c){return this._isValidId(c)?(this.style.removeSource(c),this._updateTerrain(),this._update(!0)):this}getSource(c){return this._isValidId(c)?this.style.getOwnSource(c):null}addImage(c,t,{pixelRatio:r=1,sdf:u=!1,stretchX:p,stretchY:_,content:v}={}){this._lazyInitEmptyStyle();const w=o.I.from(c);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:D,data:L}=o.q.getImageData(t);this.style.addImage(w,{data:new o.r({width:A,height:D},L),pixelRatio:r,stretchX:p,stretchY:_,content:v,sdf:u,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:D}=t,L=t;this.style.addImage(w,{data:new o.r({width:A,height:D},new Uint8Array(L.data)),pixelRatio:r,stretchX:p,stretchY:_,content:v,sdf:u,usvg:!1,version:0,userImage:L}),L.onAdd&&L.onAdd(this,c)}}updateImage(c,t){this._lazyInitEmptyStyle();const r=o.I.from(c),u=this.style.getImage(r);if(!u)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.q.getImageData(t):t,{width:_,height:v,data:w}=p;if(_===void 0||v===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(_!==(u.usvg?u.icon.usvg_tree.width:u.data.width)||v!==(u.usvg?u.icon.usvg_tree.height:u.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${_}, ${v})
                must be that same as the previous version of the image
                (${u.data.width}, ${u.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let D=!1;u.usvg?(u.data=new o.r({width:_,height:v},new Uint8Array(w)),u.usvg=!1,u.icon=void 0,D=!0):u.data.replace(w,A),this.style.updateImage(r,u,D)}hasImage(c){return c?!!this.style&&!!this.style.getImage(o.I.from(c)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(c){this.style.removeImage(o.I.from(c))}loadImage(c,t){o.o(this._requestManager.transformRequest(c,o.R.Image),(r,u)=>{t(r,u instanceof HTMLImageElement?o.q.getImageData(u):u)})}listImages(){return this.style.listImages().map(c=>c.name)}addModel(c,t){this._lazyInitEmptyStyle(),this.style.addModel(c,t)}hasModel(c){return c?this.style.hasModel(c):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(c){this.style.removeModel(c)}listModels(){return this.style.listModels()}addLayer(c,t){return this._isValidId(c.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(c,t),this._update(!0)):this}getSlot(c){const t=this.getLayer(c);return t&&t.slot||null}setSlot(c,t){return this.style.setSlot(c,t),this.style.mergeLayers(),this._update(!0)}addImport(c,t){return this.style.addImport(c,t).catch(r=>this.fire(new o.z(new Error("Failed to add import",r)))),this}updateImport(c,t){return typeof t!="string"&&t.id!==c?(this.removeImport(c),this.addImport(t)):(this.style.updateImport(c,t),this._update(!0))}removeImport(c){return this.style.removeImport(c),this}moveImport(c,t){return this.style.moveImport(c,t),this._update(!0)}moveLayer(c,t){return this._isValidId(c)?(this.style.moveLayer(c,t),this._update(!0)):this}removeLayer(c){return this._isValidId(c)?(this.style.removeLayer(c),this._update(!0)):this}getLayer(c){if(!this._isValidId(c))return null;const t=this.style.getOwnLayer(c);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(c,t,r){return this._isValidId(c)?(this.style.setLayerZoomRange(c,t,r),this._update(!0)):this}setFilter(c,t,r={}){return this._isValidId(c)?(this.style.setFilter(c,t,r),this._update(!0)):this}getFilter(c){return this._isValidId(c)?this.style.getFilter(c):null}setPaintProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setPaintProperty(c,t,r,u),this._update(!0)):this}getPaintProperty(c,t){return this._isValidId(c)?this.style.getPaintProperty(c,t):null}setLayoutProperty(c,t,r,u={}){return this._isValidId(c)?(this.style.setLayoutProperty(c,t,r,u),this._update(!0)):this}getLayoutProperty(c,t){return this._isValidId(c)?this.style.getLayoutProperty(c,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(c){return this.style.setGlyphsUrl(c),this._update(!0)}getSchema(c){return this.style.getSchema(c)}setSchema(c,t){return this.style.setSchema(c,t),this._update(!0)}getConfig(c){return this.style.getConfig(c)}setConfig(c,t){return this.style.setConfig(c,t),this._update(!0)}getConfigProperty(c,t){return this.style.getConfigProperty(c,t)}setConfigProperty(c,t,r){return this.style.setConfigProperty(c,t,r),this._update(!0)}getFeaturesetDescriptors(c){return this.style.getFeaturesetDescriptors(c)}setLights(c){if(this._lazyInitEmptyStyle(),c&&c.length===1&&c[0].type==="flat"){const t=c[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(c),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const c=this.style.getLights()||[];return c.length===0&&c.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),c}setLight(c,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:c}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(c){return this._lazyInitEmptyStyle(),!c&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(c),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(c){return this._lazyInitEmptyStyle(),this.style.setFog(c),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(c){return this._lazyInitEmptyStyle(),this.style.setSnow(c),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(c){return this._lazyInitEmptyStyle(),this.style.setRain(c),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(c){return this._lazyInitEmptyStyle(),this.style.setColorTheme(c),this._update(!0)}setImportColorTheme(c,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(c,t),this._update(!0)}setCamera(c){return this.style.setCamera(c),this._triggerCameraUpdate(c)}_triggerCameraUpdate(c){return this._update(this.transform.setOrthographicProjectionAtLowPitch(c["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(c){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.cd.convert(c),this.transform):0}setFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.setFeatureState(c,t),this._update())}removeFeatureState(c,t){return c.source&&!this._isValidId(c.source)?this:(this.style.removeFeatureState(c,t),this._update())}getFeatureState(c){return c.source&&!this._isValidId(c.source)?null:this.style.getFeatureState(c)}_updateContainerDimensions(){if(!this._container)return;const c=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,u,p,_=this._container;for(;_&&(!u||!p);){const v=window.getComputedStyle(_).transform;v&&v!=="none"&&(r=v.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&r[0]!=="0"&&r[0]!=="1"&&(u=r[0]),r[3]&&r[3]!=="0"&&r[3]!=="1"&&(p=r[3])),_=_.parentElement}this._containerWidth=u?Math.abs(c/u):c,this._containerHeight=p?Math.abs(t/p):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const c=this._container;c.classList.add("mapboxgl-map"),(this._missingCSSCanary=Yt("div","mapboxgl-canary",c)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Yt("div","mapboxgl-canvas-container",c);this._canvas=Yt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=Yt("div","mapboxgl-control-container",c),u=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(p=>{u[p]=Yt("div",`mapboxgl-ctrl-${p}`,r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(c,t){const r=o.q.devicePixelRatio||1;this._canvas.width=r*Math.ceil(c),this._canvas.height=r*Math.ceil(t),this._canvas.style.width=`${c}px`,this._canvas.style.height=`${t}px`}_addMarker(c){this._markers.push(c)}_removeMarker(c){const t=this._markers.indexOf(c);t!==-1&&this._markers.splice(t,1)}_addPopup(c){this._popups.push(c)}_removePopup(c){const t=this._popups.indexOf(c);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const c=o.h({},pi.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",c);t?(_o(t,!0),this.painter=new Kc(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",r=>{r.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(t)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(c){c.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:c}))}_contextRestored(c){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:c}))}_onMapScroll(c){if(c.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(c){return this.style?(this._styleDirty=this._styleDirty||c,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(c){return this._update(),this._renderTaskQueue.add(c)}_cancelRenderFrame(c){this._renderTaskQueue.remove(c)}_requestDomTask(c){!this.loaded()||this.loaded()&&!this.isMoving()?c():this._domRenderTaskQueue.add(c)}_render(c){let t;this.fire(new o.A("renderstart")),++this._frameId;const r=this.painter.context.extTimerQuery,u=o.q.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=p.createQuery(),p.beginQuery(r.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(c),this._domRenderTaskQueue.run(c),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const D=this.transform.zoom,L=this.transform.pitch,k=o.q.now(),O=new o.aa(D,{now:k,fadeDuration:_,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(u),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(u);const w=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),w&&(this._placementDirty=w.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Ke.mark(pe.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const D=o.q.now()-u;p.endQuery(r.TIME_ELAPSED_EXT),setTimeout(()=>{const L=p.getQueryParameter(t,p.QUERY_RESULT)/1e6;p.deleteQuery(t),this.fire(new o.A("gpu-timing-frame",{cpuTime:D,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const D=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(D);this.fire(new o.A("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const D=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(D);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:L}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(A||this._repaint)this.triggerRepaint();else{const D=this.idle();if(D&&(v=this._updateAverageElevation(u,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),D&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,Ke.mark(pe.fullLoad),this._performanceMetricsCollection&&Hn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(c){for(const t of this._markers)c&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!c||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(c,t=!1){const r=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&r(0);const u=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(u||(t||c-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(c)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=c;const v=Math.abs(p-_);if(v>1){if(this._isInitialLoad||u)return this._averageElevation.jumpTo(_),r(_);this._averageElevation.easeTo(_,c,300)}else if(v>1e-4)return this._averageElevation.jumpTo(_),r(_)}return!!this._averageElevation.isEasing(c)&&r(this._averageElevation.getValue(c))}_authenticate(){Bl(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,c=>{if(c&&(c.message===Vr||c.status===401)){const t=this.painter.context.gl;_o(t,!1),this._logoControl instanceof ud&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),ki(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&yi(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const c=this._isDragging();this.painter.updateTerrain(this.style,c)}_calculateSpeedIndex(){const c=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,u=r.createFramebuffer();function p(_){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,_,0);const v=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,v),v}return r.bindFramebuffer(r.FRAMEBUFFER,u),this._canvasPixelComparison(p(c),t.canvasCopies.map(p),t.timeStamps)}_canvasPixelComparison(c,t,r){let u=r[1]-r[0];const p=c.length/4;for(let _=0;_<t.length;_++){const v=t[_];let w=0;for(let A=0;A<v.length;A+=4)v[A]===c[A]&&v[A+1]===c[A+1]&&v[A+2]===c[A+2]&&v[A+3]===c[A+3]&&(w+=1);u+=(r[_+2]-r[_+1])*(1-w/p)}return u}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const c=this.painter.context.gl.getExtension("WEBGL_lose_context");c&&c.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ao.delete(this.painter.context.gl),cn.remove(),di.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(c){this._renderNextFrame=this._renderNextFrame||c,this.style&&!this._frame&&(this._frame=o.q.frame(t=>{const r=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,r&&this._render(t)}))}_preloadTiles(c){const t=this.style?this.style.getSourceCaches():[];return o.bt(t,(r,u)=>r._preloadTiles(c,u),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(c){this._trackResize&&this.resize({originalEvent:c})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(c){this._showTileBoundaries!==c&&(this._showTileBoundaries=c,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(c){this._showParseStatus!==c&&(this._showParseStatus=c,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(c){this._showTerrainWireframe!==c&&(this._showTerrainWireframe=c,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(c){this._showLayers2DWireframe!==c&&(this._showLayers2DWireframe=c,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(c){this._showLayers3DWireframe!==c&&(this._showLayers3DWireframe=c,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(c){this._speedIndexTiming!==c&&(this._speedIndexTiming=c,this._update())}get showPadding(){return!!this._showPadding}set showPadding(c){this._showPadding!==c&&(this._showPadding=c,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(c){this._showCollisionBoxes!==c&&(this._showCollisionBoxes=c,this._tp.refreshUI(),c?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(c){this._showOverdrawInspector!==c&&(this._showOverdrawInspector=c,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(c){this._repaint!==c&&(this._repaint=c,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(c){this._vertices=c,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(c){this._showTileAABBs!==c&&(this._showTileAABBs=c,this._tp.refreshUI(),c&&this._update())}_setCacheLimits(c,t){o.eJ(c,t)}get version(){return xe}},NavigationControl:class{constructor(c={}){this.options=o.h({},Sp,c),this._container=Yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),Yt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),Yt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const r=this._map;r&&(this.options.visualizePitch?r.resetNorthPitch({},{originalEvent:t}):r.resetNorth({},{originalEvent:t}))}),this._compassIcon=Yt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const c=this._map;if(!c)return;const t=c.getZoom(),r=t===c.getMaxZoom(),u=t===c.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=u,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",u.toString())}_rotateCompassArrow(){const c=this._map;if(!c)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(c.transform.pitch*(Math.PI/180)),.5)}) rotateX(${c.transform.pitch}deg) rotateZ(${c.transform.angle*(180/Math.PI)}deg)`:`rotate(${c.transform.angle*(180/Math.PI)}deg)`;c._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(c){return this._map=c,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),c.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&c.on("pitch",this._rotateCompassArrow),c.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mf(c,this._compass,this.options.visualizePitch)),this._container}onRemove(){const c=this._map;c&&(this._container.remove(),this.options.showZoom&&c.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&c.off("pitch",this._rotateCompassArrow),c.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(c,t){const r=Yt("button",c,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(c,t){if(!this._map)return;const r=this._map._getUIString(`NavigationControl.${t}`);c.setAttribute("aria-label",r),c.firstElementChild&&c.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends o.E{constructor(c={}){super();const t=navigator.geolocation;this.options=o.h({geolocation:t},_f,c),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pa(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(c){return this._map=c,this._container=Yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(c){const t=(r=!!this.options.geolocation)=>{this._supportsGeolocation=r,c(r)};this._supportsGeolocation!==void 0?c(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(r=>t(r.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(c){const t=this._map.getMaxBounds(),r=c.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",c)),this._finish()}}_updateCamera(c){const t=new o.cd(c.coords.longitude,c.coords.latitude),r=c.coords.accuracy,u=this._map.getBearing(),p=o.h({bearing:u},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(r),p,{geolocateSource:!0})}_updateMarker(c){if(c){const t=new o.cd(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const c=this._map.transform,t=o.c6(1,c._center.lat)*c.worldSize,r=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${r}px`,this._circleElement.style.height=`${r}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",c)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(c){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=Yt("button","mapboxgl-ctrl-geolocate",this._container),Yt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",c===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Yt("div","mapboxgl-user-location"),this._dotElement.appendChild(Yt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Yt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new hd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Yt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new hd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(c){this._userLocationDotMarker&&(c.webkitCompassHeading?this._heading=c.webkitCompassHeading:c.absolute===!0&&(this._heading=-1*c.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(c={maximumAge:6e5,timeout:0},this._noTimeout=!0):(c=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,c),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const c=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&c()}).catch(console.error):c()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:cd,ScaleControl:class{constructor(c={}){this.options=o.h({},Dl,c),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const c=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,u=t._containerWidth/2-c/2,p=t.unproject([u,r]),_=t.unproject([u+c,r]),v=p.distanceTo(_);if(this.options.unit==="imperial"){const w=3.2808*v;w>5280?this._setScale(c,w/5280,"mile"):this._setScale(c,w,"foot")}else this.options.unit==="nautical"?this._setScale(c,v/1852,"nautical-mile"):v>=1e3?this._setScale(c,v/1e3,"kilometer"):this._setScale(c,v,"meter")}_setScale(c,t,r){this._map._requestDomTask(()=>{const u=function(_){const v=Math.pow(10,`${Math.floor(_)}`.length-1);let w=_/v;return w=w>=10?10:w>=5?5:w>=3?3:w>=2?2:w>=1?1:function(A){const D=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*D)/D}(w),v*w}(t),p=u/t;this._container.innerHTML=this._isNumberFormatSupported&&r!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(u):`${u}&nbsp;${Eo[r]}`,this._container.style.width=c*p+"px"})}onAdd(c){return this._map=c,this._language=c.getLanguage(),this._container=Yt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",c.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(c){this._language=c,this._update()}setUnit(c){this.options.unit=c,this._update()}},FullscreenControl:class{constructor(c={}){this._fullscreen=!1,c&&c.container&&(c.container instanceof HTMLElement?this._container=c.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(c){return this._map=c,this._container||(this._container=this._map.getContainer()),this._controlContainer=Yt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const c=this._fullscreenButton=Yt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Yt("span","mapboxgl-ctrl-icon",c).setAttribute("aria-hidden","true"),c.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const c=this._getTitle();this._fullscreenButton.setAttribute("aria-label",c),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",c)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(c){super(),this.options=o.h(Object.create(Ka),c),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(c&&c.className?c.className.trim().split(/\s+/):[])}addTo(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&c.on("preclick",this._onClose),this.options.closeOnMove&&c.on("move",this._onClose),c.on("remove",this.remove),this._update(),c._addPopup(this),this._focusFirstElement(),this._trackPointer?(c.on("mousemove",this._onMouseEvent),c.on("mouseup",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")):c.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const c=this._map;return c&&(c.off("move",this._update),c.off("move",this._onClose),c.off("preclick",this._onClose),c.off("click",this._onClose),c.off("remove",this.remove),c.off("mousemove",this._onMouseEvent),c.off("mouseup",this._onMouseEvent),c.off("drag",this._onMouseEvent),c._canvasContainer&&c._canvasContainer.classList.remove("mapboxgl-track-pointer"),c._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(c){this._lngLat=o.cd.convert(c),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(c){return this._altitude=c,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const c=this._map;return c&&(c.off("move",this._update),c.on("mousemove",this._onMouseEvent),c.on("drag",this._onMouseEvent),c._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(c){return this.setDOMContent(document.createTextNode(c))}setHTML(c){const t=document.createDocumentFragment(),r=document.createElement("body");let u;for(r.innerHTML=c;u=r.firstChild,u;)t.appendChild(u);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(c){return this.options.maxWidth=c,this._update(),this}setDOMContent(c){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Yt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(c),this.options.closeButton){const r=this._closeButton=Yt("button","mapboxgl-popup-close-button",t);r.type="button",r.setAttribute("aria-label","Close popup"),r.innerHTML='<span aria-hidden="true">&#215;</span>',r.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(c){return this._classList.add(c),this._updateClassList(),this}removeClassName(c){return this._classList.delete(c),this._updateClassList(),this}setOffset(c){return this.options.offset=c,this._update(),this}toggleClassName(c){let t;return this._classList.delete(c)?t=!1:(this._classList.add(c),t=!0),this._updateClassList(),t}_onMouseEvent(c){this._update(c.point)}_getAnchor(c){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,u=this._pos;if(!t||!r||!u)return"bottom";const p=r.offsetWidth,_=r.offsetHeight,v=u.x<p/2,w=u.x>t.transform.width-p/2;if(u.y+c<_)return v?"top-left":w?"top-right":"top";if(u.y>t.transform.height-_){if(v)return"bottom-left";if(w)return"bottom-right"}return v?"left":w?"right":"bottom"}_updateClassList(){const c=this._container;if(!c)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),c.className=t.join(" ")}_update(c){const t=this._map,r=this._content;if(!t||!this._lngLat&&!this._trackPointer||!r)return;let u=this._container;if(u||(u=this._container=Yt("div","mapboxgl-popup",t.getContainer()),this._tip=Yt("div","mapboxgl-popup-tip",u),u.appendChild(r)),this.options.maxWidth&&u.style.maxWidth!==this.options.maxWidth&&(u.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$a(this._lngLat,this._pos,t.transform)),!this._trackPointer||c){const p=this._pos=this._trackPointer&&c instanceof o.P?c:t.project(this._lngLat,this._altitude),_=Ns(this.options.offset),v=this._anchor=this._getAnchor(_.y),w=Ns(this.options.offset,v),A=p.add(w).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${Mr[v]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){const p=o.eK(t.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const c=this._container.querySelector(Ho);c&&c.focus()}_onClose(){this.remove()}_setOpacity(c){this._container&&(this._container.style.opacity=`${c}`),this._content&&(this._content.style.pointerEvents=c?"auto":"none")}},Marker:hd,Style:hs,LngLat:o.cd,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:Fd,Evented:o.E,config:o.e,prewarm:o.eO,clearPrewarmedResources:o.eN,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(c){o.e.ACCESS_TOKEN=c},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(c){o.e.API_URL=c},get workerCount(){return o.eX.workerCount},set workerCount(c){o.eX.workerCount=c},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(c){o.e.MAX_PARALLEL_IMAGE_REQUESTS=c},clearStorage(c){o.eW(c)},get workerUrl(){return o.eV.workerUrl},set workerUrl(c){o.eV.workerUrl=c},get workerClass(){return o.eV.workerClass},set workerClass(c){o.eV.workerClass=c},get workerParams(){return o.eV.workerParams},set workerParams(c){o.eV.workerParams=c},get dracoUrl(){return o.eU()},set dracoUrl(c){o.eT(c)},get meshoptUrl(){return o.eS()},set meshoptUrl(c){o.eR(c)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var Q=B;return Q})}(Ky)),Ky.exports}var BA=kA();const W0=px(BA),FA=()=>{};var Dw={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ET={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const si=function(E,m){if(!E)throw o_(m)},o_=function(E){return new Error("Firebase Database ("+ET.SDK_VERSION+") INTERNAL ASSERT FAILED: "+E)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT=function(E){const m=[];let T=0;for(let I=0;I<E.length;I++){let B=E.charCodeAt(I);B<128?m[T++]=B:B<2048?(m[T++]=B>>6|192,m[T++]=B&63|128):(B&64512)===55296&&I+1<E.length&&(E.charCodeAt(I+1)&64512)===56320?(B=65536+((B&1023)<<10)+(E.charCodeAt(++I)&1023),m[T++]=B>>18|240,m[T++]=B>>12&63|128,m[T++]=B>>6&63|128,m[T++]=B&63|128):(m[T++]=B>>12|224,m[T++]=B>>6&63|128,m[T++]=B&63|128)}return m},NA=function(E){const m=[];let T=0,I=0;for(;T<E.length;){const B=E[T++];if(B<128)m[I++]=String.fromCharCode(B);else if(B>191&&B<224){const H=E[T++];m[I++]=String.fromCharCode((B&31)<<6|H&63)}else if(B>239&&B<365){const H=E[T++],Q=E[T++],o=E[T++],xe=((B&7)<<18|(H&63)<<12|(Q&63)<<6|o&63)-65536;m[I++]=String.fromCharCode(55296+(xe>>10)),m[I++]=String.fromCharCode(56320+(xe&1023))}else{const H=E[T++],Q=E[T++];m[I++]=String.fromCharCode((B&15)<<12|(H&63)<<6|Q&63)}}return m.join("")},_x={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(E,m){if(!Array.isArray(E))throw Error("encodeByteArray takes an array as a parameter");this.init_();const T=m?this.byteToCharMapWebSafe_:this.byteToCharMap_,I=[];for(let B=0;B<E.length;B+=3){const H=E[B],Q=B+1<E.length,o=Q?E[B+1]:0,xe=B+2<E.length,pe=xe?E[B+2]:0,Ke=H>>2,nt=(H&3)<<4|o>>4;let Je=(o&15)<<2|pe>>6,Kt=pe&63;xe||(Kt=64,Q||(Je=64)),I.push(T[Ke],T[nt],T[Je],T[Kt])}return I.join("")},encodeString(E,m){return this.HAS_NATIVE_SUPPORT&&!m?btoa(E):this.encodeByteArray(AT(E),m)},decodeString(E,m){return this.HAS_NATIVE_SUPPORT&&!m?atob(E):NA(this.decodeStringToByteArray(E,m))},decodeStringToByteArray(E,m){this.init_();const T=m?this.charToByteMapWebSafe_:this.charToByteMap_,I=[];for(let B=0;B<E.length;){const H=T[E.charAt(B++)],o=B<E.length?T[E.charAt(B)]:0;++B;const pe=B<E.length?T[E.charAt(B)]:64;++B;const nt=B<E.length?T[E.charAt(B)]:64;if(++B,H==null||o==null||pe==null||nt==null)throw new UA;const Je=H<<2|o>>4;if(I.push(Je),pe!==64){const Kt=o<<4&240|pe>>2;if(I.push(Kt),nt!==64){const pi=pe<<6&192|nt;I.push(pi)}}}return I},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let E=0;E<this.ENCODED_VALS.length;E++)this.byteToCharMap_[E]=this.ENCODED_VALS.charAt(E),this.charToByteMap_[this.byteToCharMap_[E]]=E,this.byteToCharMapWebSafe_[E]=this.ENCODED_VALS_WEBSAFE.charAt(E),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[E]]=E,E>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(E)]=E,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(E)]=E)}}};class UA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const CT=function(E){const m=AT(E);return _x.encodeByteArray(m,!0)},Jy=function(E){return CT(E).replace(/\./g,"")},$0=function(E){try{return _x.decodeString(E,!0)}catch(m){console.error("base64Decode failed: ",m)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VA(E){return IT(void 0,E)}function IT(E,m){if(!(m instanceof Object))return m;switch(m.constructor){case Date:const T=m;return new Date(T.getTime());case Object:E===void 0&&(E={});break;case Array:E=[];break;default:return m}for(const T in m)!m.hasOwnProperty(T)||!jA(T)||(E[T]=IT(E[T],m[T]));return E}function jA(E){return E!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HA=()=>GA().__FIREBASE_DEFAULTS__,qA=()=>{if(typeof process>"u"||typeof Dw>"u")return;const E=Dw.__FIREBASE_DEFAULTS__;if(E)return JSON.parse(E)},ZA=()=>{if(typeof document>"u")return;let E;try{E=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const m=E&&$0(E[1]);return m&&JSON.parse(m)},MT=()=>{try{return FA()||HA()||qA()||ZA()}catch(E){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${E}`);return}},XA=E=>{var m,T;return(T=(m=MT())===null||m===void 0?void 0:m.emulatorHosts)===null||T===void 0?void 0:T[E]},WA=E=>{const m=XA(E);if(!m)return;const T=m.lastIndexOf(":");if(T<=0||T+1===m.length)throw new Error(`Invalid host ${m} with no separate hostname and port!`);const I=parseInt(m.substring(T+1),10);return m[0]==="["?[m.substring(1,T-1),I]:[m.substring(0,T),I]},RT=()=>{var E;return(E=MT())===null||E===void 0?void 0:E.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gx{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((m,T)=>{this.resolve=m,this.reject=T})}wrapCallback(m){return(T,I)=>{T?this.reject(T):this.resolve(I),typeof m=="function"&&(this.promise.catch(()=>{}),m.length===1?m(T):m(T,I))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yx(E){try{return(E.startsWith("http://")||E.startsWith("https://")?new URL(E).hostname:E).endsWith(".cloudworkstations.dev")}catch{return!1}}async function $A(E){return(await fetch(E,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YA(E,m){if(E.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const T={alg:"none",type:"JWT"},I=m||"demo-project",B=E.iat||0,H=E.sub||E.user_id;if(!H)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const Q=Object.assign({iss:`https://securetoken.google.com/${I}`,aud:I,iat:B,exp:B+3600,auth_time:B,sub:H,user_id:H,firebase:{sign_in_provider:"custom",identities:{}}},E);return[Jy(JSON.stringify(T)),Jy(JSON.stringify(Q)),""].join(".")}const pg={};function KA(){const E={prod:[],emulator:[]};for(const m of Object.keys(pg))pg[m]?E.emulator.push(m):E.prod.push(m);return E}function QA(E){let m=document.getElementById(E),T=!1;return m||(m=document.createElement("div"),m.setAttribute("id",E),T=!0),{created:T,element:m}}let zw=!1;function JA(E,m){if(typeof window>"u"||typeof document>"u"||!yx(window.location.host)||pg[E]===m||pg[E]||zw)return;pg[E]=m;function T(Je){return`__firebase__banner__${Je}`}const I="__firebase__banner",H=KA().prod.length>0;function Q(){const Je=document.getElementById(I);Je&&Je.remove()}function o(Je){Je.style.display="flex",Je.style.background="#7faaf0",Je.style.position="fixed",Je.style.bottom="5px",Je.style.left="5px",Je.style.padding=".5em",Je.style.borderRadius="5px",Je.style.alignItems="center"}function xe(Je,Kt){Je.setAttribute("width","24"),Je.setAttribute("id",Kt),Je.setAttribute("height","24"),Je.setAttribute("viewBox","0 0 24 24"),Je.setAttribute("fill","none"),Je.style.marginLeft="-6px"}function pe(){const Je=document.createElement("span");return Je.style.cursor="pointer",Je.style.marginLeft="16px",Je.style.fontSize="24px",Je.innerHTML=" &times;",Je.onclick=()=>{zw=!0,Q()},Je}function Ke(Je,Kt){Je.setAttribute("id",Kt),Je.innerText="Learn more",Je.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",Je.setAttribute("target","__blank"),Je.style.paddingLeft="5px",Je.style.textDecoration="underline"}function nt(){const Je=QA(I),Kt=T("text"),pi=document.getElementById(Kt)||document.createElement("span"),Yt=T("learnmore"),Qi=document.getElementById(Yt)||document.createElement("a"),Ji=T("preprendIcon"),Yn=document.getElementById(Ji)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(Je.created){const xn=Je.element;o(xn),Ke(Qi,Yt);const Nr=pe();xe(Yn,Ji),xn.append(Yn,pi,Qi,Nr),document.body.appendChild(xn)}H?(pi.innerText="Preview backend disconnected.",Yn.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Yn.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,pi.innerText="Preview backend running in this workspace."),pi.setAttribute("id",Kt)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",nt):nt()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eC(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function DT(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(eC())}function tC(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function iC(){return ET.NODE_ADMIN===!0}function nC(){try{return typeof indexedDB=="object"}catch{return!1}}function rC(){return new Promise((E,m)=>{try{let T=!0;const I="validate-browser-context-for-indexeddb-analytics-module",B=self.indexedDB.open(I);B.onsuccess=()=>{B.result.close(),T||self.indexedDB.deleteDatabase(I),E(!0)},B.onupgradeneeded=()=>{T=!1},B.onerror=()=>{var H;m(((H=B.error)===null||H===void 0?void 0:H.message)||"")}}catch(T){m(T)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sC="FirebaseError";class Mg extends Error{constructor(m,T,I){super(T),this.code=m,this.customData=I,this.name=sC,Object.setPrototypeOf(this,Mg.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,zT.prototype.create)}}class zT{constructor(m,T,I){this.service=m,this.serviceName=T,this.errors=I}create(m,...T){const I=T[0]||{},B=`${this.service}/${m}`,H=this.errors[m],Q=H?oC(H,I):"Error",o=`${this.serviceName}: ${Q} (${B}).`;return new Mg(B,o,I)}}function oC(E,m){return E.replace(aC,(T,I)=>{const B=m[I];return B!=null?String(B):`<${I}?>`})}const aC=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xg(E){return JSON.parse(E)}function mo(E){return JSON.stringify(E)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LT=function(E){let m={},T={},I={},B="";try{const H=E.split(".");m=xg($0(H[0])||""),T=xg($0(H[1])||""),B=H[2],I=T.d||{},delete T.d}catch{}return{header:m,claims:T,data:I,signature:B}},lC=function(E){const m=LT(E),T=m.claims;return!!T&&typeof T=="object"&&T.hasOwnProperty("iat")},cC=function(E){const m=LT(E).claims;return typeof m=="object"&&m.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ld(E,m){return Object.prototype.hasOwnProperty.call(E,m)}function i_(E,m){if(Object.prototype.hasOwnProperty.call(E,m))return E[m]}function Lw(E){for(const m in E)if(Object.prototype.hasOwnProperty.call(E,m))return!1;return!0}function ev(E,m,T){const I={};for(const B in E)Object.prototype.hasOwnProperty.call(E,B)&&(I[B]=m.call(T,E[B],B,E));return I}function tv(E,m){if(E===m)return!0;const T=Object.keys(E),I=Object.keys(m);for(const B of T){if(!I.includes(B))return!1;const H=E[B],Q=m[B];if(Pw(H)&&Pw(Q)){if(!tv(H,Q))return!1}else if(H!==Q)return!1}for(const B of I)if(!T.includes(B))return!1;return!0}function Pw(E){return E!==null&&typeof E=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uC(E){const m=[];for(const[T,I]of Object.entries(E))Array.isArray(I)?I.forEach(B=>{m.push(encodeURIComponent(T)+"="+encodeURIComponent(B))}):m.push(encodeURIComponent(T)+"="+encodeURIComponent(I));return m.length?"&"+m.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hC{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let m=1;m<this.blockSize;++m)this.pad_[m]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(m,T){T||(T=0);const I=this.W_;if(typeof m=="string")for(let nt=0;nt<16;nt++)I[nt]=m.charCodeAt(T)<<24|m.charCodeAt(T+1)<<16|m.charCodeAt(T+2)<<8|m.charCodeAt(T+3),T+=4;else for(let nt=0;nt<16;nt++)I[nt]=m[T]<<24|m[T+1]<<16|m[T+2]<<8|m[T+3],T+=4;for(let nt=16;nt<80;nt++){const Je=I[nt-3]^I[nt-8]^I[nt-14]^I[nt-16];I[nt]=(Je<<1|Je>>>31)&4294967295}let B=this.chain_[0],H=this.chain_[1],Q=this.chain_[2],o=this.chain_[3],xe=this.chain_[4],pe,Ke;for(let nt=0;nt<80;nt++){nt<40?nt<20?(pe=o^H&(Q^o),Ke=1518500249):(pe=H^Q^o,Ke=1859775393):nt<60?(pe=H&Q|o&(H|Q),Ke=2400959708):(pe=H^Q^o,Ke=3395469782);const Je=(B<<5|B>>>27)+pe+xe+Ke+I[nt]&4294967295;xe=o,o=Q,Q=(H<<30|H>>>2)&4294967295,H=B,B=Je}this.chain_[0]=this.chain_[0]+B&4294967295,this.chain_[1]=this.chain_[1]+H&4294967295,this.chain_[2]=this.chain_[2]+Q&4294967295,this.chain_[3]=this.chain_[3]+o&4294967295,this.chain_[4]=this.chain_[4]+xe&4294967295}update(m,T){if(m==null)return;T===void 0&&(T=m.length);const I=T-this.blockSize;let B=0;const H=this.buf_;let Q=this.inbuf_;for(;B<T;){if(Q===0)for(;B<=I;)this.compress_(m,B),B+=this.blockSize;if(typeof m=="string"){for(;B<T;)if(H[Q]=m.charCodeAt(B),++Q,++B,Q===this.blockSize){this.compress_(H),Q=0;break}}else for(;B<T;)if(H[Q]=m[B],++Q,++B,Q===this.blockSize){this.compress_(H),Q=0;break}}this.inbuf_=Q,this.total_+=T}digest(){const m=[];let T=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let B=this.blockSize-1;B>=56;B--)this.buf_[B]=T&255,T/=256;this.compress_(this.buf_);let I=0;for(let B=0;B<5;B++)for(let H=24;H>=0;H-=8)m[I]=this.chain_[B]>>H&255,++I;return m}}function PT(E,m){return`${E} failed: ${m} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dC=function(E){const m=[];let T=0;for(let I=0;I<E.length;I++){let B=E.charCodeAt(I);if(B>=55296&&B<=56319){const H=B-55296;I++,si(I<E.length,"Surrogate pair missing trail surrogate.");const Q=E.charCodeAt(I)-56320;B=65536+(H<<10)+Q}B<128?m[T++]=B:B<2048?(m[T++]=B>>6|192,m[T++]=B&63|128):B<65536?(m[T++]=B>>12|224,m[T++]=B>>6&63|128,m[T++]=B&63|128):(m[T++]=B>>18|240,m[T++]=B>>12&63|128,m[T++]=B>>6&63|128,m[T++]=B&63|128)}return m},gv=function(E){let m=0;for(let T=0;T<E.length;T++){const I=E.charCodeAt(T);I<128?m++:I<2048?m+=2:I>=55296&&I<=56319?(m+=4,T++):m+=3}return m};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yv(E){return E&&E._delegate?E._delegate:E}class bg{constructor(m,T,I){this.name=m,this.instanceFactory=T,this.type=I,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(m){return this.instantiationMode=m,this}setMultipleInstances(m){return this.multipleInstances=m,this}setServiceProps(m){return this.serviceProps=m,this}setInstanceCreatedCallback(m){return this.onInstanceCreated=m,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $p="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fC{constructor(m,T){this.name=m,this.container=T,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(m){const T=this.normalizeInstanceIdentifier(m);if(!this.instancesDeferred.has(T)){const I=new gx;if(this.instancesDeferred.set(T,I),this.isInitialized(T)||this.shouldAutoInitialize())try{const B=this.getOrInitializeService({instanceIdentifier:T});B&&I.resolve(B)}catch{}}return this.instancesDeferred.get(T).promise}getImmediate(m){var T;const I=this.normalizeInstanceIdentifier(m?.identifier),B=(T=m?.optional)!==null&&T!==void 0?T:!1;if(this.isInitialized(I)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:I})}catch(H){if(B)return null;throw H}else{if(B)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(m){if(m.name!==this.name)throw Error(`Mismatching Component ${m.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=m,!!this.shouldAutoInitialize()){if(mC(m))try{this.getOrInitializeService({instanceIdentifier:$p})}catch{}for(const[T,I]of this.instancesDeferred.entries()){const B=this.normalizeInstanceIdentifier(T);try{const H=this.getOrInitializeService({instanceIdentifier:B});I.resolve(H)}catch{}}}}clearInstance(m=$p){this.instancesDeferred.delete(m),this.instancesOptions.delete(m),this.instances.delete(m)}async delete(){const m=Array.from(this.instances.values());await Promise.all([...m.filter(T=>"INTERNAL"in T).map(T=>T.INTERNAL.delete()),...m.filter(T=>"_delete"in T).map(T=>T._delete())])}isComponentSet(){return this.component!=null}isInitialized(m=$p){return this.instances.has(m)}getOptions(m=$p){return this.instancesOptions.get(m)||{}}initialize(m={}){const{options:T={}}=m,I=this.normalizeInstanceIdentifier(m.instanceIdentifier);if(this.isInitialized(I))throw Error(`${this.name}(${I}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const B=this.getOrInitializeService({instanceIdentifier:I,options:T});for(const[H,Q]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(H);I===o&&Q.resolve(B)}return B}onInit(m,T){var I;const B=this.normalizeInstanceIdentifier(T),H=(I=this.onInitCallbacks.get(B))!==null&&I!==void 0?I:new Set;H.add(m),this.onInitCallbacks.set(B,H);const Q=this.instances.get(B);return Q&&m(Q,B),()=>{H.delete(m)}}invokeOnInitCallbacks(m,T){const I=this.onInitCallbacks.get(T);if(I)for(const B of I)try{B(m,T)}catch{}}getOrInitializeService({instanceIdentifier:m,options:T={}}){let I=this.instances.get(m);if(!I&&this.component&&(I=this.component.instanceFactory(this.container,{instanceIdentifier:pC(m),options:T}),this.instances.set(m,I),this.instancesOptions.set(m,T),this.invokeOnInitCallbacks(I,m),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,m,I)}catch{}return I||null}normalizeInstanceIdentifier(m=$p){return this.component?this.component.multipleInstances?m:$p:m}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function pC(E){return E===$p?void 0:E}function mC(E){return E.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _C{constructor(m){this.name=m,this.providers=new Map}addComponent(m){const T=this.getProvider(m.name);if(T.isComponentSet())throw new Error(`Component ${m.name} has already been registered with ${this.name}`);T.setComponent(m)}addOrOverwriteComponent(m){this.getProvider(m.name).isComponentSet()&&this.providers.delete(m.name),this.addComponent(m)}getProvider(m){if(this.providers.has(m))return this.providers.get(m);const T=new fC(m,this);return this.providers.set(m,T),T}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hr;(function(E){E[E.DEBUG=0]="DEBUG",E[E.VERBOSE=1]="VERBOSE",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.SILENT=5]="SILENT"})(Hr||(Hr={}));const gC={debug:Hr.DEBUG,verbose:Hr.VERBOSE,info:Hr.INFO,warn:Hr.WARN,error:Hr.ERROR,silent:Hr.SILENT},yC=Hr.INFO,vC={[Hr.DEBUG]:"log",[Hr.VERBOSE]:"log",[Hr.INFO]:"info",[Hr.WARN]:"warn",[Hr.ERROR]:"error"},xC=(E,m,...T)=>{if(m<E.logLevel)return;const I=new Date().toISOString(),B=vC[m];if(B)console[B](`[${I}]  ${E.name}:`,...T);else throw new Error(`Attempted to log a message with an invalid logType (value: ${m})`)};class OT{constructor(m){this.name=m,this._logLevel=yC,this._logHandler=xC,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(m){if(!(m in Hr))throw new TypeError(`Invalid value "${m}" assigned to \`logLevel\``);this._logLevel=m}setLogLevel(m){this._logLevel=typeof m=="string"?gC[m]:m}get logHandler(){return this._logHandler}set logHandler(m){if(typeof m!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=m}get userLogHandler(){return this._userLogHandler}set userLogHandler(m){this._userLogHandler=m}debug(...m){this._userLogHandler&&this._userLogHandler(this,Hr.DEBUG,...m),this._logHandler(this,Hr.DEBUG,...m)}log(...m){this._userLogHandler&&this._userLogHandler(this,Hr.VERBOSE,...m),this._logHandler(this,Hr.VERBOSE,...m)}info(...m){this._userLogHandler&&this._userLogHandler(this,Hr.INFO,...m),this._logHandler(this,Hr.INFO,...m)}warn(...m){this._userLogHandler&&this._userLogHandler(this,Hr.WARN,...m),this._logHandler(this,Hr.WARN,...m)}error(...m){this._userLogHandler&&this._userLogHandler(this,Hr.ERROR,...m),this._logHandler(this,Hr.ERROR,...m)}}const bC=(E,m)=>m.some(T=>E instanceof T);let Ow,kw;function wC(){return Ow||(Ow=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function TC(){return kw||(kw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const kT=new WeakMap,Y0=new WeakMap,BT=new WeakMap,B0=new WeakMap,vx=new WeakMap;function SC(E){const m=new Promise((T,I)=>{const B=()=>{E.removeEventListener("success",H),E.removeEventListener("error",Q)},H=()=>{T(Bf(E.result)),B()},Q=()=>{I(E.error),B()};E.addEventListener("success",H),E.addEventListener("error",Q)});return m.then(T=>{T instanceof IDBCursor&&kT.set(T,E)}).catch(()=>{}),vx.set(m,E),m}function EC(E){if(Y0.has(E))return;const m=new Promise((T,I)=>{const B=()=>{E.removeEventListener("complete",H),E.removeEventListener("error",Q),E.removeEventListener("abort",Q)},H=()=>{T(),B()},Q=()=>{I(E.error||new DOMException("AbortError","AbortError")),B()};E.addEventListener("complete",H),E.addEventListener("error",Q),E.addEventListener("abort",Q)});Y0.set(E,m)}let K0={get(E,m,T){if(E instanceof IDBTransaction){if(m==="done")return Y0.get(E);if(m==="objectStoreNames")return E.objectStoreNames||BT.get(E);if(m==="store")return T.objectStoreNames[1]?void 0:T.objectStore(T.objectStoreNames[0])}return Bf(E[m])},set(E,m,T){return E[m]=T,!0},has(E,m){return E instanceof IDBTransaction&&(m==="done"||m==="store")?!0:m in E}};function AC(E){K0=E(K0)}function CC(E){return E===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(m,...T){const I=E.call(F0(this),m,...T);return BT.set(I,m.sort?m.sort():[m]),Bf(I)}:TC().includes(E)?function(...m){return E.apply(F0(this),m),Bf(kT.get(this))}:function(...m){return Bf(E.apply(F0(this),m))}}function IC(E){return typeof E=="function"?CC(E):(E instanceof IDBTransaction&&EC(E),bC(E,wC())?new Proxy(E,K0):E)}function Bf(E){if(E instanceof IDBRequest)return SC(E);if(B0.has(E))return B0.get(E);const m=IC(E);return m!==E&&(B0.set(E,m),vx.set(m,E)),m}const F0=E=>vx.get(E);function MC(E,m,{blocked:T,upgrade:I,blocking:B,terminated:H}={}){const Q=indexedDB.open(E,m),o=Bf(Q);return I&&Q.addEventListener("upgradeneeded",xe=>{I(Bf(Q.result),xe.oldVersion,xe.newVersion,Bf(Q.transaction),xe)}),T&&Q.addEventListener("blocked",xe=>T(xe.oldVersion,xe.newVersion,xe)),o.then(xe=>{H&&xe.addEventListener("close",()=>H()),B&&xe.addEventListener("versionchange",pe=>B(pe.oldVersion,pe.newVersion,pe))}).catch(()=>{}),o}const RC=["get","getKey","getAll","getAllKeys","count"],DC=["put","add","delete","clear"],N0=new Map;function Bw(E,m){if(!(E instanceof IDBDatabase&&!(m in E)&&typeof m=="string"))return;if(N0.get(m))return N0.get(m);const T=m.replace(/FromIndex$/,""),I=m!==T,B=DC.includes(T);if(!(T in(I?IDBIndex:IDBObjectStore).prototype)||!(B||RC.includes(T)))return;const H=async function(Q,...o){const xe=this.transaction(Q,B?"readwrite":"readonly");let pe=xe.store;return I&&(pe=pe.index(o.shift())),(await Promise.all([pe[T](...o),B&&xe.done]))[0]};return N0.set(m,H),H}AC(E=>({...E,get:(m,T,I)=>Bw(m,T)||E.get(m,T,I),has:(m,T)=>!!Bw(m,T)||E.has(m,T)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zC{constructor(m){this.container=m}getPlatformInfoString(){return this.container.getProviders().map(T=>{if(LC(T)){const I=T.getImmediate();return`${I.library}/${I.version}`}else return null}).filter(T=>T).join(" ")}}function LC(E){const m=E.getComponent();return m?.type==="VERSION"}const Q0="@firebase/app",Fw="0.13.2";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dd=new OT("@firebase/app"),PC="@firebase/app-compat",OC="@firebase/analytics-compat",kC="@firebase/analytics",BC="@firebase/app-check-compat",FC="@firebase/app-check",NC="@firebase/auth",UC="@firebase/auth-compat",VC="@firebase/database",jC="@firebase/data-connect",GC="@firebase/database-compat",HC="@firebase/functions",qC="@firebase/functions-compat",ZC="@firebase/installations",XC="@firebase/installations-compat",WC="@firebase/messaging",$C="@firebase/messaging-compat",YC="@firebase/performance",KC="@firebase/performance-compat",QC="@firebase/remote-config",JC="@firebase/remote-config-compat",eI="@firebase/storage",tI="@firebase/storage-compat",iI="@firebase/firestore",nI="@firebase/ai",rI="@firebase/firestore-compat",sI="firebase",oI="11.10.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J0="[DEFAULT]",aI={[Q0]:"fire-core",[PC]:"fire-core-compat",[kC]:"fire-analytics",[OC]:"fire-analytics-compat",[FC]:"fire-app-check",[BC]:"fire-app-check-compat",[NC]:"fire-auth",[UC]:"fire-auth-compat",[VC]:"fire-rtdb",[jC]:"fire-data-connect",[GC]:"fire-rtdb-compat",[HC]:"fire-fn",[qC]:"fire-fn-compat",[ZC]:"fire-iid",[XC]:"fire-iid-compat",[WC]:"fire-fcm",[$C]:"fire-fcm-compat",[YC]:"fire-perf",[KC]:"fire-perf-compat",[QC]:"fire-rc",[JC]:"fire-rc-compat",[eI]:"fire-gcs",[tI]:"fire-gcs-compat",[iI]:"fire-fst",[rI]:"fire-fst-compat",[nI]:"fire-vertex","fire-js":"fire-js",[sI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iv=new Map,lI=new Map,ex=new Map;function Nw(E,m){try{E.container.addComponent(m)}catch(T){Dd.debug(`Component ${m.name} failed to register with FirebaseApp ${E.name}`,T)}}function nv(E){const m=E.name;if(ex.has(m))return Dd.debug(`There were multiple attempts to register component ${m}.`),!1;ex.set(m,E);for(const T of iv.values())Nw(T,E);for(const T of lI.values())Nw(T,E);return!0}function cI(E,m){const T=E.container.getProvider("heartbeat").getImmediate({optional:!0});return T&&T.triggerHeartbeat(),E.container.getProvider(m)}function uI(E){return E==null?!1:E.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ff=new zT("app","Firebase",hI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dI{constructor(m,T,I){this._isDeleted=!1,this._options=Object.assign({},m),this._config=Object.assign({},T),this._name=T.name,this._automaticDataCollectionEnabled=T.automaticDataCollectionEnabled,this._container=I,this.container.addComponent(new bg("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(m){this.checkDestroyed(),this._automaticDataCollectionEnabled=m}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(m){this._isDeleted=m}checkDestroyed(){if(this.isDeleted)throw Ff.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fI=oI;function FT(E,m={}){let T=E;typeof m!="object"&&(m={name:m});const I=Object.assign({name:J0,automaticDataCollectionEnabled:!0},m),B=I.name;if(typeof B!="string"||!B)throw Ff.create("bad-app-name",{appName:String(B)});if(T||(T=RT()),!T)throw Ff.create("no-options");const H=iv.get(B);if(H){if(tv(T,H.options)&&tv(I,H.config))return H;throw Ff.create("duplicate-app",{appName:B})}const Q=new _C(B);for(const xe of ex.values())Q.addComponent(xe);const o=new dI(T,I,Q);return iv.set(B,o),o}function pI(E=J0){const m=iv.get(E);if(!m&&E===J0&&RT())return FT();if(!m)throw Ff.create("no-app",{appName:E});return m}function Qm(E,m,T){var I;let B=(I=aI[E])!==null&&I!==void 0?I:E;T&&(B+=`-${T}`);const H=B.match(/\s|\//),Q=m.match(/\s|\//);if(H||Q){const o=[`Unable to register library "${B}" with version "${m}":`];H&&o.push(`library name "${B}" contains illegal characters (whitespace or "/")`),H&&Q&&o.push("and"),Q&&o.push(`version name "${m}" contains illegal characters (whitespace or "/")`),Dd.warn(o.join(" "));return}nv(new bg(`${B}-version`,()=>({library:B,version:m}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mI="firebase-heartbeat-database",_I=1,wg="firebase-heartbeat-store";let U0=null;function NT(){return U0||(U0=MC(mI,_I,{upgrade:(E,m)=>{switch(m){case 0:try{E.createObjectStore(wg)}catch(T){console.warn(T)}}}}).catch(E=>{throw Ff.create("idb-open",{originalErrorMessage:E.message})})),U0}async function gI(E){try{const T=(await NT()).transaction(wg),I=await T.objectStore(wg).get(UT(E));return await T.done,I}catch(m){if(m instanceof Mg)Dd.warn(m.message);else{const T=Ff.create("idb-get",{originalErrorMessage:m?.message});Dd.warn(T.message)}}}async function Uw(E,m){try{const I=(await NT()).transaction(wg,"readwrite");await I.objectStore(wg).put(m,UT(E)),await I.done}catch(T){if(T instanceof Mg)Dd.warn(T.message);else{const I=Ff.create("idb-set",{originalErrorMessage:T?.message});Dd.warn(I.message)}}}function UT(E){return`${E.name}!${E.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yI=1024,vI=30;class xI{constructor(m){this.container=m,this._heartbeatsCache=null;const T=this.container.getProvider("app").getImmediate();this._storage=new wI(T),this._heartbeatsCachePromise=this._storage.read().then(I=>(this._heartbeatsCache=I,I))}async triggerHeartbeat(){var m,T;try{const B=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),H=Vw();if(((m=this._heartbeatsCache)===null||m===void 0?void 0:m.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((T=this._heartbeatsCache)===null||T===void 0?void 0:T.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===H||this._heartbeatsCache.heartbeats.some(Q=>Q.date===H))return;if(this._heartbeatsCache.heartbeats.push({date:H,agent:B}),this._heartbeatsCache.heartbeats.length>vI){const Q=TI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(Q,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(I){Dd.warn(I)}}async getHeartbeatsHeader(){var m;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((m=this._heartbeatsCache)===null||m===void 0?void 0:m.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const T=Vw(),{heartbeatsToSend:I,unsentEntries:B}=bI(this._heartbeatsCache.heartbeats),H=Jy(JSON.stringify({version:2,heartbeats:I}));return this._heartbeatsCache.lastSentHeartbeatDate=T,B.length>0?(this._heartbeatsCache.heartbeats=B,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),H}catch(T){return Dd.warn(T),""}}}function Vw(){return new Date().toISOString().substring(0,10)}function bI(E,m=yI){const T=[];let I=E.slice();for(const B of E){const H=T.find(Q=>Q.agent===B.agent);if(H){if(H.dates.push(B.date),jw(T)>m){H.dates.pop();break}}else if(T.push({agent:B.agent,dates:[B.date]}),jw(T)>m){T.pop();break}I=I.slice(1)}return{heartbeatsToSend:T,unsentEntries:I}}class wI{constructor(m){this.app=m,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return nC()?rC().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const T=await gI(this.app);return T?.heartbeats?T:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(m){var T;if(await this._canUseIndexedDBPromise){const B=await this.read();return Uw(this.app,{lastSentHeartbeatDate:(T=m.lastSentHeartbeatDate)!==null&&T!==void 0?T:B.lastSentHeartbeatDate,heartbeats:m.heartbeats})}else return}async add(m){var T;if(await this._canUseIndexedDBPromise){const B=await this.read();return Uw(this.app,{lastSentHeartbeatDate:(T=m.lastSentHeartbeatDate)!==null&&T!==void 0?T:B.lastSentHeartbeatDate,heartbeats:[...B.heartbeats,...m.heartbeats]})}else return}}function jw(E){return Jy(JSON.stringify({version:2,heartbeats:E})).length}function TI(E){if(E.length===0)return-1;let m=0,T=E[0].date;for(let I=1;I<E.length;I++)E[I].date<T&&(T=E[I].date,m=I);return m}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SI(E){nv(new bg("platform-logger",m=>new zC(m),"PRIVATE")),nv(new bg("heartbeat",m=>new xI(m),"PRIVATE")),Qm(Q0,Fw,E),Qm(Q0,Fw,"esm2017"),Qm("fire-js","")}SI("");var EI="firebase",AI="11.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Qm(EI,AI,"app");var Gw={};const Hw="@firebase/database",qw="1.0.20";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let VT="";function CI(E){VT=E}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class II{constructor(m){this.domStorage_=m,this.prefix_="firebase:"}set(m,T){T==null?this.domStorage_.removeItem(this.prefixedName_(m)):this.domStorage_.setItem(this.prefixedName_(m),mo(T))}get(m){const T=this.domStorage_.getItem(this.prefixedName_(m));return T==null?null:xg(T)}remove(m){this.domStorage_.removeItem(this.prefixedName_(m))}prefixedName_(m){return this.prefix_+m}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MI{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(m,T){T==null?delete this.cache_[m]:this.cache_[m]=T}get(m){return Ld(this.cache_,m)?this.cache_[m]:null}remove(m){delete this.cache_[m]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jT=function(E){try{if(typeof window<"u"&&typeof window[E]<"u"){const m=window[E];return m.setItem("firebase:sentinel","cache"),m.removeItem("firebase:sentinel"),new II(m)}}catch{}return new MI},Kp=jT("localStorage"),RI=jT("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jm=new OT("@firebase/database"),DI=function(){let E=1;return function(){return E++}}(),GT=function(E){const m=dC(E),T=new hC;T.update(m);const I=T.digest();return _x.encodeByteArray(I)},Rg=function(...E){let m="";for(let T=0;T<E.length;T++){const I=E[T];Array.isArray(I)||I&&typeof I=="object"&&typeof I.length=="number"?m+=Rg.apply(null,I):typeof I=="object"?m+=mo(I):m+=I,m+=" "}return m};let mg=null,Zw=!0;const zI=function(E,m){si(!0,"Can't turn on custom loggers persistently."),Jm.logLevel=Hr.VERBOSE,mg=Jm.log.bind(Jm)},Ko=function(...E){if(Zw===!0&&(Zw=!1,mg===null&&RI.get("logging_enabled")===!0&&zI()),mg){const m=Rg.apply(null,E);mg(m)}},Dg=function(E){return function(...m){Ko(E,...m)}},tx=function(...E){const m="FIREBASE INTERNAL ERROR: "+Rg(...E);Jm.error(m)},zd=function(...E){const m=`FIREBASE FATAL ERROR: ${Rg(...E)}`;throw Jm.error(m),new Error(m)},kl=function(...E){const m="FIREBASE WARNING: "+Rg(...E);Jm.warn(m)},LI=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&kl("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},HT=function(E){return typeof E=="number"&&(E!==E||E===Number.POSITIVE_INFINITY||E===Number.NEGATIVE_INFINITY)},PI=function(E){if(document.readyState==="complete")E();else{let m=!1;const T=function(){if(!document.body){setTimeout(T,Math.floor(10));return}m||(m=!0,E())};document.addEventListener?(document.addEventListener("DOMContentLoaded",T,!1),window.addEventListener("load",T,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&T()}),window.attachEvent("onload",T))}},n_="[MIN_NAME]",Qp="[MAX_NAME]",a_=function(E,m){if(E===m)return 0;if(E===n_||m===Qp)return-1;if(m===n_||E===Qp)return 1;{const T=Xw(E),I=Xw(m);return T!==null?I!==null?T-I===0?E.length-m.length:T-I:-1:I!==null?1:E<m?-1:1}},OI=function(E,m){return E===m?0:E<m?-1:1},ug=function(E,m){if(m&&E in m)return m[E];throw new Error("Missing required key ("+E+") in object: "+mo(m))},xx=function(E){if(typeof E!="object"||E===null)return mo(E);const m=[];for(const I in E)m.push(I);m.sort();let T="{";for(let I=0;I<m.length;I++)I!==0&&(T+=","),T+=mo(m[I]),T+=":",T+=xx(E[m[I]]);return T+="}",T},qT=function(E,m){const T=E.length;if(T<=m)return[E];const I=[];for(let B=0;B<T;B+=m)B+m>T?I.push(E.substring(B,T)):I.push(E.substring(B,B+m));return I};function nl(E,m){for(const T in E)E.hasOwnProperty(T)&&m(T,E[T])}const ZT=function(E){si(!HT(E),"Invalid JSON number");const m=11,T=52,I=(1<<m-1)-1;let B,H,Q,o,xe;E===0?(H=0,Q=0,B=1/E===-1/0?1:0):(B=E<0,E=Math.abs(E),E>=Math.pow(2,1-I)?(o=Math.min(Math.floor(Math.log(E)/Math.LN2),I),H=o+I,Q=Math.round(E*Math.pow(2,T-o)-Math.pow(2,T))):(H=0,Q=Math.round(E/Math.pow(2,1-I-T))));const pe=[];for(xe=T;xe;xe-=1)pe.push(Q%2?1:0),Q=Math.floor(Q/2);for(xe=m;xe;xe-=1)pe.push(H%2?1:0),H=Math.floor(H/2);pe.push(B?1:0),pe.reverse();const Ke=pe.join("");let nt="";for(xe=0;xe<64;xe+=8){let Je=parseInt(Ke.substr(xe,8),2).toString(16);Je.length===1&&(Je="0"+Je),nt=nt+Je}return nt.toLowerCase()},kI=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},BI=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function FI(E,m){let T="Unknown Error";E==="too_big"?T="The data requested exceeds the maximum size that can be accessed with a single request.":E==="permission_denied"?T="Client doesn't have permission to access the desired data.":E==="unavailable"&&(T="The service is unavailable");const I=new Error(E+" at "+m._path.toString()+": "+T);return I.code=E.toUpperCase(),I}const NI=new RegExp("^-?(0*)\\d{1,10}$"),UI=-2147483648,VI=2147483647,Xw=function(E){if(NI.test(E)){const m=Number(E);if(m>=UI&&m<=VI)return m}return null},zg=function(E){try{E()}catch(m){setTimeout(()=>{const T=m.stack||"";throw kl("Exception was thrown by user callback.",T),m},Math.floor(0))}},jI=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},_g=function(E,m){const T=setTimeout(E,m);return typeof T=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(T):typeof T=="object"&&T.unref&&T.unref(),T};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GI{constructor(m,T){this.appCheckProvider=T,this.appName=m.name,uI(m)&&m.settings.appCheckToken&&(this.serverAppAppCheckToken=m.settings.appCheckToken),this.appCheck=T?.getImmediate({optional:!0}),this.appCheck||T?.get().then(I=>this.appCheck=I)}getToken(m){if(this.serverAppAppCheckToken){if(m)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(m):new Promise((T,I)=>{setTimeout(()=>{this.appCheck?this.getToken(m).then(T,I):T(null)},0)})}addTokenChangeListener(m){var T;(T=this.appCheckProvider)===null||T===void 0||T.get().then(I=>I.addTokenListener(m))}notifyForInvalidToken(){kl(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HI{constructor(m,T,I){this.appName_=m,this.firebaseOptions_=T,this.authProvider_=I,this.auth_=null,this.auth_=I.getImmediate({optional:!0}),this.auth_||I.onInit(B=>this.auth_=B)}getToken(m){return this.auth_?this.auth_.getToken(m).catch(T=>T&&T.code==="auth/token-not-initialized"?(Ko("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(T)):new Promise((T,I)=>{setTimeout(()=>{this.auth_?this.getToken(m).then(T,I):T(null)},0)})}addTokenChangeListener(m){this.auth_?this.auth_.addAuthTokenListener(m):this.authProvider_.get().then(T=>T.addAuthTokenListener(m))}removeTokenChangeListener(m){this.authProvider_.get().then(T=>T.removeAuthTokenListener(m))}notifyForInvalidToken(){let m='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?m+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?m+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':m+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',kl(m)}}class Qy{constructor(m){this.accessToken=m}getToken(m){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(m){m(this.accessToken)}removeTokenChangeListener(m){}notifyForInvalidToken(){}}Qy.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx="5",XT="v",WT="s",$T="r",YT="f",KT=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,QT="ls",JT="p",ix="ac",eS="websocket",tS="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iS{constructor(m,T,I,B,H=!1,Q="",o=!1,xe=!1,pe=null){this.secure=T,this.namespace=I,this.webSocketOnly=B,this.nodeAdmin=H,this.persistenceKey=Q,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=xe,this.emulatorOptions=pe,this._host=m.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Kp.get("host:"+m)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(m){m!==this.internalHost&&(this.internalHost=m,this.isCacheableHost()&&Kp.set("host:"+this._host,this.internalHost))}toString(){let m=this.toURLString();return this.persistenceKey&&(m+="<"+this.persistenceKey+">"),m}toURLString(){const m=this.secure?"https://":"http://",T=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${m}${this.host}/${T}`}}function qI(E){return E.host!==E.internalHost||E.isCustomHost()||E.includeNamespaceInQueryParams}function nS(E,m,T){si(typeof m=="string","typeof type must == string"),si(typeof T=="object","typeof params must == object");let I;if(m===eS)I=(E.secure?"wss://":"ws://")+E.internalHost+"/.ws?";else if(m===tS)I=(E.secure?"https://":"http://")+E.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+m);qI(E)&&(T.ns=E.namespace);const B=[];return nl(T,(H,Q)=>{B.push(H+"="+Q)}),I+B.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(){this.counters_={}}incrementCounter(m,T=1){Ld(this.counters_,m)||(this.counters_[m]=0),this.counters_[m]+=T}get(){return VA(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V0={},j0={};function wx(E){const m=E.toString();return V0[m]||(V0[m]=new ZI),V0[m]}function XI(E,m){const T=E.toString();return j0[T]||(j0[T]=m()),j0[T]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WI{constructor(m){this.onMessage_=m,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(m,T){this.closeAfterResponse=m,this.onClose=T,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(m,T){for(this.pendingResponses[m]=T;this.pendingResponses[this.currentResponseNum];){const I=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let B=0;B<I.length;++B)I[B]&&zg(()=>{this.onMessage_(I[B])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ww="start",$I="close",YI="pLPCommand",KI="pRTLPCB",rS="id",sS="pw",oS="ser",QI="cb",JI="seg",eM="ts",tM="d",iM="dframe",aS=1870,lS=30,nM=aS-lS,rM=25e3,sM=3e4;class Ym{constructor(m,T,I,B,H,Q,o){this.connId=m,this.repoInfo=T,this.applicationId=I,this.appCheckToken=B,this.authToken=H,this.transportSessionId=Q,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Dg(m),this.stats_=wx(T),this.urlFn=xe=>(this.appCheckToken&&(xe[ix]=this.appCheckToken),nS(T,tS,xe))}open(m,T){this.curSegmentNum=0,this.onDisconnect_=T,this.myPacketOrderer=new WI(m),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(sM)),PI(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Tx((...H)=>{const[Q,o,xe,pe,Ke]=H;if(this.incrementIncomingBytes_(H),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,Q===Ww)this.id=o,this.password=xe;else if(Q===$I)o?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(o,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+Q)},(...H)=>{const[Q,o]=H;this.incrementIncomingBytes_(H),this.myPacketOrderer.handleResponse(Q,o)},()=>{this.onClosed_()},this.urlFn);const I={};I[Ww]="t",I[oS]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(I[QI]=this.scriptTagHolder.uniqueCallbackIdentifier),I[XT]=bx,this.transportSessionId&&(I[WT]=this.transportSessionId),this.lastSessionId&&(I[QT]=this.lastSessionId),this.applicationId&&(I[JT]=this.applicationId),this.appCheckToken&&(I[ix]=this.appCheckToken),typeof location<"u"&&location.hostname&&KT.test(location.hostname)&&(I[$T]=YT);const B=this.urlFn(I);this.log_("Connecting via long-poll to "+B),this.scriptTagHolder.addTag(B,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ym.forceAllow_=!0}static forceDisallow(){Ym.forceDisallow_=!0}static isAvailable(){return Ym.forceAllow_?!0:!Ym.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!kI()&&!BI()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(m){const T=mo(m);this.bytesSent+=T.length,this.stats_.incrementCounter("bytes_sent",T.length);const I=CT(T),B=qT(I,nM);for(let H=0;H<B.length;H++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,B.length,B[H]),this.curSegmentNum++}addDisconnectPingFrame(m,T){this.myDisconnFrame=document.createElement("iframe");const I={};I[iM]="t",I[rS]=m,I[sS]=T,this.myDisconnFrame.src=this.urlFn(I),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(m){const T=mo(m).length;this.bytesReceived+=T,this.stats_.incrementCounter("bytes_received",T)}}class Tx{constructor(m,T,I,B){this.onDisconnect=I,this.urlFn=B,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=DI(),window[YI+this.uniqueCallbackIdentifier]=m,window[KI+this.uniqueCallbackIdentifier]=T,this.myIFrame=Tx.createIFrame_();let H="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(H='<script>document.domain="'+document.domain+'";<\/script>');const Q="<html><body>"+H+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(Q),this.myIFrame.doc.close()}catch(o){Ko("frame writing exception"),o.stack&&Ko(o.stack),Ko(o)}}}static createIFrame_(){const m=document.createElement("iframe");if(m.style.display="none",document.body){document.body.appendChild(m);try{m.contentWindow.document||Ko("No IE domain setting required")}catch{const I=document.domain;m.src="javascript:void((function(){document.open();document.domain='"+I+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return m.contentDocument?m.doc=m.contentDocument:m.contentWindow?m.doc=m.contentWindow.document:m.document&&(m.doc=m.document),m}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const m=this.onDisconnect;m&&(this.onDisconnect=null,m())}startLongPoll(m,T){for(this.myID=m,this.myPW=T,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const m={};m[rS]=this.myID,m[sS]=this.myPW,m[oS]=this.currentSerial;let T=this.urlFn(m),I="",B=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+lS+I.length<=aS;){const Q=this.pendingSegs.shift();I=I+"&"+JI+B+"="+Q.seg+"&"+eM+B+"="+Q.ts+"&"+tM+B+"="+Q.d,B++}return T=T+I,this.addLongPollTag_(T,this.currentSerial),!0}else return!1}enqueueSegment(m,T,I){this.pendingSegs.push({seg:m,ts:T,d:I}),this.alive&&this.newRequest_()}addLongPollTag_(m,T){this.outstandingRequests.add(T);const I=()=>{this.outstandingRequests.delete(T),this.newRequest_()},B=setTimeout(I,Math.floor(rM)),H=()=>{clearTimeout(B),I()};this.addTag(m,H)}addTag(m,T){setTimeout(()=>{try{if(!this.sendNewPolls)return;const I=this.myIFrame.doc.createElement("script");I.type="text/javascript",I.async=!0,I.src=m,I.onload=I.onreadystatechange=function(){const B=I.readyState;(!B||B==="loaded"||B==="complete")&&(I.onload=I.onreadystatechange=null,I.parentNode&&I.parentNode.removeChild(I),T())},I.onerror=()=>{Ko("Long-poll script failed to load: "+m),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(I)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oM=16384,aM=45e3;let rv=null;typeof MozWebSocket<"u"?rv=MozWebSocket:typeof WebSocket<"u"&&(rv=WebSocket);class pu{constructor(m,T,I,B,H,Q,o){this.connId=m,this.applicationId=I,this.appCheckToken=B,this.authToken=H,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Dg(this.connId),this.stats_=wx(T),this.connURL=pu.connectionURL_(T,Q,o,B,I),this.nodeAdmin=T.nodeAdmin}static connectionURL_(m,T,I,B,H){const Q={};return Q[XT]=bx,typeof location<"u"&&location.hostname&&KT.test(location.hostname)&&(Q[$T]=YT),T&&(Q[WT]=T),I&&(Q[QT]=I),B&&(Q[ix]=B),H&&(Q[JT]=H),nS(m,eS,Q)}open(m,T){this.onDisconnect=T,this.onMessage=m,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Kp.set("previous_websocket_failure",!0);try{let I;iC(),this.mySock=new rv(this.connURL,[],I)}catch(I){this.log_("Error instantiating WebSocket.");const B=I.message||I.data;B&&this.log_(B),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=I=>{this.handleIncomingFrame(I)},this.mySock.onerror=I=>{this.log_("WebSocket error.  Closing connection.");const B=I.message||I.data;B&&this.log_(B),this.onClosed_()}}start(){}static forceDisallow(){pu.forceDisallow_=!0}static isAvailable(){let m=!1;if(typeof navigator<"u"&&navigator.userAgent){const T=/Android ([0-9]{0,}\.[0-9]{0,})/,I=navigator.userAgent.match(T);I&&I.length>1&&parseFloat(I[1])<4.4&&(m=!0)}return!m&&rv!==null&&!pu.forceDisallow_}static previouslyFailed(){return Kp.isInMemoryStorage||Kp.get("previous_websocket_failure")===!0}markConnectionHealthy(){Kp.remove("previous_websocket_failure")}appendFrame_(m){if(this.frames.push(m),this.frames.length===this.totalFrames){const T=this.frames.join("");this.frames=null;const I=xg(T);this.onMessage(I)}}handleNewFrameCount_(m){this.totalFrames=m,this.frames=[]}extractFrameCount_(m){if(si(this.frames===null,"We already have a frame buffer"),m.length<=6){const T=Number(m);if(!isNaN(T))return this.handleNewFrameCount_(T),null}return this.handleNewFrameCount_(1),m}handleIncomingFrame(m){if(this.mySock===null)return;const T=m.data;if(this.bytesReceived+=T.length,this.stats_.incrementCounter("bytes_received",T.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(T);else{const I=this.extractFrameCount_(T);I!==null&&this.appendFrame_(I)}}send(m){this.resetKeepAlive();const T=mo(m);this.bytesSent+=T.length,this.stats_.incrementCounter("bytes_sent",T.length);const I=qT(T,oM);I.length>1&&this.sendString_(String(I.length));for(let B=0;B<I.length;B++)this.sendString_(I[B])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(aM))}sendString_(m){try{this.mySock.send(m)}catch(T){this.log_("Exception thrown from WebSocket.send():",T.message||T.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}pu.responsesRequiredToBeHealthy=2;pu.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tg{static get ALL_TRANSPORTS(){return[Ym,pu]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(m){this.initTransports_(m)}initTransports_(m){const T=pu&&pu.isAvailable();let I=T&&!pu.previouslyFailed();if(m.webSocketOnly&&(T||kl("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),I=!0),I)this.transports_=[pu];else{const B=this.transports_=[];for(const H of Tg.ALL_TRANSPORTS)H&&H.isAvailable()&&B.push(H);Tg.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Tg.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lM=6e4,cM=5e3,uM=10*1024,hM=100*1024,G0="t",$w="d",dM="s",Yw="r",fM="e",Kw="o",Qw="a",Jw="n",eT="p",pM="h";class mM{constructor(m,T,I,B,H,Q,o,xe,pe,Ke){this.id=m,this.repoInfo_=T,this.applicationId_=I,this.appCheckToken_=B,this.authToken_=H,this.onMessage_=Q,this.onReady_=o,this.onDisconnect_=xe,this.onKill_=pe,this.lastSessionId=Ke,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Dg("c:"+this.id+":"),this.transportManager_=new Tg(T),this.log_("Connection created"),this.start_()}start_(){const m=this.transportManager_.initialTransport();this.conn_=new m(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=m.responsesRequiredToBeHealthy||0;const T=this.connReceiver_(this.conn_),I=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(T,I)},Math.floor(0));const B=m.healthyTimeout||0;B>0&&(this.healthyTimeout_=_g(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>hM?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>uM?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(B)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(m){return T=>{m===this.conn_?this.onConnectionLost_(T):m===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(m){return T=>{this.state_!==2&&(m===this.rx_?this.onPrimaryMessageReceived_(T):m===this.secondaryConn_?this.onSecondaryMessageReceived_(T):this.log_("message on old connection"))}}sendRequest(m){const T={t:"d",d:m};this.sendData_(T)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(m){if(G0 in m){const T=m[G0];T===Qw?this.upgradeIfSecondaryHealthy_():T===Yw?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):T===Kw&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(m){const T=ug("t",m),I=ug("d",m);if(T==="c")this.onSecondaryControl_(I);else if(T==="d")this.pendingDataMessages.push(I);else throw new Error("Unknown protocol layer: "+T)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:eT,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Qw,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Jw,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(m){const T=ug("t",m),I=ug("d",m);T==="c"?this.onControl_(I):T==="d"&&this.onDataMessage_(I)}onDataMessage_(m){this.onPrimaryResponse_(),this.onMessage_(m)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(m){const T=ug(G0,m);if($w in m){const I=m[$w];if(T===pM){const B=Object.assign({},I);this.repoInfo_.isUsingEmulator&&(B.h=this.repoInfo_.host),this.onHandshake_(B)}else if(T===Jw){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let B=0;B<this.pendingDataMessages.length;++B)this.onDataMessage_(this.pendingDataMessages[B]);this.pendingDataMessages=[],this.tryCleanupConnection()}else T===dM?this.onConnectionShutdown_(I):T===Yw?this.onReset_(I):T===fM?tx("Server Error: "+I):T===Kw?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):tx("Unknown control packet command: "+T)}}onHandshake_(m){const T=m.ts,I=m.v,B=m.h;this.sessionId=m.s,this.repoInfo_.host=B,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,T),bx!==I&&kl("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const m=this.transportManager_.upgradeTransport();m&&this.startUpgrade_(m)}startUpgrade_(m){this.secondaryConn_=new m(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=m.responsesRequiredToBeHealthy||0;const T=this.connReceiver_(this.secondaryConn_),I=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(T,I),_g(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(lM))}onReset_(m){this.log_("Reset packet received.  New host: "+m),this.repoInfo_.host=m,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(m,T){this.log_("Realtime connection established."),this.conn_=m,this.state_=1,this.onReady_&&(this.onReady_(T,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):_g(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(cM))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:eT,d:{}}}))}onSecondaryConnectionLost_(){const m=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===m||this.rx_===m)&&this.close()}onConnectionLost_(m){this.conn_=null,!m&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Kp.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(m){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(m),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(m){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(m)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cS{put(m,T,I,B){}merge(m,T,I,B){}refreshAuthToken(m){}refreshAppCheckToken(m){}onDisconnectPut(m,T,I){}onDisconnectMerge(m,T,I){}onDisconnectCancel(m,T){}reportStats(m){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uS{constructor(m){this.allowedEvents_=m,this.listeners_={},si(Array.isArray(m)&&m.length>0,"Requires a non-empty array")}trigger(m,...T){if(Array.isArray(this.listeners_[m])){const I=[...this.listeners_[m]];for(let B=0;B<I.length;B++)I[B].callback.apply(I[B].context,T)}}on(m,T,I){this.validateEventType_(m),this.listeners_[m]=this.listeners_[m]||[],this.listeners_[m].push({callback:T,context:I});const B=this.getInitialEvent(m);B&&T.apply(I,B)}off(m,T,I){this.validateEventType_(m);const B=this.listeners_[m]||[];for(let H=0;H<B.length;H++)if(B[H].callback===T&&(!I||I===B[H].context)){B.splice(H,1);return}}validateEventType_(m){si(this.allowedEvents_.find(T=>T===m),"Unknown event: "+m)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sv extends uS{static getInstance(){return new sv}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!DT()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(m){return si(m==="online","Unknown event type: "+m),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tT=32,iT=768;class Fr{constructor(m,T){if(T===void 0){this.pieces_=m.split("/");let I=0;for(let B=0;B<this.pieces_.length;B++)this.pieces_[B].length>0&&(this.pieces_[I]=this.pieces_[B],I++);this.pieces_.length=I,this.pieceNum_=0}else this.pieces_=m,this.pieceNum_=T}toString(){let m="";for(let T=this.pieceNum_;T<this.pieces_.length;T++)this.pieces_[T]!==""&&(m+="/"+this.pieces_[T]);return m||"/"}}function Er(){return new Fr("")}function ar(E){return E.pieceNum_>=E.pieces_.length?null:E.pieces_[E.pieceNum_]}function Uf(E){return E.pieces_.length-E.pieceNum_}function qr(E){let m=E.pieceNum_;return m<E.pieces_.length&&m++,new Fr(E.pieces_,m)}function hS(E){return E.pieceNum_<E.pieces_.length?E.pieces_[E.pieces_.length-1]:null}function _M(E){let m="";for(let T=E.pieceNum_;T<E.pieces_.length;T++)E.pieces_[T]!==""&&(m+="/"+encodeURIComponent(String(E.pieces_[T])));return m||"/"}function dS(E,m=0){return E.pieces_.slice(E.pieceNum_+m)}function fS(E){if(E.pieceNum_>=E.pieces_.length)return null;const m=[];for(let T=E.pieceNum_;T<E.pieces_.length-1;T++)m.push(E.pieces_[T]);return new Fr(m,0)}function eo(E,m){const T=[];for(let I=E.pieceNum_;I<E.pieces_.length;I++)T.push(E.pieces_[I]);if(m instanceof Fr)for(let I=m.pieceNum_;I<m.pieces_.length;I++)T.push(m.pieces_[I]);else{const I=m.split("/");for(let B=0;B<I.length;B++)I[B].length>0&&T.push(I[B])}return new Fr(T,0)}function lr(E){return E.pieceNum_>=E.pieces_.length}function tl(E,m){const T=ar(E),I=ar(m);if(T===null)return m;if(T===I)return tl(qr(E),qr(m));throw new Error("INTERNAL ERROR: innerPath ("+m+") is not within outerPath ("+E+")")}function Sx(E,m){if(Uf(E)!==Uf(m))return!1;for(let T=E.pieceNum_,I=m.pieceNum_;T<=E.pieces_.length;T++,I++)if(E.pieces_[T]!==m.pieces_[I])return!1;return!0}function mu(E,m){let T=E.pieceNum_,I=m.pieceNum_;if(Uf(E)>Uf(m))return!1;for(;T<E.pieces_.length;){if(E.pieces_[T]!==m.pieces_[I])return!1;++T,++I}return!0}class gM{constructor(m,T){this.errorPrefix_=T,this.parts_=dS(m,0),this.byteLength_=Math.max(1,this.parts_.length);for(let I=0;I<this.parts_.length;I++)this.byteLength_+=gv(this.parts_[I]);pS(this)}}function yM(E,m){E.parts_.length>0&&(E.byteLength_+=1),E.parts_.push(m),E.byteLength_+=gv(m),pS(E)}function vM(E){const m=E.parts_.pop();E.byteLength_-=gv(m),E.parts_.length>0&&(E.byteLength_-=1)}function pS(E){if(E.byteLength_>iT)throw new Error(E.errorPrefix_+"has a key path longer than "+iT+" bytes ("+E.byteLength_+").");if(E.parts_.length>tT)throw new Error(E.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+tT+") or object contains a cycle "+Yp(E))}function Yp(E){return E.parts_.length===0?"":"in property '"+E.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ex extends uS{static getInstance(){return new Ex}constructor(){super(["visible"]);let m,T;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(T="visibilitychange",m="hidden"):typeof document.mozHidden<"u"?(T="mozvisibilitychange",m="mozHidden"):typeof document.msHidden<"u"?(T="msvisibilitychange",m="msHidden"):typeof document.webkitHidden<"u"&&(T="webkitvisibilitychange",m="webkitHidden")),this.visible_=!0,T&&document.addEventListener(T,()=>{const I=!document[m];I!==this.visible_&&(this.visible_=I,this.trigger("visible",I))},!1)}getInitialEvent(m){return si(m==="visible","Unknown event type: "+m),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hg=1e3,xM=60*5*1e3,nT=30*1e3,bM=1.3,wM=3e4,TM="server_kill",rT=3;class Rd extends cS{constructor(m,T,I,B,H,Q,o,xe){if(super(),this.repoInfo_=m,this.applicationId_=T,this.onDataUpdate_=I,this.onConnectStatus_=B,this.onServerInfoUpdate_=H,this.authTokenProvider_=Q,this.appCheckTokenProvider_=o,this.authOverride_=xe,this.id=Rd.nextPersistentConnectionId_++,this.log_=Dg("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=hg,this.maxReconnectDelay_=xM,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,xe)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Ex.getInstance().on("visible",this.onVisible_,this),m.host.indexOf("fblocal")===-1&&sv.getInstance().on("online",this.onOnline_,this)}sendRequest(m,T,I){const B=++this.requestNumber_,H={r:B,a:m,b:T};this.log_(mo(H)),si(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(H),I&&(this.requestCBHash_[B]=I)}get(m){this.initConnection_();const T=new gx,B={action:"g",request:{p:m._path.toString(),q:m._queryObject},onComplete:Q=>{const o=Q.d;Q.s==="ok"?T.resolve(o):T.reject(o)}};this.outstandingGets_.push(B),this.outstandingGetCount_++;const H=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(H),T.promise}listen(m,T,I,B){this.initConnection_();const H=m._queryIdentifier,Q=m._path.toString();this.log_("Listen called for "+Q+" "+H),this.listens.has(Q)||this.listens.set(Q,new Map),si(m._queryParams.isDefault()||!m._queryParams.loadsAllData(),"listen() called for non-default but complete query"),si(!this.listens.get(Q).has(H),"listen() called twice for same path/queryId.");const o={onComplete:B,hashFn:T,query:m,tag:I};this.listens.get(Q).set(H,o),this.connected_&&this.sendListen_(o)}sendGet_(m){const T=this.outstandingGets_[m];this.sendRequest("g",T.request,I=>{delete this.outstandingGets_[m],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),T.onComplete&&T.onComplete(I)})}sendListen_(m){const T=m.query,I=T._path.toString(),B=T._queryIdentifier;this.log_("Listen on "+I+" for "+B);const H={p:I},Q="q";m.tag&&(H.q=T._queryObject,H.t=m.tag),H.h=m.hashFn(),this.sendRequest(Q,H,o=>{const xe=o.d,pe=o.s;Rd.warnOnListenWarnings_(xe,T),(this.listens.get(I)&&this.listens.get(I).get(B))===m&&(this.log_("listen response",o),pe!=="ok"&&this.removeListen_(I,B),m.onComplete&&m.onComplete(pe,xe))})}static warnOnListenWarnings_(m,T){if(m&&typeof m=="object"&&Ld(m,"w")){const I=i_(m,"w");if(Array.isArray(I)&&~I.indexOf("no_index")){const B='".indexOn": "'+T._queryParams.getIndex().toString()+'"',H=T._path.toString();kl(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${B} at ${H} to your security rules for better performance.`)}}}refreshAuthToken(m){this.authToken_=m,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(m)}reduceReconnectDelayIfAdminCredential_(m){(m&&m.length===40||cC(m))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=nT)}refreshAppCheckToken(m){this.appCheckToken_=m,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const m=this.authToken_,T=lC(m)?"auth":"gauth",I={cred:m};this.authOverride_===null?I.noauth=!0:typeof this.authOverride_=="object"&&(I.authvar=this.authOverride_),this.sendRequest(T,I,B=>{const H=B.s,Q=B.d||"error";this.authToken_===m&&(H==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(H,Q))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},m=>{const T=m.s,I=m.d||"error";T==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(T,I)})}unlisten(m,T){const I=m._path.toString(),B=m._queryIdentifier;this.log_("Unlisten called for "+I+" "+B),si(m._queryParams.isDefault()||!m._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(I,B)&&this.connected_&&this.sendUnlisten_(I,B,m._queryObject,T)}sendUnlisten_(m,T,I,B){this.log_("Unlisten on "+m+" for "+T);const H={p:m},Q="n";B&&(H.q=I,H.t=B),this.sendRequest(Q,H)}onDisconnectPut(m,T,I){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",m,T,I):this.onDisconnectRequestQueue_.push({pathString:m,action:"o",data:T,onComplete:I})}onDisconnectMerge(m,T,I){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",m,T,I):this.onDisconnectRequestQueue_.push({pathString:m,action:"om",data:T,onComplete:I})}onDisconnectCancel(m,T){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",m,null,T):this.onDisconnectRequestQueue_.push({pathString:m,action:"oc",data:null,onComplete:T})}sendOnDisconnect_(m,T,I,B){const H={p:T,d:I};this.log_("onDisconnect "+m,H),this.sendRequest(m,H,Q=>{B&&setTimeout(()=>{B(Q.s,Q.d)},Math.floor(0))})}put(m,T,I,B){this.putInternal("p",m,T,I,B)}merge(m,T,I,B){this.putInternal("m",m,T,I,B)}putInternal(m,T,I,B,H){this.initConnection_();const Q={p:T,d:I};H!==void 0&&(Q.h=H),this.outstandingPuts_.push({action:m,request:Q,onComplete:B}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+T)}sendPut_(m){const T=this.outstandingPuts_[m].action,I=this.outstandingPuts_[m].request,B=this.outstandingPuts_[m].onComplete;this.outstandingPuts_[m].queued=this.connected_,this.sendRequest(T,I,H=>{this.log_(T+" response",H),delete this.outstandingPuts_[m],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),B&&B(H.s,H.d)})}reportStats(m){if(this.connected_){const T={c:m};this.log_("reportStats",T),this.sendRequest("s",T,I=>{if(I.s!=="ok"){const H=I.d;this.log_("reportStats","Error sending stats: "+H)}})}}onDataMessage_(m){if("r"in m){this.log_("from server: "+mo(m));const T=m.r,I=this.requestCBHash_[T];I&&(delete this.requestCBHash_[T],I(m.b))}else{if("error"in m)throw"A server-side error has occurred: "+m.error;"a"in m&&this.onDataPush_(m.a,m.b)}}onDataPush_(m,T){this.log_("handleServerMessage",m,T),m==="d"?this.onDataUpdate_(T.p,T.d,!1,T.t):m==="m"?this.onDataUpdate_(T.p,T.d,!0,T.t):m==="c"?this.onListenRevoked_(T.p,T.q):m==="ac"?this.onAuthRevoked_(T.s,T.d):m==="apc"?this.onAppCheckRevoked_(T.s,T.d):m==="sd"?this.onSecurityDebugPacket_(T):tx("Unrecognized action received from server: "+mo(m)+`
Are you using the latest client?`)}onReady_(m,T){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(m),this.lastSessionId=T,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(m){si(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(m))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(m){m&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=hg,this.realtime_||this.scheduleConnect_(0)),this.visible_=m}onOnline_(m){m?(this.log_("Browser went online."),this.reconnectDelay_=hg,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>wM&&(this.reconnectDelay_=hg),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const m=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let T=Math.max(0,this.reconnectDelay_-m);T=Math.random()*T,this.log_("Trying to reconnect in "+T+"ms"),this.scheduleConnect_(T),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*bM)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const m=this.onDataMessage_.bind(this),T=this.onReady_.bind(this),I=this.onRealtimeDisconnect_.bind(this),B=this.id+":"+Rd.nextConnectionId_++,H=this.lastSessionId;let Q=!1,o=null;const xe=function(){o?o.close():(Q=!0,I())},pe=function(nt){si(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(nt)};this.realtime_={close:xe,sendRequest:pe};const Ke=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[nt,Je]=await Promise.all([this.authTokenProvider_.getToken(Ke),this.appCheckTokenProvider_.getToken(Ke)]);Q?Ko("getToken() completed but was canceled"):(Ko("getToken() completed. Creating connection."),this.authToken_=nt&&nt.accessToken,this.appCheckToken_=Je&&Je.token,o=new mM(B,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,m,T,I,Kt=>{kl(Kt+" ("+this.repoInfo_.toString()+")"),this.interrupt(TM)},H))}catch(nt){this.log_("Failed to get token: "+nt),Q||(this.repoInfo_.nodeAdmin&&kl(nt),xe())}}}interrupt(m){Ko("Interrupting connection for reason: "+m),this.interruptReasons_[m]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(m){Ko("Resuming connection for reason: "+m),delete this.interruptReasons_[m],Lw(this.interruptReasons_)&&(this.reconnectDelay_=hg,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(m){const T=m-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:T})}cancelSentTransactions_(){for(let m=0;m<this.outstandingPuts_.length;m++){const T=this.outstandingPuts_[m];T&&"h"in T.request&&T.queued&&(T.onComplete&&T.onComplete("disconnect"),delete this.outstandingPuts_[m],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(m,T){let I;T?I=T.map(H=>xx(H)).join("$"):I="default";const B=this.removeListen_(m,I);B&&B.onComplete&&B.onComplete("permission_denied")}removeListen_(m,T){const I=new Fr(m).toString();let B;if(this.listens.has(I)){const H=this.listens.get(I);B=H.get(T),H.delete(T),H.size===0&&this.listens.delete(I)}else B=void 0;return B}onAuthRevoked_(m,T){Ko("Auth token revoked: "+m+"/"+T),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(m==="invalid_token"||m==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=rT&&(this.reconnectDelay_=nT,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(m,T){Ko("App check token revoked: "+m+"/"+T),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(m==="invalid_token"||m==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=rT&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(m){this.securityDebugCallback_?this.securityDebugCallback_(m):"msg"in m&&console.log("FIREBASE: "+m.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const m of this.listens.values())for(const T of m.values())this.sendListen_(T);for(let m=0;m<this.outstandingPuts_.length;m++)this.outstandingPuts_[m]&&this.sendPut_(m);for(;this.onDisconnectRequestQueue_.length;){const m=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(m.action,m.pathString,m.data,m.onComplete)}for(let m=0;m<this.outstandingGets_.length;m++)this.outstandingGets_[m]&&this.sendGet_(m)}sendConnectStats_(){const m={};let T="js";m["sdk."+T+"."+VT.replace(/\./g,"-")]=1,DT()?m["framework.cordova"]=1:tC()&&(m["framework.reactnative"]=1),this.reportStats(m)}shouldReconnect_(){const m=sv.getInstance().currentlyOnline();return Lw(this.interruptReasons_)&&m}}Rd.nextPersistentConnectionId_=0;Rd.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(m,T){this.name=m,this.node=T}static Wrap(m,T){return new tr(m,T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vv{getCompare(){return this.compare.bind(this)}indexedValueChanged(m,T){const I=new tr(n_,m),B=new tr(n_,T);return this.compare(I,B)!==0}minPost(){return tr.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Xy;class mS extends vv{static get __EMPTY_NODE(){return Xy}static set __EMPTY_NODE(m){Xy=m}compare(m,T){return a_(m.name,T.name)}isDefinedOn(m){throw o_("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(m,T){return!1}minPost(){return tr.MIN}maxPost(){return new tr(Qp,Xy)}makePost(m,T){return si(typeof m=="string","KeyIndex indexValue must always be a string."),new tr(m,Xy)}toString(){return".key"}}const e_=new mS;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wy{constructor(m,T,I,B,H=null){this.isReverse_=B,this.resultGenerator_=H,this.nodeStack_=[];let Q=1;for(;!m.isEmpty();)if(m=m,Q=T?I(m.key,T):1,B&&(Q*=-1),Q<0)this.isReverse_?m=m.left:m=m.right;else if(Q===0){this.nodeStack_.push(m);break}else this.nodeStack_.push(m),this.isReverse_?m=m.right:m=m.left}getNext(){if(this.nodeStack_.length===0)return null;let m=this.nodeStack_.pop(),T;if(this.resultGenerator_?T=this.resultGenerator_(m.key,m.value):T={key:m.key,value:m.value},this.isReverse_)for(m=m.left;!m.isEmpty();)this.nodeStack_.push(m),m=m.right;else for(m=m.right;!m.isEmpty();)this.nodeStack_.push(m),m=m.left;return T}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const m=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(m.key,m.value):{key:m.key,value:m.value}}}class po{constructor(m,T,I,B,H){this.key=m,this.value=T,this.color=I??po.RED,this.left=B??il.EMPTY_NODE,this.right=H??il.EMPTY_NODE}copy(m,T,I,B,H){return new po(m??this.key,T??this.value,I??this.color,B??this.left,H??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(m){return this.left.inorderTraversal(m)||!!m(this.key,this.value)||this.right.inorderTraversal(m)}reverseTraversal(m){return this.right.reverseTraversal(m)||m(this.key,this.value)||this.left.reverseTraversal(m)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(m,T,I){let B=this;const H=I(m,B.key);return H<0?B=B.copy(null,null,null,B.left.insert(m,T,I),null):H===0?B=B.copy(null,T,null,null,null):B=B.copy(null,null,null,null,B.right.insert(m,T,I)),B.fixUp_()}removeMin_(){if(this.left.isEmpty())return il.EMPTY_NODE;let m=this;return!m.left.isRed_()&&!m.left.left.isRed_()&&(m=m.moveRedLeft_()),m=m.copy(null,null,null,m.left.removeMin_(),null),m.fixUp_()}remove(m,T){let I,B;if(I=this,T(m,I.key)<0)!I.left.isEmpty()&&!I.left.isRed_()&&!I.left.left.isRed_()&&(I=I.moveRedLeft_()),I=I.copy(null,null,null,I.left.remove(m,T),null);else{if(I.left.isRed_()&&(I=I.rotateRight_()),!I.right.isEmpty()&&!I.right.isRed_()&&!I.right.left.isRed_()&&(I=I.moveRedRight_()),T(m,I.key)===0){if(I.right.isEmpty())return il.EMPTY_NODE;B=I.right.min_(),I=I.copy(B.key,B.value,null,null,I.right.removeMin_())}I=I.copy(null,null,null,null,I.right.remove(m,T))}return I.fixUp_()}isRed_(){return this.color}fixUp_(){let m=this;return m.right.isRed_()&&!m.left.isRed_()&&(m=m.rotateLeft_()),m.left.isRed_()&&m.left.left.isRed_()&&(m=m.rotateRight_()),m.left.isRed_()&&m.right.isRed_()&&(m=m.colorFlip_()),m}moveRedLeft_(){let m=this.colorFlip_();return m.right.left.isRed_()&&(m=m.copy(null,null,null,null,m.right.rotateRight_()),m=m.rotateLeft_(),m=m.colorFlip_()),m}moveRedRight_(){let m=this.colorFlip_();return m.left.left.isRed_()&&(m=m.rotateRight_(),m=m.colorFlip_()),m}rotateLeft_(){const m=this.copy(null,null,po.RED,null,this.right.left);return this.right.copy(null,null,this.color,m,null)}rotateRight_(){const m=this.copy(null,null,po.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,m)}colorFlip_(){const m=this.left.copy(null,null,!this.left.color,null,null),T=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,m,T)}checkMaxDepth_(){const m=this.check_();return Math.pow(2,m)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const m=this.left.check_();if(m!==this.right.check_())throw new Error("Black depths differ");return m+(this.isRed_()?0:1)}}po.RED=!0;po.BLACK=!1;class SM{copy(m,T,I,B,H){return this}insert(m,T,I){return new po(m,T,null)}remove(m,T){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(m){return!1}reverseTraversal(m){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class il{constructor(m,T=il.EMPTY_NODE){this.comparator_=m,this.root_=T}insert(m,T){return new il(this.comparator_,this.root_.insert(m,T,this.comparator_).copy(null,null,po.BLACK,null,null))}remove(m){return new il(this.comparator_,this.root_.remove(m,this.comparator_).copy(null,null,po.BLACK,null,null))}get(m){let T,I=this.root_;for(;!I.isEmpty();){if(T=this.comparator_(m,I.key),T===0)return I.value;T<0?I=I.left:T>0&&(I=I.right)}return null}getPredecessorKey(m){let T,I=this.root_,B=null;for(;!I.isEmpty();)if(T=this.comparator_(m,I.key),T===0){if(I.left.isEmpty())return B?B.key:null;for(I=I.left;!I.right.isEmpty();)I=I.right;return I.key}else T<0?I=I.left:T>0&&(B=I,I=I.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(m){return this.root_.inorderTraversal(m)}reverseTraversal(m){return this.root_.reverseTraversal(m)}getIterator(m){return new Wy(this.root_,null,this.comparator_,!1,m)}getIteratorFrom(m,T){return new Wy(this.root_,m,this.comparator_,!1,T)}getReverseIteratorFrom(m,T){return new Wy(this.root_,m,this.comparator_,!0,T)}getReverseIterator(m){return new Wy(this.root_,null,this.comparator_,!0,m)}}il.EMPTY_NODE=new SM;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EM(E,m){return a_(E.name,m.name)}function Ax(E,m){return a_(E,m)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let nx;function AM(E){nx=E}const _S=function(E){return typeof E=="number"?"number:"+ZT(E):"string:"+E},gS=function(E){if(E.isLeafNode()){const m=E.val();si(typeof m=="string"||typeof m=="number"||typeof m=="object"&&Ld(m,".sv"),"Priority must be a string or number.")}else si(E===nx||E.isEmpty(),"priority of unexpected type.");si(E===nx||E.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let sT;class fo{static set __childrenNodeConstructor(m){sT=m}static get __childrenNodeConstructor(){return sT}constructor(m,T=fo.__childrenNodeConstructor.EMPTY_NODE){this.value_=m,this.priorityNode_=T,this.lazyHash_=null,si(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),gS(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(m){return new fo(this.value_,m)}getImmediateChild(m){return m===".priority"?this.priorityNode_:fo.__childrenNodeConstructor.EMPTY_NODE}getChild(m){return lr(m)?this:ar(m)===".priority"?this.priorityNode_:fo.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(m,T){return null}updateImmediateChild(m,T){return m===".priority"?this.updatePriority(T):T.isEmpty()&&m!==".priority"?this:fo.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(m,T).updatePriority(this.priorityNode_)}updateChild(m,T){const I=ar(m);return I===null?T:T.isEmpty()&&I!==".priority"?this:(si(I!==".priority"||Uf(m)===1,".priority must be the last token in a path"),this.updateImmediateChild(I,fo.__childrenNodeConstructor.EMPTY_NODE.updateChild(qr(m),T)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(m,T){return!1}val(m){return m&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let m="";this.priorityNode_.isEmpty()||(m+="priority:"+_S(this.priorityNode_.val())+":");const T=typeof this.value_;m+=T+":",T==="number"?m+=ZT(this.value_):m+=this.value_,this.lazyHash_=GT(m)}return this.lazyHash_}getValue(){return this.value_}compareTo(m){return m===fo.__childrenNodeConstructor.EMPTY_NODE?1:m instanceof fo.__childrenNodeConstructor?-1:(si(m.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(m))}compareToLeafNode_(m){const T=typeof m.value_,I=typeof this.value_,B=fo.VALUE_TYPE_ORDER.indexOf(T),H=fo.VALUE_TYPE_ORDER.indexOf(I);return si(B>=0,"Unknown leaf type: "+T),si(H>=0,"Unknown leaf type: "+I),B===H?I==="object"?0:this.value_<m.value_?-1:this.value_===m.value_?0:1:H-B}withIndex(){return this}isIndexed(){return!0}equals(m){if(m===this)return!0;if(m.isLeafNode()){const T=m;return this.value_===T.value_&&this.priorityNode_.equals(T.priorityNode_)}else return!1}}fo.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yS,vS;function CM(E){yS=E}function IM(E){vS=E}class MM extends vv{compare(m,T){const I=m.node.getPriority(),B=T.node.getPriority(),H=I.compareTo(B);return H===0?a_(m.name,T.name):H}isDefinedOn(m){return!m.getPriority().isEmpty()}indexedValueChanged(m,T){return!m.getPriority().equals(T.getPriority())}minPost(){return tr.MIN}maxPost(){return new tr(Qp,new fo("[PRIORITY-POST]",vS))}makePost(m,T){const I=yS(m);return new tr(T,new fo("[PRIORITY-POST]",I))}toString(){return".priority"}}const gs=new MM;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RM=Math.log(2);class DM{constructor(m){const T=H=>parseInt(Math.log(H)/RM,10),I=H=>parseInt(Array(H+1).join("1"),2);this.count=T(m+1),this.current_=this.count-1;const B=I(this.count);this.bits_=m+1&B}nextBitIsOne(){const m=!(this.bits_&1<<this.current_);return this.current_--,m}}const ov=function(E,m,T,I){E.sort(m);const B=function(xe,pe){const Ke=pe-xe;let nt,Je;if(Ke===0)return null;if(Ke===1)return nt=E[xe],Je=T?T(nt):nt,new po(Je,nt.node,po.BLACK,null,null);{const Kt=parseInt(Ke/2,10)+xe,pi=B(xe,Kt),Yt=B(Kt+1,pe);return nt=E[Kt],Je=T?T(nt):nt,new po(Je,nt.node,po.BLACK,pi,Yt)}},H=function(xe){let pe=null,Ke=null,nt=E.length;const Je=function(pi,Yt){const Qi=nt-pi,Ji=nt;nt-=pi;const Yn=B(Qi+1,Ji),xn=E[Qi],Nr=T?T(xn):xn;Kt(new po(Nr,xn.node,Yt,null,Yn))},Kt=function(pi){pe?(pe.left=pi,pe=pi):(Ke=pi,pe=pi)};for(let pi=0;pi<xe.count;++pi){const Yt=xe.nextBitIsOne(),Qi=Math.pow(2,xe.count-(pi+1));Yt?Je(Qi,po.BLACK):(Je(Qi,po.BLACK),Je(Qi,po.RED))}return Ke},Q=new DM(E.length),o=H(Q);return new il(I||m,o)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let H0;const $m={};class Md{static get Default(){return si($m&&gs,"ChildrenNode.ts has not been loaded"),H0=H0||new Md({".priority":$m},{".priority":gs}),H0}constructor(m,T){this.indexes_=m,this.indexSet_=T}get(m){const T=i_(this.indexes_,m);if(!T)throw new Error("No index defined for "+m);return T instanceof il?T:null}hasIndex(m){return Ld(this.indexSet_,m.toString())}addIndex(m,T){si(m!==e_,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const I=[];let B=!1;const H=T.getIterator(tr.Wrap);let Q=H.getNext();for(;Q;)B=B||m.isDefinedOn(Q.node),I.push(Q),Q=H.getNext();let o;B?o=ov(I,m.getCompare()):o=$m;const xe=m.toString(),pe=Object.assign({},this.indexSet_);pe[xe]=m;const Ke=Object.assign({},this.indexes_);return Ke[xe]=o,new Md(Ke,pe)}addToIndexes(m,T){const I=ev(this.indexes_,(B,H)=>{const Q=i_(this.indexSet_,H);if(si(Q,"Missing index implementation for "+H),B===$m)if(Q.isDefinedOn(m.node)){const o=[],xe=T.getIterator(tr.Wrap);let pe=xe.getNext();for(;pe;)pe.name!==m.name&&o.push(pe),pe=xe.getNext();return o.push(m),ov(o,Q.getCompare())}else return $m;else{const o=T.get(m.name);let xe=B;return o&&(xe=xe.remove(new tr(m.name,o))),xe.insert(m,m.node)}});return new Md(I,this.indexSet_)}removeFromIndexes(m,T){const I=ev(this.indexes_,B=>{if(B===$m)return B;{const H=T.get(m.name);return H?B.remove(new tr(m.name,H)):B}});return new Md(I,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let dg;class ln{static get EMPTY_NODE(){return dg||(dg=new ln(new il(Ax),null,Md.Default))}constructor(m,T,I){this.children_=m,this.priorityNode_=T,this.indexMap_=I,this.lazyHash_=null,this.priorityNode_&&gS(this.priorityNode_),this.children_.isEmpty()&&si(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||dg}updatePriority(m){return this.children_.isEmpty()?this:new ln(this.children_,m,this.indexMap_)}getImmediateChild(m){if(m===".priority")return this.getPriority();{const T=this.children_.get(m);return T===null?dg:T}}getChild(m){const T=ar(m);return T===null?this:this.getImmediateChild(T).getChild(qr(m))}hasChild(m){return this.children_.get(m)!==null}updateImmediateChild(m,T){if(si(T,"We should always be passing snapshot nodes"),m===".priority")return this.updatePriority(T);{const I=new tr(m,T);let B,H;T.isEmpty()?(B=this.children_.remove(m),H=this.indexMap_.removeFromIndexes(I,this.children_)):(B=this.children_.insert(m,T),H=this.indexMap_.addToIndexes(I,this.children_));const Q=B.isEmpty()?dg:this.priorityNode_;return new ln(B,Q,H)}}updateChild(m,T){const I=ar(m);if(I===null)return T;{si(ar(m)!==".priority"||Uf(m)===1,".priority must be the last token in a path");const B=this.getImmediateChild(I).updateChild(qr(m),T);return this.updateImmediateChild(I,B)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(m){if(this.isEmpty())return null;const T={};let I=0,B=0,H=!0;if(this.forEachChild(gs,(Q,o)=>{T[Q]=o.val(m),I++,H&&ln.INTEGER_REGEXP_.test(Q)?B=Math.max(B,Number(Q)):H=!1}),!m&&H&&B<2*I){const Q=[];for(const o in T)Q[o]=T[o];return Q}else return m&&!this.getPriority().isEmpty()&&(T[".priority"]=this.getPriority().val()),T}hash(){if(this.lazyHash_===null){let m="";this.getPriority().isEmpty()||(m+="priority:"+_S(this.getPriority().val())+":"),this.forEachChild(gs,(T,I)=>{const B=I.hash();B!==""&&(m+=":"+T+":"+B)}),this.lazyHash_=m===""?"":GT(m)}return this.lazyHash_}getPredecessorChildName(m,T,I){const B=this.resolveIndex_(I);if(B){const H=B.getPredecessorKey(new tr(m,T));return H?H.name:null}else return this.children_.getPredecessorKey(m)}getFirstChildName(m){const T=this.resolveIndex_(m);if(T){const I=T.minKey();return I&&I.name}else return this.children_.minKey()}getFirstChild(m){const T=this.getFirstChildName(m);return T?new tr(T,this.children_.get(T)):null}getLastChildName(m){const T=this.resolveIndex_(m);if(T){const I=T.maxKey();return I&&I.name}else return this.children_.maxKey()}getLastChild(m){const T=this.getLastChildName(m);return T?new tr(T,this.children_.get(T)):null}forEachChild(m,T){const I=this.resolveIndex_(m);return I?I.inorderTraversal(B=>T(B.name,B.node)):this.children_.inorderTraversal(T)}getIterator(m){return this.getIteratorFrom(m.minPost(),m)}getIteratorFrom(m,T){const I=this.resolveIndex_(T);if(I)return I.getIteratorFrom(m,B=>B);{const B=this.children_.getIteratorFrom(m.name,tr.Wrap);let H=B.peek();for(;H!=null&&T.compare(H,m)<0;)B.getNext(),H=B.peek();return B}}getReverseIterator(m){return this.getReverseIteratorFrom(m.maxPost(),m)}getReverseIteratorFrom(m,T){const I=this.resolveIndex_(T);if(I)return I.getReverseIteratorFrom(m,B=>B);{const B=this.children_.getReverseIteratorFrom(m.name,tr.Wrap);let H=B.peek();for(;H!=null&&T.compare(H,m)>0;)B.getNext(),H=B.peek();return B}}compareTo(m){return this.isEmpty()?m.isEmpty()?0:-1:m.isLeafNode()||m.isEmpty()?1:m===Lg?-1:0}withIndex(m){if(m===e_||this.indexMap_.hasIndex(m))return this;{const T=this.indexMap_.addIndex(m,this.children_);return new ln(this.children_,this.priorityNode_,T)}}isIndexed(m){return m===e_||this.indexMap_.hasIndex(m)}equals(m){if(m===this)return!0;if(m.isLeafNode())return!1;{const T=m;if(this.getPriority().equals(T.getPriority()))if(this.children_.count()===T.children_.count()){const I=this.getIterator(gs),B=T.getIterator(gs);let H=I.getNext(),Q=B.getNext();for(;H&&Q;){if(H.name!==Q.name||!H.node.equals(Q.node))return!1;H=I.getNext(),Q=B.getNext()}return H===null&&Q===null}else return!1;else return!1}}resolveIndex_(m){return m===e_?null:this.indexMap_.get(m.toString())}}ln.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class zM extends ln{constructor(){super(new il(Ax),ln.EMPTY_NODE,Md.Default)}compareTo(m){return m===this?0:1}equals(m){return m===this}getPriority(){return this}getImmediateChild(m){return ln.EMPTY_NODE}isEmpty(){return!1}}const Lg=new zM;Object.defineProperties(tr,{MIN:{value:new tr(n_,ln.EMPTY_NODE)},MAX:{value:new tr(Qp,Lg)}});mS.__EMPTY_NODE=ln.EMPTY_NODE;fo.__childrenNodeConstructor=ln;AM(Lg);IM(Lg);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LM=!0;function Qo(E,m=null){if(E===null)return ln.EMPTY_NODE;if(typeof E=="object"&&".priority"in E&&(m=E[".priority"]),si(m===null||typeof m=="string"||typeof m=="number"||typeof m=="object"&&".sv"in m,"Invalid priority type found: "+typeof m),typeof E=="object"&&".value"in E&&E[".value"]!==null&&(E=E[".value"]),typeof E!="object"||".sv"in E){const T=E;return new fo(T,Qo(m))}if(!(E instanceof Array)&&LM){const T=[];let I=!1;if(nl(E,(Q,o)=>{if(Q.substring(0,1)!=="."){const xe=Qo(o);xe.isEmpty()||(I=I||!xe.getPriority().isEmpty(),T.push(new tr(Q,xe)))}}),T.length===0)return ln.EMPTY_NODE;const H=ov(T,EM,Q=>Q.name,Ax);if(I){const Q=ov(T,gs.getCompare());return new ln(H,Qo(m),new Md({".priority":Q},{".priority":gs}))}else return new ln(H,Qo(m),Md.Default)}else{let T=ln.EMPTY_NODE;return nl(E,(I,B)=>{if(Ld(E,I)&&I.substring(0,1)!=="."){const H=Qo(B);(H.isLeafNode()||!H.isEmpty())&&(T=T.updateImmediateChild(I,H))}}),T.updatePriority(Qo(m))}}CM(Qo);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PM extends vv{constructor(m){super(),this.indexPath_=m,si(!lr(m)&&ar(m)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(m){return m.getChild(this.indexPath_)}isDefinedOn(m){return!m.getChild(this.indexPath_).isEmpty()}compare(m,T){const I=this.extractChild(m.node),B=this.extractChild(T.node),H=I.compareTo(B);return H===0?a_(m.name,T.name):H}makePost(m,T){const I=Qo(m),B=ln.EMPTY_NODE.updateChild(this.indexPath_,I);return new tr(T,B)}maxPost(){const m=ln.EMPTY_NODE.updateChild(this.indexPath_,Lg);return new tr(Qp,m)}toString(){return dS(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OM extends vv{compare(m,T){const I=m.node.compareTo(T.node);return I===0?a_(m.name,T.name):I}isDefinedOn(m){return!0}indexedValueChanged(m,T){return!m.equals(T)}minPost(){return tr.MIN}maxPost(){return tr.MAX}makePost(m,T){const I=Qo(m);return new tr(T,I)}toString(){return".value"}}const kM=new OM;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xS(E){return{type:"value",snapshotNode:E}}function r_(E,m){return{type:"child_added",snapshotNode:m,childName:E}}function Sg(E,m){return{type:"child_removed",snapshotNode:m,childName:E}}function Eg(E,m,T){return{type:"child_changed",snapshotNode:m,childName:E,oldSnap:T}}function BM(E,m){return{type:"child_moved",snapshotNode:m,childName:E}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cx{constructor(m){this.index_=m}updateChild(m,T,I,B,H,Q){si(m.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=m.getImmediateChild(T);return o.getChild(B).equals(I.getChild(B))&&o.isEmpty()===I.isEmpty()||(Q!=null&&(I.isEmpty()?m.hasChild(T)?Q.trackChildChange(Sg(T,o)):si(m.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?Q.trackChildChange(r_(T,I)):Q.trackChildChange(Eg(T,I,o))),m.isLeafNode()&&I.isEmpty())?m:m.updateImmediateChild(T,I).withIndex(this.index_)}updateFullNode(m,T,I){return I!=null&&(m.isLeafNode()||m.forEachChild(gs,(B,H)=>{T.hasChild(B)||I.trackChildChange(Sg(B,H))}),T.isLeafNode()||T.forEachChild(gs,(B,H)=>{if(m.hasChild(B)){const Q=m.getImmediateChild(B);Q.equals(H)||I.trackChildChange(Eg(B,H,Q))}else I.trackChildChange(r_(B,H))})),T.withIndex(this.index_)}updatePriority(m,T){return m.isEmpty()?ln.EMPTY_NODE:m.updatePriority(T)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(m){this.indexedFilter_=new Cx(m.getIndex()),this.index_=m.getIndex(),this.startPost_=Ag.getStartPost_(m),this.endPost_=Ag.getEndPost_(m),this.startIsInclusive_=!m.startAfterSet_,this.endIsInclusive_=!m.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(m){const T=this.startIsInclusive_?this.index_.compare(this.getStartPost(),m)<=0:this.index_.compare(this.getStartPost(),m)<0,I=this.endIsInclusive_?this.index_.compare(m,this.getEndPost())<=0:this.index_.compare(m,this.getEndPost())<0;return T&&I}updateChild(m,T,I,B,H,Q){return this.matches(new tr(T,I))||(I=ln.EMPTY_NODE),this.indexedFilter_.updateChild(m,T,I,B,H,Q)}updateFullNode(m,T,I){T.isLeafNode()&&(T=ln.EMPTY_NODE);let B=T.withIndex(this.index_);B=B.updatePriority(ln.EMPTY_NODE);const H=this;return T.forEachChild(gs,(Q,o)=>{H.matches(new tr(Q,o))||(B=B.updateImmediateChild(Q,ln.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(m,B,I)}updatePriority(m,T){return m}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(m){if(m.hasStart()){const T=m.getIndexStartName();return m.getIndex().makePost(m.getIndexStartValue(),T)}else return m.getIndex().minPost()}static getEndPost_(m){if(m.hasEnd()){const T=m.getIndexEndName();return m.getIndex().makePost(m.getIndexEndValue(),T)}else return m.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FM{constructor(m){this.withinDirectionalStart=T=>this.reverse_?this.withinEndPost(T):this.withinStartPost(T),this.withinDirectionalEnd=T=>this.reverse_?this.withinStartPost(T):this.withinEndPost(T),this.withinStartPost=T=>{const I=this.index_.compare(this.rangedFilter_.getStartPost(),T);return this.startIsInclusive_?I<=0:I<0},this.withinEndPost=T=>{const I=this.index_.compare(T,this.rangedFilter_.getEndPost());return this.endIsInclusive_?I<=0:I<0},this.rangedFilter_=new Ag(m),this.index_=m.getIndex(),this.limit_=m.getLimit(),this.reverse_=!m.isViewFromLeft(),this.startIsInclusive_=!m.startAfterSet_,this.endIsInclusive_=!m.endBeforeSet_}updateChild(m,T,I,B,H,Q){return this.rangedFilter_.matches(new tr(T,I))||(I=ln.EMPTY_NODE),m.getImmediateChild(T).equals(I)?m:m.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(m,T,I,B,H,Q):this.fullLimitUpdateChild_(m,T,I,H,Q)}updateFullNode(m,T,I){let B;if(T.isLeafNode()||T.isEmpty())B=ln.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<T.numChildren()&&T.isIndexed(this.index_)){B=ln.EMPTY_NODE.withIndex(this.index_);let H;this.reverse_?H=T.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):H=T.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let Q=0;for(;H.hasNext()&&Q<this.limit_;){const o=H.getNext();if(this.withinDirectionalStart(o))if(this.withinDirectionalEnd(o))B=B.updateImmediateChild(o.name,o.node),Q++;else break;else continue}}else{B=T.withIndex(this.index_),B=B.updatePriority(ln.EMPTY_NODE);let H;this.reverse_?H=B.getReverseIterator(this.index_):H=B.getIterator(this.index_);let Q=0;for(;H.hasNext();){const o=H.getNext();Q<this.limit_&&this.withinDirectionalStart(o)&&this.withinDirectionalEnd(o)?Q++:B=B.updateImmediateChild(o.name,ln.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(m,B,I)}updatePriority(m,T){return m}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(m,T,I,B,H){let Q;if(this.reverse_){const nt=this.index_.getCompare();Q=(Je,Kt)=>nt(Kt,Je)}else Q=this.index_.getCompare();const o=m;si(o.numChildren()===this.limit_,"");const xe=new tr(T,I),pe=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),Ke=this.rangedFilter_.matches(xe);if(o.hasChild(T)){const nt=o.getImmediateChild(T);let Je=B.getChildAfterChild(this.index_,pe,this.reverse_);for(;Je!=null&&(Je.name===T||o.hasChild(Je.name));)Je=B.getChildAfterChild(this.index_,Je,this.reverse_);const Kt=Je==null?1:Q(Je,xe);if(Ke&&!I.isEmpty()&&Kt>=0)return H?.trackChildChange(Eg(T,I,nt)),o.updateImmediateChild(T,I);{H?.trackChildChange(Sg(T,nt));const Yt=o.updateImmediateChild(T,ln.EMPTY_NODE);return Je!=null&&this.rangedFilter_.matches(Je)?(H?.trackChildChange(r_(Je.name,Je.node)),Yt.updateImmediateChild(Je.name,Je.node)):Yt}}else return I.isEmpty()?m:Ke&&Q(pe,xe)>=0?(H!=null&&(H.trackChildChange(Sg(pe.name,pe.node)),H.trackChildChange(r_(T,I))),o.updateImmediateChild(T,I).updateImmediateChild(pe.name,ln.EMPTY_NODE)):m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=gs}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return si(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return si(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:n_}hasEnd(){return this.endSet_}getIndexEndValue(){return si(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return si(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Qp}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return si(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===gs}copy(){const m=new Ix;return m.limitSet_=this.limitSet_,m.limit_=this.limit_,m.startSet_=this.startSet_,m.startAfterSet_=this.startAfterSet_,m.indexStartValue_=this.indexStartValue_,m.startNameSet_=this.startNameSet_,m.indexStartName_=this.indexStartName_,m.endSet_=this.endSet_,m.endBeforeSet_=this.endBeforeSet_,m.indexEndValue_=this.indexEndValue_,m.endNameSet_=this.endNameSet_,m.indexEndName_=this.indexEndName_,m.index_=this.index_,m.viewFrom_=this.viewFrom_,m}}function NM(E){return E.loadsAllData()?new Cx(E.getIndex()):E.hasLimit()?new FM(E):new Ag(E)}function oT(E){const m={};if(E.isDefault())return m;let T;if(E.index_===gs?T="$priority":E.index_===kM?T="$value":E.index_===e_?T="$key":(si(E.index_ instanceof PM,"Unrecognized index type!"),T=E.index_.toString()),m.orderBy=mo(T),E.startSet_){const I=E.startAfterSet_?"startAfter":"startAt";m[I]=mo(E.indexStartValue_),E.startNameSet_&&(m[I]+=","+mo(E.indexStartName_))}if(E.endSet_){const I=E.endBeforeSet_?"endBefore":"endAt";m[I]=mo(E.indexEndValue_),E.endNameSet_&&(m[I]+=","+mo(E.indexEndName_))}return E.limitSet_&&(E.isViewFromLeft()?m.limitToFirst=E.limit_:m.limitToLast=E.limit_),m}function aT(E){const m={};if(E.startSet_&&(m.sp=E.indexStartValue_,E.startNameSet_&&(m.sn=E.indexStartName_),m.sin=!E.startAfterSet_),E.endSet_&&(m.ep=E.indexEndValue_,E.endNameSet_&&(m.en=E.indexEndName_),m.ein=!E.endBeforeSet_),E.limitSet_){m.l=E.limit_;let T=E.viewFrom_;T===""&&(E.isViewFromLeft()?T="l":T="r"),m.vf=T}return E.index_!==gs&&(m.i=E.index_.toString()),m}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class av extends cS{reportStats(m){throw new Error("Method not implemented.")}static getListenId_(m,T){return T!==void 0?"tag$"+T:(si(m._queryParams.isDefault(),"should have a tag if it's not a default query."),m._path.toString())}constructor(m,T,I,B){super(),this.repoInfo_=m,this.onDataUpdate_=T,this.authTokenProvider_=I,this.appCheckTokenProvider_=B,this.log_=Dg("p:rest:"),this.listens_={}}listen(m,T,I,B){const H=m._path.toString();this.log_("Listen called for "+H+" "+m._queryIdentifier);const Q=av.getListenId_(m,I),o={};this.listens_[Q]=o;const xe=oT(m._queryParams);this.restRequest_(H+".json",xe,(pe,Ke)=>{let nt=Ke;if(pe===404&&(nt=null,pe=null),pe===null&&this.onDataUpdate_(H,nt,!1,I),i_(this.listens_,Q)===o){let Je;pe?pe===401?Je="permission_denied":Je="rest_error:"+pe:Je="ok",B(Je,null)}})}unlisten(m,T){const I=av.getListenId_(m,T);delete this.listens_[I]}get(m){const T=oT(m._queryParams),I=m._path.toString(),B=new gx;return this.restRequest_(I+".json",T,(H,Q)=>{let o=Q;H===404&&(o=null,H=null),H===null?(this.onDataUpdate_(I,o,!1,null),B.resolve(o)):B.reject(new Error(o))}),B.promise}refreshAuthToken(m){}restRequest_(m,T={},I){return T.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([B,H])=>{B&&B.accessToken&&(T.auth=B.accessToken),H&&H.token&&(T.ac=H.token);const Q=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+m+"?ns="+this.repoInfo_.namespace+uC(T);this.log_("Sending REST request for "+Q);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(I&&o.readyState===4){this.log_("REST Response for "+Q+" received. status:",o.status,"response:",o.responseText);let xe=null;if(o.status>=200&&o.status<300){try{xe=xg(o.responseText)}catch{kl("Failed to parse JSON response for "+Q+": "+o.responseText)}I(null,xe)}else o.status!==401&&o.status!==404&&kl("Got unsuccessful REST response for "+Q+" Status: "+o.status),I(o.status);I=null}},o.open("GET",Q,!0),o.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UM{constructor(){this.rootNode_=ln.EMPTY_NODE}getNode(m){return this.rootNode_.getChild(m)}updateSnapshot(m,T){this.rootNode_=this.rootNode_.updateChild(m,T)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lv(){return{value:null,children:new Map}}function bS(E,m,T){if(lr(m))E.value=T,E.children.clear();else if(E.value!==null)E.value=E.value.updateChild(m,T);else{const I=ar(m);E.children.has(I)||E.children.set(I,lv());const B=E.children.get(I);m=qr(m),bS(B,m,T)}}function rx(E,m,T){E.value!==null?T(m,E.value):VM(E,(I,B)=>{const H=new Fr(m.toString()+"/"+I);rx(B,H,T)})}function VM(E,m){E.children.forEach((T,I)=>{m(I,T)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jM{constructor(m){this.collection_=m,this.last_=null}get(){const m=this.collection_.get(),T=Object.assign({},m);return this.last_&&nl(this.last_,(I,B)=>{T[I]=T[I]-B}),this.last_=m,T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lT=10*1e3,GM=30*1e3,HM=5*60*1e3;class qM{constructor(m,T){this.server_=T,this.statsToReport_={},this.statsListener_=new jM(m);const I=lT+(GM-lT)*Math.random();_g(this.reportStats_.bind(this),Math.floor(I))}reportStats_(){const m=this.statsListener_.get(),T={};let I=!1;nl(m,(B,H)=>{H>0&&Ld(this.statsToReport_,B)&&(T[B]=H,I=!0)}),I&&this.server_.reportStats(T),_g(this.reportStats_.bind(this),Math.floor(Math.random()*2*HM))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var _u;(function(E){E[E.OVERWRITE=0]="OVERWRITE",E[E.MERGE=1]="MERGE",E[E.ACK_USER_WRITE=2]="ACK_USER_WRITE",E[E.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(_u||(_u={}));function wS(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Mx(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Rx(E){return{fromUser:!1,fromServer:!0,queryId:E,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cv{constructor(m,T,I){this.path=m,this.affectedTree=T,this.revert=I,this.type=_u.ACK_USER_WRITE,this.source=wS()}operationForChild(m){if(lr(this.path)){if(this.affectedTree.value!=null)return si(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const T=this.affectedTree.subtree(new Fr(m));return new cv(Er(),T,this.revert)}}else return si(ar(this.path)===m,"operationForChild called for unrelated child."),new cv(qr(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cg{constructor(m,T){this.source=m,this.path=T,this.type=_u.LISTEN_COMPLETE}operationForChild(m){return lr(this.path)?new Cg(this.source,Er()):new Cg(this.source,qr(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(m,T,I){this.source=m,this.path=T,this.snap=I,this.type=_u.OVERWRITE}operationForChild(m){return lr(this.path)?new Jp(this.source,Er(),this.snap.getImmediateChild(m)):new Jp(this.source,qr(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ig{constructor(m,T,I){this.source=m,this.path=T,this.children=I,this.type=_u.MERGE}operationForChild(m){if(lr(this.path)){const T=this.children.subtree(new Fr(m));return T.isEmpty()?null:T.value?new Jp(this.source,Er(),T.value):new Ig(this.source,Er(),T)}else return si(ar(this.path)===m,"Can't get a merge for a child not on the path of the operation"),new Ig(this.source,qr(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class em{constructor(m,T,I){this.node_=m,this.fullyInitialized_=T,this.filtered_=I}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(m){if(lr(m))return this.isFullyInitialized()&&!this.filtered_;const T=ar(m);return this.isCompleteForChild(T)}isCompleteForChild(m){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(m)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZM{constructor(m){this.query_=m,this.index_=this.query_._queryParams.getIndex()}}function XM(E,m,T,I){const B=[],H=[];return m.forEach(Q=>{Q.type==="child_changed"&&E.index_.indexedValueChanged(Q.oldSnap,Q.snapshotNode)&&H.push(BM(Q.childName,Q.snapshotNode))}),fg(E,B,"child_removed",m,I,T),fg(E,B,"child_added",m,I,T),fg(E,B,"child_moved",H,I,T),fg(E,B,"child_changed",m,I,T),fg(E,B,"value",m,I,T),B}function fg(E,m,T,I,B,H){const Q=I.filter(o=>o.type===T);Q.sort((o,xe)=>$M(E,o,xe)),Q.forEach(o=>{const xe=WM(E,o,H);B.forEach(pe=>{pe.respondsTo(o.type)&&m.push(pe.createEvent(xe,E.query_))})})}function WM(E,m,T){return m.type==="value"||m.type==="child_removed"||(m.prevName=T.getPredecessorChildName(m.childName,m.snapshotNode,E.index_)),m}function $M(E,m,T){if(m.childName==null||T.childName==null)throw o_("Should only compare child_ events.");const I=new tr(m.childName,m.snapshotNode),B=new tr(T.childName,T.snapshotNode);return E.index_.compare(I,B)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(E,m){return{eventCache:E,serverCache:m}}function gg(E,m,T,I){return xv(new em(m,T,I),E.serverCache)}function TS(E,m,T,I){return xv(E.eventCache,new em(m,T,I))}function sx(E){return E.eventCache.isFullyInitialized()?E.eventCache.getNode():null}function tm(E){return E.serverCache.isFullyInitialized()?E.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let q0;const YM=()=>(q0||(q0=new il(OI)),q0);class Yr{static fromObject(m){let T=new Yr(null);return nl(m,(I,B)=>{T=T.set(new Fr(I),B)}),T}constructor(m,T=YM()){this.value=m,this.children=T}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(m,T){if(this.value!=null&&T(this.value))return{path:Er(),value:this.value};if(lr(m))return null;{const I=ar(m),B=this.children.get(I);if(B!==null){const H=B.findRootMostMatchingPathAndValue(qr(m),T);return H!=null?{path:eo(new Fr(I),H.path),value:H.value}:null}else return null}}findRootMostValueAndPath(m){return this.findRootMostMatchingPathAndValue(m,()=>!0)}subtree(m){if(lr(m))return this;{const T=ar(m),I=this.children.get(T);return I!==null?I.subtree(qr(m)):new Yr(null)}}set(m,T){if(lr(m))return new Yr(T,this.children);{const I=ar(m),H=(this.children.get(I)||new Yr(null)).set(qr(m),T),Q=this.children.insert(I,H);return new Yr(this.value,Q)}}remove(m){if(lr(m))return this.children.isEmpty()?new Yr(null):new Yr(null,this.children);{const T=ar(m),I=this.children.get(T);if(I){const B=I.remove(qr(m));let H;return B.isEmpty()?H=this.children.remove(T):H=this.children.insert(T,B),this.value===null&&H.isEmpty()?new Yr(null):new Yr(this.value,H)}else return this}}get(m){if(lr(m))return this.value;{const T=ar(m),I=this.children.get(T);return I?I.get(qr(m)):null}}setTree(m,T){if(lr(m))return T;{const I=ar(m),H=(this.children.get(I)||new Yr(null)).setTree(qr(m),T);let Q;return H.isEmpty()?Q=this.children.remove(I):Q=this.children.insert(I,H),new Yr(this.value,Q)}}fold(m){return this.fold_(Er(),m)}fold_(m,T){const I={};return this.children.inorderTraversal((B,H)=>{I[B]=H.fold_(eo(m,B),T)}),T(m,this.value,I)}findOnPath(m,T){return this.findOnPath_(m,Er(),T)}findOnPath_(m,T,I){const B=this.value?I(T,this.value):!1;if(B)return B;if(lr(m))return null;{const H=ar(m),Q=this.children.get(H);return Q?Q.findOnPath_(qr(m),eo(T,H),I):null}}foreachOnPath(m,T){return this.foreachOnPath_(m,Er(),T)}foreachOnPath_(m,T,I){if(lr(m))return this;{this.value&&I(T,this.value);const B=ar(m),H=this.children.get(B);return H?H.foreachOnPath_(qr(m),eo(T,B),I):new Yr(null)}}foreach(m){this.foreach_(Er(),m)}foreach_(m,T){this.children.inorderTraversal((I,B)=>{B.foreach_(eo(m,I),T)}),this.value&&T(m,this.value)}foreachChild(m){this.children.inorderTraversal((T,I)=>{I.value&&m(T,I.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(m){this.writeTree_=m}static empty(){return new gu(new Yr(null))}}function yg(E,m,T){if(lr(m))return new gu(new Yr(T));{const I=E.writeTree_.findRootMostValueAndPath(m);if(I!=null){const B=I.path;let H=I.value;const Q=tl(B,m);return H=H.updateChild(Q,T),new gu(E.writeTree_.set(B,H))}else{const B=new Yr(T),H=E.writeTree_.setTree(m,B);return new gu(H)}}}function cT(E,m,T){let I=E;return nl(T,(B,H)=>{I=yg(I,eo(m,B),H)}),I}function uT(E,m){if(lr(m))return gu.empty();{const T=E.writeTree_.setTree(m,new Yr(null));return new gu(T)}}function ox(E,m){return im(E,m)!=null}function im(E,m){const T=E.writeTree_.findRootMostValueAndPath(m);return T!=null?E.writeTree_.get(T.path).getChild(tl(T.path,m)):null}function hT(E){const m=[],T=E.writeTree_.value;return T!=null?T.isLeafNode()||T.forEachChild(gs,(I,B)=>{m.push(new tr(I,B))}):E.writeTree_.children.inorderTraversal((I,B)=>{B.value!=null&&m.push(new tr(I,B.value))}),m}function Nf(E,m){if(lr(m))return E;{const T=im(E,m);return T!=null?new gu(new Yr(T)):new gu(E.writeTree_.subtree(m))}}function ax(E){return E.writeTree_.isEmpty()}function s_(E,m){return SS(Er(),E.writeTree_,m)}function SS(E,m,T){if(m.value!=null)return T.updateChild(E,m.value);{let I=null;return m.children.inorderTraversal((B,H)=>{B===".priority"?(si(H.value!==null,"Priority writes must always be leaf nodes"),I=H.value):T=SS(eo(E,B),H,T)}),!T.getChild(E).isEmpty()&&I!==null&&(T=T.updateChild(eo(E,".priority"),I)),T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dx(E,m){return IS(m,E)}function KM(E,m,T,I,B){si(I>E.lastWriteId,"Stacking an older write on top of newer ones"),B===void 0&&(B=!0),E.allWrites.push({path:m,snap:T,writeId:I,visible:B}),B&&(E.visibleWrites=yg(E.visibleWrites,m,T)),E.lastWriteId=I}function QM(E,m){for(let T=0;T<E.allWrites.length;T++){const I=E.allWrites[T];if(I.writeId===m)return I}return null}function JM(E,m){const T=E.allWrites.findIndex(o=>o.writeId===m);si(T>=0,"removeWrite called with nonexistent writeId.");const I=E.allWrites[T];E.allWrites.splice(T,1);let B=I.visible,H=!1,Q=E.allWrites.length-1;for(;B&&Q>=0;){const o=E.allWrites[Q];o.visible&&(Q>=T&&eR(o,I.path)?B=!1:mu(I.path,o.path)&&(H=!0)),Q--}if(B){if(H)return tR(E),!0;if(I.snap)E.visibleWrites=uT(E.visibleWrites,I.path);else{const o=I.children;nl(o,xe=>{E.visibleWrites=uT(E.visibleWrites,eo(I.path,xe))})}return!0}else return!1}function eR(E,m){if(E.snap)return mu(E.path,m);for(const T in E.children)if(E.children.hasOwnProperty(T)&&mu(eo(E.path,T),m))return!0;return!1}function tR(E){E.visibleWrites=ES(E.allWrites,iR,Er()),E.allWrites.length>0?E.lastWriteId=E.allWrites[E.allWrites.length-1].writeId:E.lastWriteId=-1}function iR(E){return E.visible}function ES(E,m,T){let I=gu.empty();for(let B=0;B<E.length;++B){const H=E[B];if(m(H)){const Q=H.path;let o;if(H.snap)mu(T,Q)?(o=tl(T,Q),I=yg(I,o,H.snap)):mu(Q,T)&&(o=tl(Q,T),I=yg(I,Er(),H.snap.getChild(o)));else if(H.children){if(mu(T,Q))o=tl(T,Q),I=cT(I,o,H.children);else if(mu(Q,T))if(o=tl(Q,T),lr(o))I=cT(I,Er(),H.children);else{const xe=i_(H.children,ar(o));if(xe){const pe=xe.getChild(qr(o));I=yg(I,Er(),pe)}}}else throw o_("WriteRecord should have .snap or .children")}}return I}function AS(E,m,T,I,B){if(!I&&!B){const H=im(E.visibleWrites,m);if(H!=null)return H;{const Q=Nf(E.visibleWrites,m);if(ax(Q))return T;if(T==null&&!ox(Q,Er()))return null;{const o=T||ln.EMPTY_NODE;return s_(Q,o)}}}else{const H=Nf(E.visibleWrites,m);if(!B&&ax(H))return T;if(!B&&T==null&&!ox(H,Er()))return null;{const Q=function(pe){return(pe.visible||B)&&(!I||!~I.indexOf(pe.writeId))&&(mu(pe.path,m)||mu(m,pe.path))},o=ES(E.allWrites,Q,m),xe=T||ln.EMPTY_NODE;return s_(o,xe)}}}function nR(E,m,T){let I=ln.EMPTY_NODE;const B=im(E.visibleWrites,m);if(B)return B.isLeafNode()||B.forEachChild(gs,(H,Q)=>{I=I.updateImmediateChild(H,Q)}),I;if(T){const H=Nf(E.visibleWrites,m);return T.forEachChild(gs,(Q,o)=>{const xe=s_(Nf(H,new Fr(Q)),o);I=I.updateImmediateChild(Q,xe)}),hT(H).forEach(Q=>{I=I.updateImmediateChild(Q.name,Q.node)}),I}else{const H=Nf(E.visibleWrites,m);return hT(H).forEach(Q=>{I=I.updateImmediateChild(Q.name,Q.node)}),I}}function rR(E,m,T,I,B){si(I||B,"Either existingEventSnap or existingServerSnap must exist");const H=eo(m,T);if(ox(E.visibleWrites,H))return null;{const Q=Nf(E.visibleWrites,H);return ax(Q)?B.getChild(T):s_(Q,B.getChild(T))}}function sR(E,m,T,I){const B=eo(m,T),H=im(E.visibleWrites,B);if(H!=null)return H;if(I.isCompleteForChild(T)){const Q=Nf(E.visibleWrites,B);return s_(Q,I.getNode().getImmediateChild(T))}else return null}function oR(E,m){return im(E.visibleWrites,m)}function aR(E,m,T,I,B,H,Q){let o;const xe=Nf(E.visibleWrites,m),pe=im(xe,Er());if(pe!=null)o=pe;else if(T!=null)o=s_(xe,T);else return[];if(o=o.withIndex(Q),!o.isEmpty()&&!o.isLeafNode()){const Ke=[],nt=Q.getCompare(),Je=H?o.getReverseIteratorFrom(I,Q):o.getIteratorFrom(I,Q);let Kt=Je.getNext();for(;Kt&&Ke.length<B;)nt(Kt,I)!==0&&Ke.push(Kt),Kt=Je.getNext();return Ke}else return[]}function lR(){return{visibleWrites:gu.empty(),allWrites:[],lastWriteId:-1}}function uv(E,m,T,I){return AS(E.writeTree,E.treePath,m,T,I)}function zx(E,m){return nR(E.writeTree,E.treePath,m)}function dT(E,m,T,I){return rR(E.writeTree,E.treePath,m,T,I)}function hv(E,m){return oR(E.writeTree,eo(E.treePath,m))}function cR(E,m,T,I,B,H){return aR(E.writeTree,E.treePath,m,T,I,B,H)}function Lx(E,m,T){return sR(E.writeTree,E.treePath,m,T)}function CS(E,m){return IS(eo(E.treePath,m),E.writeTree)}function IS(E,m){return{treePath:E,writeTree:m}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uR{constructor(){this.changeMap=new Map}trackChildChange(m){const T=m.type,I=m.childName;si(T==="child_added"||T==="child_changed"||T==="child_removed","Only child changes supported for tracking"),si(I!==".priority","Only non-priority child changes can be tracked.");const B=this.changeMap.get(I);if(B){const H=B.type;if(T==="child_added"&&H==="child_removed")this.changeMap.set(I,Eg(I,m.snapshotNode,B.snapshotNode));else if(T==="child_removed"&&H==="child_added")this.changeMap.delete(I);else if(T==="child_removed"&&H==="child_changed")this.changeMap.set(I,Sg(I,B.oldSnap));else if(T==="child_changed"&&H==="child_added")this.changeMap.set(I,r_(I,m.snapshotNode));else if(T==="child_changed"&&H==="child_changed")this.changeMap.set(I,Eg(I,m.snapshotNode,B.oldSnap));else throw o_("Illegal combination of changes: "+m+" occurred after "+B)}else this.changeMap.set(I,m)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{getCompleteChild(m){return null}getChildAfterChild(m,T,I){return null}}const MS=new hR;class Px{constructor(m,T,I=null){this.writes_=m,this.viewCache_=T,this.optCompleteServerCache_=I}getCompleteChild(m){const T=this.viewCache_.eventCache;if(T.isCompleteForChild(m))return T.getNode().getImmediateChild(m);{const I=this.optCompleteServerCache_!=null?new em(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Lx(this.writes_,m,I)}}getChildAfterChild(m,T,I){const B=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:tm(this.viewCache_),H=cR(this.writes_,B,T,1,I,m);return H.length===0?null:H[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dR(E){return{filter:E}}function fR(E,m){si(m.eventCache.getNode().isIndexed(E.filter.getIndex()),"Event snap not indexed"),si(m.serverCache.getNode().isIndexed(E.filter.getIndex()),"Server snap not indexed")}function pR(E,m,T,I,B){const H=new uR;let Q,o;if(T.type===_u.OVERWRITE){const pe=T;pe.source.fromUser?Q=lx(E,m,pe.path,pe.snap,I,B,H):(si(pe.source.fromServer,"Unknown source."),o=pe.source.tagged||m.serverCache.isFiltered()&&!lr(pe.path),Q=dv(E,m,pe.path,pe.snap,I,B,o,H))}else if(T.type===_u.MERGE){const pe=T;pe.source.fromUser?Q=_R(E,m,pe.path,pe.children,I,B,H):(si(pe.source.fromServer,"Unknown source."),o=pe.source.tagged||m.serverCache.isFiltered(),Q=cx(E,m,pe.path,pe.children,I,B,o,H))}else if(T.type===_u.ACK_USER_WRITE){const pe=T;pe.revert?Q=vR(E,m,pe.path,I,B,H):Q=gR(E,m,pe.path,pe.affectedTree,I,B,H)}else if(T.type===_u.LISTEN_COMPLETE)Q=yR(E,m,T.path,I,H);else throw o_("Unknown operation type: "+T.type);const xe=H.getChanges();return mR(m,Q,xe),{viewCache:Q,changes:xe}}function mR(E,m,T){const I=m.eventCache;if(I.isFullyInitialized()){const B=I.getNode().isLeafNode()||I.getNode().isEmpty(),H=sx(E);(T.length>0||!E.eventCache.isFullyInitialized()||B&&!I.getNode().equals(H)||!I.getNode().getPriority().equals(H.getPriority()))&&T.push(xS(sx(m)))}}function RS(E,m,T,I,B,H){const Q=m.eventCache;if(hv(I,T)!=null)return m;{let o,xe;if(lr(T))if(si(m.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),m.serverCache.isFiltered()){const pe=tm(m),Ke=pe instanceof ln?pe:ln.EMPTY_NODE,nt=zx(I,Ke);o=E.filter.updateFullNode(m.eventCache.getNode(),nt,H)}else{const pe=uv(I,tm(m));o=E.filter.updateFullNode(m.eventCache.getNode(),pe,H)}else{const pe=ar(T);if(pe===".priority"){si(Uf(T)===1,"Can't have a priority with additional path components");const Ke=Q.getNode();xe=m.serverCache.getNode();const nt=dT(I,T,Ke,xe);nt!=null?o=E.filter.updatePriority(Ke,nt):o=Q.getNode()}else{const Ke=qr(T);let nt;if(Q.isCompleteForChild(pe)){xe=m.serverCache.getNode();const Je=dT(I,T,Q.getNode(),xe);Je!=null?nt=Q.getNode().getImmediateChild(pe).updateChild(Ke,Je):nt=Q.getNode().getImmediateChild(pe)}else nt=Lx(I,pe,m.serverCache);nt!=null?o=E.filter.updateChild(Q.getNode(),pe,nt,Ke,B,H):o=Q.getNode()}}return gg(m,o,Q.isFullyInitialized()||lr(T),E.filter.filtersNodes())}}function dv(E,m,T,I,B,H,Q,o){const xe=m.serverCache;let pe;const Ke=Q?E.filter:E.filter.getIndexedFilter();if(lr(T))pe=Ke.updateFullNode(xe.getNode(),I,null);else if(Ke.filtersNodes()&&!xe.isFiltered()){const Kt=xe.getNode().updateChild(T,I);pe=Ke.updateFullNode(xe.getNode(),Kt,null)}else{const Kt=ar(T);if(!xe.isCompleteForPath(T)&&Uf(T)>1)return m;const pi=qr(T),Qi=xe.getNode().getImmediateChild(Kt).updateChild(pi,I);Kt===".priority"?pe=Ke.updatePriority(xe.getNode(),Qi):pe=Ke.updateChild(xe.getNode(),Kt,Qi,pi,MS,null)}const nt=TS(m,pe,xe.isFullyInitialized()||lr(T),Ke.filtersNodes()),Je=new Px(B,nt,H);return RS(E,nt,T,B,Je,o)}function lx(E,m,T,I,B,H,Q){const o=m.eventCache;let xe,pe;const Ke=new Px(B,m,H);if(lr(T))pe=E.filter.updateFullNode(m.eventCache.getNode(),I,Q),xe=gg(m,pe,!0,E.filter.filtersNodes());else{const nt=ar(T);if(nt===".priority")pe=E.filter.updatePriority(m.eventCache.getNode(),I),xe=gg(m,pe,o.isFullyInitialized(),o.isFiltered());else{const Je=qr(T),Kt=o.getNode().getImmediateChild(nt);let pi;if(lr(Je))pi=I;else{const Yt=Ke.getCompleteChild(nt);Yt!=null?hS(Je)===".priority"&&Yt.getChild(fS(Je)).isEmpty()?pi=Yt:pi=Yt.updateChild(Je,I):pi=ln.EMPTY_NODE}if(Kt.equals(pi))xe=m;else{const Yt=E.filter.updateChild(o.getNode(),nt,pi,Je,Ke,Q);xe=gg(m,Yt,o.isFullyInitialized(),E.filter.filtersNodes())}}}return xe}function fT(E,m){return E.eventCache.isCompleteForChild(m)}function _R(E,m,T,I,B,H,Q){let o=m;return I.foreach((xe,pe)=>{const Ke=eo(T,xe);fT(m,ar(Ke))&&(o=lx(E,o,Ke,pe,B,H,Q))}),I.foreach((xe,pe)=>{const Ke=eo(T,xe);fT(m,ar(Ke))||(o=lx(E,o,Ke,pe,B,H,Q))}),o}function pT(E,m,T){return T.foreach((I,B)=>{m=m.updateChild(I,B)}),m}function cx(E,m,T,I,B,H,Q,o){if(m.serverCache.getNode().isEmpty()&&!m.serverCache.isFullyInitialized())return m;let xe=m,pe;lr(T)?pe=I:pe=new Yr(null).setTree(T,I);const Ke=m.serverCache.getNode();return pe.children.inorderTraversal((nt,Je)=>{if(Ke.hasChild(nt)){const Kt=m.serverCache.getNode().getImmediateChild(nt),pi=pT(E,Kt,Je);xe=dv(E,xe,new Fr(nt),pi,B,H,Q,o)}}),pe.children.inorderTraversal((nt,Je)=>{const Kt=!m.serverCache.isCompleteForChild(nt)&&Je.value===null;if(!Ke.hasChild(nt)&&!Kt){const pi=m.serverCache.getNode().getImmediateChild(nt),Yt=pT(E,pi,Je);xe=dv(E,xe,new Fr(nt),Yt,B,H,Q,o)}}),xe}function gR(E,m,T,I,B,H,Q){if(hv(B,T)!=null)return m;const o=m.serverCache.isFiltered(),xe=m.serverCache;if(I.value!=null){if(lr(T)&&xe.isFullyInitialized()||xe.isCompleteForPath(T))return dv(E,m,T,xe.getNode().getChild(T),B,H,o,Q);if(lr(T)){let pe=new Yr(null);return xe.getNode().forEachChild(e_,(Ke,nt)=>{pe=pe.set(new Fr(Ke),nt)}),cx(E,m,T,pe,B,H,o,Q)}else return m}else{let pe=new Yr(null);return I.foreach((Ke,nt)=>{const Je=eo(T,Ke);xe.isCompleteForPath(Je)&&(pe=pe.set(Ke,xe.getNode().getChild(Je)))}),cx(E,m,T,pe,B,H,o,Q)}}function yR(E,m,T,I,B){const H=m.serverCache,Q=TS(m,H.getNode(),H.isFullyInitialized()||lr(T),H.isFiltered());return RS(E,Q,T,I,MS,B)}function vR(E,m,T,I,B,H){let Q;if(hv(I,T)!=null)return m;{const o=new Px(I,m,B),xe=m.eventCache.getNode();let pe;if(lr(T)||ar(T)===".priority"){let Ke;if(m.serverCache.isFullyInitialized())Ke=uv(I,tm(m));else{const nt=m.serverCache.getNode();si(nt instanceof ln,"serverChildren would be complete if leaf node"),Ke=zx(I,nt)}Ke=Ke,pe=E.filter.updateFullNode(xe,Ke,H)}else{const Ke=ar(T);let nt=Lx(I,Ke,m.serverCache);nt==null&&m.serverCache.isCompleteForChild(Ke)&&(nt=xe.getImmediateChild(Ke)),nt!=null?pe=E.filter.updateChild(xe,Ke,nt,qr(T),o,H):m.eventCache.getNode().hasChild(Ke)?pe=E.filter.updateChild(xe,Ke,ln.EMPTY_NODE,qr(T),o,H):pe=xe,pe.isEmpty()&&m.serverCache.isFullyInitialized()&&(Q=uv(I,tm(m)),Q.isLeafNode()&&(pe=E.filter.updateFullNode(pe,Q,H)))}return Q=m.serverCache.isFullyInitialized()||hv(I,Er())!=null,gg(m,pe,Q,E.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xR{constructor(m,T){this.query_=m,this.eventRegistrations_=[];const I=this.query_._queryParams,B=new Cx(I.getIndex()),H=NM(I);this.processor_=dR(H);const Q=T.serverCache,o=T.eventCache,xe=B.updateFullNode(ln.EMPTY_NODE,Q.getNode(),null),pe=H.updateFullNode(ln.EMPTY_NODE,o.getNode(),null),Ke=new em(xe,Q.isFullyInitialized(),B.filtersNodes()),nt=new em(pe,o.isFullyInitialized(),H.filtersNodes());this.viewCache_=xv(nt,Ke),this.eventGenerator_=new ZM(this.query_)}get query(){return this.query_}}function bR(E){return E.viewCache_.serverCache.getNode()}function wR(E,m){const T=tm(E.viewCache_);return T&&(E.query._queryParams.loadsAllData()||!lr(m)&&!T.getImmediateChild(ar(m)).isEmpty())?T.getChild(m):null}function mT(E){return E.eventRegistrations_.length===0}function TR(E,m){E.eventRegistrations_.push(m)}function _T(E,m,T){const I=[];if(T){si(m==null,"A cancel should cancel all event registrations.");const B=E.query._path;E.eventRegistrations_.forEach(H=>{const Q=H.createCancelEvent(T,B);Q&&I.push(Q)})}if(m){let B=[];for(let H=0;H<E.eventRegistrations_.length;++H){const Q=E.eventRegistrations_[H];if(!Q.matches(m))B.push(Q);else if(m.hasAnyCallback()){B=B.concat(E.eventRegistrations_.slice(H+1));break}}E.eventRegistrations_=B}else E.eventRegistrations_=[];return I}function gT(E,m,T,I){m.type===_u.MERGE&&m.source.queryId!==null&&(si(tm(E.viewCache_),"We should always have a full cache before handling merges"),si(sx(E.viewCache_),"Missing event cache, even though we have a server cache"));const B=E.viewCache_,H=pR(E.processor_,B,m,T,I);return fR(E.processor_,H.viewCache),si(H.viewCache.serverCache.isFullyInitialized()||!B.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),E.viewCache_=H.viewCache,DS(E,H.changes,H.viewCache.eventCache.getNode(),null)}function SR(E,m){const T=E.viewCache_.eventCache,I=[];return T.getNode().isLeafNode()||T.getNode().forEachChild(gs,(H,Q)=>{I.push(r_(H,Q))}),T.isFullyInitialized()&&I.push(xS(T.getNode())),DS(E,I,T.getNode(),m)}function DS(E,m,T,I){const B=I?[I]:E.eventRegistrations_;return XM(E.eventGenerator_,m,T,B)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fv;class ER{constructor(){this.views=new Map}}function AR(E){si(!fv,"__referenceConstructor has already been defined"),fv=E}function CR(){return si(fv,"Reference.ts has not been loaded"),fv}function IR(E){return E.views.size===0}function Ox(E,m,T,I){const B=m.source.queryId;if(B!==null){const H=E.views.get(B);return si(H!=null,"SyncTree gave us an op for an invalid query."),gT(H,m,T,I)}else{let H=[];for(const Q of E.views.values())H=H.concat(gT(Q,m,T,I));return H}}function MR(E,m,T,I,B){const H=m._queryIdentifier,Q=E.views.get(H);if(!Q){let o=uv(T,B?I:null),xe=!1;o?xe=!0:I instanceof ln?(o=zx(T,I),xe=!1):(o=ln.EMPTY_NODE,xe=!1);const pe=xv(new em(o,xe,!1),new em(I,B,!1));return new xR(m,pe)}return Q}function RR(E,m,T,I,B,H){const Q=MR(E,m,I,B,H);return E.views.has(m._queryIdentifier)||E.views.set(m._queryIdentifier,Q),TR(Q,T),SR(Q,T)}function DR(E,m,T,I){const B=m._queryIdentifier,H=[];let Q=[];const o=Vf(E);if(B==="default")for(const[xe,pe]of E.views.entries())Q=Q.concat(_T(pe,T,I)),mT(pe)&&(E.views.delete(xe),pe.query._queryParams.loadsAllData()||H.push(pe.query));else{const xe=E.views.get(B);xe&&(Q=Q.concat(_T(xe,T,I)),mT(xe)&&(E.views.delete(B),xe.query._queryParams.loadsAllData()||H.push(xe.query)))}return o&&!Vf(E)&&H.push(new(CR())(m._repo,m._path)),{removed:H,events:Q}}function zS(E){const m=[];for(const T of E.views.values())T.query._queryParams.loadsAllData()||m.push(T);return m}function t_(E,m){let T=null;for(const I of E.views.values())T=T||wR(I,m);return T}function LS(E,m){if(m._queryParams.loadsAllData())return bv(E);{const I=m._queryIdentifier;return E.views.get(I)}}function PS(E,m){return LS(E,m)!=null}function Vf(E){return bv(E)!=null}function bv(E){for(const m of E.views.values())if(m.query._queryParams.loadsAllData())return m;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pv;function zR(E){si(!pv,"__referenceConstructor has already been defined"),pv=E}function LR(){return si(pv,"Reference.ts has not been loaded"),pv}let PR=1;class yT{constructor(m){this.listenProvider_=m,this.syncPointTree_=new Yr(null),this.pendingWriteTree_=lR(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function OR(E,m,T,I,B){return KM(E.pendingWriteTree_,m,T,I,B),B?Pg(E,new Jp(wS(),m,T)):[]}function Km(E,m,T=!1){const I=QM(E.pendingWriteTree_,m);if(JM(E.pendingWriteTree_,m)){let H=new Yr(null);return I.snap!=null?H=H.set(Er(),!0):nl(I.children,Q=>{H=H.set(new Fr(Q),!0)}),Pg(E,new cv(I.path,H,T))}else return[]}function wv(E,m,T){return Pg(E,new Jp(Mx(),m,T))}function kR(E,m,T){const I=Yr.fromObject(T);return Pg(E,new Ig(Mx(),m,I))}function BR(E,m){return Pg(E,new Cg(Mx(),m))}function FR(E,m,T){const I=kx(E,T);if(I){const B=Bx(I),H=B.path,Q=B.queryId,o=tl(H,m),xe=new Cg(Rx(Q),o);return Fx(E,H,xe)}else return[]}function ux(E,m,T,I,B=!1){const H=m._path,Q=E.syncPointTree_.get(H);let o=[];if(Q&&(m._queryIdentifier==="default"||PS(Q,m))){const xe=DR(Q,m,T,I);IR(Q)&&(E.syncPointTree_=E.syncPointTree_.remove(H));const pe=xe.removed;if(o=xe.events,!B){const Ke=pe.findIndex(Je=>Je._queryParams.loadsAllData())!==-1,nt=E.syncPointTree_.findOnPath(H,(Je,Kt)=>Vf(Kt));if(Ke&&!nt){const Je=E.syncPointTree_.subtree(H);if(!Je.isEmpty()){const Kt=VR(Je);for(let pi=0;pi<Kt.length;++pi){const Yt=Kt[pi],Qi=Yt.query,Ji=FS(E,Yt);E.listenProvider_.startListening(vg(Qi),mv(E,Qi),Ji.hashFn,Ji.onComplete)}}}!nt&&pe.length>0&&!I&&(Ke?E.listenProvider_.stopListening(vg(m),null):pe.forEach(Je=>{const Kt=E.queryToTagMap.get(Tv(Je));E.listenProvider_.stopListening(vg(Je),Kt)}))}jR(E,pe)}return o}function NR(E,m,T,I){const B=kx(E,I);if(B!=null){const H=Bx(B),Q=H.path,o=H.queryId,xe=tl(Q,m),pe=new Jp(Rx(o),xe,T);return Fx(E,Q,pe)}else return[]}function UR(E,m,T,I){const B=kx(E,I);if(B){const H=Bx(B),Q=H.path,o=H.queryId,xe=tl(Q,m),pe=Yr.fromObject(T),Ke=new Ig(Rx(o),xe,pe);return Fx(E,Q,Ke)}else return[]}function vT(E,m,T,I=!1){const B=m._path;let H=null,Q=!1;E.syncPointTree_.foreachOnPath(B,(Je,Kt)=>{const pi=tl(Je,B);H=H||t_(Kt,pi),Q=Q||Vf(Kt)});let o=E.syncPointTree_.get(B);o?(Q=Q||Vf(o),H=H||t_(o,Er())):(o=new ER,E.syncPointTree_=E.syncPointTree_.set(B,o));let xe;H!=null?xe=!0:(xe=!1,H=ln.EMPTY_NODE,E.syncPointTree_.subtree(B).foreachChild((Kt,pi)=>{const Yt=t_(pi,Er());Yt&&(H=H.updateImmediateChild(Kt,Yt))}));const pe=PS(o,m);if(!pe&&!m._queryParams.loadsAllData()){const Je=Tv(m);si(!E.queryToTagMap.has(Je),"View does not exist, but we have a tag");const Kt=GR();E.queryToTagMap.set(Je,Kt),E.tagToQueryMap.set(Kt,Je)}const Ke=Dx(E.pendingWriteTree_,B);let nt=RR(o,m,T,Ke,H,xe);if(!pe&&!Q&&!I){const Je=LS(o,m);nt=nt.concat(HR(E,m,Je))}return nt}function OS(E,m,T){const B=E.pendingWriteTree_,H=E.syncPointTree_.findOnPath(m,(Q,o)=>{const xe=tl(Q,m),pe=t_(o,xe);if(pe)return pe});return AS(B,m,H,T,!0)}function Pg(E,m){return kS(m,E.syncPointTree_,null,Dx(E.pendingWriteTree_,Er()))}function kS(E,m,T,I){if(lr(E.path))return BS(E,m,T,I);{const B=m.get(Er());T==null&&B!=null&&(T=t_(B,Er()));let H=[];const Q=ar(E.path),o=E.operationForChild(Q),xe=m.children.get(Q);if(xe&&o){const pe=T?T.getImmediateChild(Q):null,Ke=CS(I,Q);H=H.concat(kS(o,xe,pe,Ke))}return B&&(H=H.concat(Ox(B,E,I,T))),H}}function BS(E,m,T,I){const B=m.get(Er());T==null&&B!=null&&(T=t_(B,Er()));let H=[];return m.children.inorderTraversal((Q,o)=>{const xe=T?T.getImmediateChild(Q):null,pe=CS(I,Q),Ke=E.operationForChild(Q);Ke&&(H=H.concat(BS(Ke,o,xe,pe)))}),B&&(H=H.concat(Ox(B,E,I,T))),H}function FS(E,m){const T=m.query,I=mv(E,T);return{hashFn:()=>(bR(m)||ln.EMPTY_NODE).hash(),onComplete:B=>{if(B==="ok")return I?FR(E,T._path,I):BR(E,T._path);{const H=FI(B,T);return ux(E,T,null,H)}}}}function mv(E,m){const T=Tv(m);return E.queryToTagMap.get(T)}function Tv(E){return E._path.toString()+"$"+E._queryIdentifier}function kx(E,m){return E.tagToQueryMap.get(m)}function Bx(E){const m=E.indexOf("$");return si(m!==-1&&m<E.length-1,"Bad queryKey."),{queryId:E.substr(m+1),path:new Fr(E.substr(0,m))}}function Fx(E,m,T){const I=E.syncPointTree_.get(m);si(I,"Missing sync point for query tag that we're tracking");const B=Dx(E.pendingWriteTree_,m);return Ox(I,T,B,null)}function VR(E){return E.fold((m,T,I)=>{if(T&&Vf(T))return[bv(T)];{let B=[];return T&&(B=zS(T)),nl(I,(H,Q)=>{B=B.concat(Q)}),B}})}function vg(E){return E._queryParams.loadsAllData()&&!E._queryParams.isDefault()?new(LR())(E._repo,E._path):E}function jR(E,m){for(let T=0;T<m.length;++T){const I=m[T];if(!I._queryParams.loadsAllData()){const B=Tv(I),H=E.queryToTagMap.get(B);E.queryToTagMap.delete(B),E.tagToQueryMap.delete(H)}}}function GR(){return PR++}function HR(E,m,T){const I=m._path,B=mv(E,m),H=FS(E,T),Q=E.listenProvider_.startListening(vg(m),B,H.hashFn,H.onComplete),o=E.syncPointTree_.subtree(I);if(B)si(!Vf(o.value),"If we're adding a query, it shouldn't be shadowed");else{const xe=o.fold((pe,Ke,nt)=>{if(!lr(pe)&&Ke&&Vf(Ke))return[bv(Ke).query];{let Je=[];return Ke&&(Je=Je.concat(zS(Ke).map(Kt=>Kt.query))),nl(nt,(Kt,pi)=>{Je=Je.concat(pi)}),Je}});for(let pe=0;pe<xe.length;++pe){const Ke=xe[pe];E.listenProvider_.stopListening(vg(Ke),mv(E,Ke))}}return Q}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nx{constructor(m){this.node_=m}getImmediateChild(m){const T=this.node_.getImmediateChild(m);return new Nx(T)}node(){return this.node_}}class Ux{constructor(m,T){this.syncTree_=m,this.path_=T}getImmediateChild(m){const T=eo(this.path_,m);return new Ux(this.syncTree_,T)}node(){return OS(this.syncTree_,this.path_)}}const qR=function(E){return E=E||{},E.timestamp=E.timestamp||new Date().getTime(),E},xT=function(E,m,T){if(!E||typeof E!="object")return E;if(si(".sv"in E,"Unexpected leaf node or priority contents"),typeof E[".sv"]=="string")return ZR(E[".sv"],m,T);if(typeof E[".sv"]=="object")return XR(E[".sv"],m);si(!1,"Unexpected server value: "+JSON.stringify(E,null,2))},ZR=function(E,m,T){switch(E){case"timestamp":return T.timestamp;default:si(!1,"Unexpected server value: "+E)}},XR=function(E,m,T){E.hasOwnProperty("increment")||si(!1,"Unexpected server value: "+JSON.stringify(E,null,2));const I=E.increment;typeof I!="number"&&si(!1,"Unexpected increment value: "+I);const B=m.node();if(si(B!==null&&typeof B<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!B.isLeafNode())return I;const Q=B.getValue();return typeof Q!="number"?I:Q+I},WR=function(E,m,T,I){return Vx(m,new Ux(T,E),I)},$R=function(E,m,T){return Vx(E,new Nx(m),T)};function Vx(E,m,T){const I=E.getPriority().val(),B=xT(I,m.getImmediateChild(".priority"),T);let H;if(E.isLeafNode()){const Q=E,o=xT(Q.getValue(),m,T);return o!==Q.getValue()||B!==Q.getPriority().val()?new fo(o,Qo(B)):E}else{const Q=E;return H=Q,B!==Q.getPriority().val()&&(H=H.updatePriority(new fo(B))),Q.forEachChild(gs,(o,xe)=>{const pe=Vx(xe,m.getImmediateChild(o),T);pe!==xe&&(H=H.updateImmediateChild(o,pe))}),H}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(m="",T=null,I={children:{},childCount:0}){this.name=m,this.parent=T,this.node=I}}function Gx(E,m){let T=m instanceof Fr?m:new Fr(m),I=E,B=ar(T);for(;B!==null;){const H=i_(I.node.children,B)||{children:{},childCount:0};I=new jx(B,I,H),T=qr(T),B=ar(T)}return I}function l_(E){return E.node.value}function NS(E,m){E.node.value=m,hx(E)}function US(E){return E.node.childCount>0}function YR(E){return l_(E)===void 0&&!US(E)}function Sv(E,m){nl(E.node.children,(T,I)=>{m(new jx(T,E,I))})}function VS(E,m,T,I){T&&m(E),Sv(E,B=>{VS(B,m,!0)})}function KR(E,m,T){let I=E.parent;for(;I!==null;){if(m(I))return!0;I=I.parent}return!1}function Og(E){return new Fr(E.parent===null?E.name:Og(E.parent)+"/"+E.name)}function hx(E){E.parent!==null&&QR(E.parent,E.name,E)}function QR(E,m,T){const I=YR(T),B=Ld(E.node.children,m);I&&B?(delete E.node.children[m],E.node.childCount--,hx(E)):!I&&!B&&(E.node.children[m]=T.node,E.node.childCount++,hx(E))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JR=/[\[\].#$\/\u0000-\u001F\u007F]/,eD=/[\[\].#$\u0000-\u001F\u007F]/,Z0=10*1024*1024,jS=function(E){return typeof E=="string"&&E.length!==0&&!JR.test(E)},GS=function(E){return typeof E=="string"&&E.length!==0&&!eD.test(E)},tD=function(E){return E&&(E=E.replace(/^\/*\.info(\/|$)/,"/")),GS(E)},HS=function(E,m,T){const I=T instanceof Fr?new gM(T,E):T;if(m===void 0)throw new Error(E+"contains undefined "+Yp(I));if(typeof m=="function")throw new Error(E+"contains a function "+Yp(I)+" with contents = "+m.toString());if(HT(m))throw new Error(E+"contains "+m.toString()+" "+Yp(I));if(typeof m=="string"&&m.length>Z0/3&&gv(m)>Z0)throw new Error(E+"contains a string greater than "+Z0+" utf8 bytes "+Yp(I)+" ('"+m.substring(0,50)+"...')");if(m&&typeof m=="object"){let B=!1,H=!1;if(nl(m,(Q,o)=>{if(Q===".value")B=!0;else if(Q!==".priority"&&Q!==".sv"&&(H=!0,!jS(Q)))throw new Error(E+" contains an invalid key ("+Q+") "+Yp(I)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);yM(I,Q),HS(E,o,I),vM(I)}),B&&H)throw new Error(E+' contains ".value" child '+Yp(I)+" in addition to actual children.")}},qS=function(E,m,T,I){if(!GS(T))throw new Error(PT(E,m)+'was an invalid path = "'+T+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},iD=function(E,m,T,I){T&&(T=T.replace(/^\/*\.info(\/|$)/,"/")),qS(E,m,T)},nD=function(E,m){const T=m.path.toString();if(typeof m.repoInfo.host!="string"||m.repoInfo.host.length===0||!jS(m.repoInfo.namespace)&&m.repoInfo.host.split(":")[0]!=="localhost"||T.length!==0&&!tD(T))throw new Error(PT(E,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function ZS(E,m){let T=null;for(let I=0;I<m.length;I++){const B=m[I],H=B.getPath();T!==null&&!Sx(H,T.path)&&(E.eventLists_.push(T),T=null),T===null&&(T={events:[],path:H}),T.events.push(B)}T&&E.eventLists_.push(T)}function XS(E,m,T){ZS(E,T),WS(E,I=>Sx(I,m))}function nm(E,m,T){ZS(E,T),WS(E,I=>mu(I,m)||mu(m,I))}function WS(E,m){E.recursionDepth_++;let T=!0;for(let I=0;I<E.eventLists_.length;I++){const B=E.eventLists_[I];if(B){const H=B.path;m(H)?(sD(E.eventLists_[I]),E.eventLists_[I]=null):T=!1}}T&&(E.eventLists_=[]),E.recursionDepth_--}function sD(E){for(let m=0;m<E.events.length;m++){const T=E.events[m];if(T!==null){E.events[m]=null;const I=T.getEventRunner();mg&&Ko("event: "+T.toString()),zg(I)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oD="repo_interrupt",aD=25;class lD{constructor(m,T,I,B){this.repoInfo_=m,this.forceRestClient_=T,this.authTokenProvider_=I,this.appCheckProvider_=B,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new rD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=lv(),this.transactionQueueTree_=new jx,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function cD(E,m,T){if(E.stats_=wx(E.repoInfo_),E.forceRestClient_||jI())E.server_=new av(E.repoInfo_,(I,B,H,Q)=>{bT(E,I,B,H,Q)},E.authTokenProvider_,E.appCheckProvider_),setTimeout(()=>wT(E,!0),0);else{if(typeof T<"u"&&T!==null){if(typeof T!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{mo(T)}catch(I){throw new Error("Invalid authOverride provided: "+I)}}E.persistentConnection_=new Rd(E.repoInfo_,m,(I,B,H,Q)=>{bT(E,I,B,H,Q)},I=>{wT(E,I)},I=>{hD(E,I)},E.authTokenProvider_,E.appCheckProvider_,T),E.server_=E.persistentConnection_}E.authTokenProvider_.addTokenChangeListener(I=>{E.server_.refreshAuthToken(I)}),E.appCheckProvider_.addTokenChangeListener(I=>{E.server_.refreshAppCheckToken(I.token)}),E.statsReporter_=XI(E.repoInfo_,()=>new qM(E.stats_,E.server_)),E.infoData_=new UM,E.infoSyncTree_=new yT({startListening:(I,B,H,Q)=>{let o=[];const xe=E.infoData_.getNode(I._path);return xe.isEmpty()||(o=wv(E.infoSyncTree_,I._path,xe),setTimeout(()=>{Q("ok")},0)),o},stopListening:()=>{}}),Hx(E,"connected",!1),E.serverSyncTree_=new yT({startListening:(I,B,H,Q)=>(E.server_.listen(I,H,B,(o,xe)=>{const pe=Q(o,xe);nm(E.eventQueue_,I._path,pe)}),[]),stopListening:(I,B)=>{E.server_.unlisten(I,B)}})}function uD(E){const T=E.infoData_.getNode(new Fr(".info/serverTimeOffset")).val()||0;return new Date().getTime()+T}function $S(E){return qR({timestamp:uD(E)})}function bT(E,m,T,I,B){E.dataUpdateCount++;const H=new Fr(m);T=E.interceptServerDataCallback_?E.interceptServerDataCallback_(m,T):T;let Q=[];if(B)if(I){const xe=ev(T,pe=>Qo(pe));Q=UR(E.serverSyncTree_,H,xe,B)}else{const xe=Qo(T);Q=NR(E.serverSyncTree_,H,xe,B)}else if(I){const xe=ev(T,pe=>Qo(pe));Q=kR(E.serverSyncTree_,H,xe)}else{const xe=Qo(T);Q=wv(E.serverSyncTree_,H,xe)}let o=H;Q.length>0&&(o=Zx(E,H)),nm(E.eventQueue_,o,Q)}function wT(E,m){Hx(E,"connected",m),m===!1&&fD(E)}function hD(E,m){nl(m,(T,I)=>{Hx(E,T,I)})}function Hx(E,m,T){const I=new Fr("/.info/"+m),B=Qo(T);E.infoData_.updateSnapshot(I,B);const H=wv(E.infoSyncTree_,I,B);nm(E.eventQueue_,I,H)}function dD(E){return E.nextWriteId_++}function fD(E){YS(E,"onDisconnectEvents");const m=$S(E),T=lv();rx(E.onDisconnect_,Er(),(B,H)=>{const Q=WR(B,H,E.serverSyncTree_,m);bS(T,B,Q)});let I=[];rx(T,Er(),(B,H)=>{I=I.concat(wv(E.serverSyncTree_,B,H));const Q=vD(E,B);Zx(E,Q)}),E.onDisconnect_=lv(),nm(E.eventQueue_,Er(),I)}function pD(E,m,T){let I;ar(m._path)===".info"?I=vT(E.infoSyncTree_,m,T):I=vT(E.serverSyncTree_,m,T),XS(E.eventQueue_,m._path,I)}function mD(E,m,T){let I;ar(m._path)===".info"?I=ux(E.infoSyncTree_,m,T):I=ux(E.serverSyncTree_,m,T),XS(E.eventQueue_,m._path,I)}function _D(E){E.persistentConnection_&&E.persistentConnection_.interrupt(oD)}function YS(E,...m){let T="";E.persistentConnection_&&(T=E.persistentConnection_.id+":"),Ko(T,...m)}function KS(E,m,T){return OS(E.serverSyncTree_,m,T)||ln.EMPTY_NODE}function qx(E,m=E.transactionQueueTree_){if(m||Ev(E,m),l_(m)){const T=JS(E,m);si(T.length>0,"Sending zero length transaction queue"),T.every(B=>B.status===0)&&gD(E,Og(m),T)}else US(m)&&Sv(m,T=>{qx(E,T)})}function gD(E,m,T){const I=T.map(pe=>pe.currentWriteId),B=KS(E,m,I);let H=B;const Q=B.hash();for(let pe=0;pe<T.length;pe++){const Ke=T[pe];si(Ke.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),Ke.status=1,Ke.retryCount++;const nt=tl(m,Ke.path);H=H.updateChild(nt,Ke.currentOutputSnapshotRaw)}const o=H.val(!0),xe=m;E.server_.put(xe.toString(),o,pe=>{YS(E,"transaction put response",{path:xe.toString(),status:pe});let Ke=[];if(pe==="ok"){const nt=[];for(let Je=0;Je<T.length;Je++)T[Je].status=2,Ke=Ke.concat(Km(E.serverSyncTree_,T[Je].currentWriteId)),T[Je].onComplete&&nt.push(()=>T[Je].onComplete(null,!0,T[Je].currentOutputSnapshotResolved)),T[Je].unwatcher();Ev(E,Gx(E.transactionQueueTree_,m)),qx(E,E.transactionQueueTree_),nm(E.eventQueue_,m,Ke);for(let Je=0;Je<nt.length;Je++)zg(nt[Je])}else{if(pe==="datastale")for(let nt=0;nt<T.length;nt++)T[nt].status===3?T[nt].status=4:T[nt].status=0;else{kl("transaction at "+xe.toString()+" failed: "+pe);for(let nt=0;nt<T.length;nt++)T[nt].status=4,T[nt].abortReason=pe}Zx(E,m)}},Q)}function Zx(E,m){const T=QS(E,m),I=Og(T),B=JS(E,T);return yD(E,B,I),I}function yD(E,m,T){if(m.length===0)return;const I=[];let B=[];const Q=m.filter(o=>o.status===0).map(o=>o.currentWriteId);for(let o=0;o<m.length;o++){const xe=m[o],pe=tl(T,xe.path);let Ke=!1,nt;if(si(pe!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),xe.status===4)Ke=!0,nt=xe.abortReason,B=B.concat(Km(E.serverSyncTree_,xe.currentWriteId,!0));else if(xe.status===0)if(xe.retryCount>=aD)Ke=!0,nt="maxretry",B=B.concat(Km(E.serverSyncTree_,xe.currentWriteId,!0));else{const Je=KS(E,xe.path,Q);xe.currentInputSnapshot=Je;const Kt=m[o].update(Je.val());if(Kt!==void 0){HS("transaction failed: Data returned ",Kt,xe.path);let pi=Qo(Kt);typeof Kt=="object"&&Kt!=null&&Ld(Kt,".priority")||(pi=pi.updatePriority(Je.getPriority()));const Qi=xe.currentWriteId,Ji=$S(E),Yn=$R(pi,Je,Ji);xe.currentOutputSnapshotRaw=pi,xe.currentOutputSnapshotResolved=Yn,xe.currentWriteId=dD(E),Q.splice(Q.indexOf(Qi),1),B=B.concat(OR(E.serverSyncTree_,xe.path,Yn,xe.currentWriteId,xe.applyLocally)),B=B.concat(Km(E.serverSyncTree_,Qi,!0))}else Ke=!0,nt="nodata",B=B.concat(Km(E.serverSyncTree_,xe.currentWriteId,!0))}nm(E.eventQueue_,T,B),B=[],Ke&&(m[o].status=2,function(Je){setTimeout(Je,Math.floor(0))}(m[o].unwatcher),m[o].onComplete&&(nt==="nodata"?I.push(()=>m[o].onComplete(null,!1,m[o].currentInputSnapshot)):I.push(()=>m[o].onComplete(new Error(nt),!1,null))))}Ev(E,E.transactionQueueTree_);for(let o=0;o<I.length;o++)zg(I[o]);qx(E,E.transactionQueueTree_)}function QS(E,m){let T,I=E.transactionQueueTree_;for(T=ar(m);T!==null&&l_(I)===void 0;)I=Gx(I,T),m=qr(m),T=ar(m);return I}function JS(E,m){const T=[];return eE(E,m,T),T.sort((I,B)=>I.order-B.order),T}function eE(E,m,T){const I=l_(m);if(I)for(let B=0;B<I.length;B++)T.push(I[B]);Sv(m,B=>{eE(E,B,T)})}function Ev(E,m){const T=l_(m);if(T){let I=0;for(let B=0;B<T.length;B++)T[B].status!==2&&(T[I]=T[B],I++);T.length=I,NS(m,T.length>0?T:void 0)}Sv(m,I=>{Ev(E,I)})}function vD(E,m){const T=Og(QS(E,m)),I=Gx(E.transactionQueueTree_,m);return KR(I,B=>{X0(E,B)}),X0(E,I),VS(I,B=>{X0(E,B)}),T}function X0(E,m){const T=l_(m);if(T){const I=[];let B=[],H=-1;for(let Q=0;Q<T.length;Q++)T[Q].status===3||(T[Q].status===1?(si(H===Q-1,"All SENT items should be at beginning of queue."),H=Q,T[Q].status=3,T[Q].abortReason="set"):(si(T[Q].status===0,"Unexpected transaction status in abort"),T[Q].unwatcher(),B=B.concat(Km(E.serverSyncTree_,T[Q].currentWriteId,!0)),T[Q].onComplete&&I.push(T[Q].onComplete.bind(null,new Error("set"),!1,null))));H===-1?NS(m,void 0):T.length=H+1,nm(E.eventQueue_,Og(m),B);for(let Q=0;Q<I.length;Q++)zg(I[Q])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xD(E){let m="";const T=E.split("/");for(let I=0;I<T.length;I++)if(T[I].length>0){let B=T[I];try{B=decodeURIComponent(B.replace(/\+/g," "))}catch{}m+="/"+B}return m}function bD(E){const m={};E.charAt(0)==="?"&&(E=E.substring(1));for(const T of E.split("&")){if(T.length===0)continue;const I=T.split("=");I.length===2?m[decodeURIComponent(I[0])]=decodeURIComponent(I[1]):kl(`Invalid query segment '${T}' in query '${E}'`)}return m}const TT=function(E,m){const T=wD(E),I=T.namespace;T.domain==="firebase.com"&&zd(T.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!I||I==="undefined")&&T.domain!=="localhost"&&zd("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),T.secure||LI();const B=T.scheme==="ws"||T.scheme==="wss";return{repoInfo:new iS(T.host,T.secure,I,B,m,"",I!==T.subdomain),path:new Fr(T.pathString)}},wD=function(E){let m="",T="",I="",B="",H="",Q=!0,o="https",xe=443;if(typeof E=="string"){let pe=E.indexOf("//");pe>=0&&(o=E.substring(0,pe-1),E=E.substring(pe+2));let Ke=E.indexOf("/");Ke===-1&&(Ke=E.length);let nt=E.indexOf("?");nt===-1&&(nt=E.length),m=E.substring(0,Math.min(Ke,nt)),Ke<nt&&(B=xD(E.substring(Ke,nt)));const Je=bD(E.substring(Math.min(E.length,nt)));pe=m.indexOf(":"),pe>=0?(Q=o==="https"||o==="wss",xe=parseInt(m.substring(pe+1),10)):pe=m.length;const Kt=m.slice(0,pe);if(Kt.toLowerCase()==="localhost")T="localhost";else if(Kt.split(".").length<=2)T=Kt;else{const pi=m.indexOf(".");I=m.substring(0,pi).toLowerCase(),T=m.substring(pi+1),H=I}"ns"in Je&&(H=Je.ns)}return{host:m,port:xe,domain:T,subdomain:I,secure:Q,scheme:o,pathString:B,namespace:H}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TD{constructor(m,T,I,B){this.eventType=m,this.eventRegistration=T,this.snapshot=I,this.prevName=B}getPath(){const m=this.snapshot.ref;return this.eventType==="value"?m._path:m.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+mo(this.snapshot.exportVal())}}class SD{constructor(m,T,I){this.eventRegistration=m,this.error=T,this.path=I}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ED{constructor(m,T){this.snapshotCallback=m,this.cancelCallback=T}onValue(m,T){this.snapshotCallback.call(null,m,T)}onCancel(m){return si(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,m)}get hasCancelCallback(){return!!this.cancelCallback}matches(m){return this.snapshotCallback===m.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===m.snapshotCallback.userCallback&&this.snapshotCallback.context===m.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(m,T,I,B){this._repo=m,this._path=T,this._queryParams=I,this._orderByCalled=B}get key(){return lr(this._path)?null:hS(this._path)}get ref(){return new jf(this._repo,this._path)}get _queryIdentifier(){const m=aT(this._queryParams),T=xx(m);return T==="{}"?"default":T}get _queryObject(){return aT(this._queryParams)}isEqual(m){if(m=yv(m),!(m instanceof Xx))return!1;const T=this._repo===m._repo,I=Sx(this._path,m._path),B=this._queryIdentifier===m._queryIdentifier;return T&&I&&B}toJSON(){return this.toString()}toString(){return this._repo.toString()+_M(this._path)}}class jf extends Xx{constructor(m,T){super(m,T,new Ix,!1)}get parent(){const m=fS(this._path);return m===null?null:new jf(this._repo,m)}get root(){let m=this;for(;m.parent!==null;)m=m.parent;return m}}class _v{constructor(m,T,I){this._node=m,this.ref=T,this._index=I}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(m){const T=new Fr(m),I=dx(this.ref,m);return new _v(this._node.getChild(T),I,gs)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(m){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(I,B)=>m(new _v(B,dx(this.ref,I),gs)))}hasChild(m){const T=new Fr(m);return!this._node.getChild(T).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function AD(E,m){return E=yv(E),E._checkNotDeleted("ref"),dx(E._root,m)}function dx(E,m){return E=yv(E),ar(E._path)===null?iD("child","path",m):qS("child","path",m),new jf(E._repo,eo(E._path,m))}class Wx{constructor(m){this.callbackContext=m}respondsTo(m){return m==="value"}createEvent(m,T){const I=T._queryParams.getIndex();return new TD("value",this,new _v(m.snapshotNode,new jf(T._repo,T._path),I))}getEventRunner(m){return m.getEventType()==="cancel"?()=>this.callbackContext.onCancel(m.error):()=>this.callbackContext.onValue(m.snapshot,null)}createCancelEvent(m,T){return this.callbackContext.hasCancelCallback?new SD(this,m,T):null}matches(m){return m instanceof Wx?!m.callbackContext||!this.callbackContext?!0:m.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}function CD(E,m,T,I,B){const H=new ED(T,void 0),Q=new Wx(H);return pD(E._repo,E,Q),()=>mD(E._repo,E,Q)}function ID(E,m,T,I){return CD(E,"value",m)}AR(jf);zR(jf);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MD="FIREBASE_DATABASE_EMULATOR_HOST",fx={};let RD=!1;function DD(E,m,T,I){const B=m.lastIndexOf(":"),H=m.substring(0,B),Q=yx(H);E.repoInfo_=new iS(m,Q,E.repoInfo_.namespace,E.repoInfo_.webSocketOnly,E.repoInfo_.nodeAdmin,E.repoInfo_.persistenceKey,E.repoInfo_.includeNamespaceInQueryParams,!0,T),I&&(E.authTokenProvider_=I)}function zD(E,m,T,I,B){let H=I||E.options.databaseURL;H===void 0&&(E.options.projectId||zd("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Ko("Using default host for project ",E.options.projectId),H=`${E.options.projectId}-default-rtdb.firebaseio.com`);let Q=TT(H,B),o=Q.repoInfo,xe;typeof process<"u"&&Gw&&(xe=Gw[MD]),xe?(H=`http://${xe}?ns=${o.namespace}`,Q=TT(H,B),o=Q.repoInfo):Q.repoInfo.secure;const pe=new HI(E.name,E.options,m);nD("Invalid Firebase Database URL",Q),lr(Q.path)||zd("Database URL must point to the root of a Firebase Database (not including a child path).");const Ke=PD(o,E,pe,new GI(E,T));return new OD(Ke,E)}function LD(E,m){const T=fx[m];(!T||T[E.key]!==E)&&zd(`Database ${m}(${E.repoInfo_}) has already been deleted.`),_D(E),delete T[E.key]}function PD(E,m,T,I){let B=fx[m.name];B||(B={},fx[m.name]=B);let H=B[E.toURLString()];return H&&zd("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),H=new lD(E,RD,T,I),B[E.toURLString()]=H,H}class OD{constructor(m,T){this._repoInternal=m,this.app=T,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(cD(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new jf(this._repo,Er())),this._rootInternal}_delete(){return this._rootInternal!==null&&(LD(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(m){this._rootInternal===null&&zd("Cannot call "+m+" on a deleted database.")}}function kD(E=pI(),m){const T=cI(E,"database").getImmediate({identifier:m});if(!T._instanceStarted){const I=WA("database");I&&BD(T,...I)}return T}function BD(E,m,T,I={}){E=yv(E),E._checkNotDeleted("useEmulator");const B=`${m}:${T}`,H=E._repoInternal;if(E._instanceStarted){if(B===E._repoInternal.repoInfo_.host&&tv(I,H.repoInfo_.emulatorOptions))return;zd("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let Q;if(H.repoInfo_.nodeAdmin)I.mockUserToken&&zd('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),Q=new Qy(Qy.OWNER);else if(I.mockUserToken){const o=typeof I.mockUserToken=="string"?I.mockUserToken:YA(I.mockUserToken,E.app.options.projectId);Q=new Qy(o)}yx(m)&&($A(m),JA("Database",!0)),DD(H,B,I,Q)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FD(E){CI(fI),nv(new bg("database",(m,{instanceIdentifier:T})=>{const I=m.getProvider("app").getImmediate(),B=m.getProvider("auth-internal"),H=m.getProvider("app-check-internal");return zD(I,B,H,T)},"PUBLIC").setMultipleInstances(!0)),Qm(Hw,qw,E),Qm(Hw,qw,"esm2017")}Rd.prototype.simpleListen=function(E,m){this.sendRequest("q",{p:E},m)};Rd.prototype.echo=function(E,m){this.sendRequest("echo",{d:E},m)};FD();const ND={apiKey:"AIzaSyCbMGC4ZH0F6VN5NK2Kh_9DApsoVl7l_Nk",authDomain:"incident-map-e3704.firebaseapp.com",databaseURL:"https://incident-map-e3704-default-rtdb.firebaseio.com",projectId:"incident-map-e3704",storageBucket:"incident-map-e3704.appspot.com",messagingSenderId:"1022446166679",appId:"1:1022446166679:web:99d66abf61f4634a503fd2"},UD=FT(ND),VD=kD(UD);W0.accessToken="pk.eyJ1IjoiY29ybmVsbmdvbWUiLCJhIjoiY21jdWQwNzU0MDA4cTJrc2RwNWNobnRpdiJ9.vEDhzgAltqHuBNmR9fAEuQ";const jD=()=>{const E=Yy.useRef(null),m=Yy.useRef(null);return Yy.useEffect(()=>{m.current=new W0.Map({container:E.current,style:"mapbox://styles/mapbox/light-v10",center:[36.8219,-1.2921],zoom:6}),m.current.on("load",()=>{const T=AD(VD,"incidents/");ID(T,I=>{const B=I.val();if(!B)return;const Q={type:"FeatureCollection",features:Object.values(B).filter(xe=>xe.lat&&xe.lon).map(xe=>({type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(xe.lon),parseFloat(xe.lat)]},properties:{county:xe.county||"N/A",time:xe.time||"N/A",title:xe.title||"N/A",weight:1}}))};m.current.getSource("incidents")?m.current.getSource("incidents").setData(Q):m.current.addSource("incidents",{type:"geojson",data:Q}),m.current.getLayer("heatmap")||m.current.addLayer({id:"heatmap",type:"heatmap",source:"incidents",paint:{"heatmap-weight":["get","weight"],"heatmap-intensity":["interpolate",["linear"],["zoom"],0,1,22,3],"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,22,40],"heatmap-opacity":.6,"heatmap-color":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"blue",.3,"cyan",.5,"lime",.7,"yellow",.9,"orange",1,"red"]}}),m.current.getLayer("points")||m.current.addLayer({id:"points",type:"circle",source:"incidents",paint:{"circle-radius":6,"circle-color":"#000","circle-opacity":0}});let o;m.current.on("mousemove","points",xe=>{const pe=xe.features[0].properties,Ke=xe.features[0].geometry.coordinates.slice();o&&o.remove(),o=new W0.Popup({closeButton:!1,closeOnClick:!1}).setLngLat(Ke).setHTML(`
              <div style="background-color: rgba(0,0,0,0.85); padding: 14px 16px; border-radius: 10px; color: white; font-family: sans-serif; max-width: 250px;">
                <strong>COUNTY:</strong> ${pe.county}<br/>
                <strong>TIME:</strong> ${pe.time}<br/>
                <strong>INCIDENT:</strong> ${pe.title}
              </div>
            `).addTo(m.current)}),m.current.on("mouseleave","points",()=>{o&&(o.remove(),o=null)})})})},[]),Yo.jsxs(Yo.Fragment,{children:[Yo.jsx("div",{ref:E,style:{height:"100vh",width:"100vw"}}),Yo.jsxs("div",{style:{position:"absolute",bottom:"30px",left:"20px",backgroundColor:"rgba(0, 0, 0, 0.85)",color:"#fff",padding:"18px 20px",borderRadius:"10px",fontSize:"16px",fontFamily:"sans-serif",maxWidth:"280px",lineHeight:"1.6",zIndex:1},children:[Yo.jsx("strong",{style:{fontSize:"18px",display:"block",marginBottom:"10px"},children:"Heatmap Key"}),Yo.jsxs("div",{children:[Yo.jsx("span",{style:$y("blue")})," Low Density"]}),Yo.jsxs("div",{children:[Yo.jsx("span",{style:$y("lime")})," Moderate Density"]}),Yo.jsxs("div",{children:[Yo.jsx("span",{style:$y("yellow")})," High Density"]}),Yo.jsxs("div",{children:[Yo.jsx("span",{style:$y("red")})," Critical Hotspot"]})]})]})},$y=E=>({width:"18px",height:"18px",backgroundColor:E,borderRadius:"50%",display:"inline-block",marginRight:"10px"});function GD(){return Yo.jsx(jD,{})}PA.createRoot(document.getElementById("root")).render(Yo.jsx(AA.StrictMode,{children:Yo.jsx(GD,{})}));
